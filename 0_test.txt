2025-07-08T18:47:27.8961109Z Current runner version: '2.325.0'
2025-07-08T18:47:27.8998034Z ##[group]Runner Image Provisioner
2025-07-08T18:47:27.8999656Z Hosted Compute Agent
2025-07-08T18:47:27.9000526Z Version: 20250703.357
2025-07-08T18:47:27.9001420Z Commit: 07daf62238a21140d93e045a38f3784d75c509e1
2025-07-08T18:47:27.9002702Z Build Date: 2025-07-03T14:39:09Z
2025-07-08T18:47:27.9003649Z ##[endgroup]
2025-07-08T18:47:27.9004450Z ##[group]Operating System
2025-07-08T18:47:27.9005534Z Ubuntu
2025-07-08T18:47:27.9006567Z 24.04.2
2025-07-08T18:47:27.9007290Z LTS
2025-07-08T18:47:27.9008028Z ##[endgroup]
2025-07-08T18:47:27.9008928Z ##[group]Runner Image
2025-07-08T18:47:27.9009819Z Image: ubuntu-24.04
2025-07-08T18:47:27.9010722Z Version: 20250622.1.0
2025-07-08T18:47:27.9012513Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250622.1/images/ubuntu/Ubuntu2404-Readme.md
2025-07-08T18:47:27.9015248Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250622.1
2025-07-08T18:47:27.9017176Z ##[endgroup]
2025-07-08T18:47:27.9019108Z ##[group]GITHUB_TOKEN Permissions
2025-07-08T18:47:27.9021959Z Contents: read
2025-07-08T18:47:27.9022798Z Metadata: read
2025-07-08T18:47:27.9023657Z Packages: read
2025-07-08T18:47:27.9024453Z ##[endgroup]
2025-07-08T18:47:27.9027644Z Secret source: Actions
2025-07-08T18:47:27.9028998Z Prepare workflow directory
2025-07-08T18:47:27.9497360Z Prepare all required actions
2025-07-08T18:47:27.9553669Z Getting action download info
2025-07-08T18:47:28.2847330Z ##[group]Download immutable action package 'actions/checkout@v4'
2025-07-08T18:47:28.2848429Z Version: 4.2.2
2025-07-08T18:47:28.2849610Z Digest: sha256:ccb2698953eaebd21c7bf6268a94f9c26518a7e38e27e0b83c1fe1ad049819b1
2025-07-08T18:47:28.2850791Z Source commit SHA: 11bd71901bbe5b1630ceea73d27597364c9af683
2025-07-08T18:47:28.2851540Z ##[endgroup]
2025-07-08T18:47:28.3757542Z ##[group]Download immutable action package 'actions/setup-python@v4'
2025-07-08T18:47:28.3759352Z Version: 4.9.1
2025-07-08T18:47:28.3760854Z Digest: sha256:f03e505388af670b5a108629e0ba26befc08d5c62b41f46146a45fe29ae509a5
2025-07-08T18:47:28.3762881Z Source commit SHA: 7f4fc3e22c37d6ff65e88745f38bd3157c663f7c
2025-07-08T18:47:28.3764412Z ##[endgroup]
2025-07-08T18:47:28.5904569Z ##[group]Download immutable action package 'actions/cache@v4'
2025-07-08T18:47:28.5905365Z Version: 4.2.3
2025-07-08T18:47:28.5906556Z Digest: sha256:c8a3bb963e1f1826d8fcc8d1354f0dd29d8ac1db1d4f6f20247055ae11b81ed9
2025-07-08T18:47:28.5907655Z Source commit SHA: 5a3ec84eff668545956fd18022155c47e93e2684
2025-07-08T18:47:28.5908390Z ##[endgroup]
2025-07-08T18:47:28.7097537Z ##[group]Download immutable action package 'actions/upload-artifact@v4'
2025-07-08T18:47:28.7098338Z Version: 4.6.2
2025-07-08T18:47:28.7099043Z Digest: sha256:290722aa3281d5caf23d0acdc3dbeb3424786a1a01a9cc97e72f147225e37c38
2025-07-08T18:47:28.7099958Z Source commit SHA: ea165f8d65b6e75b540449e92b4886f43607fa02
2025-07-08T18:47:28.7100618Z ##[endgroup]
2025-07-08T18:47:28.9106531Z Complete job name: test
2025-07-08T18:47:28.9803518Z ##[group]Run actions/checkout@v4
2025-07-08T18:47:28.9804437Z with:
2025-07-08T18:47:28.9804941Z   repository: jleechan2015/worldarchitect.ai
2025-07-08T18:47:28.9805906Z   token: ***
2025-07-08T18:47:28.9806362Z   ssh-strict: true
2025-07-08T18:47:28.9806797Z   ssh-user: git
2025-07-08T18:47:28.9807249Z   persist-credentials: true
2025-07-08T18:47:28.9807753Z   clean: true
2025-07-08T18:47:28.9808225Z   sparse-checkout-cone-mode: true
2025-07-08T18:47:28.9808793Z   fetch-depth: 1
2025-07-08T18:47:28.9809229Z   fetch-tags: false
2025-07-08T18:47:28.9809673Z   show-progress: true
2025-07-08T18:47:28.9810121Z   lfs: false
2025-07-08T18:47:28.9810530Z   submodules: false
2025-07-08T18:47:28.9810976Z   set-safe-directory: true
2025-07-08T18:47:28.9811728Z ##[endgroup]
2025-07-08T18:47:29.0988485Z Syncing repository: jleechan2015/worldarchitect.ai
2025-07-08T18:47:29.0991549Z ##[group]Getting Git version info
2025-07-08T18:47:29.0993394Z Working directory is '/home/runner/work/worldarchitect.ai/worldarchitect.ai'
2025-07-08T18:47:29.0997773Z [command]/usr/bin/git version
2025-07-08T18:47:29.1051647Z git version 2.49.0
2025-07-08T18:47:29.1084899Z ##[endgroup]
2025-07-08T18:47:29.1098877Z Temporarily overriding HOME='/home/runner/work/_temp/b4f0a6c6-740f-4a78-a3fd-22c706080d88' before making global git config changes
2025-07-08T18:47:29.1102549Z Adding repository directory to the temporary git global config as a safe directory
2025-07-08T18:47:29.1106913Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T18:47:29.1145946Z Deleting the contents of '/home/runner/work/worldarchitect.ai/worldarchitect.ai'
2025-07-08T18:47:29.1149210Z ##[group]Initializing the repository
2025-07-08T18:47:29.1154575Z [command]/usr/bin/git init /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T18:47:29.1221751Z hint: Using 'master' as the name for the initial branch. This default branch name
2025-07-08T18:47:29.1223883Z hint: is subject to change. To configure the initial branch name to use in all
2025-07-08T18:47:29.1227073Z hint: of your new repositories, which will suppress this warning, call:
2025-07-08T18:47:29.1228452Z hint:
2025-07-08T18:47:29.1229446Z hint: 	git config --global init.defaultBranch <name>
2025-07-08T18:47:29.1230946Z hint:
2025-07-08T18:47:29.1232050Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2025-07-08T18:47:29.1233849Z hint: 'development'. The just-created branch can be renamed via this command:
2025-07-08T18:47:29.1235209Z hint:
2025-07-08T18:47:29.1236146Z hint: 	git branch -m <name>
2025-07-08T18:47:29.1238241Z Initialized empty Git repository in /home/runner/work/worldarchitect.ai/worldarchitect.ai/.git/
2025-07-08T18:47:29.1243482Z [command]/usr/bin/git remote add origin https://github.com/jleechan2015/worldarchitect.ai
2025-07-08T18:47:29.1277425Z ##[endgroup]
2025-07-08T18:47:29.1278825Z ##[group]Disabling automatic garbage collection
2025-07-08T18:47:29.1281952Z [command]/usr/bin/git config --local gc.auto 0
2025-07-08T18:47:29.1314517Z ##[endgroup]
2025-07-08T18:47:29.1316209Z ##[group]Setting up auth
2025-07-08T18:47:29.1322591Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-07-08T18:47:29.1355565Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-07-08T18:47:29.1648014Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-07-08T18:47:29.1682064Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-07-08T18:47:29.1913511Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2025-07-08T18:47:29.1961992Z ##[endgroup]
2025-07-08T18:47:29.1964979Z ##[group]Fetching the repository
2025-07-08T18:47:29.1973342Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +3da786e8c7c8012a5ab5aaca99825c75fa4ab9a0:refs/remotes/pull/430/merge
2025-07-08T18:47:29.9635885Z From https://github.com/jleechan2015/worldarchitect.ai
2025-07-08T18:47:29.9638369Z  * [new ref]         3da786e8c7c8012a5ab5aaca99825c75fa4ab9a0 -> pull/430/merge
2025-07-08T18:47:29.9642386Z ##[endgroup]
2025-07-08T18:47:29.9644001Z ##[group]Determining the checkout info
2025-07-08T18:47:29.9647598Z ##[endgroup]
2025-07-08T18:47:29.9649854Z [command]/usr/bin/git sparse-checkout disable
2025-07-08T18:47:29.9658867Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2025-07-08T18:47:29.9691544Z ##[group]Checking out the ref
2025-07-08T18:47:29.9694544Z [command]/usr/bin/git checkout --progress --force refs/remotes/pull/430/merge
2025-07-08T18:47:30.0635515Z Note: switching to 'refs/remotes/pull/430/merge'.
2025-07-08T18:47:30.0638249Z 
2025-07-08T18:47:30.0639131Z You are in 'detached HEAD' state. You can look around, make experimental
2025-07-08T18:47:30.0641511Z changes and commit them, and you can discard any commits you make in this
2025-07-08T18:47:30.0650943Z state without impacting any branches by switching back to a branch.
2025-07-08T18:47:30.0658028Z 
2025-07-08T18:47:30.0658877Z If you want to create a new branch to retain commits you create, you may
2025-07-08T18:47:30.0660885Z do so (now or later) by using -c with the switch command. Example:
2025-07-08T18:47:30.0661896Z 
2025-07-08T18:47:30.0662397Z   git switch -c <new-branch-name>
2025-07-08T18:47:30.0663162Z 
2025-07-08T18:47:30.0663640Z Or undo this operation with:
2025-07-08T18:47:30.0664363Z 
2025-07-08T18:47:30.0664814Z   git switch -
2025-07-08T18:47:30.0665491Z 
2025-07-08T18:47:30.0666628Z Turn off this advice by setting config variable advice.detachedHead to false
2025-07-08T18:47:30.0667939Z 
2025-07-08T18:47:30.0669358Z HEAD is now at 3da786e Merge 2243bad54ce492aca3890c99f6d8d1411237b882 into 206cf39f97cecb851995f65e84dac0b4fa4f9d4c
2025-07-08T18:47:30.0673547Z ##[endgroup]
2025-07-08T18:47:30.0675978Z [command]/usr/bin/git log -1 --format=%H
2025-07-08T18:47:30.0677456Z 3da786e8c7c8012a5ab5aaca99825c75fa4ab9a0
2025-07-08T18:47:30.1123105Z ##[group]Run actions/setup-python@v4
2025-07-08T18:47:30.1124503Z with:
2025-07-08T18:47:30.1125529Z   python-version: 3.11
2025-07-08T18:47:30.1126804Z   check-latest: false
2025-07-08T18:47:30.1128153Z   token: ***
2025-07-08T18:47:30.1129242Z   update-environment: true
2025-07-08T18:47:30.1130445Z   allow-prereleases: false
2025-07-08T18:47:30.1131482Z ##[endgroup]
2025-07-08T18:47:30.3154594Z ##[group]Installed versions
2025-07-08T18:47:30.3225116Z Successfully set up CPython (3.11.13)
2025-07-08T18:47:30.3229394Z ##[endgroup]
2025-07-08T18:47:30.4973087Z ##[group]Run actions/cache@v4
2025-07-08T18:47:30.4973888Z with:
2025-07-08T18:47:30.4974523Z   path: ~/.cache/pip
2025-07-08T18:47:30.4975535Z   key: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T18:47:30.4977473Z   restore-keys: Linux-pip-

2025-07-08T18:47:30.4978235Z   enableCrossOsArchive: false
2025-07-08T18:47:30.4978994Z   fail-on-cache-miss: false
2025-07-08T18:47:30.4979710Z   lookup-only: false
2025-07-08T18:47:30.4980393Z   save-always: false
2025-07-08T18:47:30.4981056Z env:
2025-07-08T18:47:30.4981802Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:30.4982933Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T18:47:30.4984021Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:30.4985021Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:30.4986285Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:30.4987361Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T18:47:30.4988257Z ##[endgroup]
2025-07-08T18:47:30.7919785Z Cache hit for: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T18:47:31.3743931Z Received 65069192 of 65069192 (100.0%), 115.1 MBs/sec
2025-07-08T18:47:31.3748543Z Cache Size: ~62 MB (65069192 B)
2025-07-08T18:47:31.3783322Z [command]/usr/bin/tar -xf /home/runner/work/_temp/5e7ea332-134c-4e3d-88e4-b38f6b7816cf/cache.tzst -P -C /home/runner/work/worldarchitect.ai/worldarchitect.ai --use-compress-program unzstd
2025-07-08T18:47:31.5612282Z Cache restored successfully
2025-07-08T18:47:31.5930476Z Cache restored from key: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T18:47:31.6129169Z ##[group]Run python -m pip install --upgrade pip
2025-07-08T18:47:31.6130336Z [36;1mpython -m pip install --upgrade pip[0m
2025-07-08T18:47:31.6131414Z [36;1mpip install -r mvp_site/requirements.txt[0m
2025-07-08T18:47:31.6233902Z shell: /usr/bin/bash -e {0}
2025-07-08T18:47:31.6234604Z env:
2025-07-08T18:47:31.6235332Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:31.6237311Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T18:47:31.6238754Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:31.6240054Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:31.6241372Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:31.6242672Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T18:47:31.6243726Z ##[endgroup]
2025-07-08T18:47:32.3845328Z Requirement already satisfied: pip in /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages (25.1.1)
2025-07-08T18:47:33.0263664Z Collecting Flask==3.0.0 (from -r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.0279972Z   Using cached flask-3.0.0-py3-none-any.whl.metadata (3.6 kB)
2025-07-08T18:47:33.0448830Z Collecting gunicorn==21.2.0 (from -r mvp_site/requirements.txt (line 2))
2025-07-08T18:47:33.0463948Z   Using cached gunicorn-21.2.0-py3-none-any.whl.metadata (4.1 kB)
2025-07-08T18:47:33.0611507Z Collecting firebase-admin==6.5.0 (from -r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.0626599Z   Using cached firebase_admin-6.5.0-py3-none-any.whl.metadata (1.5 kB)
2025-07-08T18:47:33.0808562Z Collecting google-cloud-firestore==2.16.0 (from -r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:33.0824233Z   Using cached google_cloud_firestore-2.16.0-py2.py3-none-any.whl.metadata (5.7 kB)
2025-07-08T18:47:33.0966945Z Collecting google-genai (from -r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:33.0981315Z   Using cached google_genai-1.24.0-py3-none-any.whl.metadata (40 kB)
2025-07-08T18:47:33.2542618Z Collecting protobuf==4.25.3 (from -r mvp_site/requirements.txt (line 6))
2025-07-08T18:47:33.2558861Z   Using cached protobuf-4.25.3-cp37-abi3-manylinux2014_x86_64.whl.metadata (541 bytes)
2025-07-08T18:47:33.2709227Z Collecting Flask-Cors==4.0.0 (from -r mvp_site/requirements.txt (line 7))
2025-07-08T18:47:33.2723544Z   Using cached Flask_Cors-4.0.0-py2.py3-none-any.whl.metadata (5.4 kB)
2025-07-08T18:47:33.2881666Z Collecting fpdf2 (from -r mvp_site/requirements.txt (line 8))
2025-07-08T18:47:33.2904089Z   Using cached fpdf2-2.8.3-py2.py3-none-any.whl.metadata (69 kB)
2025-07-08T18:47:33.3053148Z Collecting python-docx (from -r mvp_site/requirements.txt (line 9))
2025-07-08T18:47:33.3067823Z   Using cached python_docx-1.2.0-py3-none-any.whl.metadata (2.0 kB)
2025-07-08T18:47:33.3248130Z Collecting google-cloud-secret-manager (from -r mvp_site/requirements.txt (line 10))
2025-07-08T18:47:33.3265095Z   Using cached google_cloud_secret_manager-2.24.0-py3-none-any.whl.metadata (9.7 kB)
2025-07-08T18:47:33.3625447Z Collecting selenium (from -r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:33.3986381Z   Downloading selenium-4.34.2-py3-none-any.whl.metadata (7.5 kB)
2025-07-08T18:47:33.4222900Z Collecting Werkzeug>=3.0.0 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.4239226Z   Using cached werkzeug-3.1.3-py3-none-any.whl.metadata (3.7 kB)
2025-07-08T18:47:33.4430409Z Collecting Jinja2>=3.1.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.4475336Z   Using cached jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
2025-07-08T18:47:33.4606303Z Collecting itsdangerous>=2.1.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.4611462Z   Using cached itsdangerous-2.2.0-py3-none-any.whl.metadata (1.9 kB)
2025-07-08T18:47:33.4767096Z Collecting click>=8.1.3 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.4807016Z   Using cached click-8.2.1-py3-none-any.whl.metadata (2.5 kB)
2025-07-08T18:47:33.4922176Z Collecting blinker>=1.6.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:33.4946019Z   Using cached blinker-1.9.0-py3-none-any.whl.metadata (1.6 kB)
2025-07-08T18:47:33.5130406Z Collecting packaging (from gunicorn==21.2.0->-r mvp_site/requirements.txt (line 2))
2025-07-08T18:47:33.5145297Z   Using cached packaging-25.0-py3-none-any.whl.metadata (3.3 kB)
2025-07-08T18:47:33.5277260Z Collecting cachecontrol>=0.12.6 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.5291176Z   Using cached cachecontrol-0.14.3-py3-none-any.whl.metadata (3.1 kB)
2025-07-08T18:47:33.5899036Z Collecting google-api-python-client>=1.7.8 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.5954984Z   Downloading google_api_python_client-2.176.0-py3-none-any.whl.metadata (7.0 kB)
2025-07-08T18:47:33.6236722Z Collecting google-cloud-storage>=1.37.1 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.6275459Z   Downloading google_cloud_storage-3.2.0-py3-none-any.whl.metadata (13 kB)
2025-07-08T18:47:33.6459554Z Collecting pyjwt>=2.5.0 (from pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.6474516Z   Using cached PyJWT-2.10.1-py3-none-any.whl.metadata (4.0 kB)
2025-07-08T18:47:33.6859891Z Collecting google-api-core<3.0.0dev,>=1.22.1 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.6880416Z   Using cached google_api_core-2.25.1-py3-none-any.whl.metadata (3.0 kB)
2025-07-08T18:47:33.8217865Z Collecting google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:33.8242752Z   Using cached google_auth-2.40.3-py2.py3-none-any.whl.metadata (6.2 kB)
2025-07-08T18:47:33.8466024Z Collecting google-cloud-core<3.0.0dev,>=1.4.1 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:33.8481434Z   Using cached google_cloud_core-2.4.3-py2.py3-none-any.whl.metadata (2.7 kB)
2025-07-08T18:47:33.8676046Z Collecting proto-plus<2.0.0dev,>=1.22.0 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:33.8691085Z   Using cached proto_plus-1.26.1-py3-none-any.whl.metadata (2.2 kB)
2025-07-08T18:47:33.9089190Z Collecting googleapis-common-protos<2.0.0,>=1.56.2 (from google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:33.9102174Z   Using cached googleapis_common_protos-1.70.0-py3-none-any.whl.metadata (9.3 kB)
2025-07-08T18:47:33.9998755Z Collecting requests<3.0.0,>=2.18.0 (from google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.0015597Z   Using cached requests-2.32.4-py3-none-any.whl.metadata (4.9 kB)
2025-07-08T18:47:34.4639632Z Collecting grpcio<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.4657055Z   Using cached grpcio-1.73.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.8 kB)
2025-07-08T18:47:34.5438736Z Collecting grpcio-status<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.5454180Z   Using cached grpcio_status-1.73.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.5782192Z Collecting cachetools<6.0,>=2.0.0 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:34.5797377Z   Using cached cachetools-5.5.2-py3-none-any.whl.metadata (5.4 kB)
2025-07-08T18:47:34.5962576Z Collecting pyasn1-modules>=0.2.1 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:34.5976614Z   Using cached pyasn1_modules-0.4.2-py3-none-any.whl.metadata (3.5 kB)
2025-07-08T18:47:34.6109890Z Collecting rsa<5,>=3.1.4 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:34.6123988Z   Using cached rsa-4.9.1-py3-none-any.whl.metadata (5.6 kB)
2025-07-08T18:47:34.7003675Z INFO: pip is looking at multiple versions of grpcio-status to determine which version is compatible with other requirements. This could take a while.
2025-07-08T18:47:34.7010400Z Collecting grpcio-status<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.7026282Z   Using cached grpcio_status-1.73.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7066326Z   Using cached grpcio_status-1.72.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7104846Z   Using cached grpcio_status-1.72.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7143580Z   Using cached grpcio_status-1.71.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7387405Z   Using cached grpcio_status-1.71.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7425264Z   Using cached grpcio_status-1.70.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7463378Z   Using cached grpcio_status-1.69.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7488355Z INFO: pip is still looking at multiple versions of grpcio-status to determine which version is compatible with other requirements. This could take a while.
2025-07-08T18:47:34.7505453Z   Using cached grpcio_status-1.68.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7543232Z   Using cached grpcio_status-1.68.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7580730Z   Using cached grpcio_status-1.67.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7618515Z   Using cached grpcio_status-1.67.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7656067Z   Using cached grpcio_status-1.66.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7682477Z INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. See https://pip.pypa.io/warnings/backtracking for guidance. If you want to abort this run, press Ctrl + C.
2025-07-08T18:47:34.7698998Z   Using cached grpcio_status-1.66.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7736867Z   Using cached grpcio_status-1.66.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7774781Z   Using cached grpcio_status-1.65.5-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7812777Z   Using cached grpcio_status-1.65.4-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7850534Z   Using cached grpcio_status-1.65.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7887819Z   Using cached grpcio_status-1.65.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7924988Z   Using cached grpcio_status-1.64.3-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.7964048Z   Using cached grpcio_status-1.64.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.8018970Z   Using cached grpcio_status-1.64.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.8074891Z   Using cached grpcio_status-1.63.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.8113058Z   Using cached grpcio_status-1.63.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T18:47:34.8150544Z   Using cached grpcio_status-1.62.3-py3-none-any.whl.metadata (1.3 kB)
2025-07-08T18:47:34.9473546Z Collecting charset_normalizer<4,>=2 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.9488870Z   Using cached charset_normalizer-3.4.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (35 kB)
2025-07-08T18:47:34.9692492Z Collecting idna<4,>=2.5 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.9707253Z   Using cached idna-3.10-py3-none-any.whl.metadata (10 kB)
2025-07-08T18:47:34.9957103Z Collecting urllib3<3,>=1.21.1 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:34.9971113Z   Using cached urllib3-2.5.0-py3-none-any.whl.metadata (6.5 kB)
2025-07-08T18:47:35.0150275Z Collecting certifi>=2017.4.17 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:35.0166355Z   Using cached certifi-2025.6.15-py3-none-any.whl.metadata (2.4 kB)
2025-07-08T18:47:35.0378064Z Collecting pyasn1>=0.1.3 (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T18:47:35.0391917Z   Using cached pyasn1-0.6.1-py3-none-any.whl.metadata (8.4 kB)
2025-07-08T18:47:35.0594589Z Collecting anyio<5.0.0,>=4.8.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.0609119Z   Using cached anyio-4.9.0-py3-none-any.whl.metadata (4.7 kB)
2025-07-08T18:47:35.0816635Z Collecting httpx<1.0.0,>=0.28.1 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.0830933Z   Using cached httpx-0.28.1-py3-none-any.whl.metadata (7.1 kB)
2025-07-08T18:47:35.1859626Z Collecting pydantic<3.0.0,>=2.0.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.1878430Z   Using cached pydantic-2.11.7-py3-none-any.whl.metadata (67 kB)
2025-07-08T18:47:35.2143900Z Collecting tenacity<9.0.0,>=8.2.3 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.2160244Z   Using cached tenacity-8.5.0-py3-none-any.whl.metadata (1.2 kB)
2025-07-08T18:47:35.2977384Z Collecting websockets<15.1.0,>=13.0.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.2994501Z   Using cached websockets-15.0.1-cp311-cp311-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.8 kB)
2025-07-08T18:47:35.3162587Z Collecting typing-extensions<5.0.0,>=4.11.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.3199548Z   Downloading typing_extensions-4.14.1-py3-none-any.whl.metadata (3.0 kB)
2025-07-08T18:47:35.3347171Z Collecting sniffio>=1.1 (from anyio<5.0.0,>=4.8.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.3361273Z   Using cached sniffio-1.3.1-py3-none-any.whl.metadata (3.9 kB)
2025-07-08T18:47:35.3580560Z Collecting httpcore==1.* (from httpx<1.0.0,>=0.28.1->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.3595020Z   Using cached httpcore-1.0.9-py3-none-any.whl.metadata (21 kB)
2025-07-08T18:47:35.3704591Z Collecting h11>=0.16 (from httpcore==1.*->httpx<1.0.0,>=0.28.1->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.3720575Z   Using cached h11-0.16.0-py3-none-any.whl.metadata (8.3 kB)
2025-07-08T18:47:35.3814646Z Collecting annotated-types>=0.6.0 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:35.3827895Z   Using cached annotated_types-0.7.0-py3-none-any.whl.metadata (15 kB)
2025-07-08T18:47:36.0349159Z Collecting pydantic-core==2.33.2 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:36.0366443Z   Using cached pydantic_core-2.33.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.8 kB)
2025-07-08T18:47:36.0496169Z Collecting typing-inspection>=0.4.0 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T18:47:36.0510638Z   Using cached typing_inspection-0.4.1-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T18:47:36.0709993Z Collecting defusedxml (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T18:47:36.0724594Z   Using cached defusedxml-0.7.1-py2.py3-none-any.whl.metadata (32 kB)
2025-07-08T18:47:36.2300436Z Collecting Pillow!=9.2.*,>=6.2.2 (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T18:47:36.2317624Z   Using cached pillow-11.3.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (9.0 kB)
2025-07-08T18:47:36.3626607Z Collecting fonttools>=4.34.0 (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T18:47:36.3668694Z   Downloading fonttools-4.58.5-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (106 kB)
2025-07-08T18:47:36.6431775Z Collecting lxml>=3.1.0 (from python-docx->-r mvp_site/requirements.txt (line 9))
2025-07-08T18:47:36.6448958Z   Using cached lxml-6.0.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (6.6 kB)
2025-07-08T18:47:36.6646928Z Collecting grpc-google-iam-v1<1.0.0,>=0.14.0 (from google-cloud-secret-manager->-r mvp_site/requirements.txt (line 10))
2025-07-08T18:47:36.6661702Z   Using cached grpc_google_iam_v1-0.14.2-py3-none-any.whl.metadata (9.1 kB)
2025-07-08T18:47:36.7183982Z Collecting trio~=0.30.0 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.7199569Z   Using cached trio-0.30.0-py3-none-any.whl.metadata (8.5 kB)
2025-07-08T18:47:36.7309276Z Collecting trio-websocket~=0.12.2 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.7323575Z   Using cached trio_websocket-0.12.2-py3-none-any.whl.metadata (5.1 kB)
2025-07-08T18:47:36.7583590Z Collecting websocket-client~=1.8.0 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.7596692Z   Using cached websocket_client-1.8.0-py3-none-any.whl.metadata (8.0 kB)
2025-07-08T18:47:36.7735075Z Collecting attrs>=23.2.0 (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.7749917Z   Using cached attrs-25.3.0-py3-none-any.whl.metadata (10 kB)
2025-07-08T18:47:36.7918931Z Collecting sortedcontainers (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.7933143Z   Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl.metadata (10 kB)
2025-07-08T18:47:36.8014215Z Collecting outcome (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.8028430Z   Using cached outcome-1.3.0.post0-py2.py3-none-any.whl.metadata (2.6 kB)
2025-07-08T18:47:36.8168450Z Collecting wsproto>=0.14 (from trio-websocket~=0.12.2->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.8182851Z   Using cached wsproto-1.2.0-py3-none-any.whl.metadata (5.6 kB)
2025-07-08T18:47:36.8294901Z Collecting pysocks!=1.5.7,<2.0,>=1.5.6 (from urllib3[socks]~=2.5.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T18:47:36.8309235Z   Using cached PySocks-1.7.1-py3-none-any.whl.metadata (13 kB)
2025-07-08T18:47:36.9091549Z Collecting msgpack<2.0.0,>=0.5.2 (from cachecontrol>=0.12.6->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:36.9108860Z   Using cached msgpack-1.1.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (8.4 kB)
2025-07-08T18:47:36.9317639Z Collecting httplib2<1.0.0,>=0.19.0 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:36.9330821Z   Using cached httplib2-0.22.0-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T18:47:36.9713805Z Collecting google-auth-httplib2<1.0.0,>=0.2.0 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:36.9728221Z   Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl.metadata (2.2 kB)
2025-07-08T18:47:36.9822047Z Collecting uritemplate<5,>=3.0.1 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:36.9836660Z   Using cached uritemplate-4.2.0-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T18:47:37.0168284Z Collecting pyparsing!=3.0.0,!=3.0.1,!=3.0.2,!=3.0.3,<4,>=2.4.2 (from httplib2<1.0.0,>=0.19.0->google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.0182334Z   Using cached pyparsing-3.2.3-py3-none-any.whl.metadata (5.0 kB)
2025-07-08T18:47:37.0591423Z Collecting google-resumable-media<3.0.0,>=2.7.2 (from google-cloud-storage>=1.37.1->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.0606169Z   Using cached google_resumable_media-2.7.2-py2.py3-none-any.whl.metadata (2.2 kB)
2025-07-08T18:47:37.1107286Z Collecting google-crc32c<2.0.0,>=1.1.3 (from google-cloud-storage>=1.37.1->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.1122801Z   Using cached google_crc32c-1.7.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (2.3 kB)
2025-07-08T18:47:37.1907325Z Collecting MarkupSafe>=2.0 (from Jinja2>=3.1.2->Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T18:47:37.1923665Z   Using cached MarkupSafe-3.0.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.0 kB)
2025-07-08T18:47:37.3813028Z Collecting cryptography>=3.4.0 (from pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.3852836Z   Downloading cryptography-45.0.5-cp311-abi3-manylinux_2_34_x86_64.whl.metadata (5.7 kB)
2025-07-08T18:47:37.5584691Z Collecting cffi>=1.14 (from cryptography>=3.4.0->pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.5602250Z   Using cached cffi-1.17.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (1.5 kB)
2025-07-08T18:47:37.5712046Z Collecting pycparser (from cffi>=1.14->cryptography>=3.4.0->pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T18:47:37.5726544Z   Using cached pycparser-2.22-py3-none-any.whl.metadata (943 bytes)
2025-07-08T18:47:37.5986911Z Using cached flask-3.0.0-py3-none-any.whl (99 kB)
2025-07-08T18:47:37.6001439Z Using cached gunicorn-21.2.0-py3-none-any.whl (80 kB)
2025-07-08T18:47:37.6015429Z Using cached firebase_admin-6.5.0-py3-none-any.whl (126 kB)
2025-07-08T18:47:37.6030868Z Using cached google_cloud_firestore-2.16.0-py2.py3-none-any.whl (317 kB)
2025-07-08T18:47:37.6047063Z Using cached protobuf-4.25.3-cp37-abi3-manylinux2014_x86_64.whl (294 kB)
2025-07-08T18:47:37.6062370Z Using cached Flask_Cors-4.0.0-py2.py3-none-any.whl (14 kB)
2025-07-08T18:47:37.6075943Z Using cached google_api_core-2.25.1-py3-none-any.whl (160 kB)
2025-07-08T18:47:37.6091042Z Using cached google_auth-2.40.3-py2.py3-none-any.whl (216 kB)
2025-07-08T18:47:37.6105930Z Using cached cachetools-5.5.2-py3-none-any.whl (10 kB)
2025-07-08T18:47:37.6119742Z Using cached google_cloud_core-2.4.3-py2.py3-none-any.whl (29 kB)
2025-07-08T18:47:37.6133504Z Using cached googleapis_common_protos-1.70.0-py3-none-any.whl (294 kB)
2025-07-08T18:47:37.6149561Z Using cached grpcio-1.73.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (6.0 MB)
2025-07-08T18:47:37.6204865Z Using cached grpcio_status-1.62.3-py3-none-any.whl (14 kB)
2025-07-08T18:47:37.6218444Z Using cached proto_plus-1.26.1-py3-none-any.whl (50 kB)
2025-07-08T18:47:37.6232207Z Using cached requests-2.32.4-py3-none-any.whl (64 kB)
2025-07-08T18:47:37.6246741Z Using cached charset_normalizer-3.4.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (147 kB)
2025-07-08T18:47:37.6261210Z Using cached idna-3.10-py3-none-any.whl (70 kB)
2025-07-08T18:47:37.6275274Z Using cached rsa-4.9.1-py3-none-any.whl (34 kB)
2025-07-08T18:47:37.6322736Z Downloading urllib3-2.5.0-py3-none-any.whl (129 kB)
2025-07-08T18:47:37.6371978Z Using cached google_genai-1.24.0-py3-none-any.whl (226 kB)
2025-07-08T18:47:37.6387067Z Using cached anyio-4.9.0-py3-none-any.whl (100 kB)
2025-07-08T18:47:37.6401230Z Using cached httpx-0.28.1-py3-none-any.whl (73 kB)
2025-07-08T18:47:37.6415417Z Using cached httpcore-1.0.9-py3-none-any.whl (78 kB)
2025-07-08T18:47:37.6429867Z Using cached pydantic-2.11.7-py3-none-any.whl (444 kB)
2025-07-08T18:47:37.6446786Z Using cached pydantic_core-2.33.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.0 MB)
2025-07-08T18:47:37.6474096Z Using cached tenacity-8.5.0-py3-none-any.whl (28 kB)
2025-07-08T18:47:37.6605919Z Downloading typing_extensions-4.14.1-py3-none-any.whl (43 kB)
2025-07-08T18:47:37.6643650Z Using cached websockets-15.0.1-cp311-cp311-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-07-08T18:47:37.6658759Z Using cached fpdf2-2.8.3-py2.py3-none-any.whl (245 kB)
2025-07-08T18:47:37.6673738Z Using cached python_docx-1.2.0-py3-none-any.whl (252 kB)
2025-07-08T18:47:37.6688952Z Using cached google_cloud_secret_manager-2.24.0-py3-none-any.whl (218 kB)
2025-07-08T18:47:37.6703781Z Using cached grpc_google_iam_v1-0.14.2-py3-none-any.whl (19 kB)
2025-07-08T18:47:37.6742215Z Downloading selenium-4.34.2-py3-none-any.whl (9.4 MB)
2025-07-08T18:47:37.7270047Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 9.4/9.4 MB 191.7 MB/s eta 0:00:00
2025-07-08T18:47:37.7283220Z Using cached trio-0.30.0-py3-none-any.whl (499 kB)
2025-07-08T18:47:37.7300305Z Using cached trio_websocket-0.12.2-py3-none-any.whl (21 kB)
2025-07-08T18:47:37.7314198Z Using cached PySocks-1.7.1-py3-none-any.whl (16 kB)
2025-07-08T18:47:37.7328254Z Using cached websocket_client-1.8.0-py3-none-any.whl (58 kB)
2025-07-08T18:47:37.7342214Z Using cached annotated_types-0.7.0-py3-none-any.whl (13 kB)
2025-07-08T18:47:37.7356017Z Using cached attrs-25.3.0-py3-none-any.whl (63 kB)
2025-07-08T18:47:37.7370146Z Using cached blinker-1.9.0-py3-none-any.whl (8.5 kB)
2025-07-08T18:47:37.7383962Z Using cached cachecontrol-0.14.3-py3-none-any.whl (21 kB)
2025-07-08T18:47:37.7398061Z Using cached msgpack-1.1.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (429 kB)
2025-07-08T18:47:37.7414564Z Using cached certifi-2025.6.15-py3-none-any.whl (157 kB)
2025-07-08T18:47:37.7429591Z Using cached click-8.2.1-py3-none-any.whl (102 kB)
2025-07-08T18:47:37.7471292Z Downloading fonttools-4.58.5-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (5.0 MB)
2025-07-08T18:47:37.7830534Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 5.0/5.0 MB 144.2 MB/s eta 0:00:00
2025-07-08T18:47:37.7870429Z Downloading google_api_python_client-2.176.0-py3-none-any.whl (13.7 MB)
2025-07-08T18:47:37.8670737Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13.7/13.7 MB 176.5 MB/s eta 0:00:00
2025-07-08T18:47:37.8686463Z Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl (9.3 kB)
2025-07-08T18:47:37.8700553Z Using cached httplib2-0.22.0-py3-none-any.whl (96 kB)
2025-07-08T18:47:37.8714923Z Using cached pyparsing-3.2.3-py3-none-any.whl (111 kB)
2025-07-08T18:47:37.8729761Z Using cached uritemplate-4.2.0-py3-none-any.whl (11 kB)
2025-07-08T18:47:37.8771843Z Downloading google_cloud_storage-3.2.0-py3-none-any.whl (176 kB)
2025-07-08T18:47:37.8814442Z Using cached google_crc32c-1.7.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (32 kB)
2025-07-08T18:47:37.8829031Z Using cached google_resumable_media-2.7.2-py2.py3-none-any.whl (81 kB)
2025-07-08T18:47:37.8843456Z Using cached h11-0.16.0-py3-none-any.whl (37 kB)
2025-07-08T18:47:37.8857426Z Using cached itsdangerous-2.2.0-py3-none-any.whl (16 kB)
2025-07-08T18:47:37.8871033Z Using cached jinja2-3.1.6-py3-none-any.whl (134 kB)
2025-07-08T18:47:37.8885846Z Using cached lxml-6.0.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (5.2 MB)
2025-07-08T18:47:37.8936211Z Using cached MarkupSafe-3.0.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (23 kB)
2025-07-08T18:47:37.8950375Z Using cached outcome-1.3.0.post0-py2.py3-none-any.whl (10 kB)
2025-07-08T18:47:37.8964205Z Using cached pillow-11.3.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (6.6 MB)
2025-07-08T18:47:37.9023577Z Using cached pyasn1-0.6.1-py3-none-any.whl (83 kB)
2025-07-08T18:47:37.9037626Z Using cached pyasn1_modules-0.4.2-py3-none-any.whl (181 kB)
2025-07-08T18:47:37.9053508Z Using cached PyJWT-2.10.1-py3-none-any.whl (22 kB)
2025-07-08T18:47:37.9099231Z Downloading cryptography-45.0.5-cp311-abi3-manylinux_2_34_x86_64.whl (4.5 MB)
2025-07-08T18:47:37.9314702Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.5/4.5 MB 221.7 MB/s eta 0:00:00
2025-07-08T18:47:37.9327707Z Using cached cffi-1.17.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (467 kB)
2025-07-08T18:47:37.9344532Z Using cached sniffio-1.3.1-py3-none-any.whl (10 kB)
2025-07-08T18:47:37.9358625Z Using cached typing_inspection-0.4.1-py3-none-any.whl (14 kB)
2025-07-08T18:47:37.9372425Z Using cached werkzeug-3.1.3-py3-none-any.whl (224 kB)
2025-07-08T18:47:37.9387832Z Using cached wsproto-1.2.0-py3-none-any.whl (24 kB)
2025-07-08T18:47:37.9402408Z Using cached defusedxml-0.7.1-py2.py3-none-any.whl (25 kB)
2025-07-08T18:47:37.9416300Z Using cached packaging-25.0-py3-none-any.whl (66 kB)
2025-07-08T18:47:37.9430443Z Using cached pycparser-2.22-py3-none-any.whl (117 kB)
2025-07-08T18:47:37.9444857Z Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl (29 kB)
2025-07-08T18:47:38.1460061Z Installing collected packages: sortedcontainers, websockets, websocket-client, urllib3, uritemplate, typing-extensions, tenacity, sniffio, pysocks, pyparsing, pyjwt, pycparser, pyasn1, protobuf, Pillow, packaging, msgpack, MarkupSafe, lxml, itsdangerous, idna, h11, grpcio, google-crc32c, fonttools, defusedxml, click, charset_normalizer, certifi, cachetools, blinker, attrs, annotated-types, wsproto, Werkzeug, typing-inspection, rsa, requests, python-docx, pydantic-core, pyasn1-modules, proto-plus, outcome, Jinja2, httplib2, httpcore, gunicorn, googleapis-common-protos, google-resumable-media, fpdf2, cffi, anyio, trio, pydantic, httpx, grpcio-status, google-auth, Flask, cryptography, cachecontrol, trio-websocket, grpc-google-iam-v1, google-genai, google-auth-httplib2, google-api-core, Flask-Cors, selenium, google-cloud-core, google-api-python-client, google-cloud-storage, google-cloud-secret-manager, google-cloud-firestore, firebase-admin
2025-07-08T18:47:44.2163021Z 
2025-07-08T18:47:44.2203994Z Successfully installed Flask-3.0.0 Flask-Cors-4.0.0 Jinja2-3.1.6 MarkupSafe-3.0.2 Pillow-11.3.0 Werkzeug-3.1.3 annotated-types-0.7.0 anyio-4.9.0 attrs-25.3.0 blinker-1.9.0 cachecontrol-0.14.3 cachetools-5.5.2 certifi-2025.6.15 cffi-1.17.1 charset_normalizer-3.4.2 click-8.2.1 cryptography-45.0.5 defusedxml-0.7.1 firebase-admin-6.5.0 fonttools-4.58.5 fpdf2-2.8.3 google-api-core-2.25.1 google-api-python-client-2.176.0 google-auth-2.40.3 google-auth-httplib2-0.2.0 google-cloud-core-2.4.3 google-cloud-firestore-2.16.0 google-cloud-secret-manager-2.24.0 google-cloud-storage-3.2.0 google-crc32c-1.7.1 google-genai-1.24.0 google-resumable-media-2.7.2 googleapis-common-protos-1.70.0 grpc-google-iam-v1-0.14.2 grpcio-1.73.1 grpcio-status-1.62.3 gunicorn-21.2.0 h11-0.16.0 httpcore-1.0.9 httplib2-0.22.0 httpx-0.28.1 idna-3.10 itsdangerous-2.2.0 lxml-6.0.0 msgpack-1.1.1 outcome-1.3.0.post0 packaging-25.0 proto-plus-1.26.1 protobuf-4.25.3 pyasn1-0.6.1 pyasn1-modules-0.4.2 pycparser-2.22 pydantic-2.11.7 pydantic-core-2.33.2 pyjwt-2.10.1 pyparsing-3.2.3 pysocks-1.7.1 python-docx-1.2.0 requests-2.32.4 rsa-4.9.1 selenium-4.34.2 sniffio-1.3.1 sortedcontainers-2.4.0 tenacity-8.5.0 trio-0.30.0 trio-websocket-0.12.2 typing-extensions-4.14.1 typing-inspection-0.4.1 uritemplate-4.2.0 urllib3-2.5.0 websocket-client-1.8.0 websockets-15.0.1 wsproto-1.2.0
2025-07-08T18:47:44.9909289Z ##[group]Run # Find all test files in mvp_site/tests directory, excluding integration and manual tests
2025-07-08T18:47:44.9909974Z [36;1m# Find all test files in mvp_site/tests directory, excluding integration and manual tests[0m
2025-07-08T18:47:44.9910743Z [36;1mtest_files=$(find mvp_site/tests -name "test_*.py" -type f ! -path "*/integration/*" ! -path "*/test_integration/*" ! -path "*/manual_tests/*" ! -name "*integration*" | sort)[0m
2025-07-08T18:47:44.9911337Z [36;1m[0m
2025-07-08T18:47:44.9911513Z [36;1m# Run each test file[0m
2025-07-08T18:47:44.9911737Z [36;1mfailed_tests=0[0m
2025-07-08T18:47:44.9911940Z [36;1mtotal_tests=0[0m
2025-07-08T18:47:44.9912319Z [36;1mfailed_list=""[0m
2025-07-08T18:47:44.9912518Z [36;1m[0m
2025-07-08T18:47:44.9912710Z [36;1mfor test_file in $test_files; do[0m
2025-07-08T18:47:44.9912970Z [36;1m  echo "Running $test_file..."[0m
2025-07-08T18:47:44.9913239Z [36;1m  total_tests=$((total_tests + 1))[0m
2025-07-08T18:47:44.9913508Z [36;1m  [0m
2025-07-08T18:47:44.9913712Z [36;1m  if TESTING=true python "$test_file"; then[0m
2025-07-08T18:47:44.9914002Z [36;1m    echo "✅ $test_file passed"[0m
2025-07-08T18:47:44.9914245Z [36;1m  else[0m
2025-07-08T18:47:44.9914437Z [36;1m    echo "❌ $test_file failed"[0m
2025-07-08T18:47:44.9914704Z [36;1m    failed_tests=$((failed_tests + 1))[0m
2025-07-08T18:47:44.9915005Z [36;1m    failed_list="$failed_list\n  - $test_file"[0m
2025-07-08T18:47:44.9915273Z [36;1m  fi[0m
2025-07-08T18:47:44.9915484Z [36;1m  echo "----------------------------------------"[0m
2025-07-08T18:47:44.9916038Z [36;1mdone[0m
2025-07-08T18:47:44.9916222Z [36;1m[0m
2025-07-08T18:47:44.9916394Z [36;1m# Summary[0m
2025-07-08T18:47:44.9916578Z [36;1mecho ""[0m
2025-07-08T18:47:44.9916790Z [36;1mecho "========================================"[0m
2025-07-08T18:47:44.9917179Z [36;1mecho "TEST SUMMARY: $((total_tests - failed_tests))/$total_tests tests passed"[0m
2025-07-08T18:47:44.9917578Z [36;1mecho "========================================"[0m
2025-07-08T18:47:44.9917834Z [36;1m[0m
2025-07-08T18:47:44.9918029Z [36;1mif [ $failed_tests -gt 0 ]; then[0m
2025-07-08T18:47:44.9918270Z [36;1m  echo ""[0m
2025-07-08T18:47:44.9918483Z [36;1m  echo "Failed tests:$failed_list"[0m
2025-07-08T18:47:44.9918725Z [36;1m  echo ""[0m
2025-07-08T18:47:44.9918952Z [36;1m  echo "Note: Some tests may fail in CI due to:"[0m
2025-07-08T18:47:44.9919299Z [36;1m  echo "  - Missing local services (e.g., test server)"[0m
2025-07-08T18:47:44.9919617Z [36;1m  echo "  - Test isolation issues"[0m
2025-07-08T18:47:44.9919887Z [36;1m  echo "  - Timing-sensitive tests"[0m
2025-07-08T18:47:44.9920143Z [36;1m  exit 1[0m
2025-07-08T18:47:44.9920323Z [36;1mfi[0m
2025-07-08T18:47:44.9977569Z shell: /usr/bin/bash -e {0}
2025-07-08T18:47:44.9977805Z env:
2025-07-08T18:47:44.9978050Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:44.9978476Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T18:47:44.9978876Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:44.9979230Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:44.9998609Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:47:44.9999255Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T18:47:44.9999755Z   TESTING: true
2025-07-08T18:47:45.0000047Z ##[endgroup]
2025-07-08T18:47:45.0117079Z Running mvp_site/tests/auth/test_auth_resilience.py...
2025-07-08T18:47:45.1684573Z test_clock_skew_auto_retry_mechanism (__main__.AuthResilienceTest.test_clock_skew_auto_retry_mechanism)
2025-07-08T18:47:45.1688232Z 🔴 RED TEST: Verify that clock skew errors trigger auto-retry ... ok
2025-07-08T18:47:45.1691172Z test_connection_status_monitoring (__main__.AuthResilienceTest.test_connection_status_monitoring)
2025-07-08T18:47:45.1692837Z 🔴 RED TEST: Verify that connection status is monitored for smart UI adaptations ... ok
2025-07-08T18:47:45.1693941Z test_integrated_resilience_workflow (__main__.AuthResilienceTest.test_integrated_resilience_workflow)
2025-07-08T18:47:45.1702515Z 🟢 GREEN TEST: Test the complete resilience workflow end-to-end ... ok
2025-07-08T18:47:45.1703338Z test_offline_campaign_caching (__main__.AuthResilienceTest.test_offline_campaign_caching)
2025-07-08T18:47:45.1704318Z 🔴 RED TEST: Verify that successful campaign data is cached for offline viewing ... ok
2025-07-08T18:47:45.1705218Z test_user_friendly_error_messages (__main__.AuthResilienceTest.test_user_friendly_error_messages)
2025-07-08T18:47:45.1706728Z 🔴 RED TEST: Verify that user gets helpful error messages instead of generic failures ... ok
2025-07-08T18:47:45.1707471Z 
2025-07-08T18:47:45.1707668Z ----------------------------------------------------------------------
2025-07-08T18:47:45.1708130Z Ran 5 tests in 0.001s
2025-07-08T18:47:45.1708326Z 
2025-07-08T18:47:45.1708426Z OK
2025-07-08T18:47:45.1708574Z 
2025-07-08T18:47:45.1708724Z ============================================================
2025-07-08T18:47:45.1709244Z 🧪 AUTHENTICATION RESILIENCE: RED/GREEN TEST SUITE
2025-07-08T18:47:45.1709684Z ============================================================
2025-07-08T18:47:45.1710220Z 🔴 RED TEST: Testing clock skew auto-retry mechanism
2025-07-08T18:47:45.1710754Z ✅ Auto-retry mechanism implementation found
2025-07-08T18:47:45.1711271Z 🔴 RED TEST: Testing connection status monitoring
2025-07-08T18:47:45.1711803Z ✅ Connection status monitoring implementation found
2025-07-08T18:47:45.1712362Z 🟢 GREEN TEST: Testing integrated resilience workflow
2025-07-08T18:47:45.1712902Z ✅ All resilience components properly integrated
2025-07-08T18:47:45.1713427Z 🔴 RED TEST: Testing offline campaign caching
2025-07-08T18:47:45.1713940Z ✅ Offline campaign caching implementation found
2025-07-08T18:47:45.1714473Z 🔴 RED TEST: Testing user-friendly error messaging
2025-07-08T18:47:45.1715020Z ✅ User-friendly error messaging implementation found
2025-07-08T18:47:45.1715358Z 
2025-07-08T18:47:45.1715491Z ============================================================
2025-07-08T18:47:45.1716382Z 🟢 GREEN STATE ACHIEVED: All resilience features implemented correctly!
2025-07-08T18:47:45.1716942Z ✅ 5 tests passed
2025-07-08T18:47:45.1717110Z 
2025-07-08T18:47:45.1717320Z 🎯 RESILIENCE FEATURES VALIDATED:
2025-07-08T18:47:45.1717749Z    • JWT clock skew auto-retry ✅
2025-07-08T18:47:45.1718171Z    • User-friendly error messages ✅
2025-07-08T18:47:45.1718598Z    • Offline campaign caching ✅
2025-07-08T18:47:45.1719003Z    • Connection status monitoring ✅
2025-07-08T18:47:45.1719415Z    • Integrated workflow ✅
2025-07-08T18:47:45.1719755Z ============================================================
2025-07-08T18:47:45.1837148Z ✅ mvp_site/tests/auth/test_auth_resilience.py passed
2025-07-08T18:47:45.1838579Z ----------------------------------------
2025-07-08T18:47:45.1839086Z Running mvp_site/tests/test_age_field_validation.py...
2025-07-08T18:47:45.4246909Z .........
2025-07-08T18:47:45.4247421Z ----------------------------------------------------------------------
2025-07-08T18:47:45.4247917Z Ran 9 tests in 0.001s
2025-07-08T18:47:45.4248119Z 
2025-07-08T18:47:45.4248221Z OK
2025-07-08T18:47:45.4580825Z ✅ mvp_site/tests/test_age_field_validation.py passed
2025-07-08T18:47:45.4597998Z ----------------------------------------
2025-07-08T18:47:45.4599750Z Running mvp_site/tests/test_always_json_mode.py...
2025-07-08T18:47:46.1592731Z .2025-07-08 18:47:46,158 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T18:47:46.1596140Z 2025-07-08 18:47:46,159 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:47:46.1601484Z 2025-07-08 18:47:46,159 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:47:46.1607533Z 2025-07-08 18:47:46,160 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T18:47:46.1623410Z 2025-07-08 18:47:46,161 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:47:46.1624635Z 2025-07-08 18:47:46,161 - INFO - Added LLM-generated standard planning block
2025-07-08T18:47:46.1633967Z .2025-07-08 18:47:46,163 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T18:47:46.1636796Z 2025-07-08 18:47:46,163 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:47:46.1648439Z 2025-07-08 18:47:46,164 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:47:46.1655305Z 2025-07-08 18:47:46,165 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:47:46.1662777Z 2025-07-08 18:47:46,165 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:47:46.1663715Z 2025-07-08 18:47:46,165 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T18:47:46.1664634Z 2025-07-08 18:47:46,165 - INFO - Starting dual-pass generation
2025-07-08T18:47:46.1665330Z 2025-07-08 18:47:46,165 - INFO - Pass 1: Generating initial narrative
2025-07-08T18:47:46.1666395Z 2025-07-08 18:47:46,165 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:47:46.1667526Z 2025-07-08 18:47:46,165 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:47:46.1668390Z 2025-07-08 18:47:46,166 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:47:46.1670133Z 2025-07-08 18:47:46,166 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T18:47:46.1671325Z 2025-07-08 18:47:46,166 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T18:47:46.1672231Z 2025-07-08 18:47:46,166 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:47:46.1673656Z 2025-07-08 18:47:46,166 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:47:46.1674597Z 2025-07-08 18:47:46,166 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:47:46.1675909Z 2025-07-08 18:47:46,166 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T18:47:46.1682036Z 2025-07-08 18:47:46,166 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T18:47:46.1683432Z 2025-07-08 18:47:46,166 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:47:46.1684667Z 2025-07-08 18:47:46,166 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:47:46.1685585Z 2025-07-08 18:47:46,166 - INFO - Planning block found in response
2025-07-08T18:47:46.1687310Z ...
2025-07-08T18:47:46.1687636Z ----------------------------------------------------------------------
2025-07-08T18:47:46.1688099Z Ran 5 tests in 0.009s
2025-07-08T18:47:46.1688300Z 
2025-07-08T18:47:46.1688414Z OK
2025-07-08T18:47:46.2546902Z ✅ mvp_site/tests/test_always_json_mode.py passed
2025-07-08T18:47:46.2548464Z ----------------------------------------
2025-07-08T18:47:46.2549016Z Running mvp_site/tests/test_animation_system.py...
2025-07-08T18:47:46.3199827Z test_accessibility_features (__main__.TestAnimationSystem.test_accessibility_features)
2025-07-08T18:47:46.3204447Z Test that accessibility features are properly implemented ... ok
2025-07-08T18:47:46.3206677Z test_animation_css_exists_and_valid (__main__.TestAnimationSystem.test_animation_css_exists_and_valid)
2025-07-08T18:47:46.3207754Z Test that animation CSS file exists and contains expected animations ... ok
2025-07-08T18:47:46.3209277Z test_animation_css_syntax_validation (__main__.TestAnimationSystem.test_animation_css_syntax_validation)
2025-07-08T18:47:46.3210791Z Test CSS syntax is valid (basic validation) ... ok
2025-07-08T18:47:46.3212936Z test_animation_js_exists_and_valid (__main__.TestAnimationSystem.test_animation_js_exists_and_valid)
2025-07-08T18:47:46.3213818Z Test that animation JavaScript file exists and is valid ... ok
2025-07-08T18:47:46.3215012Z test_animation_performance_properties (__main__.TestAnimationSystem.test_animation_performance_properties)
2025-07-08T18:47:46.3218443Z Test that performance-enhancing CSS properties are present ... ok
2025-07-08T18:47:46.3219868Z test_index_html_includes_animation_files (__main__.TestAnimationSystem.test_index_html_includes_animation_files)
2025-07-08T18:47:46.3221217Z Test that index.html includes animation CSS and JS ... ok
2025-07-08T18:47:46.3222566Z test_javascript_error_handling (__main__.TestAnimationSystem.test_javascript_error_handling)
2025-07-08T18:47:46.3224238Z Test that JavaScript has proper error handling patterns ... ok
2025-07-08T18:47:46.3225353Z test_theme_specific_animations (__main__.TestAnimationSystem.test_theme_specific_animations)
2025-07-08T18:47:46.3226883Z Test that theme-specific animations are included ... ok
2025-07-08T18:47:46.3228265Z test_animation_system_compatibility (__main__.TestAnimationIntegration.test_animation_system_compatibility)
2025-07-08T18:47:46.3229570Z Test that animation system doesn't conflict with existing app.js ... ok
2025-07-08T18:47:46.3230824Z test_loading_order_in_html (__main__.TestAnimationIntegration.test_loading_order_in_html)
2025-07-08T18:47:46.3234323Z Test that scripts are loaded in correct order ... ok
2025-07-08T18:47:46.3235032Z test_css_file_size (__main__.TestAnimationPerformance.test_css_file_size)
2025-07-08T18:47:46.3236056Z Test that CSS file size is reasonable ... ok
2025-07-08T18:47:46.3236871Z test_css_selector_efficiency (__main__.TestAnimationPerformance.test_css_selector_efficiency)
2025-07-08T18:47:46.3237678Z Test that CSS selectors are efficient ... ok
2025-07-08T18:47:46.3238399Z test_javascript_file_size (__main__.TestAnimationPerformance.test_javascript_file_size)
2025-07-08T18:47:46.3239152Z Test that JavaScript file size is reasonable ... ok
2025-07-08T18:47:46.3240037Z test_animation_duration_variables (__main__.TestAnimationFunctionality.test_animation_duration_variables)
2025-07-08T18:47:46.3257097Z Test that animation duration variables are properly defined ... ok
2025-07-08T18:47:46.3258056Z 🧪 Running Animation System Tests...
2025-07-08T18:47:46.3258579Z ✅ All animation tests passed!
2025-07-08T18:47:46.3259296Z test_javascript_api_methods (__main__.TestAnimationFunctionality.test_javascript_api_methods)
2025-07-08T18:47:46.3260432Z Test that JavaScript API provides expected methods ... ok
2025-07-08T18:47:46.3261376Z test_keyframe_animations_defined (__main__.TestAnimationFunctionality.test_keyframe_animations_defined)
2025-07-08T18:47:46.3262296Z Test that essential keyframe animations are defined ... ok
2025-07-08T18:47:46.3262689Z 
2025-07-08T18:47:46.3262904Z ----------------------------------------------------------------------
2025-07-08T18:47:46.3263369Z Ran 16 tests in 0.004s
2025-07-08T18:47:46.3263593Z 
2025-07-08T18:47:46.3263701Z OK
2025-07-08T18:47:46.3360953Z ✅ mvp_site/tests/test_animation_system.py passed
2025-07-08T18:47:46.3362263Z ----------------------------------------
2025-07-08T18:47:46.3362732Z Running mvp_site/tests/test_api_routes.py...
2025-07-08T18:47:47.3060098Z ......Traceback (most recent call last):
2025-07-08T18:47:47.3072461Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 615, in update_campaign
2025-07-08T18:47:47.3073717Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T18:47:47.3074921Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T18:47:47.3079040Z     return self._mock_call(*args, **kwargs)
2025-07-08T18:47:47.3079549Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:47:47.3080470Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T18:47:47.3081433Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T18:47:47.3081951Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:47:47.3082936Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T18:47:47.3084102Z     raise effect
2025-07-08T18:47:47.3084470Z Exception: Update error
2025-07-08T18:47:47.3219648Z ...2025-07-08 18:47:47,321 - INFO - Received custom_options: ['destinySystem']
2025-07-08T18:47:47.3221899Z 2025-07-08 18:47:47,321 - INFO - Selected attribute_system: D&D
2025-07-08T18:47:47.3272044Z .2025-07-08 18:47:47,327 - INFO - Received custom_options: []
2025-07-08T18:47:47.3274154Z 2025-07-08 18:47:47,327 - INFO - Selected attribute_system: D&D
2025-07-08T18:47:47.3375461Z ..2025-07-08 18:47:47,337 - INFO - Received custom_options: ['destinySystem', 'companions', 'defaultWorld']
2025-07-08T18:47:47.3378206Z 2025-07-08 18:47:47,337 - INFO - Selected attribute_system: D&D
2025-07-08T18:47:47.3429890Z .2025-07-08 18:47:47,342 - INFO - Received custom_options: []
2025-07-08T18:47:47.3435135Z 2025-07-08 18:47:47,343 - INFO - Selected attribute_system: <MagicMock name='constants.ATTRIBUTE_SYSTEM_DND' id='140060049294992'>
2025-07-08T18:47:47.3548711Z ..2025-07-08 18:47:47,354 - INFO - Exporting file '/tmp/campaign_exports/7a508756-580a-48e9-8644-ccd0ae7935f3.pdf' with download_name='Test Campaign.pdf'
2025-07-08T18:47:47.3594739Z ..
2025-07-08T18:47:47.3596176Z ----------------------------------------------------------------------
2025-07-08T18:47:47.3596905Z Ran 17 tests in 0.089s
2025-07-08T18:47:47.3598333Z 
2025-07-08T18:47:47.3598683Z OK
2025-07-08T18:47:47.5032822Z ✅ mvp_site/tests/test_api_routes.py passed
2025-07-08T18:47:47.5034283Z ----------------------------------------
2025-07-08T18:47:47.5034834Z Running mvp_site/tests/test_architectural_decisions.py...
2025-07-08T18:47:47.6349773Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6353161Z   @validator('strength', pre=True)
2025-07-08T18:47:47.6358208Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6367963Z   @validator('dexterity', pre=True)
2025-07-08T18:47:47.6370712Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6373473Z   @validator('constitution', pre=True)
2025-07-08T18:47:47.6376357Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6379058Z   @validator('intelligence', pre=True)
2025-07-08T18:47:47.6382033Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6384700Z   @validator('wisdom', pre=True)
2025-07-08T18:47:47.6387421Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6390126Z   @validator('charisma', pre=True)
2025-07-08T18:47:47.6539956Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6543324Z   @validator('hp', pre=True)
2025-07-08T18:47:47.6547560Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6550539Z   @validator('hp_max', pre=True)
2025-07-08T18:47:47.6553378Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6556615Z   @validator('temp_hp', pre=True)
2025-07-08T18:47:47.6585216Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6588062Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T18:47:47.6617847Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6622208Z   @validator('level', pre=True)
2025-07-08T18:47:47.6624912Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6627856Z   @validator('gender')
2025-07-08T18:47:47.6630512Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6633509Z   @validator('age')
2025-07-08T18:47:47.6639885Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6642633Z   @validator('mbti')
2025-07-08T18:47:47.6645276Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6648484Z   @validator('alignment')
2025-07-08T18:47:47.6651153Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6653837Z   @validator('entity_type')
2025-07-08T18:47:47.6798256Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6803086Z   @validator('participants')
2025-07-08T18:47:47.6815240Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6821141Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T18:47:47.6824200Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:47.6827135Z   @validator('present_entities')
2025-07-08T18:47:47.6882804Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:47.6888516Z ..
2025-07-08T18:47:47.6888912Z ----------------------------------------------------------------------
2025-07-08T18:47:47.6889389Z Ran 6 tests in 0.147s
2025-07-08T18:47:47.6889578Z 
2025-07-08T18:47:47.6889683Z OK
2025-07-08T18:47:47.7110702Z ✅ mvp_site/tests/test_architectural_decisions.py passed
2025-07-08T18:47:47.7112224Z ----------------------------------------
2025-07-08T18:47:47.7112776Z Running mvp_site/tests/test_banned_name_prevention_v2.py...
2025-07-08T18:47:47.7493229Z ....
2025-07-08T18:47:47.7494592Z ----------------------------------------------------------------------
2025-07-08T18:47:47.7495136Z Ran 4 tests in 0.002s
2025-07-08T18:47:47.7495347Z 
2025-07-08T18:47:47.7495458Z OK
2025-07-08T18:47:47.7552666Z ✅ mvp_site/tests/test_banned_name_prevention_v2.py passed
2025-07-08T18:47:47.7553986Z ----------------------------------------
2025-07-08T18:47:47.7554864Z Running mvp_site/tests/test_banned_names_loading.py...
2025-07-08T18:47:47.8018036Z ........
2025-07-08T18:47:47.8019420Z ----------------------------------------------------------------------
2025-07-08T18:47:47.8019932Z Ran 8 tests in 0.001s
2025-07-08T18:47:47.8020145Z 
2025-07-08T18:47:47.8020268Z OK
2025-07-08T18:47:47.8090767Z ✅ mvp_site/tests/test_banned_names_loading.py passed
2025-07-08T18:47:47.8092061Z ----------------------------------------
2025-07-08T18:47:47.8092622Z Running mvp_site/tests/test_banned_names_visibility_v2.py...
2025-07-08T18:47:47.8528386Z ...
2025-07-08T18:47:47.8529805Z ----------------------------------------------------------------------
2025-07-08T18:47:47.8530336Z Ran 3 tests in 0.002s
2025-07-08T18:47:47.8530952Z 
2025-07-08T18:47:47.8531059Z OK
2025-07-08T18:47:47.8598590Z ✅ mvp_site/tests/test_banned_names_visibility_v2.py passed
2025-07-08T18:47:47.8599914Z ----------------------------------------
2025-07-08T18:47:47.8600435Z Running mvp_site/tests/test_campaign_clicks.py...
2025-07-08T18:47:47.9253458Z ....
2025-07-08T18:47:47.9254882Z ----------------------------------------------------------------------
2025-07-08T18:47:47.9255387Z Ran 4 tests in 0.001s
2025-07-08T18:47:47.9255594Z 
2025-07-08T18:47:47.9256466Z OK
2025-07-08T18:47:47.9359439Z ✅ mvp_site/tests/test_campaign_clicks.py passed
2025-07-08T18:47:47.9360754Z ----------------------------------------
2025-07-08T18:47:47.9361275Z Running mvp_site/tests/test_combat_bug_green.py...
2025-07-08T18:47:47.9794644Z test_cleanup_defeated_enemies_handles_list_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_handles_list_combatants)
2025-07-08T18:47:47.9797276Z GREEN TEST: This should PASS without errors ... ok
2025-07-08T18:47:47.9798424Z test_cleanup_defeated_enemies_preserves_dict_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_preserves_dict_combatants)
2025-07-08T18:47:47.9799531Z Verify that dict format still works correctly (regression test) ... ok
2025-07-08T18:47:47.9800488Z test_cleanup_with_complex_list_structure (__main__.TestCombatBugGreen.test_cleanup_with_complex_list_structure)
2025-07-08T18:47:47.9801368Z Test with more complex list structure that AI might generate ... ok
2025-07-08T18:47:47.9801767Z 
2025-07-08T18:47:47.9801973Z ----------------------------------------------------------------------
2025-07-08T18:47:47.9802418Z Ran 3 tests in 0.000s
2025-07-08T18:47:47.9802623Z 
2025-07-08T18:47:47.9802734Z OK
2025-07-08T18:47:47.9803252Z ======================================================================
2025-07-08T18:47:47.9804127Z 🟢 RUNNING GREEN TEST - THIS SHOULD PASS!
2025-07-08T18:47:47.9805910Z If this test PASSES, the bug is fixed.
2025-07-08T18:47:47.9807184Z ======================================================================
2025-07-08T18:47:47.9807523Z 
2025-07-08T18:47:47.9807925Z ✅ GREEN TEST: Attempting to call cleanup_defeated_enemies()...
2025-07-08T18:47:47.9808574Z Expected: No errors, returns list of defeated enemies
2025-07-08T18:47:47.9809260Z ✅ Successfully cleaned up defeated enemies: ['Dragon']
2025-07-08T18:47:47.9809966Z ✅ Combatants normalized to dict format and Dragon removed
2025-07-08T18:47:47.9810354Z 
2025-07-08T18:47:47.9810657Z ✅ Dict format still works correctly (no regression)
2025-07-08T18:47:47.9811008Z 
2025-07-08T18:47:47.9811262Z ✅ Complex list structure handled correctly
2025-07-08T18:47:47.9875482Z ✅ mvp_site/tests/test_combat_bug_green.py passed
2025-07-08T18:47:47.9876948Z ----------------------------------------
2025-07-08T18:47:47.9877519Z Running mvp_site/tests/test_combat_cleanup_comprehensive.py...
2025-07-08T18:47:48.9320869Z test_automatic_cleanup_via_state_updates_hp_defeat (__main__.TestCombatCleanupComprehensive.test_automatic_cleanup_via_state_updates_hp_defeat)
2025-07-08T18:47:48.9323110Z Test: Enemy defeated via AI HP update should be automatically cleaned up. ... 2025-07-08 18:47:48,931 - INFO - COMBAT STARTED - Participants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T18:47:48.9325094Z 2025-07-08 18:47:48,932 - INFO - COMBAT INITIALIZED - Initiative order: ['Hero(18)', 'Orc Warrior(14)', 'Goblin(12)']
2025-07-08T18:47:48.9326535Z 2025-07-08 18:47:48,932 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9327463Z   "combat_state": {
2025-07-08T18:47:48.9327970Z     "combatants": {
2025-07-08T18:47:48.9328304Z       "Orc Warrior": {
2025-07-08T18:47:48.9328640Z         "hp_current": 0,
2025-07-08T18:47:48.9328962Z         "status": [
2025-07-08T18:47:48.9329265Z           "bloodied",
2025-07-08T18:47:48.9329582Z           "unconscious"
2025-07-08T18:47:48.9329890Z         ]
2025-07-08T18:47:48.9330157Z       }
2025-07-08T18:47:48.9330419Z     }
2025-07-08T18:47:48.9330670Z   }
2025-07-08T18:47:48.9331167Z }
2025-07-08T18:47:48.9377183Z 2025-07-08 18:47:48,933 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9378006Z   "combatants": {
2025-07-08T18:47:48.9378484Z     "Orc Warrior": {
2025-07-08T18:47:48.9378956Z       "hp_current": 0,
2025-07-08T18:47:48.9379414Z       "status": [
2025-07-08T18:47:48.9379846Z         "bloodied",
2025-07-08T18:47:48.9380282Z         "unconscious"
2025-07-08T18:47:48.9380708Z       ]
2025-07-08T18:47:48.9381071Z     }
2025-07-08T18:47:48.9381427Z   }
2025-07-08T18:47:48.9381775Z }
2025-07-08T18:47:48.9382334Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9383081Z   "Orc Warrior": {
2025-07-08T18:47:48.9383499Z     "hp_current": 0,
2025-07-08T18:47:48.9383904Z     "status": [
2025-07-08T18:47:48.9384281Z       "bloodied",
2025-07-08T18:47:48.9384684Z       "unconscious"
2025-07-08T18:47:48.9385073Z     ]
2025-07-08T18:47:48.9385424Z   }
2025-07-08T18:47:48.9385959Z Running comprehensive combat cleanup tests
2025-07-08T18:47:48.9386556Z These tests verify the automatic cleanup system works correctly
2025-07-08T18:47:48.9387129Z ======================================================================
2025-07-08T18:47:48.9387468Z 
2025-07-08T18:47:48.9387665Z Testing: Automatic cleanup via HP state updates
2025-07-08T18:47:48.9388175Z Initial combatants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T18:47:48.9388690Z Initial NPC data: ['Orc Warrior', 'Goblin', 'Merchant']
2025-07-08T18:47:48.9389517Z AI proposed changes: {'combat_state': {'combatants': {'Orc Warrior': {'hp_current': 0, 'status': ['bloodied', 'unconscious']}}}}
2025-07-08T18:47:48.9390367Z After automatic cleanup - Combatants: ['Hero', 'Goblin']
2025-07-08T18:47:48.9391035Z }
2025-07-08T18:47:48.9391397Z After automatic cleanup - NPCs: ['Goblin', 'Merchant']
2025-07-08T18:47:48.9392129Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9392580Z 
2025-07-08T18:47:48.9392883Z   "hp_current": 0,
2025-07-08T18:47:48.9393281Z Testing: Cleanup without explicit combat state changes
2025-07-08T18:47:48.9393732Z Before update - Troll HP: 0
2025-07-08T18:47:48.9394114Z Before update - Combatants: ['Ranger', 'Troll']
2025-07-08T18:47:48.9394572Z After update - Combatants: ['Ranger']
2025-07-08T18:47:48.9395077Z   "status": [
2025-07-08T18:47:48.9395252Z 
2025-07-08T18:47:48.9395468Z     "bloodied",
2025-07-08T18:47:48.9410220Z Testing: Combat end with pre-defeated enemies
2025-07-08T18:47:48.9410856Z Before combat end - Combatants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T18:47:48.9411384Z Dead Orc HP: 0
2025-07-08T18:47:48.9411686Z After combat end - In combat: False
2025-07-08T18:47:48.9412164Z After combat end - Combatants: ['Player', 'Living Wolf']
2025-07-08T18:47:48.9412514Z 
2025-07-08T18:47:48.9412668Z Testing: Multiple simultaneous defeats
2025-07-08T18:47:48.9413247Z Before fireball - Combatants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T18:47:48.9413879Z After fireball - Combatants: ['Wizard', 'Orc Chief']
2025-07-08T18:47:48.9414395Z After fireball - NPCs: ['Orc Chief', 'Village Elder']
2025-07-08T18:47:48.9414904Z     "unconscious"
2025-07-08T18:47:48.9415174Z   ]
2025-07-08T18:47:48.9415403Z }
2025-07-08T18:47:48.9416186Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9416828Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9417434Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9418032Z 2025-07-08 18:47:48,934 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9418787Z 2025-07-08 18:47:48,934 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T18:47:48.9419589Z 2025-07-08 18:47:48,934 - INFO - COMBAT CLEANUP: Marking Orc Warrior (enemy) as defeated
2025-07-08T18:47:48.9420385Z 2025-07-08 18:47:48,934 - INFO - COMBAT CLEANUP: Removed Orc Warrior from combat_state.combatants
2025-07-08T18:47:48.9421374Z 2025-07-08 18:47:48,934 - INFO - COMBAT CLEANUP: Removed Orc Warrior from npc_data
2025-07-08T18:47:48.9422141Z 2025-07-08 18:47:48,934 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Orc Warrior']
2025-07-08T18:47:48.9422717Z ok
2025-07-08T18:47:48.9423546Z test_cleanup_without_explicit_combat_state_changes (__main__.TestCombatCleanupComprehensive.test_cleanup_without_explicit_combat_state_changes)
2025-07-08T18:47:48.9425074Z Test: Cleanup should trigger even when combat_state isn't explicitly in proposed_changes. ... 2025-07-08 18:47:48,934 - INFO - COMBAT STARTED - Participants: ['Ranger', 'Troll']
2025-07-08T18:47:48.9456517Z 2025-07-08 18:47:48,935 - INFO - COMBAT INITIALIZED - Initiative order: ['Ranger(16)', 'Troll(8)']
2025-07-08T18:47:48.9457311Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9457831Z   "combat_state": {
2025-07-08T18:47:48.9458137Z     "current_turn_index": 1,
2025-07-08T18:47:48.9458478Z     "current_round": 3
2025-07-08T18:47:48.9458754Z   },
2025-07-08T18:47:48.9458984Z   "world_data": {
2025-07-08T18:47:48.9459274Z     "current_weather": "stormy"
2025-07-08T18:47:48.9459589Z   }
2025-07-08T18:47:48.9459814Z }
2025-07-08T18:47:48.9460227Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9460760Z   "current_turn_index": 1,
2025-07-08T18:47:48.9461068Z   "current_round": 3
2025-07-08T18:47:48.9461345Z }
2025-07-08T18:47:48.9461703Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9462320Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9462844Z   "current_weather": "stormy"
2025-07-08T18:47:48.9463149Z }
2025-07-08T18:47:48.9463509Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9464094Z 2025-07-08 18:47:48,935 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9464833Z 2025-07-08 18:47:48,935 - INFO - COMBAT CLEANUP CHECK: Found 2 combatants, scanning for defeated enemies...
2025-07-08T18:47:48.9465606Z 2025-07-08 18:47:48,935 - INFO - COMBAT CLEANUP: Marking Troll (enemy) as defeated
2025-07-08T18:47:48.9466433Z 2025-07-08 18:47:48,935 - INFO - COMBAT CLEANUP: Removed Troll from combat_state.combatants
2025-07-08T18:47:48.9467128Z 2025-07-08 18:47:48,935 - INFO - COMBAT CLEANUP: Removed Troll from npc_data
2025-07-08T18:47:48.9467781Z 2025-07-08 18:47:48,935 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Troll']
2025-07-08T18:47:48.9468289Z ok
2025-07-08T18:47:48.9468938Z test_combat_end_with_pre_defeated_enemies (__main__.TestCombatCleanupComprehensive.test_combat_end_with_pre_defeated_enemies)
2025-07-08T18:47:48.9470372Z Test: When combat ends and there are already defeated enemies, they should be cleaned up. ... 2025-07-08 18:47:48,935 - INFO - COMBAT STARTED - Participants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T18:47:48.9471648Z 2025-07-08 18:47:48,936 - INFO - COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dead Orc(12)', 'Living Wolf(10)']
2025-07-08T18:47:48.9472439Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9473154Z   "combat_state": {
2025-07-08T18:47:48.9473446Z     "in_combat": false,
2025-07-08T18:47:48.9473744Z     "current_round": 0
2025-07-08T18:47:48.9474019Z   }
2025-07-08T18:47:48.9474242Z }
2025-07-08T18:47:48.9474629Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9475114Z   "in_combat": false,
2025-07-08T18:47:48.9475402Z   "current_round": 0
2025-07-08T18:47:48.9475809Z }
2025-07-08T18:47:48.9476171Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9476745Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9477443Z 2025-07-08 18:47:48,936 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T18:47:48.9478361Z 2025-07-08 18:47:48,936 - INFO - COMBAT CLEANUP: Marking Dead Orc (enemy) as defeated
2025-07-08T18:47:48.9479055Z 2025-07-08 18:47:48,936 - INFO - COMBAT CLEANUP: Removed Dead Orc from combat_state.combatants
2025-07-08T18:47:48.9479718Z 2025-07-08 18:47:48,936 - INFO - COMBAT CLEANUP: Removed Dead Orc from npc_data
2025-07-08T18:47:48.9480387Z 2025-07-08 18:47:48,936 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Dead Orc']
2025-07-08T18:47:48.9480895Z ok
2025-07-08T18:47:48.9481549Z test_multiple_enemies_defeated_same_turn (__main__.TestCombatCleanupComprehensive.test_multiple_enemies_defeated_same_turn)
2025-07-08T18:47:48.9482946Z Test: Multiple enemies defeated in the same AI response should all be cleaned up. ... 2025-07-08 18:47:48,936 - INFO - COMBAT STARTED - Participants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T18:47:48.9484229Z 2025-07-08 18:47:48,936 - INFO - COMBAT INITIALIZED - Initiative order: ['Wizard(20)', 'Goblin A(15)', 'Goblin B(14)', 'Orc Chief(13)']
2025-07-08T18:47:48.9485077Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9485560Z   "combat_state": {
2025-07-08T18:47:48.9486032Z     "combatants": {
2025-07-08T18:47:48.9486309Z       "Goblin A": {
2025-07-08T18:47:48.9486580Z         "hp_current": 0,
2025-07-08T18:47:48.9486873Z         "status": [
2025-07-08T18:47:48.9487124Z           "dead"
2025-07-08T18:47:48.9487376Z         ]
2025-07-08T18:47:48.9487695Z       },
2025-07-08T18:47:48.9487922Z       "Goblin B": {
2025-07-08T18:47:48.9488192Z         "hp_current": 0,
2025-07-08T18:47:48.9488487Z         "status": [
2025-07-08T18:47:48.9488739Z           "dead"
2025-07-08T18:47:48.9488989Z         ]
2025-07-08T18:47:48.9489222Z       },
2025-07-08T18:47:48.9489452Z       "Orc Chief": {
2025-07-08T18:47:48.9489736Z         "hp_current": 5,
2025-07-08T18:47:48.9490023Z         "status": [
2025-07-08T18:47:48.9490281Z           "wounded"
2025-07-08T18:47:48.9490566Z ... (truncated, showing 19/24 lines)
2025-07-08T18:47:48.9491066Z 2025-07-08 18:47:48,936 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9491574Z   "combatants": {
2025-07-08T18:47:48.9491832Z     "Goblin A": {
2025-07-08T18:47:48.9492110Z       "hp_current": 0,
2025-07-08T18:47:48.9492393Z       "status": [
2025-07-08T18:47:48.9492647Z         "dead"
2025-07-08T18:47:48.9492888Z       ]
2025-07-08T18:47:48.9493113Z     },
2025-07-08T18:47:48.9493339Z     "Goblin B": {
2025-07-08T18:47:48.9493610Z       "hp_current": 0,
2025-07-08T18:47:48.9493887Z       "status": [
2025-07-08T18:47:48.9494133Z         "dead"
2025-07-08T18:47:48.9494372Z       ]
2025-07-08T18:47:48.9494594Z     },
2025-07-08T18:47:48.9494823Z     "Orc Chief": {
2025-07-08T18:47:48.9495096Z       "hp_current": 5,
2025-07-08T18:47:48.9495376Z       "status": [
2025-07-08T18:47:48.9495627Z         "wounded"
2025-07-08T18:47:48.9496035Z       ]
2025-07-08T18:47:48.9496302Z ... (truncated, showing 19/22 lines)
2025-07-08T18:47:48.9496792Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9497299Z   "Goblin A": {
2025-07-08T18:47:48.9497572Z     "hp_current": 0,
2025-07-08T18:47:48.9497841Z     "status": [
2025-07-08T18:47:48.9498334Z       "dead"
2025-07-08T18:47:48.9498589Z     ]
2025-07-08T18:47:48.9498817Z   },
2025-07-08T18:47:48.9499049Z   "Goblin B": {
2025-07-08T18:47:48.9499316Z     "hp_current": 0,
2025-07-08T18:47:48.9499592Z     "status": [
2025-07-08T18:47:48.9499832Z       "dead"
2025-07-08T18:47:48.9500073Z     ]
2025-07-08T18:47:48.9500296Z   },
2025-07-08T18:47:48.9500518Z   "Orc Chief": {
2025-07-08T18:47:48.9500778Z     "hp_current": 5,
2025-07-08T18:47:48.9501053Z     "status": [
2025-07-08T18:47:48.9501297Z       "wounded"
2025-07-08T18:47:48.9501542Z     ]
2025-07-08T18:47:48.9501768Z   }
2025-07-08T18:47:48.9501985Z }
2025-07-08T18:47:48.9502384Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9503049Z   "hp_current": 0,
2025-07-08T18:47:48.9503311Z   "status": [
2025-07-08T18:47:48.9503557Z     "dead"
2025-07-08T18:47:48.9503794Z   ]
2025-07-08T18:47:48.9504006Z }
2025-07-08T18:47:48.9504377Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9504988Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9505479Z   "hp_current": 0,
2025-07-08T18:47:48.9505879Z   "status": [
2025-07-08T18:47:48.9506123Z     "dead"
2025-07-08T18:47:48.9506353Z   ]
2025-07-08T18:47:48.9506567Z }
2025-07-08T18:47:48.9506936Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9507560Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:48.9508052Z   "hp_current": 5,
2025-07-08T18:47:48.9508324Z   "status": [
2025-07-08T18:47:48.9508576Z     "wounded"
2025-07-08T18:47:48.9508819Z   ]
2025-07-08T18:47:48.9509046Z }
2025-07-08T18:47:48.9509400Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9509962Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9510535Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9511113Z 2025-07-08 18:47:48,937 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:48.9511808Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP CHECK: Found 4 combatants, scanning for defeated enemies...
2025-07-08T18:47:48.9512554Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Marking Goblin A (enemy) as defeated
2025-07-08T18:47:48.9513187Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Marking Goblin B (enemy) as defeated
2025-07-08T18:47:48.9513871Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Removed Goblin A from combat_state.combatants
2025-07-08T18:47:48.9514554Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Removed Goblin A from npc_data
2025-07-08T18:47:48.9515234Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Removed Goblin B from combat_state.combatants
2025-07-08T18:47:48.9518429Z 2025-07-08 18:47:48,937 - INFO - COMBAT CLEANUP: Removed Goblin B from npc_data
2025-07-08T18:47:48.9519213Z 2025-07-08 18:47:48,937 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Goblin A', 'Goblin B']
2025-07-08T18:47:48.9519801Z ok
2025-07-08T18:47:48.9519941Z 
2025-07-08T18:47:48.9520127Z ----------------------------------------------------------------------
2025-07-08T18:47:48.9520551Z Ran 4 tests in 0.006s
2025-07-08T18:47:48.9520737Z 
2025-07-08T18:47:48.9520839Z OK
2025-07-08T18:47:49.1094982Z ✅ mvp_site/tests/test_combat_cleanup_comprehensive.py passed
2025-07-08T18:47:49.1096821Z ----------------------------------------
2025-07-08T18:47:49.1097364Z Running mvp_site/tests/test_complete_combined_approach.py...
2025-07-08T18:47:49.2914591Z test_complete_combined_approach_integration (__main__.TestCompleteCombinedApproach.test_complete_combined_approach_integration)
2025-07-08T18:47:49.2936078Z Test complete Combined approach integration flow ... ok
2025-07-08T18:47:49.2938830Z test_failure_case_handling (__main__.TestCompleteCombinedApproach.test_failure_case_handling)
2025-07-08T18:47:49.2948907Z Test how the system handles failure cases ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:47:49.2950351Z ok
2025-07-08T18:47:49.2951793Z test_step1_structured_generation_prompt_creation (__main__.TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation)
2025-07-08T18:47:49.2957084Z Step 1: Create structured generation prompt with entity manifest ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation of <__main__.TestCompleteCombinedApproach testMethod=test_step1_structured_generation_prompt_creation>>)
2025-07-08T18:47:49.2960355Z   return self.run(*args, **kwds)
2025-07-08T18:47:49.2960983Z ok
2025-07-08T18:47:49.2961949Z test_step2_structured_response_parsing (__main__.TestCompleteCombinedApproach.test_step2_structured_response_parsing)
2025-07-08T18:47:49.2970239Z Step 2: Parse structured JSON response from LLM ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step2_structured_response_parsing of <__main__.TestCompleteCombinedApproach testMethod=test_step2_structured_response_parsing>>)
2025-07-08T18:47:49.2972553Z   return self.run(*args, **kwds)
2025-07-08T18:47:49.2973191Z 🎯 Complete Combined Approach Implementation Test
2025-07-08T18:47:49.2973677Z Testing Milestone 1: Production Entity Tracking
2025-07-08T18:47:49.2974128Z ======================================================================
2025-07-08T18:47:49.2974428Z 
2025-07-08T18:47:49.2974678Z 🚀 Complete Combined Approach Integration Test
2025-07-08T18:47:49.2975105Z ============================================================
2025-07-08T18:47:49.2975369Z 
2025-07-08T18:47:49.2975624Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T18:47:49.2979454Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2979992Z    ✅ Prompt injection created (836 chars)
2025-07-08T18:47:49.2980272Z 
2025-07-08T18:47:49.2980496Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T18:47:49.2980955Z    ✅ JSON parsed successfully
2025-07-08T18:47:49.2981367Z    ✅ Narrative extracted (380 chars)
2025-07-08T18:47:49.2981845Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2982129Z 
2025-07-08T18:47:49.2982372Z 🔧 Step 3: Schema validation of structured response
2025-07-08T18:47:49.2982847Z    ✅ Schema validation: True
2025-07-08T18:47:49.2983241Z    ✅ Narrative validation: True
2025-07-08T18:47:49.2983647Z    ✅ Coverage rate: 1.00
2025-07-08T18:47:49.2983838Z 
2025-07-08T18:47:49.2984074Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T18:47:49.2984528Z    ✅ All entities present: True
2025-07-08T18:47:49.2984978Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2985429Z    ✅ Confidence: 1.00
2025-07-08T18:47:49.2985612Z 
2025-07-08T18:47:49.2985968Z 📊 Combined Approach Results:
2025-07-08T18:47:49.2986380Z    🎯 Structured Generation: ✅ PASS
2025-07-08T18:47:49.2986803Z    🎯 Response Parsing: ✅ PASS
2025-07-08T18:47:49.2987251Z    🎯 Schema Validation: ✅ PASS (100% coverage)
2025-07-08T18:47:49.2987735Z    🎯 Sync Validation: ✅ PASS (100% confidence)
2025-07-08T18:47:49.2988172Z    🎯 Overall: ✅ 100% SUCCESS
2025-07-08T18:47:49.2988383Z 
2025-07-08T18:47:49.2988620Z 🎉 Combined Approach Implementation VERIFIED!
2025-07-08T18:47:49.2989028Z    The Cassian Problem is SOLVED!
2025-07-08T18:47:49.2989266Z 
2025-07-08T18:47:49.2989453Z 🧪 Testing failure case handling
2025-07-08T18:47:49.2989919Z    ✅ Graceful fallback for non-JSON response
2025-07-08T18:47:49.2990557Z    ✅ Validation still detects missing entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2990963Z 
2025-07-08T18:47:49.2991192Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T18:47:49.2991956Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2992472Z    ✅ Prompt injection created (836 chars)
2025-07-08T18:47:49.2992724Z 
2025-07-08T18:47:49.2992936Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T18:47:49.2993380Z    ✅ JSON parsed successfully
2025-07-08T18:47:49.2993780Z    ✅ Narrative extracted (380 chars)
2025-07-08T18:47:49.2994276Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2994566Z 
2025-07-08T18:47:49.2994805Z 🔧 Step 3: Schema validation of structured response
2025-07-08T18:47:49.2995258Z    ✅ Schema validation: True
2025-07-08T18:47:49.2995788Z    ✅ Narrative validation: True
2025-07-08T18:47:49.2996168Z    ✅ Coverage rate: 1.00
2025-07-08T18:47:49.2996564Z 
2025-07-08T18:47:49.2996800Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T18:47:49.2997257Z    ✅ All entities present: True
2025-07-08T18:47:49.2997697Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:49.2998132Z    ✅ Confidence: 1.00
2025-07-08T18:47:49.2998461Z ok
2025-07-08T18:47:49.2999048Z test_step3_schema_validation (__main__.TestCompleteCombinedApproach.test_step3_schema_validation)
2025-07-08T18:47:49.3001318Z Step 3: Validate structured response against expected schema ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step3_schema_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step3_schema_validation>>)
2025-07-08T18:47:49.3003350Z   return self.run(*args, **kwds)
2025-07-08T18:47:49.3003684Z ok
2025-07-08T18:47:49.3004307Z test_step4_narrative_sync_validation (__main__.TestCompleteCombinedApproach.test_step4_narrative_sync_validation)
2025-07-08T18:47:49.3006947Z Step 4: Additional validation with NarrativeSyncValidator ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step4_narrative_sync_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step4_narrative_sync_validation>>)
2025-07-08T18:47:49.3009129Z   return self.run(*args, **kwds)
2025-07-08T18:47:49.3009495Z ok
2025-07-08T18:47:49.3009644Z 
2025-07-08T18:47:49.3009842Z ----------------------------------------------------------------------
2025-07-08T18:47:49.3010340Z Ran 6 tests in 0.005s
2025-07-08T18:47:49.3010533Z 
2025-07-08T18:47:49.3010637Z OK
2025-07-08T18:47:49.3255255Z ✅ mvp_site/tests/test_complete_combined_approach.py passed
2025-07-08T18:47:49.3256934Z ----------------------------------------
2025-07-08T18:47:49.3257445Z Running mvp_site/tests/test_constants.py...
2025-07-08T18:47:49.3638632Z ...............
2025-07-08T18:47:49.3640516Z ----------------------------------------------------------------------
2025-07-08T18:47:49.3642943Z Ran 15 tests in 0.001s
2025-07-08T18:47:49.3643186Z 
2025-07-08T18:47:49.3643335Z OK
2025-07-08T18:47:49.3697479Z ✅ mvp_site/tests/test_constants.py passed
2025-07-08T18:47:49.3698898Z ----------------------------------------
2025-07-08T18:47:49.3699420Z Running mvp_site/tests/test_context_truncation.py...
2025-07-08T18:47:50.0036961Z 2025-07-08 18:47:50,003 - INFO - Initializing Gemini Client
2025-07-08T18:47:50.0039017Z 2025-07-08 18:47:50,003 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T18:47:50.0040710Z 2025-07-08 18:47:50,003 - INFO - Initial context stats: Turns: 2, Tokens: 5 (est: 5), Core Memories: 0
2025-07-08T18:47:50.0041929Z 2025-07-08 18:47:50,003 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:47:50.0044178Z .2025-07-08 18:47:50,003 - INFO - Initializing Gemini Client
2025-07-08T18:47:50.0052414Z 2025-07-08 18:47:50,003 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T18:47:50.0053940Z 2025-07-08 18:47:50,003 - INFO - Initial context stats: Turns: 6, Tokens: 15 (est: 15), Core Memories: 0
2025-07-08T18:47:50.0054739Z 2025-07-08 18:47:50,003 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:47:50.0055344Z .2025-07-08 18:47:50,004 - INFO - Initializing Gemini Client
2025-07-08T18:47:50.0056575Z 2025-07-08 18:47:50,004 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T18:47:50.0057564Z 2025-07-08 18:47:50,004 - INFO - Initial context stats: Turns: 4, Tokens: 50 (est: 50), Core Memories: 0
2025-07-08T18:47:50.0058521Z 2025-07-08 18:47:50,004 - WARNING - ⚠️ Context (50 tokens) exceeds budget of 30 tokens. Truncating...
2025-07-08T18:47:50.0059429Z 2025-07-08 18:47:50,004 - INFO - Initializing Gemini Client
2025-07-08T18:47:50.0060410Z 2025-07-08 18:47:50,004 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T18:47:50.0061534Z 2025-07-08 18:47:50,004 - INFO - Final context stats after truncation: Turns: 4, Tokens: 67 (est: 67), Core Memories: 0
2025-07-08T18:47:50.0062250Z .
2025-07-08T18:47:50.0062577Z ----------------------------------------------------------------------
2025-07-08T18:47:50.0063016Z Ran 3 tests in 0.001s
2025-07-08T18:47:50.0063205Z 
2025-07-08T18:47:50.0063304Z OK
2025-07-08T18:47:50.0063734Z \n--- Running Test: test_does_not_truncate_if_within_all_limits ---
2025-07-08T18:47:50.0064247Z --- Test Finished Successfully ---
2025-07-08T18:47:50.0064733Z \n--- Running Test: test_no_truncation_when_under_char_limit ---
2025-07-08T18:47:50.0065244Z --- Test Finished Successfully ---
2025-07-08T18:47:50.0065908Z \n--- Running Test: test_truncates_when_few_turns_over_char_limit ---
2025-07-08T18:47:50.0066412Z --- Test Finished Successfully ---
2025-07-08T18:47:50.0888765Z ✅ mvp_site/tests/test_context_truncation.py passed
2025-07-08T18:47:50.0890319Z ----------------------------------------
2025-07-08T18:47:50.0890854Z Running mvp_site/tests/test_data_integrity.py...
2025-07-08T18:47:50.3495081Z INFO: COMBAT STARTED - Participants: ['Player', 'Dragon Boss', 'Friendly Wolf']
2025-07-08T18:47:50.3497413Z INFO: COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dragon Boss(12)', 'Friendly Wolf(8)']
2025-07-08T18:47:50.3498753Z INFO: COMBAT CLEANUP: Marking Dragon Boss (enemy) as defeated
2025-07-08T18:47:50.3499504Z INFO: COMBAT CLEANUP: Removed Dragon Boss from combat_state.combatants
2025-07-08T18:47:50.3500226Z INFO: COMBAT CLEANUP: Removed Dragon Boss from npc_data
2025-07-08T18:47:50.3501579Z ..INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:50.3502408Z   "custom_campaign_state": {
2025-07-08T18:47:50.3502880Z     "active_missions": {
2025-07-08T18:47:50.3503262Z       "rogue_mission": {
2025-07-08T18:47:50.3503666Z         "title": "This shouldn't be here"
2025-07-08T18:47:50.3504084Z       }
2025-07-08T18:47:50.3504337Z     }
2025-07-08T18:47:50.3504605Z   }
2025-07-08T18:47:50.3504878Z }
2025-07-08T18:47:50.3505288Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:50.3506018Z   "active_missions": {
2025-07-08T18:47:50.3506395Z     "rogue_mission": {
2025-07-08T18:47:50.3506775Z       "title": "This shouldn't be here"
2025-07-08T18:47:50.3507215Z     }
2025-07-08T18:47:50.3507506Z   }
2025-07-08T18:47:50.3507779Z }
2025-07-08T18:47:50.3508820Z WARNING: ⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T18:47:50.3509560Z INFO: Adding new mission: rogue_mission
2025-07-08T18:47:50.3510050Z INFO: --- update_state_with_changes: finished ---
2025-07-08T18:47:50.3510593Z INFO: --- update_state_with_changes: finished ---
2025-07-08T18:47:50.3512037Z ........INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:50.3512534Z   "npc_data": {
2025-07-08T18:47:50.3512814Z     "Grishnak": "defeated"
2025-07-08T18:47:50.3513127Z   }
2025-07-08T18:47:50.3513354Z }
2025-07-08T18:47:50.3514054Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:50.3514559Z   "Grishnak": "defeated"
2025-07-08T18:47:50.3514869Z }
2025-07-08T18:47:50.3515356Z INFO: update_state: Preserving dict structure for key 'Grishnak', adding 'status' field.
2025-07-08T18:47:50.3516211Z INFO: --- update_state_with_changes: finished ---
2025-07-08T18:47:50.3516688Z INFO: --- update_state_with_changes: finished ---
2025-07-08T18:47:50.3517071Z .
2025-07-08T18:47:50.3517381Z ----------------------------------------------------------------------
2025-07-08T18:47:50.3517835Z Ran 11 tests in 0.002s
2025-07-08T18:47:50.3518033Z 
2025-07-08T18:47:50.3518140Z OK
2025-07-08T18:47:50.3909438Z ✅ mvp_site/tests/test_data_integrity.py passed
2025-07-08T18:47:50.3918430Z ----------------------------------------
2025-07-08T18:47:50.3918995Z Running mvp_site/tests/test_debug_hybrid_system.py...
2025-07-08T18:47:50.4018027Z Traceback (most recent call last):
2025-07-08T18:47:50.4020075Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/tests/test_debug_hybrid_system.py", line 5, in <module>
2025-07-08T18:47:50.4021065Z     import pytest
2025-07-08T18:47:50.4021462Z ModuleNotFoundError: No module named 'pytest'
2025-07-08T18:47:50.4042396Z ❌ mvp_site/tests/test_debug_hybrid_system.py failed
2025-07-08T18:47:50.4043753Z ----------------------------------------
2025-07-08T18:47:50.4044250Z Running mvp_site/tests/test_debug_logging.py...
2025-07-08T18:47:51.2845463Z ...
2025-07-08T18:47:51.2847360Z ----------------------------------------------------------------------
2025-07-08T18:47:51.2848230Z Ran 3 tests in 0.022s
2025-07-08T18:47:51.2849131Z 
2025-07-08T18:47:51.2849672Z OK
2025-07-08T18:47:51.4270063Z ✅ mvp_site/tests/test_debug_logging.py passed
2025-07-08T18:47:51.4271780Z ----------------------------------------
2025-07-08T18:47:51.4272412Z Running mvp_site/tests/test_debug_mode.py...
2025-07-08T18:47:52.2883783Z 2025-07-08 18:47:52,288 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:52.2886139Z 2025-07-08 18:47:52,288 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T18:47:52.2948265Z .2025-07-08 18:47:52,294 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:52.2950180Z 2025-07-08 18:47:52,294 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T18:47:52.3006524Z .2025-07-08 18:47:52,300 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:52.3008601Z 2025-07-08 18:47:52,300 - WARNING - ⚠️ AI response missing debug content for campaign test_campaign_456
2025-07-08T18:47:52.3010994Z 2025-07-08 18:47:52,300 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T18:47:52.3011959Z 2025-07-08 18:47:52,300 - INFO - Response length: 40 characters (~10 tokens)
2025-07-08T18:47:52.3068257Z .2025-07-08 18:47:52,306 - INFO - Debug mode enabled for campaign test_campaign_456
2025-07-08T18:47:52.3087716Z 2025-07-08 18:47:52,308 - INFO - Debug mode disabled for campaign test_campaign_456
2025-07-08T18:47:52.3141748Z .2025-07-08 18:47:52,314 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:52.3143695Z 2025-07-08 18:47:52,314 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': False, 'dice_rolls': True, 'state_changes': False}
2025-07-08T18:47:52.3148818Z .
2025-07-08T18:47:52.3149512Z ----------------------------------------------------------------------
2025-07-08T18:47:52.3150247Z Ran 5 tests in 0.036s
2025-07-08T18:47:52.3151365Z 
2025-07-08T18:47:52.3151478Z OK
2025-07-08T18:47:52.4587469Z ✅ mvp_site/tests/test_debug_mode.py passed
2025-07-08T18:47:52.4589377Z ----------------------------------------
2025-07-08T18:47:52.4589875Z Running mvp_site/tests/test_debug_mode_e2e.py...
2025-07-08T18:47:53.3209239Z .2025-07-08 18:47:53,320 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:53.3211291Z 2025-07-08 18:47:53,320 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T18:47:53.3268589Z .2025-07-08 18:47:53,326 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:47:53.3270509Z 2025-07-08 18:47:53,326 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T18:47:53.3275404Z .
2025-07-08T18:47:53.3275980Z ----------------------------------------------------------------------
2025-07-08T18:47:53.3276462Z Ran 3 tests in 0.020s
2025-07-08T18:47:53.3276691Z 
2025-07-08T18:47:53.3276800Z OK
2025-07-08T18:47:53.4728252Z ✅ mvp_site/tests/test_debug_mode_e2e.py passed
2025-07-08T18:47:53.4747046Z ----------------------------------------
2025-07-08T18:47:53.4747610Z Running mvp_site/tests/test_debug_mode_game_state.py...
2025-07-08T18:47:53.5168616Z ......
2025-07-08T18:47:53.5175294Z ----------------------------------------------------------------------
2025-07-08T18:47:53.5176059Z Ran 6 tests in 0.000s
2025-07-08T18:47:53.5176282Z 
2025-07-08T18:47:53.5176411Z OK
2025-07-08T18:47:53.5240504Z ✅ mvp_site/tests/test_debug_mode_game_state.py passed
2025-07-08T18:47:53.5241782Z ----------------------------------------
2025-07-08T18:47:53.5242306Z Running mvp_site/tests/test_debug_mode_parser.py...
2025-07-08T18:47:53.5701127Z ...............
2025-07-08T18:47:53.5701981Z ----------------------------------------------------------------------
2025-07-08T18:47:53.5702803Z Ran 15 tests in 0.006s
2025-07-08T18:47:53.5703329Z 
2025-07-08T18:47:53.5704378Z OK
2025-07-08T18:47:53.5768644Z ✅ mvp_site/tests/test_debug_mode_parser.py passed
2025-07-08T18:47:53.5770098Z ----------------------------------------
2025-07-08T18:47:53.5770610Z Running mvp_site/tests/test_debug_mode_unit.py...
2025-07-08T18:47:53.6434795Z .......
2025-07-08T18:47:53.6435525Z ----------------------------------------------------------------------
2025-07-08T18:47:53.6438019Z Ran 7 tests in 0.001s
2025-07-08T18:47:53.6438242Z 
2025-07-08T18:47:53.6438360Z OK
2025-07-08T18:47:53.6559717Z ✅ mvp_site/tests/test_debug_mode_unit.py passed
2025-07-08T18:47:53.6561084Z ----------------------------------------
2025-07-08T18:47:53.6561593Z Running mvp_site/tests/test_debug_stripping.py...
2025-07-08T18:47:53.7041663Z ..............
2025-07-08T18:47:53.7042567Z ----------------------------------------------------------------------
2025-07-08T18:47:53.7043364Z Ran 14 tests in 0.001s
2025-07-08T18:47:53.7044140Z 
2025-07-08T18:47:53.7044493Z OK
2025-07-08T18:47:53.7119486Z ✅ mvp_site/tests/test_debug_stripping.py passed
2025-07-08T18:47:53.7120298Z ----------------------------------------
2025-07-08T18:47:53.7121085Z Running mvp_site/tests/test_debug_stripping_isolated.py...
2025-07-08T18:47:53.7503488Z .........
2025-07-08T18:47:53.7504389Z ----------------------------------------------------------------------
2025-07-08T18:47:53.7505255Z Ran 9 tests in 0.001s
2025-07-08T18:47:53.7506836Z 
2025-07-08T18:47:53.7506970Z OK
2025-07-08T18:47:53.7565144Z ✅ mvp_site/tests/test_debug_stripping_isolated.py passed
2025-07-08T18:47:53.7566226Z ----------------------------------------
2025-07-08T18:47:53.7566833Z Running mvp_site/tests/test_debug_stripping_json_safety.py...
2025-07-08T18:47:53.8237497Z .....
2025-07-08T18:47:53.8237964Z ----------------------------------------------------------------------
2025-07-08T18:47:53.8238488Z Ran 5 tests in 0.001s
2025-07-08T18:47:53.8238703Z 
2025-07-08T18:47:53.8238818Z OK
2025-07-08T18:47:53.8342229Z ✅ mvp_site/tests/test_debug_stripping_json_safety.py passed
2025-07-08T18:47:53.8344038Z ----------------------------------------
2025-07-08T18:47:53.8344543Z Running mvp_site/tests/test_decorators.py...
2025-07-08T18:47:53.9005523Z .........
2025-07-08T18:47:53.9007616Z ----------------------------------------------------------------------
2025-07-08T18:47:53.9008132Z Ran 9 tests in 0.004s
2025-07-08T18:47:53.9008338Z 
2025-07-08T18:47:53.9008452Z OK
2025-07-08T18:47:53.9115195Z ✅ mvp_site/tests/test_decorators.py passed
2025-07-08T18:47:53.9116443Z ----------------------------------------
2025-07-08T18:47:53.9118612Z Running mvp_site/tests/test_defensive_numeric_converter.py...
2025-07-08T18:47:54.0873547Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0875631Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.0877668Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T18:47:54.0878802Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.0879803Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0880748Z WARNING:root:⚠️ Invalid value 'Unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0881674Z WARNING:root:⚠️ Invalid value 'UNKNOWN' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0882578Z WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0883556Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'hp'. Using default: 1
2025-07-08T18:47:54.0884576Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.0885531Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.0887010Z WARNING:root:⚠️ Invalid value 'unknown' for field 'temp_hp'. Using default: 0
2025-07-08T18:47:54.0888155Z WARNING:root:⚠️ Invalid value 'None' for field 'temp_hp'. Using default: 0
2025-07-08T18:47:54.0889357Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T18:47:54.0890400Z WARNING:root:⚠️ Invalid value 'None' for field 'level'. Using default: 1
2025-07-08T18:47:54.0896556Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'level'. Using default: 1
2025-07-08T18:47:54.0897509Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'gold'. Using default: 0
2025-07-08T18:47:54.0898383Z WARNING:root:⚠️ Invalid value 'None' for field 'gold'. Using default: 0
2025-07-08T18:47:54.0899206Z WARNING:root:⚠️ Invalid value 'unknown' for field 'initiative'. Using default: 0
2025-07-08T18:47:54.0900057Z WARNING:root:⚠️ Invalid value 'None' for field 'initiative'. Using default: 0
2025-07-08T18:47:54.0900919Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T18:47:54.0901759Z WARNING:root:⚠️ Invalid value 'None' for field 'strength'. Using default: 10
2025-07-08T18:47:54.0902639Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T18:47:54.0903506Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.0904331Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.0905200Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.0906290Z WARNING:root:⚠️ Invalid value 'unknown' for field 'constitution'. Using default: 10
2025-07-08T18:47:54.0907136Z WARNING:root:⚠️ Invalid value 'None' for field 'constitution'. Using default: 10
2025-07-08T18:47:54.0908034Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T18:47:54.0908960Z WARNING:root:⚠️ Invalid value 'unknown' for field 'intelligence'. Using default: 10
2025-07-08T18:47:54.0909801Z WARNING:root:⚠️ Invalid value 'None' for field 'intelligence'. Using default: 10
2025-07-08T18:47:54.0910961Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'intelligence'. Using default: 10
2025-07-08T18:47:54.0911846Z WARNING:root:⚠️ Invalid value 'unknown' for field 'wisdom'. Using default: 10
2025-07-08T18:47:54.0912616Z WARNING:root:⚠️ Invalid value 'None' for field 'wisdom'. Using default: 10
2025-07-08T18:47:54.0913415Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'wisdom'. Using default: 10
2025-07-08T18:47:54.0914240Z WARNING:root:⚠️ Invalid value 'unknown' for field 'charisma'. Using default: 10
2025-07-08T18:47:54.0915303Z WARNING:root:⚠️ Invalid value 'None' for field 'charisma'. Using default: 10
2025-07-08T18:47:54.0916524Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'charisma'. Using default: 10
2025-07-08T18:47:54.0917825Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T18:47:54.0918739Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0919612Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.0920577Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T18:47:54.0921535Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.0922444Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.0923362Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T18:47:54.0924307Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.0925323Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T18:47:54.0926196Z .
2025-07-08T18:47:54.0926644Z ----------------------------------------------------------------------
2025-07-08T18:47:54.0927221Z Ran 12 tests in 0.003s
2025-07-08T18:47:54.0927518Z 
2025-07-08T18:47:54.0927701Z OK
2025-07-08T18:47:54.1168182Z ✅ mvp_site/tests/test_defensive_numeric_converter.py passed
2025-07-08T18:47:54.1169708Z ----------------------------------------
2025-07-08T18:47:54.1170190Z Running mvp_site/tests/test_delete_fix.py...
2025-07-08T18:47:54.1270593Z === Testing __DELETE__ Token Processing ===
2025-07-08T18:47:54.1280635Z 
2025-07-08T18:47:54.1280819Z Test 1: Simple deletion
2025-07-08T18:47:54.1281753Z Before: {'npc_data': {'Drake 1': {'name': 'Drake 1', 'type': 'enemy'}, 'Drake 2': {'name': 'Drake 2', 'type': 'enemy'}, 'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T18:47:54.1282774Z Removed 'Drake 1' from state.
2025-07-08T18:47:54.1283185Z Removed 'Drake 2' from state.
2025-07-08T18:47:54.1283839Z After: {'npc_data': {'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T18:47:54.1284723Z ✅ Test 1 passed!
2025-07-08T18:47:54.1284925Z 
2025-07-08T18:47:54.1285070Z Test 2: Top-level deletion
2025-07-08T18:47:54.1286001Z Before: {'defeated_enemy': {'name': 'Orc', 'hp': 0}, 'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T18:47:54.1286799Z Removed 'defeated_enemy' from state.
2025-07-08T18:47:54.1287407Z After: {'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T18:47:54.1288075Z ✅ Test 2 passed!
2025-07-08T18:47:54.1288270Z 
2025-07-08T18:47:54.1288672Z 🎉 All tests passed! __DELETE__ token processing works correctly.
2025-07-08T18:47:54.1296656Z ✅ mvp_site/tests/test_delete_fix.py passed
2025-07-08T18:47:54.1297936Z ----------------------------------------
2025-07-08T18:47:54.1298488Z Running mvp_site/tests/test_delete_token_comprehensive.py...
2025-07-08T18:47:54.2011563Z .....
2025-07-08T18:47:54.2013682Z ----------------------------------------------------------------------
2025-07-08T18:47:54.2014219Z Ran 5 tests in 0.004s
2025-07-08T18:47:54.2014435Z 
2025-07-08T18:47:54.2014542Z OK
2025-07-08T18:47:54.2121964Z ✅ mvp_site/tests/test_delete_token_comprehensive.py passed
2025-07-08T18:47:54.2123319Z ----------------------------------------
2025-07-08T18:47:54.2124193Z Running mvp_site/tests/test_deployment_build.py...
2025-07-08T18:47:54.2601219Z ...
2025-07-08T18:47:54.2602071Z ----------------------------------------------------------------------
2025-07-08T18:47:54.2603852Z Ran 3 tests in 0.007s
2025-07-08T18:47:54.2606132Z 
2025-07-08T18:47:54.2606268Z OK
2025-07-08T18:47:54.2680585Z ✅ mvp_site/tests/test_deployment_build.py passed
2025-07-08T18:47:54.2681909Z ----------------------------------------
2025-07-08T18:47:54.2682437Z Running mvp_site/tests/test_dual_pass_generator.py...
2025-07-08T18:47:54.3365101Z .....................
2025-07-08T18:47:54.3366402Z ----------------------------------------------------------------------
2025-07-08T18:47:54.3386507Z Ran 21 tests in 0.003s
2025-07-08T18:47:54.3386969Z 
2025-07-08T18:47:54.3387262Z OK
2025-07-08T18:47:54.3487727Z ✅ mvp_site/tests/test_dual_pass_generator.py passed
2025-07-08T18:47:54.3488237Z ----------------------------------------
2025-07-08T18:47:54.3488712Z Running mvp_site/tests/test_entity_classes.py...
2025-07-08T18:47:54.5270993Z ......WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T18:47:54.5276944Z .....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:54.5278013Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T18:47:54.5279075Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T18:47:54.5283325Z ..........WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T18:47:54.5288831Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T18:47:54.5289754Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T18:47:54.5290387Z .
2025-07-08T18:47:54.5290721Z ----------------------------------------------------------------------
2025-07-08T18:47:54.5291191Z Ran 22 tests in 0.002s
2025-07-08T18:47:54.5291381Z 
2025-07-08T18:47:54.5291502Z OK
2025-07-08T18:47:54.5514335Z ✅ mvp_site/tests/test_entity_classes.py passed
2025-07-08T18:47:54.5516012Z ----------------------------------------
2025-07-08T18:47:54.5516540Z Running mvp_site/tests/test_entity_instructions.py...
2025-07-08T18:47:54.6186903Z ............................
2025-07-08T18:47:54.6187880Z ----------------------------------------------------------------------
2025-07-08T18:47:54.6189675Z Ran 28 tests in 0.003s
2025-07-08T18:47:54.6191686Z 
2025-07-08T18:47:54.6191807Z OK
2025-07-08T18:47:54.6299001Z ✅ mvp_site/tests/test_entity_instructions.py passed
2025-07-08T18:47:54.6299965Z ----------------------------------------
2025-07-08T18:47:54.6300601Z Running mvp_site/tests/test_entity_preloader.py...
2025-07-08T18:47:54.8117085Z .............
2025-07-08T18:47:54.8118715Z ----------------------------------------------------------------------
2025-07-08T18:47:54.8119214Z Ran 13 tests in 0.003s
2025-07-08T18:47:54.8119411Z 
2025-07-08T18:47:54.8119527Z OK
2025-07-08T18:47:54.8381925Z ✅ mvp_site/tests/test_entity_preloader.py passed
2025-07-08T18:47:54.8383386Z ----------------------------------------
2025-07-08T18:47:54.8383926Z Running mvp_site/tests/test_entity_tracking.py...
2025-07-08T18:47:55.0154330Z test_entity_id_format_standardization (__main__.TestEntityTracking.test_entity_id_format_standardization)
2025-07-08T18:47:55.0159450Z Test that entity IDs follow underscore format like 'pc_name_001' ... ok
2025-07-08T18:47:55.0161542Z test_existing_string_ids_preserved (__main__.TestEntityTracking.test_existing_string_ids_preserved)
2025-07-08T18:47:55.0162547Z Test that existing string_ids from game state are preserved ... ok
2025-07-08T18:47:55.0163498Z test_expected_entities_filtering (__main__.TestEntityTracking.test_expected_entities_filtering)
2025-07-08T18:47:55.0164640Z Test that expected entities correctly filters visible, conscious entities ... ok
2025-07-08T18:47:55.0167003Z test_get_validation_info (__main__.TestEntityTracking.test_get_validation_info)
2025-07-08T18:47:55.0169172Z Test get_validation_info function returns correct information. ... ok
2025-07-08T18:47:55.0170051Z test_integration_flow (__main__.TestEntityTracking.test_integration_flow)
2025-07-08T18:47:55.0179281Z Test the complete entity tracking flow ... ok
2025-07-08T18:47:55.0180979Z test_manifest_prompt_format (__main__.TestEntityTracking.test_manifest_prompt_format)
2025-07-08T18:47:55.0181826Z Test manifest to prompt format conversion ... ok
2025-07-08T18:47:55.0183813Z test_narrative_sync_validator (__main__.TestEntityTracking.test_narrative_sync_validator)
2025-07-08T18:47:55.0185536Z Test NarrativeSyncValidator functionality ... ok
2025-07-08T18:47:55.0186555Z test_scene_manifest_creation (__main__.TestEntityTracking.test_scene_manifest_creation)
2025-07-08T18:47:55.0187824Z Test SceneManifest creation from game state ... ok
2025-07-08T18:47:55.0188727Z test_validator_presence_detection (__main__.TestEntityTracking.test_validator_presence_detection)
2025-07-08T18:47:55.0191546Z 🧪 Testing Entity Tracking Production Implementation
2025-07-08T18:47:55.0192017Z ============================================================
2025-07-08T18:47:55.0192488Z ✅ Integration test passed!
2025-07-08T18:47:55.0192908Z    Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:55.0193390Z    Found entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T18:47:55.0193796Z    Confidence: 1.00
2025-07-08T18:47:55.0195219Z Test validator's presence detection logic ... ok
2025-07-08T18:47:55.0196228Z 
2025-07-08T18:47:55.0196566Z ----------------------------------------------------------------------
2025-07-08T18:47:55.0197688Z Ran 9 tests in 0.004s
2025-07-08T18:47:55.0197892Z 
2025-07-08T18:47:55.0197994Z OK
2025-07-08T18:47:55.0433508Z ✅ mvp_site/tests/test_entity_tracking.py passed
2025-07-08T18:47:55.0434988Z ----------------------------------------
2025-07-08T18:47:55.0435541Z Running mvp_site/tests/test_entity_tracking_generic.py...
2025-07-08T18:47:55.2257335Z ..........
2025-07-08T18:47:55.2259027Z ----------------------------------------------------------------------
2025-07-08T18:47:55.2260530Z Ran 10 tests in 0.001s
2025-07-08T18:47:55.2261678Z 
2025-07-08T18:47:55.2262733Z OK
2025-07-08T18:47:55.2497867Z ✅ mvp_site/tests/test_entity_tracking_generic.py passed
2025-07-08T18:47:55.2498408Z ----------------------------------------
2025-07-08T18:47:55.2498893Z Running mvp_site/tests/test_entity_validator.py...
2025-07-08T18:47:55.3146451Z .Entity validation failed after 2 retries. Missing: ['Cassian']
2025-07-08T18:47:55.3152428Z .Entity validation failed after 0 retries. Missing: ['Cassian']
2025-07-08T18:47:55.3171205Z ...............
2025-07-08T18:47:55.3172337Z ----------------------------------------------------------------------
2025-07-08T18:47:55.3173555Z Ran 17 tests in 0.004s
2025-07-08T18:47:55.3173776Z 
2025-07-08T18:47:55.3173883Z OK
2025-07-08T18:47:55.3282937Z ✅ mvp_site/tests/test_entity_validator.py passed
2025-07-08T18:47:55.3284432Z ----------------------------------------
2025-07-08T18:47:55.3284982Z Running mvp_site/tests/test_extra_json_fields.py...
2025-07-08T18:47:55.3739779Z ..
2025-07-08T18:47:55.3740674Z ----------------------------------------------------------------------
2025-07-08T18:47:55.3742441Z Ran 2 tests in 0.000s
2025-07-08T18:47:55.3744039Z 
2025-07-08T18:47:55.3744169Z OK
2025-07-08T18:47:55.3814073Z ✅ mvp_site/tests/test_extra_json_fields.py passed
2025-07-08T18:47:55.3814888Z ----------------------------------------
2025-07-08T18:47:55.3816986Z Running mvp_site/tests/test_fallback_logic_json_bug.py...
2025-07-08T18:47:55.4283302Z ....
2025-07-08T18:47:55.4287376Z ----------------------------------------------------------------------
2025-07-08T18:47:55.4287936Z Ran 4 tests in 0.001s
2025-07-08T18:47:55.4288186Z 
2025-07-08T18:47:55.4288301Z OK
2025-07-08T18:47:55.4358783Z ✅ mvp_site/tests/test_fallback_logic_json_bug.py passed
2025-07-08T18:47:55.4360202Z ----------------------------------------
2025-07-08T18:47:55.4361142Z Running mvp_site/tests/test_firestore_helper_functions_fixed.py...
2025-07-08T18:47:55.7020733Z test_perform_append_all_duplicates (__main__.TestFirestoreHelperFunctions.test_perform_append_all_duplicates)
2025-07-08T18:47:55.7028846Z Test _perform_append when all items are duplicates ... ok
2025-07-08T18:47:55.7031516Z test_perform_append_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_complex_objects)
2025-07-08T18:47:55.7034383Z Test _perform_append with complex objects ... ok
2025-07-08T18:47:55.7036967Z test_perform_append_deduplicate_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_complex_objects)
2025-07-08T18:47:55.7041459Z Test _perform_append deduplication with complex objects ... ok
2025-07-08T18:47:55.7043502Z test_perform_append_deduplicate_false (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_false)
2025-07-08T18:47:55.7046251Z Test _perform_append with deduplication disabled ... ok
2025-07-08T18:47:55.7047444Z test_perform_append_deduplicate_true (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_true)
2025-07-08T18:47:55.7053301Z Test _perform_append with deduplication enabled ... ok
2025-07-08T18:47:55.7055441Z test_perform_append_empty_list (__main__.TestFirestoreHelperFunctions.test_perform_append_empty_list)
2025-07-08T18:47:55.7058463Z Test _perform_append with empty items list ... ok
2025-07-08T18:47:55.7061252Z test_perform_append_list_items (__main__.TestFirestoreHelperFunctions.test_perform_append_list_items)
2025-07-08T18:47:55.7065009Z Test _perform_append with list of items ... ok
2025-07-08T18:47:55.7066477Z test_perform_append_none_item (__main__.TestFirestoreHelperFunctions.test_perform_append_none_item)
2025-07-08T18:47:55.7070135Z Test _perform_append with None as single item ... ok
2025-07-08T18:47:55.7071425Z test_perform_append_single_item (__main__.TestFirestoreHelperFunctions.test_perform_append_single_item)
2025-07-08T18:47:55.7076055Z Test _perform_append with single item (not a list) ... ok
2025-07-08T18:47:55.7077499Z test_truncate_log_json_circular_reference (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_circular_reference)
2025-07-08T18:47:55.7078837Z Test _truncate_log_json with circular reference ... ok
2025-07-08T18:47:55.7080860Z test_truncate_log_json_empty_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_empty_data)
2025-07-08T18:47:55.7081751Z Test _truncate_log_json with empty data ... ok
2025-07-08T18:47:55.7082698Z test_truncate_log_json_exact_boundary (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_exact_boundary)
2025-07-08T18:47:55.7083654Z Test _truncate_log_json with exactly max_lines ... ok
2025-07-08T18:47:55.7084613Z test_truncate_log_json_invalid_json (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_invalid_json)
2025-07-08T18:47:55.7086038Z Test _truncate_log_json exception handling with non-serializable data ... ok
2025-07-08T18:47:55.7087261Z test_truncate_log_json_large_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_large_data)
2025-07-08T18:47:55.7093836Z Test _truncate_log_json with data exceeding max_lines ... ok
2025-07-08T18:47:55.7100807Z test_truncate_log_json_max_lines_parameter (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_max_lines_parameter)
2025-07-08T18:47:55.7101804Z Test _truncate_log_json respects max_lines parameter ... ok
2025-07-08T18:47:55.7102622Z test_truncate_log_json_none_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_none_data)
2025-07-08T18:47:55.7103381Z Test _truncate_log_json with None ... ok
2025-07-08T18:47:55.7104115Z test_truncate_log_json_small_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_small_data)
2025-07-08T18:47:55.7104951Z Test _truncate_log_json with data smaller than max_lines ... ok
2025-07-08T18:47:55.7105325Z 
2025-07-08T18:47:55.7105522Z ----------------------------------------------------------------------
2025-07-08T18:47:55.7106128Z Ran 17 tests in 0.008s
2025-07-08T18:47:55.7106326Z 
2025-07-08T18:47:55.7106438Z OK
2025-07-08T18:47:55.7542305Z ✅ mvp_site/tests/test_firestore_helper_functions_fixed.py passed
2025-07-08T18:47:55.7548319Z ----------------------------------------
2025-07-08T18:47:55.7548859Z Running mvp_site/tests/test_firestore_helpers.py...
2025-07-08T18:47:55.8302087Z ...............
2025-07-08T18:47:55.8304414Z ----------------------------------------------------------------------
2025-07-08T18:47:55.8304929Z Ran 15 tests in 0.008s
2025-07-08T18:47:55.8305138Z 
2025-07-08T18:47:55.8305249Z OK
2025-07-08T18:47:55.8419796Z ✅ mvp_site/tests/test_firestore_helpers.py passed
2025-07-08T18:47:55.8421169Z ----------------------------------------
2025-07-08T18:47:55.8421721Z Running mvp_site/tests/test_firestore_mission_handler.py...
2025-07-08T18:47:56.1047804Z test_find_existing_mission_index_empty_list (__main__.TestMissionHandler.test_find_existing_mission_index_empty_list)
2025-07-08T18:47:56.1049404Z Test find_existing_mission_index with empty list ... ok
2025-07-08T18:47:56.1050457Z test_find_existing_mission_index_found (__main__.TestMissionHandler.test_find_existing_mission_index_found)
2025-07-08T18:47:56.1051364Z Test find_existing_mission_index when mission exists ... ok
2025-07-08T18:47:56.1052452Z test_find_existing_mission_index_invalid_mission_objects (__main__.TestMissionHandler.test_find_existing_mission_index_invalid_mission_objects)
2025-07-08T18:47:56.1053583Z Test find_existing_mission_index with non-dict items in list ... ok
2025-07-08T18:47:56.1054680Z test_find_existing_mission_index_missing_mission_id (__main__.TestMissionHandler.test_find_existing_mission_index_missing_mission_id)
2025-07-08T18:47:56.1056038Z Test find_existing_mission_index when dicts lack mission_id ... ok
2025-07-08T18:47:56.1057123Z test_find_existing_mission_index_not_found (__main__.TestMissionHandler.test_find_existing_mission_index_not_found)
2025-07-08T18:47:56.1058134Z Test find_existing_mission_index when mission doesn't exist ... ok
2025-07-08T18:47:56.1059179Z test_handle_active_missions_conversion_dict (__main__.TestMissionHandler.test_handle_active_missions_conversion_dict)
2025-07-08T18:47:56.1066146Z Test handle_active_missions_conversion with dict value ... ok
2025-07-08T18:47:56.1068295Z test_handle_active_missions_conversion_invalid_type (__main__.TestMissionHandler.test_handle_active_missions_conversion_invalid_type)
2025-07-08T18:47:56.1075497Z Test handle_active_missions_conversion with non-dict, non-list value ... ok
2025-07-08T18:47:56.1077176Z test_handle_missions_dict_conversion (__main__.TestMissionHandler.test_handle_missions_dict_conversion)
2025-07-08T18:47:56.1082854Z Test handle_missions_dict_conversion with dict of missions ... ok
2025-07-08T18:47:56.1084300Z test_handle_missions_dict_conversion_empty (__main__.TestMissionHandler.test_handle_missions_dict_conversion_empty)
2025-07-08T18:47:56.1086655Z Test handle_missions_dict_conversion with empty dict ... ok
2025-07-08T18:47:56.1087765Z test_handle_missions_dict_conversion_mixed_types (__main__.TestMissionHandler.test_handle_missions_dict_conversion_mixed_types)
2025-07-08T18:47:56.1088975Z Test handle_missions_dict_conversion with various invalid types ... ok
2025-07-08T18:47:56.1090343Z test_initialize_missions_list_already_list (__main__.TestMissionHandler.test_initialize_missions_list_already_list)
2025-07-08T18:47:56.1091880Z Test initialize_missions_list when key already has a list ... ok
2025-07-08T18:47:56.1093234Z test_initialize_missions_list_missing_key (__main__.TestMissionHandler.test_initialize_missions_list_missing_key)
2025-07-08T18:47:56.1094386Z Test initialize_missions_list when key doesn't exist ... ok
2025-07-08T18:47:56.1095586Z test_initialize_missions_list_non_list_value (__main__.TestMissionHandler.test_initialize_missions_list_non_list_value)
2025-07-08T18:47:56.1097163Z Test initialize_missions_list when key exists but isn't a list ... ok
2025-07-08T18:47:56.1098526Z test_initialize_missions_list_none_value (__main__.TestMissionHandler.test_initialize_missions_list_none_value)
2025-07-08T18:47:56.1100535Z Test initialize_missions_list when key has None value ... ok
2025-07-08T18:47:56.1101880Z test_process_mission_data_adds_missing_id (__main__.TestMissionHandler.test_process_mission_data_adds_missing_id)
2025-07-08T18:47:56.1103294Z Test process_mission_data adds mission_id if missing ... ok
2025-07-08T18:47:56.1104559Z test_process_mission_data_new_mission (__main__.TestMissionHandler.test_process_mission_data_new_mission)
2025-07-08T18:47:56.1105986Z Test process_mission_data adding a new mission ... ok
2025-07-08T18:47:56.1107039Z test_process_mission_data_update_existing (__main__.TestMissionHandler.test_process_mission_data_update_existing)
2025-07-08T18:47:56.1111691Z Test process_mission_data updating an existing mission ... ok
2025-07-08T18:47:56.1112835Z 
2025-07-08T18:47:56.1113283Z ----------------------------------------------------------------------
2025-07-08T18:47:56.1116284Z Ran 17 tests in 0.007s
2025-07-08T18:47:56.1116503Z 
2025-07-08T18:47:56.1116616Z OK
2025-07-08T18:47:56.1521802Z ✅ mvp_site/tests/test_firestore_mission_handler.py passed
2025-07-08T18:47:56.1523991Z ----------------------------------------
2025-07-08T18:47:56.1524490Z Running mvp_site/tests/test_firestore_service.py...
2025-07-08T18:47:56.4219216Z .............WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:56.4221403Z .WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:56.4225974Z .....WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:56.4226973Z ..
2025-07-08T18:47:56.4227420Z ----------------------------------------------------------------------
2025-07-08T18:47:56.4228105Z Ran 21 tests in 0.004s
2025-07-08T18:47:56.4228457Z 
2025-07-08T18:47:56.4228674Z OK
2025-07-08T18:47:56.4662716Z ✅ mvp_site/tests/test_firestore_service.py passed
2025-07-08T18:47:56.4664298Z ----------------------------------------
2025-07-08T18:47:56.4664847Z Running mvp_site/tests/test_firestore_state_helpers.py...
2025-07-08T18:47:56.7288458Z test_handle_append_syntax_core_memories_dedup (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_core_memories_dedup)
2025-07-08T18:47:56.7300533Z Test _handle_append_syntax with core_memories uses deduplication ... ok
2025-07-08T18:47:56.7302282Z test_handle_append_syntax_creates_list (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_creates_list)
2025-07-08T18:47:56.7309110Z Test _handle_append_syntax creates list if missing ... ok
2025-07-08T18:47:56.7310499Z test_handle_append_syntax_no_append_key (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_no_append_key)
2025-07-08T18:47:56.7311797Z Test _handle_append_syntax with dict missing 'append' key ... ok
2025-07-08T18:47:56.7313954Z test_handle_append_syntax_not_dict (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_not_dict)
2025-07-08T18:47:56.7314926Z Test _handle_append_syntax with non-dict value ... ok
2025-07-08T18:47:56.7315987Z test_handle_append_syntax_valid (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_valid)
2025-07-08T18:47:56.7322308Z Test _handle_append_syntax with valid append syntax ... ok
2025-07-08T18:47:56.7324995Z test_handle_core_memories_safeguard_creates_list (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_creates_list)
2025-07-08T18:47:56.7331619Z Test _handle_core_memories_safeguard creates list if missing ... ok
2025-07-08T18:47:56.7333107Z test_handle_core_memories_safeguard_other_key (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_other_key)
2025-07-08T18:47:56.7336142Z Test _handle_core_memories_safeguard ignores other keys ... ok
2025-07-08T18:47:56.7338872Z test_handle_core_memories_safeguard_triggered (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_triggered)
2025-07-08T18:47:56.7343325Z Test _handle_core_memories_safeguard prevents overwrite ... ok
2025-07-08T18:47:56.7346946Z test_handle_delete_token_deletes_existing (__main__.TestFirestoreStateHelpers.test_handle_delete_token_deletes_existing)
2025-07-08T18:47:56.7348410Z Test _handle_delete_token removes existing key ... ok
2025-07-08T18:47:56.7349937Z test_handle_delete_token_missing_key (__main__.TestFirestoreStateHelpers.test_handle_delete_token_missing_key)
2025-07-08T18:47:56.7352821Z Test _handle_delete_token with non-existent key ... ok
2025-07-08T18:47:56.7355261Z test_handle_delete_token_wrong_value (__main__.TestFirestoreStateHelpers.test_handle_delete_token_wrong_value)
2025-07-08T18:47:56.7356443Z Test _handle_delete_token with value not DELETE_TOKEN ... ok
2025-07-08T18:47:56.7357709Z test_handle_dict_merge_existing_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_existing_dict)
2025-07-08T18:47:56.7361455Z Test _handle_dict_merge merges with existing dict ... ok
2025-07-08T18:47:56.7362352Z test_handle_dict_merge_new_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_new_dict)
2025-07-08T18:47:56.7363640Z Test _handle_dict_merge creates new dict when key missing ... ok
2025-07-08T18:47:56.7364937Z test_handle_dict_merge_non_dict_value (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_non_dict_value)
2025-07-08T18:47:56.7366347Z Test _handle_dict_merge with non-dict value ... ok
2025-07-08T18:47:56.7367735Z test_handle_dict_merge_overwrite_non_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_overwrite_non_dict)
2025-07-08T18:47:56.7369228Z Test _handle_dict_merge overwrites non-dict existing value ... ok
2025-07-08T18:47:56.7370620Z test_handle_string_to_dict_update_missing_key (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_missing_key)
2025-07-08T18:47:56.7371943Z Test _handle_string_to_dict_update with missing key ... ok
2025-07-08T18:47:56.7373135Z test_handle_string_to_dict_update_non_dict_existing (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_non_dict_existing)
2025-07-08T18:47:56.7374279Z Test _handle_string_to_dict_update with non-dict existing value ... ok
2025-07-08T18:47:56.7375415Z test_handle_string_to_dict_update_overwrites_status (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_overwrites_status)
2025-07-08T18:47:56.7382865Z Test _handle_string_to_dict_update overwrites existing status ... ok
2025-07-08T18:47:56.7384372Z test_handle_string_to_dict_update_preserves_dict (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_preserves_dict)
2025-07-08T18:47:56.7386063Z Test _handle_string_to_dict_update preserves dict structure ... ok
2025-07-08T18:47:56.7387568Z test_update_state_with_changes_integration (__main__.TestFirestoreStateHelpers.test_update_state_with_changes_integration)
2025-07-08T18:47:56.7396905Z Test update_state_with_changes with various scenarios ... ok
2025-07-08T18:47:56.7397604Z 
2025-07-08T18:47:56.7397996Z ----------------------------------------------------------------------
2025-07-08T18:47:56.7398819Z Ran 20 tests in 0.011s
2025-07-08T18:47:56.7399234Z 
2025-07-08T18:47:56.7399594Z OK
2025-07-08T18:47:56.7798868Z ✅ mvp_site/tests/test_firestore_state_helpers.py passed
2025-07-08T18:47:56.7800520Z ----------------------------------------
2025-07-08T18:47:56.7801119Z Running mvp_site/tests/test_firestore_state_helpers_edge_cases.py...
2025-07-08T18:47:57.0410007Z test_handle_append_syntax_nested_append_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_append_syntax_nested_append_structure)
2025-07-08T18:47:57.0419906Z Test append syntax with nested append structure ... ok
2025-07-08T18:47:57.0421675Z test_handle_dict_merge_with_delete_token_in_value (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_dict_merge_with_delete_token_in_value)
2025-07-08T18:47:57.0427681Z Test dict merge where new dict contains DELETE_TOKEN ... ok
2025-07-08T18:47:57.0429098Z test_update_state_complex_nested_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_complex_nested_structure)
2025-07-08T18:47:57.0436537Z Test deeply nested structure updates ... ok
2025-07-08T18:47:57.0438067Z test_update_state_core_memories_multiple_attempts (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_core_memories_multiple_attempts)
2025-07-08T18:47:57.0443057Z Test multiple types of core_memories updates in one call ... ok
2025-07-08T18:47:57.0444333Z test_update_state_delete_nested_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_delete_nested_keys)
2025-07-08T18:47:57.0451145Z Test DELETE_TOKEN on nested dictionary keys ... ok
2025-07-08T18:47:57.0453444Z test_update_state_empty_changes (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_empty_changes)
2025-07-08T18:47:57.0454772Z Test update_state_with_changes with empty changes dict ... ok
2025-07-08T18:47:57.0456027Z test_update_state_list_overwrite (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_list_overwrite)
2025-07-08T18:47:57.0457034Z Test that non-append list updates do overwrite ... ok
2025-07-08T18:47:57.0458068Z test_update_state_nested_append_syntax (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_nested_append_syntax)
2025-07-08T18:47:57.0460174Z Test nested append syntax in dict values ... ok
2025-07-08T18:47:57.0465132Z test_update_state_none_values (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_none_values)
2025-07-08T18:47:57.0467431Z Test update_state_with_changes with None values ... ok
2025-07-08T18:47:57.0468408Z test_update_state_preserve_unchanged_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_preserve_unchanged_keys)
2025-07-08T18:47:57.0469342Z Test that unchanged keys are preserved ... ok
2025-07-08T18:47:57.0469634Z 
2025-07-08T18:47:57.0469854Z ----------------------------------------------------------------------
2025-07-08T18:47:57.0470303Z Ran 10 tests in 0.006s
2025-07-08T18:47:57.0470503Z 
2025-07-08T18:47:57.0470609Z OK
2025-07-08T18:47:57.0866433Z ✅ mvp_site/tests/test_firestore_state_helpers_edge_cases.py passed
2025-07-08T18:47:57.0868164Z ----------------------------------------
2025-07-08T18:47:57.0868632Z Running mvp_site/tests/test_game_state.py...
2025-07-08T18:47:58.0339526Z ....................2025-07-08 18:47:58,033 - INFO - Performing one-time cleanup. Deleting 3 legacy keys: ['player.name', 'player.level', 'world.location']
2025-07-08T18:47:58.0341335Z .2025-07-08 18:47:58,033 - INFO - Performing one-time cleanup. Deleting 1 legacy keys: ['world_time']
2025-07-08T18:47:58.0343824Z .......2025-07-08 18:47:58,034 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: invalid_key = invalid_json
2025-07-08T18:47:58.0347770Z ....2025-07-08 18:47:58,034 - INFO - APPEND/SAFEGUARD: Added 7 new items to 'test_key'.
2025-07-08T18:47:58.0349204Z .2025-07-08 18:47:58,034 - INFO - APPEND/SAFEGUARD: No new items were added to 'test_key' (duplicates may have been found).
2025-07-08T18:47:58.0350432Z .2025-07-08 18:47:58,034 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T18:47:58.0356846Z .2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T18:47:58.0357980Z .2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T18:47:58.0361336Z .2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T18:47:58.0362178Z .2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0362752Z   "core_memories": [
2025-07-08T18:47:58.0363060Z     "memory2",
2025-07-08T18:47:58.0363326Z     "memory3"
2025-07-08T18:47:58.0363609Z   ]
2025-07-08T18:47:58.0363870Z }
2025-07-08T18:47:58.0365004Z 2025-07-08 18:47:58,035 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:58.0366445Z 2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T18:47:58.0367279Z 2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0368514Z .2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0369193Z   "core_memories": [
2025-07-08T18:47:58.0369556Z     "new_memory1",
2025-07-08T18:47:58.0369902Z     "new_memory2"
2025-07-08T18:47:58.0370213Z   ]
2025-07-08T18:47:58.0370496Z }
2025-07-08T18:47:58.0371624Z 2025-07-08 18:47:58,035 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:58.0372855Z 2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T18:47:58.0373644Z 2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0374640Z .2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0375264Z   "core_memories": [
2025-07-08T18:47:58.0375611Z     "memory1",
2025-07-08T18:47:58.0376115Z     "memory2"
2025-07-08T18:47:58.0376425Z   ]
2025-07-08T18:47:58.0376708Z }
2025-07-08T18:47:58.0377834Z 2025-07-08 18:47:58,035 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:58.0379052Z 2025-07-08 18:47:58,035 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T18:47:58.0379882Z 2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0380659Z .2025-07-08 18:47:58,035 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0381293Z   "level1": {
2025-07-08T18:47:58.0381615Z     "level2": {
2025-07-08T18:47:58.0381934Z       "level3": {
2025-07-08T18:47:58.0382276Z         "value": "new",
2025-07-08T18:47:58.0382638Z         "add": "this"
2025-07-08T18:47:58.0382965Z       }
2025-07-08T18:47:58.0383237Z     }
2025-07-08T18:47:58.0383513Z   }
2025-07-08T18:47:58.0383785Z }
2025-07-08T18:47:58.0384376Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0386052Z   "level2": {
2025-07-08T18:47:58.0386370Z     "level3": {
2025-07-08T18:47:58.0386703Z       "value": "new",
2025-07-08T18:47:58.0387060Z       "add": "this"
2025-07-08T18:47:58.0387384Z     }
2025-07-08T18:47:58.0387661Z   }
2025-07-08T18:47:58.0387916Z }
2025-07-08T18:47:58.0388596Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0389331Z   "level3": {
2025-07-08T18:47:58.0389740Z     "value": "new",
2025-07-08T18:47:58.0390149Z     "add": "this"
2025-07-08T18:47:58.0390542Z   }
2025-07-08T18:47:58.0390889Z }
2025-07-08T18:47:58.0391444Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0392184Z   "value": "new",
2025-07-08T18:47:58.0392614Z   "add": "this"
2025-07-08T18:47:58.0393015Z }
2025-07-08T18:47:58.0393544Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0394451Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0395348Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0396378Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0397281Z .2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0398041Z   "items": {
2025-07-08T18:47:58.0398447Z     "append": [
2025-07-08T18:47:58.0398860Z       "potion",
2025-07-08T18:47:58.0399256Z       "key"
2025-07-08T18:47:58.0399632Z     ]
2025-07-08T18:47:58.0399982Z   }
2025-07-08T18:47:58.0400325Z }
2025-07-08T18:47:58.0400881Z 2025-07-08 18:47:58,036 - INFO - update_state: Detected explicit append for 'items'.
2025-07-08T18:47:58.0401853Z 2025-07-08 18:47:58,036 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'items'.
2025-07-08T18:47:58.0402747Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0403897Z .2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0404724Z   "key": {
2025-07-08T18:47:58.0405125Z     "append": [
2025-07-08T18:47:58.0405531Z       "item1"
2025-07-08T18:47:58.0406073Z     ]
2025-07-08T18:47:58.0406442Z   }
2025-07-08T18:47:58.0406797Z }
2025-07-08T18:47:58.0407349Z 2025-07-08 18:47:58,036 - INFO - update_state: Detected explicit append for 'key'.
2025-07-08T18:47:58.0408287Z 2025-07-08 18:47:58,036 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'key'.
2025-07-08T18:47:58.0409179Z 2025-07-08 18:47:58,036 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0410077Z .2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0411114Z   "new_list": {
2025-07-08T18:47:58.0411542Z     "append": [
2025-07-08T18:47:58.0411971Z       "item1",
2025-07-08T18:47:58.0412379Z       "item2"
2025-07-08T18:47:58.0412753Z     ]
2025-07-08T18:47:58.0413114Z   }
2025-07-08T18:47:58.0413453Z }
2025-07-08T18:47:58.0414033Z 2025-07-08 18:47:58,037 - INFO - update_state: Detected explicit append for 'new_list'.
2025-07-08T18:47:58.0414993Z 2025-07-08 18:47:58,037 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'new_list'.
2025-07-08T18:47:58.0416004Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0416837Z .2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0417585Z   "player": {
2025-07-08T18:47:58.0417999Z     "level": 2,
2025-07-08T18:47:58.0418413Z     "gold": 100
2025-07-08T18:47:58.0418803Z   },
2025-07-08T18:47:58.0419173Z   "inventory": {
2025-07-08T18:47:58.0419583Z     "append": [
2025-07-08T18:47:58.0419998Z       "potion"
2025-07-08T18:47:58.0420415Z     ]
2025-07-08T18:47:58.0420771Z   },
2025-07-08T18:47:58.0421148Z   "core_memories": [
2025-07-08T18:47:58.0421584Z     "memory1",
2025-07-08T18:47:58.0421994Z     "memory2"
2025-07-08T18:47:58.0422370Z   ],
2025-07-08T18:47:58.0422758Z   "simple_value": "new",
2025-07-08T18:47:58.0423254Z   "new_key": "new_value"
2025-07-08T18:47:58.0423718Z }
2025-07-08T18:47:58.0424273Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0425018Z   "level": 2,
2025-07-08T18:47:58.0425416Z   "gold": 100
2025-07-08T18:47:58.0425984Z }
2025-07-08T18:47:58.0426508Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0427439Z 2025-07-08 18:47:58,037 - INFO - update_state: Detected explicit append for 'inventory'.
2025-07-08T18:47:58.0428406Z 2025-07-08 18:47:58,037 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'inventory'.
2025-07-08T18:47:58.0430014Z 2025-07-08 18:47:58,037 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T18:47:58.0431426Z 2025-07-08 18:47:58,037 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T18:47:58.0432381Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0433321Z .2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0433984Z   "player": {
2025-07-08T18:47:58.0439542Z     "level": 2,
2025-07-08T18:47:58.0441452Z     "stats": {
2025-07-08T18:47:58.0441727Z       "mp": 50
2025-07-08T18:47:58.0441996Z     }
2025-07-08T18:47:58.0442232Z   },
2025-07-08T18:47:58.0442469Z   "world": {
2025-07-08T18:47:58.0442736Z     "weather": "sunny"
2025-07-08T18:47:58.0443026Z   }
2025-07-08T18:47:58.0443259Z }
2025-07-08T18:47:58.0443677Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0444203Z   "level": 2,
2025-07-08T18:47:58.0444490Z   "stats": {
2025-07-08T18:47:58.0444743Z     "mp": 50
2025-07-08T18:47:58.0444980Z   }
2025-07-08T18:47:58.0445202Z }
2025-07-08T18:47:58.0445598Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0446290Z   "mp": 50
2025-07-08T18:47:58.0446756Z }
2025-07-08T18:47:58.0447176Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0447795Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0448429Z 2025-07-08 18:47:58,037 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0448965Z   "weather": "sunny"
2025-07-08T18:47:58.0449264Z }
2025-07-08T18:47:58.0449638Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0450256Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0450894Z .2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0451645Z   "key1": "new_value",
2025-07-08T18:47:58.0451942Z   "key3": "added_value"
2025-07-08T18:47:58.0452228Z }
2025-07-08T18:47:58.0452596Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0453270Z .2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0453801Z   "game_data": {
2025-07-08T18:47:58.0454077Z     "player_info": {
2025-07-08T18:47:58.0454367Z       "character_sheet": {
2025-07-08T18:47:58.0454697Z         "name": "UpdatedHero",
2025-07-08T18:47:58.0455034Z         "level": 5,
2025-07-08T18:47:58.0455346Z         "health_ratio": 0.8,
2025-07-08T18:47:58.0455840Z         "is_active": false,
2025-07-08T18:47:58.0456173Z         "special_items": [
2025-07-08T18:47:58.0456483Z           "magic_ring"
2025-07-08T18:47:58.0456764Z         ],
2025-07-08T18:47:58.0457010Z         "skills": {
2025-07-08T18:47:58.0457285Z           "append": [
2025-07-08T18:47:58.0457585Z             "fireball",
2025-07-08T18:47:58.0457876Z             "heal"
2025-07-08T18:47:58.0458140Z           ]
2025-07-08T18:47:58.0458377Z         },
2025-07-08T18:47:58.0458628Z         "attributes": {
2025-07-08T18:47:58.0458925Z           "strength": 15,
2025-07-08T18:47:58.0459252Z ... (truncated, showing 19/60 lines)
2025-07-08T18:47:58.0459791Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0460320Z   "player_info": {
2025-07-08T18:47:58.0460599Z     "character_sheet": {
2025-07-08T18:47:58.0460920Z       "name": "UpdatedHero",
2025-07-08T18:47:58.0461238Z       "level": 5,
2025-07-08T18:47:58.0461518Z       "health_ratio": 0.8,
2025-07-08T18:47:58.0461821Z       "is_active": false,
2025-07-08T18:47:58.0462129Z       "special_items": [
2025-07-08T18:47:58.0462432Z         "magic_ring"
2025-07-08T18:47:58.0462689Z       ],
2025-07-08T18:47:58.0462938Z       "skills": {
2025-07-08T18:47:58.0463220Z         "append": [
2025-07-08T18:47:58.0463500Z           "fireball",
2025-07-08T18:47:58.0463773Z           "heal"
2025-07-08T18:47:58.0464040Z         ]
2025-07-08T18:47:58.0464274Z       },
2025-07-08T18:47:58.0464525Z       "attributes": {
2025-07-08T18:47:58.0464820Z         "strength": 15,
2025-07-08T18:47:58.0465118Z         "wisdom": 14
2025-07-08T18:47:58.0465418Z ... (truncated, showing 19/23 lines)
2025-07-08T18:47:58.0466097Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0466643Z   "character_sheet": {
2025-07-08T18:47:58.0466946Z     "name": "UpdatedHero",
2025-07-08T18:47:58.0467246Z     "level": 5,
2025-07-08T18:47:58.0467527Z     "health_ratio": 0.8,
2025-07-08T18:47:58.0467830Z     "is_active": false,
2025-07-08T18:47:58.0468135Z     "special_items": [
2025-07-08T18:47:58.0468421Z       "magic_ring"
2025-07-08T18:47:58.0468670Z     ],
2025-07-08T18:47:58.0468912Z     "skills": {
2025-07-08T18:47:58.0469176Z       "append": [
2025-07-08T18:47:58.0469451Z         "fireball",
2025-07-08T18:47:58.0469727Z         "heal"
2025-07-08T18:47:58.0469981Z       ]
2025-07-08T18:47:58.0470207Z     },
2025-07-08T18:47:58.0470450Z     "attributes": {
2025-07-08T18:47:58.0470734Z       "strength": 15,
2025-07-08T18:47:58.0471009Z       "wisdom": 14
2025-07-08T18:47:58.0471284Z     }
2025-07-08T18:47:58.0471749Z ... (truncated, showing 19/21 lines)
2025-07-08T18:47:58.0472289Z 2025-07-08 18:47:58,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0472812Z   "name": "UpdatedHero",
2025-07-08T18:47:58.0473112Z   "level": 5,
2025-07-08T18:47:58.0473380Z   "health_ratio": 0.8,
2025-07-08T18:47:58.0473684Z   "is_active": false,
2025-07-08T18:47:58.0473977Z   "special_items": [
2025-07-08T18:47:58.0474262Z     "magic_ring"
2025-07-08T18:47:58.0474524Z   ],
2025-07-08T18:47:58.0474763Z   "skills": {
2025-07-08T18:47:58.0475025Z     "append": [
2025-07-08T18:47:58.0475283Z       "fireball",
2025-07-08T18:47:58.0475552Z       "heal"
2025-07-08T18:47:58.0476137Z     ]
2025-07-08T18:47:58.0476362Z   },
2025-07-08T18:47:58.0476620Z   "attributes": {
2025-07-08T18:47:58.0476903Z     "strength": 15,
2025-07-08T18:47:58.0477173Z     "wisdom": 14
2025-07-08T18:47:58.0477441Z   }
2025-07-08T18:47:58.0477680Z }
2025-07-08T18:47:58.0478110Z 2025-07-08 18:47:58,039 - INFO - update_state: Detected explicit append for 'skills'.
2025-07-08T18:47:58.0478821Z 2025-07-08 18:47:58,039 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'skills'.
2025-07-08T18:47:58.0479479Z 2025-07-08 18:47:58,039 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0480007Z   "strength": 15,
2025-07-08T18:47:58.0480285Z   "wisdom": 14
2025-07-08T18:47:58.0480539Z }
2025-07-08T18:47:58.0480904Z 2025-07-08 18:47:58,039 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0481499Z 2025-07-08 18:47:58,039 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0482091Z 2025-07-08 18:47:58,039 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0482706Z 2025-07-08 18:47:58,039 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0483310Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0483843Z   "environment": {
2025-07-08T18:47:58.0484152Z     "current_location": {
2025-07-08T18:47:58.0484471Z       "danger_level": 2,
2025-07-08T18:47:58.0484796Z       "weather_factor": 0.3,
2025-07-08T18:47:58.0485140Z       "is_discovered": false,
2025-07-08T18:47:58.0485507Z       "hidden_treasure": "gold_coins",
2025-07-08T18:47:58.0486015Z       "npcs": {
2025-07-08T18:47:58.0486273Z         "append": [
2025-07-08T18:47:58.0486598Z           "merchant",
2025-07-08T18:47:58.0486877Z           "guard"
2025-07-08T18:47:58.0487137Z         ]
2025-07-08T18:47:58.0487377Z       },
2025-07-08T18:47:58.0487619Z       "connections": {
2025-07-08T18:47:58.0487914Z         "east": "mountain",
2025-07-08T18:47:58.0488221Z         "west": null
2025-07-08T18:47:58.0488506Z       }
2025-07-08T18:47:58.0488742Z     }
2025-07-08T18:47:58.0488974Z   }
2025-07-08T18:47:58.0489190Z }
2025-07-08T18:47:58.0489580Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0490111Z   "current_location": {
2025-07-08T18:47:58.0490414Z     "danger_level": 2,
2025-07-08T18:47:58.0490717Z     "weather_factor": 0.3,
2025-07-08T18:47:58.0491028Z     "is_discovered": false,
2025-07-08T18:47:58.0491367Z     "hidden_treasure": "gold_coins",
2025-07-08T18:47:58.0491703Z     "npcs": {
2025-07-08T18:47:58.0491955Z       "append": [
2025-07-08T18:47:58.0492228Z         "merchant",
2025-07-08T18:47:58.0492491Z         "guard"
2025-07-08T18:47:58.0492737Z       ]
2025-07-08T18:47:58.0492958Z     },
2025-07-08T18:47:58.0493192Z     "connections": {
2025-07-08T18:47:58.0493478Z       "east": "mountain",
2025-07-08T18:47:58.0493773Z       "west": null
2025-07-08T18:47:58.0494026Z     }
2025-07-08T18:47:58.0494248Z   }
2025-07-08T18:47:58.0494467Z }
2025-07-08T18:47:58.0494853Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0495385Z   "danger_level": 2,
2025-07-08T18:47:58.0495825Z   "weather_factor": 0.3,
2025-07-08T18:47:58.0496138Z   "is_discovered": false,
2025-07-08T18:47:58.0496649Z   "hidden_treasure": "gold_coins",
2025-07-08T18:47:58.0496994Z   "npcs": {
2025-07-08T18:47:58.0497245Z     "append": [
2025-07-08T18:47:58.0497498Z       "merchant",
2025-07-08T18:47:58.0497763Z       "guard"
2025-07-08T18:47:58.0498006Z     ]
2025-07-08T18:47:58.0498230Z   },
2025-07-08T18:47:58.0498466Z   "connections": {
2025-07-08T18:47:58.0498743Z     "east": "mountain",
2025-07-08T18:47:58.0499026Z     "west": null
2025-07-08T18:47:58.0499283Z   }
2025-07-08T18:47:58.0499502Z }
2025-07-08T18:47:58.0499892Z 2025-07-08 18:47:58,040 - INFO - update_state: Detected explicit append for 'npcs'.
2025-07-08T18:47:58.0500542Z 2025-07-08 18:47:58,040 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'npcs'.
2025-07-08T18:47:58.0501357Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0501856Z   "east": "mountain",
2025-07-08T18:47:58.0502138Z   "west": null
2025-07-08T18:47:58.0502391Z }
2025-07-08T18:47:58.0502751Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0503348Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0503937Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0504602Z 2025-07-08 18:47:58,040 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0505308Z 2025-07-08 18:47:58,041 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0506128Z   "session_info": {
2025-07-08T18:47:58.0506523Z     "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T18:47:58.0507200Z     "session_id": 12345,
2025-07-08T18:47:58.0507636Z     "is_tutorial": false,
2025-07-08T18:47:58.0508003Z     "notes": null,
2025-07-08T18:47:58.0520795Z     "participants": [
2025-07-08T18:47:58.0521186Z       "player1"
2025-07-08T18:47:58.0521475Z     ],
2025-07-08T18:47:58.0521725Z     "settings": {
2025-07-08T18:47:58.0522026Z       "difficulty": "normal",
2025-07-08T18:47:58.0522367Z       "auto_save": true
2025-07-08T18:47:58.0522651Z     }
2025-07-08T18:47:58.0522880Z   }
2025-07-08T18:47:58.0523104Z }
2025-07-08T18:47:58.0523519Z 2025-07-08 18:47:58,041 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0524040Z   "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T18:47:58.0524398Z   "session_id": 12345,
2025-07-08T18:47:58.0524692Z   "is_tutorial": false,
2025-07-08T18:47:58.0524970Z   "notes": null,
2025-07-08T18:47:58.0525252Z   "participants": [
2025-07-08T18:47:58.0525530Z     "player1"
2025-07-08T18:47:58.0525979Z   ],
2025-07-08T18:47:58.0526218Z   "settings": {
2025-07-08T18:47:58.0526492Z     "difficulty": "normal",
2025-07-08T18:47:58.0526804Z     "auto_save": true
2025-07-08T18:47:58.0527085Z   }
2025-07-08T18:47:58.0527308Z }
2025-07-08T18:47:58.0527698Z 2025-07-08 18:47:58,041 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0528211Z   "difficulty": "normal",
2025-07-08T18:47:58.0528506Z   "auto_save": true
2025-07-08T18:47:58.0528765Z }
2025-07-08T18:47:58.0529131Z 2025-07-08 18:47:58,041 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0529721Z 2025-07-08 18:47:58,042 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0530303Z 2025-07-08 18:47:58,042 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0530874Z 2025-07-08 18:47:58,042 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0531479Z .2025-07-08 18:47:58,042 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0531975Z   "container1": {
2025-07-08T18:47:58.0532232Z     "container2": {
2025-07-08T18:47:58.0532495Z       "container3": {
2025-07-08T18:47:58.0532783Z         "empty_list": {
2025-07-08T18:47:58.0533066Z           "append": [
2025-07-08T18:47:58.0533342Z             "first_item"
2025-07-08T18:47:58.0533633Z           ]
2025-07-08T18:47:58.0533871Z         },
2025-07-08T18:47:58.0534114Z         "empty_dict": {
2025-07-08T18:47:58.0534680Z           "new_key": "new_value"
2025-07-08T18:47:58.0535007Z         },
2025-07-08T18:47:58.0535244Z         "zero_int": 42,
2025-07-08T18:47:58.0535536Z         "zero_float": 3.14,
2025-07-08T18:47:58.0536018Z         "false_bool": true,
2025-07-08T18:47:58.0536348Z         "empty_string": "now_has_content",
2025-07-08T18:47:58.0536750Z         "completely_new": "brand_new_value"
2025-07-08T18:47:58.0537103Z       }
2025-07-08T18:47:58.0537325Z     }
2025-07-08T18:47:58.0537573Z ... (truncated, showing 19/21 lines)
2025-07-08T18:47:58.0538067Z 2025-07-08 18:47:58,042 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0538552Z   "container2": {
2025-07-08T18:47:58.0538821Z     "container3": {
2025-07-08T18:47:58.0539273Z       "empty_list": {
2025-07-08T18:47:58.0539558Z         "append": [
2025-07-08T18:47:58.0539820Z           "first_item"
2025-07-08T18:47:58.0540087Z         ]
2025-07-08T18:47:58.0540323Z       },
2025-07-08T18:47:58.0540558Z       "empty_dict": {
2025-07-08T18:47:58.0540861Z         "new_key": "new_value"
2025-07-08T18:47:58.0541169Z       },
2025-07-08T18:47:58.0541396Z       "zero_int": 42,
2025-07-08T18:47:58.0541676Z       "zero_float": 3.14,
2025-07-08T18:47:58.0541980Z       "false_bool": true,
2025-07-08T18:47:58.0542286Z       "empty_string": "now_has_content",
2025-07-08T18:47:58.0542664Z       "completely_new": "brand_new_value"
2025-07-08T18:47:58.0543012Z     }
2025-07-08T18:47:58.0543234Z   }
2025-07-08T18:47:58.0543458Z }
2025-07-08T18:47:58.0543849Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0544336Z   "container3": {
2025-07-08T18:47:58.0544607Z     "empty_list": {
2025-07-08T18:47:58.0544885Z       "append": [
2025-07-08T18:47:58.0545147Z         "first_item"
2025-07-08T18:47:58.0545407Z       ]
2025-07-08T18:47:58.0545630Z     },
2025-07-08T18:47:58.0546011Z     "empty_dict": {
2025-07-08T18:47:58.0546278Z       "new_key": "new_value"
2025-07-08T18:47:58.0546576Z     },
2025-07-08T18:47:58.0546818Z     "zero_int": 42,
2025-07-08T18:47:58.0547083Z     "zero_float": 3.14,
2025-07-08T18:47:58.0547372Z     "false_bool": true,
2025-07-08T18:47:58.0547675Z     "empty_string": "now_has_content",
2025-07-08T18:47:58.0548040Z     "completely_new": "brand_new_value"
2025-07-08T18:47:58.0548384Z   }
2025-07-08T18:47:58.0548608Z }
2025-07-08T18:47:58.0548994Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0549491Z   "empty_list": {
2025-07-08T18:47:58.0549753Z     "append": [
2025-07-08T18:47:58.0550008Z       "first_item"
2025-07-08T18:47:58.0550265Z     ]
2025-07-08T18:47:58.0550487Z   },
2025-07-08T18:47:58.0550715Z   "empty_dict": {
2025-07-08T18:47:58.0551055Z     "new_key": "new_value"
2025-07-08T18:47:58.0551338Z   },
2025-07-08T18:47:58.0551568Z   "zero_int": 42,
2025-07-08T18:47:58.0551824Z   "zero_float": 3.14,
2025-07-08T18:47:58.0552106Z   "false_bool": true,
2025-07-08T18:47:58.0552451Z   "empty_string": "now_has_content",
2025-07-08T18:47:58.0552833Z   "completely_new": "brand_new_value"
2025-07-08T18:47:58.0553172Z }
2025-07-08T18:47:58.0553583Z 2025-07-08 18:47:58,043 - INFO - update_state: Detected explicit append for 'empty_list'.
2025-07-08T18:47:58.0554252Z 2025-07-08 18:47:58,043 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'empty_list'.
2025-07-08T18:47:58.0554920Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:47:58.0555431Z   "new_key": "new_value"
2025-07-08T18:47:58.0555951Z }
2025-07-08T18:47:58.0556312Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0556884Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0557473Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0558033Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0558780Z 2025-07-08 18:47:58,043 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:47:58.0559244Z .
2025-07-08T18:47:58.0559549Z ----------------------------------------------------------------------
2025-07-08T18:47:58.0559969Z Ran 50 tests in 0.011s
2025-07-08T18:47:58.0560163Z 
2025-07-08T18:47:58.0560258Z OK
2025-07-08T18:47:58.2166226Z ✅ mvp_site/tests/test_game_state.py passed
2025-07-08T18:47:58.2167742Z ----------------------------------------
2025-07-08T18:47:58.2168240Z Running mvp_site/tests/test_gemini_response.py...
2025-07-08T18:47:58.8482572Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8487261Z   @validator('strength', pre=True)
2025-07-08T18:47:58.8490028Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8492717Z   @validator('dexterity', pre=True)
2025-07-08T18:47:58.8495386Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8498256Z   @validator('constitution', pre=True)
2025-07-08T18:47:58.8500974Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8503597Z   @validator('intelligence', pre=True)
2025-07-08T18:47:58.8506433Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8509634Z   @validator('wisdom', pre=True)
2025-07-08T18:47:58.8512322Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8515028Z   @validator('charisma', pre=True)
2025-07-08T18:47:58.8518551Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8521571Z   @validator('hp', pre=True)
2025-07-08T18:47:58.8524172Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8527032Z   @validator('hp_max', pre=True)
2025-07-08T18:47:58.8529700Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8532585Z   @validator('temp_hp', pre=True)
2025-07-08T18:47:58.8564323Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8567859Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T18:47:58.8593846Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8597666Z   @validator('level', pre=True)
2025-07-08T18:47:58.8600557Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8603140Z   @validator('gender')
2025-07-08T18:47:58.8605899Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8608520Z   @validator('age')
2025-07-08T18:47:58.8611143Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8613874Z   @validator('mbti')
2025-07-08T18:47:58.8616712Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8619435Z   @validator('alignment')
2025-07-08T18:47:58.8622368Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8625103Z   @validator('entity_type')
2025-07-08T18:47:58.8777276Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8781301Z   @validator('participants')
2025-07-08T18:47:58.8795220Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8798791Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T18:47:58.8801762Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:47:58.8804532Z   @validator('present_entities')
2025-07-08T18:47:58.8917087Z 2025-07-08 18:47:58,891 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:47:58.8921604Z 2025-07-08 18:47:58,892 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T18:47:58.8924022Z 2025-07-08 18:47:58,892 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:47:58.8930417Z 2025-07-08 18:47:58,892 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:47:58.8935496Z 2025-07-08 18:47:58,893 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T18:47:58.8947652Z 2025-07-08 18:47:58,894 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:47:58.8948951Z 2025-07-08 18:47:58,894 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:47:58.8951984Z 2025-07-08 18:47:58,894 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T18:47:58.8952966Z 2025-07-08 18:47:58,894 - INFO - Starting dual-pass generation
2025-07-08T18:47:58.8953661Z 2025-07-08 18:47:58,894 - INFO - Pass 1: Generating initial narrative
2025-07-08T18:47:58.8961525Z 2025-07-08 18:47:58,894 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:47:58.8962872Z 2025-07-08 18:47:58,894 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:47:58.8963910Z 2025-07-08 18:47:58,895 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:47:58.8964796Z 2025-07-08 18:47:58,895 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T18:47:58.8965808Z 2025-07-08 18:47:58,895 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T18:47:58.8966695Z 2025-07-08 18:47:58,895 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:47:58.8967990Z 2025-07-08 18:47:58,895 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:47:58.8968839Z 2025-07-08 18:47:58,895 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:47:58.8970085Z 2025-07-08 18:47:58,895 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T18:47:58.8971063Z 2025-07-08 18:47:58,895 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T18:47:58.8972247Z 2025-07-08 18:47:58,895 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:47:58.8973214Z 2025-07-08 18:47:58,895 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:47:58.8975928Z ......2025-07-08 18:47:58,897 - WARNING - ⚠️ No specific system prompts selected for initial story. Using none.
2025-07-08T18:47:58.8984371Z 2025-07-08 18:47:58,898 - INFO - Using model: gemini-1.5-flash for initial story generation.
2025-07-08T18:47:58.8990246Z .2025-07-08 18:47:58,898 - WARNING - Using deprecated create_legacy method. Switch to create() with raw response.
2025-07-08T18:47:58.9003281Z ...2025-07-08 18:47:58,900 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:47:58.9005154Z 2025-07-08 18:47:58,900 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:47:58.9006551Z 2025-07-08 18:47:58,900 - INFO - Recovered from incomplete JSON response. Narrative length: 42 characters (~10 tokens)
2025-07-08T18:47:58.9008324Z ..
2025-07-08T18:47:58.9008873Z ----------------------------------------------------------------------
2025-07-08T18:47:58.9009383Z Ran 12 tests in 0.619s
2025-07-08T18:47:58.9009595Z 
2025-07-08T18:47:58.9011291Z OK
2025-07-08T18:47:58.9907704Z ✅ mvp_site/tests/test_gemini_response.py passed
2025-07-08T18:47:58.9909323Z ----------------------------------------
2025-07-08T18:47:58.9909818Z Running mvp_site/tests/test_generator_isolated.py...
2025-07-08T18:47:59.4084098Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:579: ResourceWarning: unclosed file <_io.BufferedReader name='/tmp/tmpl3bvdrbz.pdf'>
2025-07-08T18:47:59.4086473Z   if method() is not None:
2025-07-08T18:47:59.4087038Z ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-07-08T18:47:59.4087634Z .
2025-07-08T18:47:59.4087969Z ----------------------------------------------------------------------
2025-07-08T18:47:59.4088445Z Ran 1 test in 0.097s
2025-07-08T18:47:59.4088637Z 
2025-07-08T18:47:59.4088746Z OK
2025-07-08T18:47:59.4089036Z \n--- Running PDF Generation Test ---
2025-07-08T18:47:59.4089449Z INFO: DejaVuSans.ttf found and loaded.
2025-07-08T18:47:59.4089897Z --- PDF Generation Test Finished Successfully ---
2025-07-08T18:47:59.4764439Z ✅ mvp_site/tests/test_generator_isolated.py passed
2025-07-08T18:47:59.4766569Z ----------------------------------------
2025-07-08T18:47:59.4767148Z Running mvp_site/tests/test_god_mode_json_display_red_green.py...
2025-07-08T18:47:59.5224204Z .......
2025-07-08T18:47:59.5225482Z ----------------------------------------------------------------------
2025-07-08T18:47:59.5227506Z Ran 7 tests in 0.001s
2025-07-08T18:47:59.5227731Z 
2025-07-08T18:47:59.5227847Z OK
2025-07-08T18:47:59.5302788Z ✅ mvp_site/tests/test_god_mode_json_display_red_green.py passed
2025-07-08T18:47:59.5304194Z ----------------------------------------
2025-07-08T18:47:59.5304745Z Running mvp_site/tests/test_god_mode_json_logging_bug.py...
2025-07-08T18:47:59.5764215Z ....
2025-07-08T18:47:59.5766616Z POTENTIAL BUG: Double JSON encoding detected
2025-07-08T18:47:59.5767486Z BUG DETECTED: Raw JSON would be logged instead of narrative
2025-07-08T18:47:59.5768949Z ----------------------------------------------------------------------
2025-07-08T18:47:59.5770838Z Ran 4 tests in 0.000s
2025-07-08T18:47:59.5771568Z 
2025-07-08T18:47:59.5771810Z OK
2025-07-08T18:47:59.5839986Z ✅ mvp_site/tests/test_god_mode_json_logging_bug.py passed
2025-07-08T18:47:59.5841432Z ----------------------------------------
2025-07-08T18:47:59.5841972Z Running mvp_site/tests/test_god_mode_response_field.py...
2025-07-08T18:47:59.6293228Z ........
2025-07-08T18:47:59.6294016Z ----------------------------------------------------------------------
2025-07-08T18:47:59.6295498Z Ran 8 tests in 0.001s
2025-07-08T18:47:59.6297400Z 
2025-07-08T18:47:59.6297529Z OK
2025-07-08T18:47:59.6367117Z ✅ mvp_site/tests/test_god_mode_response_field.py passed
2025-07-08T18:47:59.6367949Z ----------------------------------------
2025-07-08T18:47:59.6368782Z Running mvp_site/tests/test_god_mode_response_parsing_debug.py...
2025-07-08T18:47:59.6822894Z test_check_narrative_response_schema (__main__.TestGodModeResponseParsingDebug.test_check_narrative_response_schema)
2025-07-08T18:47:59.6828449Z Check if NarrativeResponse schema supports god_mode_response field. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_check_narrative_response_schema of <__main__.TestGodModeResponseParsingDebug testMethod=test_check_narrative_response_schema>>)
2025-07-08T18:47:59.6834581Z   return self.run(*args, **kwds)
2025-07-08T18:47:59.6834936Z ok
2025-07-08T18:47:59.6835623Z test_luke_campaign_scene_31_exact_debug (__main__.TestGodModeResponseParsingDebug.test_luke_campaign_scene_31_exact_debug)
2025-07-08T18:47:59.6836719Z Debug the exact Scene #31 response from Luke's campaign. ... ok
2025-07-08T18:47:59.6837761Z test_narrative_response_creation_with_god_mode (__main__.TestGodModeResponseParsingDebug.test_narrative_response_creation_with_god_mode)
2025-07-08T18:47:59.6838817Z Test if NarrativeResponse creation fails with god mode data. ... ok
2025-07-08T18:47:59.6839714Z test_simulate_parsing_paths (__main__.TestGodModeResponseParsingDebug.test_simulate_parsing_paths)
2025-07-08T18:47:59.6842446Z Simulate different parsing paths to see which one is taken. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_simulate_parsing_paths of <__main__.TestGodModeResponseParsingDebug testMethod=test_simulate_parsing_paths>>)
2025-07-08T18:47:59.6844839Z   return self.run(*args, **kwds)
2025-07-08T18:47:59.6845221Z ok
2025-07-08T18:47:59.6845372Z 
2025-07-08T18:47:59.6845592Z ----------------------------------------------------------------------
2025-07-08T18:47:59.6846238Z Ran 4 tests in 0.001s
2025-07-08T18:47:59.6846444Z 
2025-07-08T18:47:59.6846555Z OK
2025-07-08T18:47:59.6846838Z NarrativeResponse fields: {}
2025-07-08T18:47:59.6847250Z God mode response creation succeeded
2025-07-08T18:47:59.6848157Z JSON parsing successful. Keys: ['narrative', 'god_mode_response', 'entities_mentioned', 'location_confirmed', 'state_updates', 'debug_info']
2025-07-08T18:47:59.6848935Z narrative: ''
2025-07-08T18:47:59.6849209Z god_mode_response length: 1322
2025-07-08T18:47:59.6849610Z parse_structured_response succeeded
2025-07-08T18:47:59.6850569Z Returned narrative_text: 'That's another excellent point, and I understand why you'd expect EXP for such a significant and imp...' (length: 1322)
2025-07-08T18:47:59.6851761Z Structured response type: <class 'narrative_response_schema.NarrativeResponse'>
2025-07-08T18:47:59.6852462Z NarrativeResponse creation succeeded
2025-07-08T18:47:59.6852911Z Has god_mode_response attr: True
2025-07-08T18:47:59.6853370Z god_mode_response value: Test god mode response
2025-07-08T18:47:59.6853901Z MAIN PATH: NarrativeResponse creation succeeded
2025-07-08T18:47:59.6854419Z MAIN PATH: god_mode_response detected
2025-07-08T18:47:59.6854986Z MAIN PATH: Combined response: 'Test response for path debugging'
2025-07-08T18:47:59.6912789Z ✅ mvp_site/tests/test_god_mode_response_parsing_debug.py passed
2025-07-08T18:47:59.6914242Z ----------------------------------------
2025-07-08T18:47:59.6914753Z Running mvp_site/tests/test_hp_unknown_values.py...
2025-07-08T18:47:59.8682648Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:59.8684228Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:47:59.8686354Z .WARNING:root:⚠️ Failed to convert '' to int for field 'hp'. Using default: 1
2025-07-08T18:47:59.8687918Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:47:59.8689337Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp'. Using default: 1
2025-07-08T18:47:59.8690818Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp_max'. Using default: 1
2025-07-08T18:47:59.8693338Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T18:47:59.8694255Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:47:59.8695133Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T18:47:59.8696411Z ..WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:47:59.8696948Z ....
2025-07-08T18:47:59.8697478Z ----------------------------------------------------------------------
2025-07-08T18:47:59.8698084Z Ran 13 tests in 0.001s
2025-07-08T18:47:59.8698399Z 
2025-07-08T18:47:59.8698649Z OK
2025-07-08T18:47:59.8939274Z ✅ mvp_site/tests/test_hp_unknown_values.py passed
2025-07-08T18:47:59.8940707Z ----------------------------------------
2025-07-08T18:47:59.8941256Z Running mvp_site/tests/test_incomplete_json_recovery.py...
2025-07-08T18:47:59.9634920Z .......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:47:59.9645103Z ...
2025-07-08T18:47:59.9646247Z ----------------------------------------------------------------------
2025-07-08T18:47:59.9646755Z Ran 10 tests in 0.005s
2025-07-08T18:47:59.9647386Z 
2025-07-08T18:47:59.9648140Z OK
2025-07-08T18:47:59.9759442Z ✅ mvp_site/tests/test_incomplete_json_recovery.py passed
2025-07-08T18:47:59.9761057Z ----------------------------------------
2025-07-08T18:47:59.9761562Z Running mvp_site/tests/test_json_bug_fix.py...
2025-07-08T18:48:00.0041247Z ============================================================
2025-07-08T18:48:00.0041996Z JSON Bug Root Cause Test
2025-07-08T18:48:00.0042653Z ============================================================
2025-07-08T18:48:00.0044053Z Testing parse_structured_response with raw JSON...
2025-07-08T18:48:00.0044564Z Input (first 100 chars): {
2025-07-08T18:48:00.0045242Z     "narrative": "[Mode: STORY MODE]\n[SESSION_HEADER]\nTimestamp: Year 11 New Peace, Kythorn Day ...
2025-07-08T18:48:00.0047094Z 
2025-07-08T18:48:00.0047442Z 🔍 Results:
2025-07-08T18:48:00.0047789Z    response_text type: <class 'str'>
2025-07-08T18:48:00.0048238Z    response_text starts with '{': False
2025-07-08T18:48:00.0048733Z    response_text first 200 chars: [Mode: STORY MODE]
2025-07-08T18:48:00.0049189Z [SESSION_HEADER]
2025-07-08T18:48:00.0049584Z Timestamp: Year 11 New Peace, Kythorn Day 2, 08:00
2025-07-08T18:48:00.0050086Z Location: Character Creation
2025-07-08T18:48:00.0050553Z Status: Lvl 1 Unknown | HP: 0/0 (Temp: 0) | XP: 0/300 | Gold: 0gp
2025-07-08T18:48:00.0050979Z Resources: HD: 0/0
2025-07-08T18:48:00.0051318Z    structured_response exists: True
2025-07-08T18:48:00.0051599Z 
2025-07-08T18:48:00.0051958Z ✅ parse_structured_response correctly extracted narrative!
2025-07-08T18:48:00.0052387Z 
2025-07-08T18:48:00.0052666Z 🟢 parse_structured_response works correctly
2025-07-08T18:48:00.0090975Z ✅ mvp_site/tests/test_json_bug_fix.py passed
2025-07-08T18:48:00.0092322Z ----------------------------------------
2025-07-08T18:48:00.0092811Z Running mvp_site/tests/test_json_bug_green.py...
2025-07-08T18:48:00.0458446Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:00.0459098Z ============================================================
2025-07-08T18:48:00.0462594Z 🟢 GREEN TEST: JSON Bug Fix Verification
2025-07-08T18:48:00.0463526Z ============================================================
2025-07-08T18:48:00.0464841Z Test 1: Well-formed JSON
2025-07-08T18:48:00.0467237Z   Result starts with '{': False
2025-07-08T18:48:00.0467857Z   Result: [Mode: STORY MODE]
2025-07-08T18:48:00.0468446Z You enter the dark cave......
2025-07-08T18:48:00.0468954Z 
2025-07-08T18:48:00.0469600Z Test 2: Malformed JSON without proper structure
2025-07-08T18:48:00.0470289Z   Result starts with '{': True
2025-07-08T18:48:00.0471028Z   Result: {"Some malformed JSON that would cause the bug...
2025-07-08T18:48:00.0472201Z   ⚠️  EXPECTED: Malformed JSON returned as fallback
2025-07-08T18:48:00.0472968Z   This is expected behavior for completely broken JSON
2025-07-08T18:48:00.0473609Z 
2025-07-08T18:48:00.0473991Z Test 3: JSON that triggers the temporary fix
2025-07-08T18:48:00.0474609Z   Result: The story text that should be extracted
2025-07-08T18:48:00.0475494Z   ✅ Narrative correctly extracted
2025-07-08T18:48:00.0476099Z 
2025-07-08T18:48:00.0476316Z Test 4: Full flow with GeminiResponse creation
2025-07-08T18:48:00.0476970Z   narrative_text: You chose option 2. Let me create a character for ...
2025-07-08T18:48:00.0477562Z   narrative_text starts with '{': False
2025-07-08T18:48:00.0478211Z   ✅ Full flow works correctly - no JSON in narrative_text
2025-07-08T18:48:00.0478582Z 
2025-07-08T18:48:00.0478775Z ✅ TESTS PASSED!
2025-07-08T18:48:00.0479126Z The JSON bug has been fixed successfully.
2025-07-08T18:48:00.0479640Z Note: Malformed JSON fallback is expected behavior.
2025-07-08T18:48:00.0527195Z ✅ mvp_site/tests/test_json_bug_green.py passed
2025-07-08T18:48:00.0528519Z ----------------------------------------
2025-07-08T18:48:00.0529016Z Running mvp_site/tests/test_json_bug_scenario.py...
2025-07-08T18:48:00.6962030Z 2025-07-08 18:48:00,695 - INFO - STRUCTURED_GENERATION: Coverage rate 1.00, Schema valid: True
2025-07-08T18:48:00.6962763Z ============================================================
2025-07-08T18:48:00.6963208Z Exact JSON Bug Scenario Test
2025-07-08T18:48:00.6963616Z ============================================================
2025-07-08T18:48:00.6964109Z 1. Testing _get_text_from_response simulation...
2025-07-08T18:48:00.6964583Z 2. Testing _process_structured_response...
2025-07-08T18:48:00.6964866Z 
2025-07-08T18:48:00.6965321Z 🔍 After _process_structured_response:
2025-07-08T18:48:00.6965971Z    response_text type: <class 'str'>
2025-07-08T18:48:00.6966384Z    response_text starts with '{': False
2025-07-08T18:48:00.6966782Z    response_text[:100]: [Mode: STORY MODE]
2025-07-08T18:48:00.6967198Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T18:48:00.6967476Z 
2025-07-08T18:48:00.6967645Z "Excellent choice, adventurer!" The voice tha
2025-07-08T18:48:00.6967933Z 
2025-07-08T18:48:00.6968217Z ✅ No bug found - response_text is clean narrative
2025-07-08T18:48:00.6968530Z 
2025-07-08T18:48:00.6968764Z 🟢 Could not reproduce bug with this scenario
2025-07-08T18:48:00.7782107Z ✅ mvp_site/tests/test_json_bug_scenario.py passed
2025-07-08T18:48:00.7783601Z ----------------------------------------
2025-07-08T18:48:00.7784196Z Running mvp_site/tests/test_json_bug_state_updates.py...
2025-07-08T18:48:00.8078532Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:00.8079094Z Initial response_text (clean):
2025-07-08T18:48:00.8079783Z   Starts with '{': False
2025-07-08T18:48:00.8082000Z   First 100 chars: [Mode: STORY MODE]
2025-07-08T18:48:00.8082471Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T18:48:00.8082768Z 
2025-07-08T18:48:00.8082961Z "Excellent choice, adventurer!" The voice tha
2025-07-08T18:48:00.8083287Z 
2025-07-08T18:48:00.8083444Z After appending state updates:
2025-07-08T18:48:00.8083858Z   Length increased from 155 to 315
2025-07-08T18:48:00.8084287Z   Still starts with '{': False
2025-07-08T18:48:00.8084713Z   Contains 'STATE_UPDATES_PROPOSED': True
2025-07-08T18:48:00.8085038Z 
2025-07-08T18:48:00.8085231Z Conclusion: State updates don't cause the JSON bug
2025-07-08T18:48:00.8085618Z 
2025-07-08T18:48:00.8085984Z ============================================================
2025-07-08T18:48:00.8086948Z Testing edge cases where parse_structured_response might return JSON
2025-07-08T18:48:00.8087323Z 
2025-07-08T18:48:00.8087535Z Test case 1: {"narrative": "Test story", "entities_mentioned": ...
2025-07-08T18:48:00.8088286Z   Result starts with '{': False
2025-07-08T18:48:00.8088665Z   Result: Test story
2025-07-08T18:48:00.8088870Z 
2025-07-08T18:48:00.8089101Z Test case 2: {"narrative": "Test story" "broken json here...
2025-07-08T18:48:00.8089631Z   Result starts with '{': False
2025-07-08T18:48:00.8090013Z   Result: Test story
2025-07-08T18:48:00.8090216Z 
2025-07-08T18:48:00.8090440Z Test case 3: {"Some weird text that starts with brace...
2025-07-08T18:48:00.8090945Z   Result starts with '{': True
2025-07-08T18:48:00.8091389Z   Result: {"Some weird text that starts with brace
2025-07-08T18:48:00.8092082Z   🚨 FOUND IT! This input causes JSON to be returned!
2025-07-08T18:48:00.8092439Z 
2025-07-08T18:48:00.8092789Z 🔴 Found a case where parse_structured_response returns JSON!
2025-07-08T18:48:00.8128390Z ✅ mvp_site/tests/test_json_bug_state_updates.py passed
2025-07-08T18:48:00.8129724Z ----------------------------------------
2025-07-08T18:48:00.8130248Z Running mvp_site/tests/test_json_cleanup_safety.py...
2025-07-08T18:48:00.8590544Z ..ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:00.8592252Z .....
2025-07-08T18:48:00.8592630Z ----------------------------------------------------------------------
2025-07-08T18:48:00.8593116Z Ran 7 tests in 0.002s
2025-07-08T18:48:00.8593341Z 
2025-07-08T18:48:00.8593443Z OK
2025-07-08T18:48:00.8661414Z ✅ mvp_site/tests/test_json_cleanup_safety.py passed
2025-07-08T18:48:00.8662706Z ----------------------------------------
2025-07-08T18:48:00.8663215Z Running mvp_site/tests/test_json_display_bugs.py...
2025-07-08T18:48:00.9336066Z test_empty_response_handling (__main__.TestIntegrationBugs.test_empty_response_handling)
2025-07-08T18:48:00.9337352Z Test handling of empty or null responses ... INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T18:48:00.9339118Z INFO:root:Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T18:48:00.9349110Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:00.9351413Z INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T18:48:00.9352378Z INFO:root:Recovered from incomplete JSON response. Narrative length: 9 characters (~2 tokens)
2025-07-08T18:48:00.9353125Z ok
2025-07-08T18:48:00.9353859Z test_state_updates_with_malformed_json (__main__.TestIntegrationBugs.test_state_updates_with_malformed_json)
2025-07-08T18:48:00.9355453Z Test that state updates work even when JSON is malformed ... INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T18:48:00.9357880Z INFO:root:Recovered from incomplete JSON response. Narrative length: 19 characters (~4 tokens)
2025-07-08T18:48:00.9358635Z ok
2025-07-08T18:48:00.9359328Z test_unicode_and_special_characters (__main__.TestIntegrationBugs.test_unicode_and_special_characters)
2025-07-08T18:48:00.9360285Z Test handling of unicode and special characters ... ok
2025-07-08T18:48:00.9361103Z test_very_long_json_response (__main__.TestIntegrationBugs.test_very_long_json_response)
2025-07-08T18:48:00.9361938Z Test handling of very long JSON responses ... ok
2025-07-08T18:48:00.9362983Z test_code_block_json_extraction (__main__.TestRawJsonDisplayBugs.test_code_block_json_extraction)
2025-07-08T18:48:00.9364245Z Test extraction of JSON from code blocks ... INFO:root:Extracted JSON from markdown code block
2025-07-08T18:48:00.9365007Z ok
2025-07-08T18:48:00.9367112Z test_debug_mode_content_stripping (__main__.TestRawJsonDisplayBugs.test_debug_mode_content_stripping)
2025-07-08T18:48:00.9369675Z Test that debug mode content is properly stripped ... WARNING:root:⚠️ Invalid debug_info type: str, expected dict. Using empty dict instead.
2025-07-08T18:48:00.9370651Z ok
2025-07-08T18:48:00.9371266Z test_json_artifact_cleaning (__main__.TestRawJsonDisplayBugs.test_json_artifact_cleaning)
2025-07-08T18:48:00.9372526Z Test that JSON artifacts are cleaned from narrative ... ok
2025-07-08T18:48:00.9373410Z test_malformed_json_fallback (__main__.TestRawJsonDisplayBugs.test_malformed_json_fallback)
2025-07-08T18:48:00.9374772Z Test that malformed JSON falls back to cleaned text ... INFO:root:Successfully completed incomplete JSON
2025-07-08T18:48:00.9376261Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T18:48:00.9377109Z INFO:root:Successfully fixed JSON boundaries
2025-07-08T18:48:00.9377907Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T18:48:00.9378762Z INFO:root:Successfully parsed with aggressive fixes
2025-07-08T18:48:00.9379618Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T18:48:00.9380459Z INFO:root:Extracted JSON from markdown code block
2025-07-08T18:48:00.9381105Z INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T18:48:00.9382137Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T18:48:00.9382876Z ok
2025-07-08T18:48:00.9384541Z test_narrative_extraction_utility (__main__.TestRawJsonDisplayBugs.test_narrative_extraction_utility)
2025-07-08T18:48:00.9386322Z Test the narrative extraction utility function ... ok
2025-07-08T18:48:00.9387115Z test_narrative_field_extraction (__main__.TestRawJsonDisplayBugs.test_narrative_field_extraction)
2025-07-08T18:48:00.9387893Z Test extraction of narrative field from complex JSON ... ok
2025-07-08T18:48:00.9388633Z test_robust_json_parser_fallback (__main__.TestRawJsonDisplayBugs.test_robust_json_parser_fallback)
2025-07-08T18:48:00.9389527Z Test the robust JSON parser as fallback ... INFO:root:Successfully completed incomplete JSON
2025-07-08T18:48:00.9390132Z ok
2025-07-08T18:48:00.9390583Z test_valid_json_parsing (__main__.TestRawJsonDisplayBugs.test_valid_json_parsing)
2025-07-08T18:48:00.9391201Z Test that valid JSON is parsed correctly ... ok
2025-07-08T18:48:00.9391793Z test_empty_state_updates (__main__.TestStateUpdateBugs.test_empty_state_updates)
2025-07-08T18:48:00.9392443Z Test handling of responses with empty state updates ... ok
2025-07-08T18:48:00.9393179Z test_json_state_updates_extraction (__main__.TestStateUpdateBugs.test_json_state_updates_extraction)
2025-07-08T18:48:00.9394033Z Test that state updates are properly extracted from JSON format ... ok
2025-07-08T18:48:00.9394823Z test_malformed_state_updates (__main__.TestStateUpdateBugs.test_malformed_state_updates)
2025-07-08T18:48:00.9396334Z Test handling of malformed state updates ... WARNING:root:⚠️ Invalid state_updates type: str, expected dict. Using empty dict instead.
2025-07-08T18:48:00.9397185Z ok
2025-07-08T18:48:00.9397897Z test_markdown_state_updates_deprecated (__main__.TestStateUpdateBugs.test_markdown_state_updates_deprecated)
2025-07-08T18:48:00.9399139Z Test that old markdown state updates are handled gracefully ... INFO:root:Successfully parsed with aggressive fixes
2025-07-08T18:48:00.9400245Z INFO:root:Recovered from incomplete JSON response. Narrative length: 2 characters (~0 tokens)
2025-07-08T18:48:00.9400924Z ok
2025-07-08T18:48:00.9401464Z test_mixed_format_handling (__main__.TestStateUpdateBugs.test_mixed_format_handling)
2025-07-08T18:48:00.9402512Z Test handling of responses with both JSON and markdown formats ... INFO:root:Successfully fixed JSON boundaries
2025-07-08T18:48:00.9403614Z INFO:root:Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:00.9404306Z ok
2025-07-08T18:48:00.9404943Z test_state_updates_not_in_narrative (__main__.TestStateUpdateBugs.test_state_updates_not_in_narrative)
2025-07-08T18:48:00.9405927Z Test that state updates don't leak into narrative text ... ok
2025-07-08T18:48:00.9406297Z 
2025-07-08T18:48:00.9406498Z ----------------------------------------------------------------------
2025-07-08T18:48:00.9407228Z Ran 18 tests in 0.005s
2025-07-08T18:48:00.9407435Z 
2025-07-08T18:48:00.9407549Z OK
2025-07-08T18:48:00.9502082Z ✅ mvp_site/tests/test_json_display_bugs.py passed
2025-07-08T18:48:00.9503354Z ----------------------------------------
2025-07-08T18:48:00.9504106Z Running mvp_site/tests/test_json_display_fix.py...
2025-07-08T18:48:00.9965240Z ......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:00.9967742Z ...
2025-07-08T18:48:00.9968694Z ----------------------------------------------------------------------
2025-07-08T18:48:00.9969914Z Ran 9 tests in 0.002s
2025-07-08T18:48:00.9970137Z 
2025-07-08T18:48:00.9970261Z OK
2025-07-08T18:48:01.0038821Z ✅ mvp_site/tests/test_json_display_fix.py passed
2025-07-08T18:48:01.0040111Z ----------------------------------------
2025-07-08T18:48:01.0040647Z Running mvp_site/tests/test_json_mode_constants.py...
2025-07-08T18:48:01.0402194Z ..
2025-07-08T18:48:01.0403606Z ----------------------------------------------------------------------
2025-07-08T18:48:01.0404157Z Ran 2 tests in 0.000s
2025-07-08T18:48:01.0404359Z 
2025-07-08T18:48:01.0404471Z OK
2025-07-08T18:48:01.0462890Z ✅ mvp_site/tests/test_json_mode_constants.py passed
2025-07-08T18:48:01.0464209Z ----------------------------------------
2025-07-08T18:48:01.0464777Z Running mvp_site/tests/test_json_mode_preference.py...
2025-07-08T18:48:01.9991425Z 2025-07-08 18:48:01,998 - INFO - Extracted JSON from markdown code block
2025-07-08T18:48:01.9993551Z 2025-07-08 18:48:01,999 - INFO - Extracted JSON from generic code block
2025-07-08T18:48:01.9995565Z ....2025-07-08 18:48:01,999 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T18:48:02.0000621Z ..
2025-07-08T18:48:02.0001675Z ----------------------------------------------------------------------
2025-07-08T18:48:02.0002935Z Ran 6 tests in 0.001s
2025-07-08T18:48:02.0003148Z 
2025-07-08T18:48:02.0003259Z OK
2025-07-08T18:48:02.1722878Z ✅ mvp_site/tests/test_json_mode_preference.py passed
2025-07-08T18:48:02.1724260Z ----------------------------------------
2025-07-08T18:48:02.1724825Z Running mvp_site/tests/test_json_mode_state_updates.py...
2025-07-08T18:48:02.2392476Z ...
2025-07-08T18:48:02.2393807Z ----------------------------------------------------------------------
2025-07-08T18:48:02.2394644Z ✅ Empty state updates handled correctly
2025-07-08T18:48:02.2397051Z Ran 3 tests in 0.000s
2025-07-08T18:48:02.2397263Z 
2025-07-08T18:48:02.2397368Z OK
2025-07-08T18:48:02.2397817Z ✅ JSON response with state updates properly converted
2025-07-08T18:48:02.2398438Z ✅ JSON response without state updates handled correctly
2025-07-08T18:48:02.2505120Z ✅ mvp_site/tests/test_json_mode_state_updates.py passed
2025-07-08T18:48:02.2506795Z ----------------------------------------
2025-07-08T18:48:02.2507352Z Running mvp_site/tests/test_json_only_comprehensive.py...
2025-07-08T18:48:03.1963532Z ..2025-07-08 18:48:03,196 - INFO - Calling Gemini API with prompt: test logging...
2025-07-08T18:48:03.1967931Z 2025-07-08 18:48:03,196 - INFO - Calling Gemini API: 11 characters (~2 tokens)
2025-07-08T18:48:03.1969719Z 2025-07-08 18:48:03,196 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'int'
2025-07-08T18:48:03.1971859Z 2025-07-08 18:48:03,196 - INFO - Using model: gemini-2.5-flash
2025-07-08T18:48:03.1975000Z 2025-07-08 18:48:03,196 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T18:48:03.1976243Z ..2025-07-08 18:48:03,197 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T18:48:03.1982368Z ....
2025-07-08T18:48:03.1983146Z ----------------------------------------------------------------------
2025-07-08T18:48:03.1985248Z Ran 8 tests in 0.003s
2025-07-08T18:48:03.1985867Z 
2025-07-08T18:48:03.1986222Z OK
2025-07-08T18:48:03.3630102Z ✅ mvp_site/tests/test_json_only_comprehensive.py passed
2025-07-08T18:48:03.3631084Z ----------------------------------------
2025-07-08T18:48:03.3632334Z Running mvp_site/tests/test_json_only_mode.py...
2025-07-08T18:48:04.0095132Z 2025-07-08 18:48:04,009 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:48:04.0101959Z 2025-07-08 18:48:04,009 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T18:48:04.0102954Z 2025-07-08 18:48:04,009 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:48:04.0117355Z 2025-07-08 18:48:04,011 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:48:04.0122513Z 2025-07-08 18:48:04,012 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T18:48:04.0123869Z 2025-07-08 18:48:04,012 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T18:48:04.0126260Z 2025-07-08 18:48:04,012 - INFO - Calling Gemini API: 62620 characters (~15655 tokens)
2025-07-08T18:48:04.0131245Z 2025-07-08 18:48:04,012 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T18:48:04.0132545Z 2025-07-08 18:48:04,013 - INFO - Using model: gemini-1.5-flash
2025-07-08T18:48:04.0133555Z 2025-07-08 18:48:04,013 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T18:48:04.0146921Z 2025-07-08 18:48:04,014 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:48:04.0148297Z 2025-07-08 18:48:04,014 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:48:04.0149476Z 2025-07-08 18:48:04,014 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T18:48:04.0150728Z 2025-07-08 18:48:04,014 - INFO - Starting dual-pass generation
2025-07-08T18:48:04.0151741Z 2025-07-08 18:48:04,014 - INFO - Pass 1: Generating initial narrative
2025-07-08T18:48:04.0152840Z 2025-07-08 18:48:04,014 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T18:48:04.0154057Z 2025-07-08 18:48:04,014 - INFO - Calling Gemini API: 62620 characters (~15655 tokens)
2025-07-08T18:48:04.0157826Z 2025-07-08 18:48:04,015 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T18:48:04.0158837Z 2025-07-08 18:48:04,015 - INFO - Using model: gemini-1.5-flash
2025-07-08T18:48:04.0159573Z 2025-07-08 18:48:04,015 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T18:48:04.0160446Z 2025-07-08 18:48:04,015 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:48:04.0182265Z 2025-07-08 18:48:04,015 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:48:04.0183189Z 2025-07-08 18:48:04,016 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:48:04.0183934Z 2025-07-08 18:48:04,016 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T18:48:04.0184666Z 2025-07-08 18:48:04,016 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T18:48:04.0185488Z 2025-07-08 18:48:04,016 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T18:48:04.0186545Z 2025-07-08 18:48:04,016 - INFO - Calling Gemini API: 61068 characters (~15267 tokens)
2025-07-08T18:48:04.0187791Z 2025-07-08 18:48:04,016 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T18:48:04.0188757Z 2025-07-08 18:48:04,016 - INFO - Using model: gemini-1.5-flash
2025-07-08T18:48:04.0189433Z 2025-07-08 18:48:04,016 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T18:48:04.0190257Z 2025-07-08 18:48:04,016 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T18:48:04.0191397Z 2025-07-08 18:48:04,016 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T18:48:04.0192271Z 2025-07-08 18:48:04,016 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T18:48:04.0193115Z 2025-07-08 18:48:04,017 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T18:48:04.0194365Z 2025-07-08 18:48:04,017 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T18:48:04.0195441Z 2025-07-08 18:48:04,017 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T18:48:04.0196731Z 2025-07-08 18:48:04,017 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T18:48:04.0197659Z .2025-07-08 18:48:04,017 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T18:48:04.0199836Z ..2025-07-08 18:48:04,019 - ERROR - 🔥🔴 --- EXCEPTION IN: continue_story ---
2025-07-08T18:48:04.0200954Z Args: ([], 'prompt', 'story')
2025-07-08T18:48:04.0201843Z Kwargs: {}
2025-07-08T18:48:04.0202941Z Error: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T18:48:04.0205002Z Traceback:
2025-07-08T18:48:04.0205375Z Traceback (most recent call last):
2025-07-08T18:48:04.0206652Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/decorators.py", line 35, in wrapper
2025-07-08T18:48:04.0207579Z     return func(*args, **kwargs)
2025-07-08T18:48:04.0207980Z            ^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:04.0208622Z TypeError: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T18:48:04.0209335Z --- END EXCEPTION ---
2025-07-08T18:48:04.3347184Z ....2025-07-08 18:48:04,334 - INFO - Extracted JSON from markdown code block
2025-07-08T18:48:04.3348711Z 2025-07-08 18:48:04,334 - INFO - Successfully completed incomplete JSON
2025-07-08T18:48:04.3351327Z 2025-07-08 18:48:04,334 - INFO - Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T18:48:04.3352321Z ..
2025-07-08T18:48:04.3354437Z ----------------------------------------------------------------------
2025-07-08T18:48:04.3354934Z Ran 9 tests in 0.327s
2025-07-08T18:48:04.3355129Z 
2025-07-08T18:48:04.3355235Z OK
2025-07-08T18:48:04.5103603Z ✅ mvp_site/tests/test_json_only_mode.py passed
2025-07-08T18:48:04.5108091Z ----------------------------------------
2025-07-08T18:48:04.5108648Z Running mvp_site/tests/test_json_state_updates_fix.py...
2025-07-08T18:48:05.4353101Z 2025-07-08 18:48:05,435 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:05.4355620Z 2025-07-08 18:48:05,435 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:05.4358940Z 2025-07-08 18:48:05,435 - INFO - Recovered from incomplete JSON response. Narrative length: 197 characters (~49 tokens)
2025-07-08T18:48:05.4376428Z 2025-07-08 18:48:05,437 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:05.4382525Z 2025-07-08 18:48:05,437 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T18:48:05.4384918Z 2025-07-08 18:48:05,438 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T18:48:05.4386080Z 2025-07-08 18:48:05,438 - INFO - Response length: 197 characters (~49 tokens)
2025-07-08T18:48:05.4444849Z .2025-07-08 18:48:05,444 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:05.4451405Z 2025-07-08 18:48:05,444 - INFO - Debug content generated for campaign test-campaign: {'dm_notes': False, 'dice_rolls': False, 'state_changes': True}
2025-07-08T18:48:05.4456582Z 2025-07-08 18:48:05,444 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4460171Z   "player_character_data": {
2025-07-08T18:48:05.4460603Z     "hp_current": 15,
2025-07-08T18:48:05.4460970Z     "combat_state": {
2025-07-08T18:48:05.4461346Z       "is_in_combat": true,
2025-07-08T18:48:05.4461760Z       "current_turn": "player"
2025-07-08T18:48:05.4462147Z     }
2025-07-08T18:48:05.4462433Z   },
2025-07-08T18:48:05.4462726Z   "npc_data": {
2025-07-08T18:48:05.4463049Z     "Goblin_1": {
2025-07-08T18:48:05.4463389Z       "hp_current": 8,
2025-07-08T18:48:05.4464198Z       "status": "wounded"
2025-07-08T18:48:05.4464564Z     }
2025-07-08T18:48:05.4464838Z   }
2025-07-08T18:48:05.4465113Z }
2025-07-08T18:48:05.4465609Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4466648Z   "hp_current": 15,
2025-07-08T18:48:05.4467018Z   "combat_state": {
2025-07-08T18:48:05.4467355Z     "is_in_combat": true,
2025-07-08T18:48:05.4467728Z     "current_turn": "player"
2025-07-08T18:48:05.4468090Z   }
2025-07-08T18:48:05.4468346Z }
2025-07-08T18:48:05.4468816Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4469436Z   "is_in_combat": true,
2025-07-08T18:48:05.4469807Z   "current_turn": "player"
2025-07-08T18:48:05.4470146Z }
2025-07-08T18:48:05.4470582Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4471320Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4472133Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4472764Z   "Goblin_1": {
2025-07-08T18:48:05.4473103Z     "hp_current": 8,
2025-07-08T18:48:05.4473461Z     "status": "wounded"
2025-07-08T18:48:05.4473791Z   }
2025-07-08T18:48:05.4474059Z }
2025-07-08T18:48:05.4474547Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4475165Z   "hp_current": 8,
2025-07-08T18:48:05.4475502Z   "status": "wounded"
2025-07-08T18:48:05.4476012Z }
2025-07-08T18:48:05.4476453Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4477167Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4477878Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4478625Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4479251Z   "player_character_data": {
2025-07-08T18:48:05.4479660Z     "hp_current": 15,
2025-07-08T18:48:05.4480019Z     "combat_state": {
2025-07-08T18:48:05.4480379Z       "is_in_combat": true,
2025-07-08T18:48:05.4480790Z       "current_turn": "player"
2025-07-08T18:48:05.4481172Z     }
2025-07-08T18:48:05.4481458Z   },
2025-07-08T18:48:05.4481747Z   "npc_data": {
2025-07-08T18:48:05.4482075Z     "Goblin_1": {
2025-07-08T18:48:05.4482411Z       "hp_current": 8,
2025-07-08T18:48:05.4482770Z       "status": "wounded"
2025-07-08T18:48:05.4483109Z     }
2025-07-08T18:48:05.4483382Z   }
2025-07-08T18:48:05.4483623Z }
2025-07-08T18:48:05.4484683Z 2025-07-08 18:48:05,445 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4485874Z   "hp_current": 15,
2025-07-08T18:48:05.4486592Z   "combat_state": {
2025-07-08T18:48:05.4487171Z     "is_in_combat": true,
2025-07-08T18:48:05.4487674Z     "current_turn": "player"
2025-07-08T18:48:05.4488026Z   }
2025-07-08T18:48:05.4488282Z }
2025-07-08T18:48:05.4488745Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4489317Z   "is_in_combat": true,
2025-07-08T18:48:05.4489662Z   "current_turn": "player"
2025-07-08T18:48:05.4489996Z }
2025-07-08T18:48:05.4490406Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4491077Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4491761Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4492292Z   "Goblin_1": {
2025-07-08T18:48:05.4492567Z     "hp_current": 8,
2025-07-08T18:48:05.4492873Z     "status": "wounded"
2025-07-08T18:48:05.4493154Z   }
2025-07-08T18:48:05.4493385Z }
2025-07-08T18:48:05.4493786Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4494314Z   "hp_current": 8,
2025-07-08T18:48:05.4494607Z   "status": "wounded"
2025-07-08T18:48:05.4494890Z }
2025-07-08T18:48:05.4495506Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4496429Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4497068Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4498022Z 2025-07-08 18:48:05,446 - INFO - AI proposed changes for campaign test-campaign:\n{
2025-07-08T18:48:05.4498573Z   "custom_campaign_state": {
2025-07-08T18:48:05.4498928Z     "last_story_mode_sequence_id": 2
2025-07-08T18:48:05.4499279Z   },
2025-07-08T18:48:05.4499536Z   "player_character_data": {
2025-07-08T18:48:05.4499869Z     "hp_current": 15,
2025-07-08T18:48:05.4500161Z     "combat_state": {
2025-07-08T18:48:05.4500459Z       "is_in_combat": true,
2025-07-08T18:48:05.4500786Z       "current_turn": "player"
2025-07-08T18:48:05.4501098Z     }
2025-07-08T18:48:05.4501334Z   },
2025-07-08T18:48:05.4501573Z   "npc_data": {
2025-07-08T18:48:05.4501847Z     "Goblin_1": {
2025-07-08T18:48:05.4502148Z       "hp_current": 8,
2025-07-08T18:48:05.4502451Z       "status": "wounded"
2025-07-08T18:48:05.4502737Z     }
2025-07-08T18:48:05.4502972Z   }
2025-07-08T18:48:05.4503202Z }
2025-07-08T18:48:05.4505163Z 2025-07-08 18:48:05,446 - INFO - Applying formatted state changes for campaign test-campaign:\nGame state updated (6 entries):\n  - custom_campaign_state.last_story_mode_sequence_id: 2\n  - player_character_data.hp_current: 15\n  - player_character_data.combat_state.is_in_combat: true\n  - player_character_data.combat_state.current_turn: "player"\n  - npc_data.Goblin_1.hp_current: 8\n  - npc_data.Goblin_1.status: "wounded"
2025-07-08T18:48:05.4507599Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4508149Z   "custom_campaign_state": {
2025-07-08T18:48:05.4508512Z     "last_story_mode_sequence_id": 2
2025-07-08T18:48:05.4508857Z   },
2025-07-08T18:48:05.4509109Z   "player_character_data": {
2025-07-08T18:48:05.4509459Z     "hp_current": 15,
2025-07-08T18:48:05.4509767Z     "combat_state": {
2025-07-08T18:48:05.4510062Z       "is_in_combat": true,
2025-07-08T18:48:05.4510395Z       "current_turn": "player"
2025-07-08T18:48:05.4510713Z     }
2025-07-08T18:48:05.4510943Z   },
2025-07-08T18:48:05.4511194Z   "npc_data": {
2025-07-08T18:48:05.4511481Z     "Goblin_1": {
2025-07-08T18:48:05.4511756Z       "hp_current": 8,
2025-07-08T18:48:05.4512067Z       "status": "wounded"
2025-07-08T18:48:05.4512362Z     }
2025-07-08T18:48:05.4512595Z   }
2025-07-08T18:48:05.4512819Z }
2025-07-08T18:48:05.4513223Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4513770Z   "last_story_mode_sequence_id": 2
2025-07-08T18:48:05.4514105Z }
2025-07-08T18:48:05.4514497Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4515142Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4515833Z   "hp_current": 15,
2025-07-08T18:48:05.4516142Z   "combat_state": {
2025-07-08T18:48:05.4516448Z     "is_in_combat": true,
2025-07-08T18:48:05.4516771Z     "current_turn": "player"
2025-07-08T18:48:05.4517094Z   }
2025-07-08T18:48:05.4517317Z }
2025-07-08T18:48:05.4517737Z 2025-07-08 18:48:05,446 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4518273Z   "is_in_combat": true,
2025-07-08T18:48:05.4518578Z   "current_turn": "player"
2025-07-08T18:48:05.4518883Z }
2025-07-08T18:48:05.4519250Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4519858Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4520486Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4521121Z   "Goblin_1": {
2025-07-08T18:48:05.4521521Z     "hp_current": 8,
2025-07-08T18:48:05.4522092Z     "status": "wounded"
2025-07-08T18:48:05.4522560Z   }
2025-07-08T18:48:05.4522847Z }
2025-07-08T18:48:05.4533939Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:05.4534480Z   "hp_current": 8,
2025-07-08T18:48:05.4534781Z   "status": "wounded"
2025-07-08T18:48:05.4535072Z }
2025-07-08T18:48:05.4538464Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4539195Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4539811Z 2025-07-08 18:48:05,447 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:05.4540506Z 2025-07-08 18:48:05,447 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T18:48:05.4541261Z 2025-07-08 18:48:05,447 - INFO - New complete game state for campaign test-campaign:\n{
2025-07-08T18:48:05.4541829Z   "game_state_version": 1,
2025-07-08T18:48:05.4542172Z   "player_character_data": {
2025-07-08T18:48:05.4542515Z     "hp_current": 15,
2025-07-08T18:48:05.4542806Z     "combat_state": {
2025-07-08T18:48:05.4543121Z       "is_in_combat": true,
2025-07-08T18:48:05.4543441Z       "current_turn": "player"
2025-07-08T18:48:05.4543754Z     }
2025-07-08T18:48:05.4544055Z   },
2025-07-08T18:48:05.4544286Z   "world_data": {},
2025-07-08T18:48:05.4544564Z   "npc_data": {
2025-07-08T18:48:05.4544834Z     "Goblin_1": {
2025-07-08T18:48:05.4545110Z       "hp_current": 8,
2025-07-08T18:48:05.4545404Z       "status": "wounded"
2025-07-08T18:48:05.4545864Z     }
2025-07-08T18:48:05.4546094Z   },
2025-07-08T18:48:05.4546349Z   "custom_campaign_state": {
2025-07-08T18:48:05.4546694Z     "attribute_system": "D&D",
2025-07-08T18:48:05.4547034Z     "last_story_mode_sequence_id": 2
2025-07-08T18:48:05.4547374Z   },
2025-07-08T18:48:05.4547627Z ... (truncated, showing 20/30 lines)
2025-07-08T18:48:05.4547954Z .
2025-07-08T18:48:05.4548265Z ----------------------------------------------------------------------
2025-07-08T18:48:05.4548707Z Ran 2 tests in 0.019s
2025-07-08T18:48:05.4548892Z 
2025-07-08T18:48:05.4548992Z OK
2025-07-08T18:48:05.6123520Z ✅ mvp_site/tests/test_json_state_updates_fix.py passed
2025-07-08T18:48:05.6125278Z ----------------------------------------
2025-07-08T18:48:05.6126003Z Running mvp_site/tests/test_json_utils.py...
2025-07-08T18:48:05.6605973Z ........................................................
2025-07-08T18:48:05.6607762Z ----------------------------------------------------------------------
2025-07-08T18:48:05.6608246Z Ran 56 tests in 0.004s
2025-07-08T18:48:05.6608448Z 
2025-07-08T18:48:05.6608555Z OK
2025-07-08T18:48:05.6672191Z ✅ mvp_site/tests/test_json_utils.py passed
2025-07-08T18:48:05.6673844Z ----------------------------------------
2025-07-08T18:48:05.6674340Z Running mvp_site/tests/test_llm_response.py...
2025-07-08T18:48:05.7149579Z test_backwards_compatibility (__main__.TestLLMResponse.test_backwards_compatibility)
2025-07-08T18:48:05.7150332Z Test that old GeminiResponse interface still works. ... ok
2025-07-08T18:48:05.7151018Z test_debug_tag_detection (__main__.TestLLMResponse.test_debug_tag_detection)
2025-07-08T18:48:05.7151674Z Test automatic debug tag detection. ... ok
2025-07-08T18:48:05.7152268Z test_factory_function (__main__.TestLLMResponse.test_factory_function)
2025-07-08T18:48:05.7152932Z Test the factory function for creating responses. ... ok
2025-07-08T18:48:05.7153751Z test_gemini_llm_response_creation (__main__.TestLLMResponse.test_gemini_llm_response_creation)
2025-07-08T18:48:05.7154546Z Test creating GeminiLLMResponse directly. ... ok
2025-07-08T18:48:05.7155295Z test_invalid_response_handling (__main__.TestLLMResponse.test_invalid_response_handling)
2025-07-08T18:48:05.7156648Z Test handling of invalid responses. ... ERROR:root:ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T18:48:05.7157538Z ok
2025-07-08T18:48:05.7158044Z test_to_dict_serialization (__main__.TestLLMResponse.test_to_dict_serialization)
2025-07-08T18:48:05.7158814Z Test converting response to dictionary for API usage. ... ok
2025-07-08T18:48:05.7159843Z test_unsupported_provider (__main__.TestLLMResponse.test_unsupported_provider)
2025-07-08T18:48:05.7160589Z Test that unsupported providers raise appropriate errors. ... ok
2025-07-08T18:48:05.7161009Z 
2025-07-08T18:48:05.7161236Z ----------------------------------------------------------------------
2025-07-08T18:48:05.7161914Z Ran 7 tests in 0.001s
2025-07-08T18:48:05.7162140Z 
2025-07-08T18:48:05.7162246Z OK
2025-07-08T18:48:05.7224855Z ✅ mvp_site/tests/test_llm_response.py passed
2025-07-08T18:48:05.7226443Z ----------------------------------------
2025-07-08T18:48:05.7227909Z Running mvp_site/tests/test_loading_messages.py...
2025-07-08T18:48:05.7593876Z .....
2025-07-08T18:48:05.7595422Z ----------------------------------------------------------------------
2025-07-08T18:48:05.7597384Z Ran 5 tests in 0.001s
2025-07-08T18:48:05.7597622Z 
2025-07-08T18:48:05.7597741Z OK
2025-07-08T18:48:05.7651024Z ✅ mvp_site/tests/test_loading_messages.py passed
2025-07-08T18:48:05.7652643Z ----------------------------------------
2025-07-08T18:48:05.7653268Z Running mvp_site/tests/test_luke_campaign_god_mode_json_bug.py...
2025-07-08T18:48:05.8109445Z ....
2025-07-08T18:48:05.8111116Z ----------------------------------------------------------------------
2025-07-08T18:48:05.8111627Z Ran 4 tests in 0.000s
2025-07-08T18:48:05.8111885Z 
2025-07-08T18:48:05.8111998Z OK
2025-07-08T18:48:05.8180804Z ✅ mvp_site/tests/test_luke_campaign_god_mode_json_bug.py passed
2025-07-08T18:48:05.8182503Z ----------------------------------------
2025-07-08T18:48:05.8183122Z Running mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py...
2025-07-08T18:48:05.9951954Z ...
2025-07-08T18:48:05.9953805Z ----------------------------------------------------------------------
2025-07-08T18:48:05.9954285Z Ran 3 tests in 0.000s
2025-07-08T18:48:05.9954488Z 
2025-07-08T18:48:05.9954596Z OK
2025-07-08T18:48:06.0217305Z ✅ mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py passed
2025-07-08T18:48:06.0218720Z ----------------------------------------
2025-07-08T18:48:06.0220186Z Running mvp_site/tests/test_main.py...
2025-07-08T18:48:06.8997922Z 2025-07-08 18:48:06,899 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9060928Z .2025-07-08 18:48:06,905 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9062880Z 2025-07-08 18:48:06,905 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T18:48:06.9064314Z 2025-07-08 18:48:06,905 - INFO - GOD_MODE_SET raw payload:\n---\n
2025-07-08T18:48:06.9065009Z player.level = 5
2025-07-08T18:48:06.9065371Z player.hp = 50\n---
2025-07-08T18:48:06.9066041Z 2025-07-08 18:48:06,906 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T18:48:06.9066603Z   "player": {
2025-07-08T18:48:06.9066900Z     "level": 5,
2025-07-08T18:48:06.9067187Z     "hp": 50
2025-07-08T18:48:06.9067464Z   }
2025-07-08T18:48:06.9067747Z }
2025-07-08T18:48:06.9068136Z 2025-07-08 18:48:06,906 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T18:48:06.9068670Z   "game_state_version": 1,
2025-07-08T18:48:06.9069068Z   "player_character_data": {},
2025-07-08T18:48:06.9069455Z   "world_data": {},
2025-07-08T18:48:06.9069797Z   "npc_data": {},
2025-07-08T18:48:06.9070150Z   "custom_campaign_state": {
2025-07-08T18:48:06.9070563Z     "attribute_system": "D&D"
2025-07-08T18:48:06.9070937Z   },
2025-07-08T18:48:06.9071231Z   "combat_state": {
2025-07-08T18:48:06.9071568Z     "in_combat": false
2025-07-08T18:48:06.9071890Z   },
2025-07-08T18:48:06.9072313Z   "last_state_update_timestamp": "2025-07-08 18:48:06.905763+00:00",
2025-07-08T18:48:06.9072876Z   "time_sensitive_events": {},
2025-07-08T18:48:06.9073267Z   "npc_agendas": {},
2025-07-08T18:48:06.9073629Z   "world_resources": {},
2025-07-08T18:48:06.9074026Z   "time_pressure_warnings": {},
2025-07-08T18:48:06.9074438Z   "debug_mode": true,
2025-07-08T18:48:06.9074795Z   "player": {
2025-07-08T18:48:06.9075572Z     "name": "Hero",
2025-07-08T18:48:06.9076128Z ... (truncated, showing 19/22 lines)
2025-07-08T18:48:06.9076802Z 2025-07-08 18:48:06,906 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T18:48:06.9077853Z 2025-07-08 18:48:06,906 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T18:48:06.9078428Z   "player": {
2025-07-08T18:48:06.9078744Z     "name": "Hero",
2025-07-08T18:48:06.9079074Z     "level": 5,
2025-07-08T18:48:06.9079390Z     "hp": 50
2025-07-08T18:48:06.9079682Z   }
2025-07-08T18:48:06.9079960Z }
2025-07-08T18:48:06.9080858Z 2025-07-08 18:48:06,907 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - player.level: 5\n  - player.hp: 50
2025-07-08T18:48:06.9082080Z 2025-07-08 18:48:06,907 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T18:48:06.9139301Z .2025-07-08 18:48:06,913 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9141973Z 2025-07-08 18:48:06,914 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T18:48:06.9196124Z .2025-07-08 18:48:06,919 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9247555Z .2025-07-08 18:48:06,924 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9305074Z .2025-07-08 18:48:06,930 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:06.9311670Z 2025-07-08 18:48:06,930 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T18:48:06.9313608Z 2025-07-08 18:48:06,931 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T18:48:06.9316070Z 2025-07-08 18:48:06,931 - INFO - Response length: 47 characters (~11 tokens)
2025-07-08T18:48:06.9356864Z .........2025-07-08 18:48:06,935 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: player.data = {invalid json}
2025-07-08T18:48:06.9361745Z ......
2025-07-08T18:48:06.9362524Z ----------------------------------------------------------------------
2025-07-08T18:48:06.9363307Z Ran 20 tests in 0.044s
2025-07-08T18:48:06.9364854Z 
2025-07-08T18:48:06.9366294Z OK
2025-07-08T18:48:07.0872745Z ✅ mvp_site/tests/test_main.py passed
2025-07-08T18:48:07.0874181Z ----------------------------------------
2025-07-08T18:48:07.0874658Z Running mvp_site/tests/test_main_auth.py...
2025-07-08T18:48:08.0062483Z ............
2025-07-08T18:48:08.0063457Z ----------------------------------------------------------------------
2025-07-08T18:48:08.0064358Z Ran 12 tests in 0.057s
2025-07-08T18:48:08.0064707Z 
2025-07-08T18:48:08.0064839Z OK
2025-07-08T18:48:08.1580234Z ✅ mvp_site/tests/test_main_auth.py passed
2025-07-08T18:48:08.1581713Z ----------------------------------------
2025-07-08T18:48:08.1582248Z Running mvp_site/tests/test_main_auth_state_phase2.py...
2025-07-08T18:48:09.0442624Z .................
2025-07-08T18:48:09.0444168Z ----------------------------------------------------------------------
2025-07-08T18:48:09.0444715Z Ran 17 tests in 0.035s
2025-07-08T18:48:09.0444917Z 
2025-07-08T18:48:09.0445029Z OK
2025-07-08T18:48:09.1857251Z ✅ mvp_site/tests/test_main_auth_state_phase2.py passed
2025-07-08T18:48:09.1858738Z ----------------------------------------
2025-07-08T18:48:09.1859319Z Running mvp_site/tests/test_main_authentication_advanced.py...
2025-07-08T18:48:10.1346936Z sssssssssssssssssssssssss
2025-07-08T18:48:10.1348618Z ----------------------------------------------------------------------
2025-07-08T18:48:10.1350374Z Ran 25 tests in 0.000s
2025-07-08T18:48:10.1351082Z 
2025-07-08T18:48:10.1352282Z OK (skipped=25)
2025-07-08T18:48:10.3012589Z ✅ mvp_site/tests/test_main_authentication_advanced.py passed
2025-07-08T18:48:10.3017603Z ----------------------------------------
2025-07-08T18:48:10.3018176Z Running mvp_site/tests/test_main_error_handling_final.py...
2025-07-08T18:48:11.2251733Z test_arrays_and_objects (__main__.TestParseSetCommandErrorHandling.test_arrays_and_objects)
2025-07-08T18:48:11.2254223Z Test complex JSON structures ... ok
2025-07-08T18:48:11.2254891Z test_edge_cases (__main__.TestParseSetCommandErrorHandling.test_edge_cases)
2025-07-08T18:48:11.2262471Z Test various edge cases ... ok
2025-07-08T18:48:11.2264335Z test_empty_values_and_whitespace (__main__.TestParseSetCommandErrorHandling.test_empty_values_and_whitespace)
2025-07-08T18:48:11.2265340Z Test handling of empty values and whitespace ... ok
2025-07-08T18:48:11.2266379Z test_escaped_characters (__main__.TestParseSetCommandErrorHandling.test_escaped_characters)
2025-07-08T18:48:11.2268142Z Test escaped characters in JSON strings ... ok
2025-07-08T18:48:11.2268973Z test_json_decode_errors (__main__.TestParseSetCommandErrorHandling.test_json_decode_errors)
2025-07-08T18:48:11.2271077Z Test handling of invalid JSON values ... ok
2025-07-08T18:48:11.2272986Z test_lines_without_equals (__main__.TestParseSetCommandErrorHandling.test_lines_without_equals)
2025-07-08T18:48:11.2273962Z Test lines that don't contain equals sign are ignored ... ok
2025-07-08T18:48:11.2274991Z test_numeric_boolean_null_values (__main__.TestParseSetCommandErrorHandling.test_numeric_boolean_null_values)
2025-07-08T18:48:11.2276092Z Test various value types ... ok
2025-07-08T18:48:11.2277806Z test_special_characters_in_values (__main__.TestParseSetCommandErrorHandling.test_special_characters_in_values)
2025-07-08T18:48:11.2278660Z Test values containing special characters ... ok
2025-07-08T18:48:11.2279351Z test_unicode_and_emoji (__main__.TestParseSetCommandErrorHandling.test_unicode_and_emoji)
2025-07-08T18:48:11.2280021Z Test unicode characters and emoji ... ok
2025-07-08T18:48:11.2280660Z test_very_long_values (__main__.TestParseSetCommandErrorHandling.test_very_long_values)
2025-07-08T18:48:11.2281323Z Test handling of very long values ... ok
2025-07-08T18:48:11.2281609Z 
2025-07-08T18:48:11.2281797Z ----------------------------------------------------------------------
2025-07-08T18:48:11.2282264Z Ran 10 tests in 0.003s
2025-07-08T18:48:11.2282463Z 
2025-07-08T18:48:11.2282589Z OK
2025-07-08T18:48:11.3912681Z ✅ mvp_site/tests/test_main_error_handling_final.py passed
2025-07-08T18:48:11.3914209Z ----------------------------------------
2025-07-08T18:48:11.3914697Z Running mvp_site/tests/test_main_god_mode.py...
2025-07-08T18:48:12.3014113Z 2025-07-08 18:48:12,301 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3075441Z .2025-07-08 18:48:12,307 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3077996Z 2025-07-08 18:48:12,307 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T18:48:12.3079076Z 2025-07-08 18:48:12,307 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = {invalid: json, missing_quotes: true}\n---
2025-07-08T18:48:12.3080989Z 2025-07-08 18:48:12,307 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: current_scene = {invalid: json, missing_quotes: true}
2025-07-08T18:48:12.3082137Z 2025-07-08 18:48:12,307 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T18:48:12.3083188Z 2025-07-08 18:48:12,307 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T18:48:12.3129109Z .2025-07-08 18:48:12,312 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3131890Z 2025-07-08 18:48:12,312 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T18:48:12.3132705Z 2025-07-08 18:48:12,312 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2\n---
2025-07-08T18:48:12.3133921Z 2025-07-08 18:48:12,312 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T18:48:12.3135407Z   "current_scene": 2
2025-07-08T18:48:12.3135901Z }
2025-07-08T18:48:12.3136356Z 2025-07-08 18:48:12,313 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T18:48:12.3137309Z   "game_state_version": 1,
2025-07-08T18:48:12.3137718Z   "player_character_data": {},
2025-07-08T18:48:12.3138087Z   "world_data": {},
2025-07-08T18:48:12.3138406Z   "npc_data": {},
2025-07-08T18:48:12.3138752Z   "custom_campaign_state": {
2025-07-08T18:48:12.3139135Z     "attribute_system": "D&D"
2025-07-08T18:48:12.3139498Z   },
2025-07-08T18:48:12.3139787Z   "combat_state": {
2025-07-08T18:48:12.3140125Z     "in_combat": false
2025-07-08T18:48:12.3140447Z   },
2025-07-08T18:48:12.3140861Z   "last_state_update_timestamp": "2025-07-08 18:48:12.312710+00:00",
2025-07-08T18:48:12.3141408Z   "time_sensitive_events": {},
2025-07-08T18:48:12.3141774Z   "npc_agendas": {},
2025-07-08T18:48:12.3142109Z   "world_resources": {},
2025-07-08T18:48:12.3142493Z   "time_pressure_warnings": {},
2025-07-08T18:48:12.3142898Z   "debug_mode": true
2025-07-08T18:48:12.3143225Z }
2025-07-08T18:48:12.3143689Z 2025-07-08 18:48:12,313 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:12.3144266Z   "current_scene": 2
2025-07-08T18:48:12.3144600Z }
2025-07-08T18:48:12.3145044Z 2025-07-08 18:48:12,313 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:12.3146022Z 2025-07-08 18:48:12,314 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T18:48:12.3146780Z 2025-07-08 18:48:12,314 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T18:48:12.3147298Z   "game_state_version": 1,
2025-07-08T18:48:12.3147672Z   "player_character_data": {},
2025-07-08T18:48:12.3148063Z   "world_data": {},
2025-07-08T18:48:12.3148386Z   "npc_data": {},
2025-07-08T18:48:12.3148729Z   "custom_campaign_state": {
2025-07-08T18:48:12.3149124Z     "attribute_system": "D&D"
2025-07-08T18:48:12.3149509Z   },
2025-07-08T18:48:12.3149792Z   "combat_state": {
2025-07-08T18:48:12.3150126Z     "in_combat": false
2025-07-08T18:48:12.3150457Z   },
2025-07-08T18:48:12.3150893Z   "last_state_update_timestamp": "2025-07-08 18:48:12.312710+00:00",
2025-07-08T18:48:12.3151468Z   "time_sensitive_events": {},
2025-07-08T18:48:12.3151873Z   "npc_agendas": {},
2025-07-08T18:48:12.3152229Z   "world_resources": {},
2025-07-08T18:48:12.3152618Z   "time_pressure_warnings": {},
2025-07-08T18:48:12.3153024Z   "debug_mode": true,
2025-07-08T18:48:12.3153389Z   "current_scene": 2
2025-07-08T18:48:12.3153728Z }
2025-07-08T18:48:12.3160617Z 2025-07-08 18:48:12,315 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (1 entry):\n  - current_scene: 2
2025-07-08T18:48:12.3163827Z 2025-07-08 18:48:12,315 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T18:48:12.3211296Z .2025-07-08 18:48:12,320 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3213839Z 2025-07-08 18:48:12,320 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T18:48:12.3216260Z 2025-07-08 18:48:12,320 - INFO - GOD_MODE_SET raw payload:\n---\n ["not", "an", "object"]\n---
2025-07-08T18:48:12.3217145Z 2025-07-08 18:48:12,321 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T18:48:12.3218203Z 2025-07-08 18:48:12,321 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T18:48:12.3267682Z .2025-07-08 18:48:12,326 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3274560Z 2025-07-08 18:48:12,326 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T18:48:12.3275422Z 2025-07-08 18:48:12,326 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2
2025-07-08T18:48:12.3276269Z npcs = [{"name": "Test NPC"}]\n---
2025-07-08T18:48:12.3279492Z 2025-07-08 18:48:12,326 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T18:48:12.3280468Z   "current_scene": 2,
2025-07-08T18:48:12.3280837Z   "npcs": [
2025-07-08T18:48:12.3281138Z     {
2025-07-08T18:48:12.3281447Z       "name": "Test NPC"
2025-07-08T18:48:12.3281805Z     }
2025-07-08T18:48:12.3282320Z   ]
2025-07-08T18:48:12.3282622Z }
2025-07-08T18:48:12.3283060Z 2025-07-08 18:48:12,326 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T18:48:12.3283646Z   "game_state_version": 1,
2025-07-08T18:48:12.3284067Z   "player_character_data": {},
2025-07-08T18:48:12.3284469Z   "world_data": {},
2025-07-08T18:48:12.3284801Z   "npc_data": {},
2025-07-08T18:48:12.3285160Z   "custom_campaign_state": {
2025-07-08T18:48:12.3285923Z     "attribute_system": "D&D"
2025-07-08T18:48:12.3286326Z   },
2025-07-08T18:48:12.3286623Z   "combat_state": {
2025-07-08T18:48:12.3286965Z     "in_combat": false
2025-07-08T18:48:12.3287301Z   },
2025-07-08T18:48:12.3287729Z   "last_state_update_timestamp": "2025-07-08 18:48:12.326458+00:00",
2025-07-08T18:48:12.3288317Z   "time_sensitive_events": {},
2025-07-08T18:48:12.3288718Z   "npc_agendas": {},
2025-07-08T18:48:12.3289101Z   "world_resources": {},
2025-07-08T18:48:12.3289511Z   "time_pressure_warnings": {},
2025-07-08T18:48:12.3289921Z   "debug_mode": true,
2025-07-08T18:48:12.3290308Z   "current_scene": 1,
2025-07-08T18:48:12.3290656Z   "npcs": []
2025-07-08T18:48:12.3290949Z }
2025-07-08T18:48:12.3291441Z 2025-07-08 18:48:12,326 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:12.3292084Z   "current_scene": 2,
2025-07-08T18:48:12.3292423Z   "npcs": [
2025-07-08T18:48:12.3292706Z     {
2025-07-08T18:48:12.3293000Z       "name": "Test NPC"
2025-07-08T18:48:12.3293344Z     }
2025-07-08T18:48:12.3293627Z   ]
2025-07-08T18:48:12.3293901Z }
2025-07-08T18:48:12.3294346Z 2025-07-08 18:48:12,326 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:12.3295187Z 2025-07-08 18:48:12,327 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T18:48:12.3296190Z 2025-07-08 18:48:12,327 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T18:48:12.3296761Z   "game_state_version": 1,
2025-07-08T18:48:12.3297178Z   "player_character_data": {},
2025-07-08T18:48:12.3297593Z   "world_data": {},
2025-07-08T18:48:12.3297942Z   "npc_data": {},
2025-07-08T18:48:12.3298289Z   "custom_campaign_state": {
2025-07-08T18:48:12.3298689Z     "attribute_system": "D&D"
2025-07-08T18:48:12.3299054Z   },
2025-07-08T18:48:12.3299335Z   "combat_state": {
2025-07-08T18:48:12.3299691Z     "in_combat": false
2025-07-08T18:48:12.3300032Z   },
2025-07-08T18:48:12.3300469Z   "last_state_update_timestamp": "2025-07-08 18:48:12.326458+00:00",
2025-07-08T18:48:12.3301069Z   "time_sensitive_events": {},
2025-07-08T18:48:12.3301485Z   "npc_agendas": {},
2025-07-08T18:48:12.3301856Z   "world_resources": {},
2025-07-08T18:48:12.3302254Z   "time_pressure_warnings": {},
2025-07-08T18:48:12.3302655Z   "debug_mode": true,
2025-07-08T18:48:12.3302978Z   "current_scene": 2,
2025-07-08T18:48:12.3303279Z   "npcs": [
2025-07-08T18:48:12.3303564Z ... (truncated, showing 19/24 lines)
2025-07-08T18:48:12.3304605Z 2025-07-08 18:48:12,327 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - current_scene: 2\n  - npcs: [{"name": "Test NPC"}]
2025-07-08T18:48:12.3306150Z 2025-07-08 18:48:12,327 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T18:48:12.3353101Z .2025-07-08 18:48:12,335 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Invalid state data
2025-07-08T18:48:12.3354969Z 2025-07-08 18:48:12,335 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T18:48:12.3362730Z 2025-07-08 18:48:12,336 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T18:48:12.3366648Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 640, in handle_interaction
2025-07-08T18:48:12.3367907Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T18:48:12.3368957Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3370252Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 73, in _prepare_game_state
2025-07-08T18:48:12.3371437Z     current_game_state = GameState.from_dict(current_game_state_doc.to_dict())
2025-07-08T18:48:12.3372099Z                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3373067Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T18:48:12.3373953Z     return self._mock_call(*args, **kwargs)
2025-07-08T18:48:12.3374431Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3375323Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T18:48:12.3376434Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T18:48:12.3376955Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3377912Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T18:48:12.3378825Z     raise effect
2025-07-08T18:48:12.3379202Z ValueError: Invalid state data
2025-07-08T18:48:12.3379495Z 
2025-07-08T18:48:12.3451619Z .2025-07-08 18:48:12,344 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3495898Z .2025-07-08 18:48:12,349 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3540911Z .2025-07-08 18:48:12,353 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3587091Z .2025-07-08 18:48:12,358 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Unexpected database error
2025-07-08T18:48:12.3602006Z 2025-07-08 18:48:12,358 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T18:48:12.3603027Z 2025-07-08 18:48:12,358 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T18:48:12.3604199Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 640, in handle_interaction
2025-07-08T18:48:12.3605417Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T18:48:12.3606387Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3607430Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 69, in _prepare_game_state
2025-07-08T18:48:12.3608676Z     current_game_state_doc = firestore_service.get_campaign_game_state(user_id, campaign_id)
2025-07-08T18:48:12.3609447Z                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3610507Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T18:48:12.3611378Z     return self._mock_call(*args, **kwargs)
2025-07-08T18:48:12.3611858Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3612770Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T18:48:12.3613692Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T18:48:12.3614182Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:12.3615164Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T18:48:12.3616258Z     raise effect
2025-07-08T18:48:12.3616642Z Exception: Unexpected database error
2025-07-08T18:48:12.3616953Z 
2025-07-08T18:48:12.3668676Z .2025-07-08 18:48:12,366 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T18:48:12.3673909Z 2025-07-08 18:48:12,366 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T18:48:12.3677989Z   "current_scene": 2,
2025-07-08T18:48:12.3680399Z   "hp": 80
2025-07-08T18:48:12.3681766Z }
2025-07-08T18:48:12.3683675Z 2025-07-08 18:48:12,366 - INFO - --- update_state_with_changes: finished ---
2025-07-08T18:48:12.3692110Z 2025-07-08 18:48:12,369 - INFO - COMBAT CLEANUP CHECK: Found 0 combatants, scanning for defeated enemies...
2025-07-08T18:48:12.3700030Z 2025-07-08 18:48:12,369 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: <MagicMock name='GameState.from_dict().cleanup_defeated_enemies()' id='140030251760144'>
2025-07-08T18:48:12.3885546Z ......
2025-07-08T18:48:12.3886690Z ----------------------------------------------------------------------
2025-07-08T18:48:12.3888184Z Ran 16 tests in 0.095s
2025-07-08T18:48:12.3888565Z 
2025-07-08T18:48:12.3888777Z OK
2025-07-08T18:48:12.5342639Z ✅ mvp_site/tests/test_main_god_mode.py passed
2025-07-08T18:48:12.5344145Z ----------------------------------------
2025-07-08T18:48:12.5344663Z Running mvp_site/tests/test_main_route_edge_cases.py...
2025-07-08T18:48:13.4765585Z sssssssssssssssssssssssss
2025-07-08T18:48:13.4768813Z ----------------------------------------------------------------------
2025-07-08T18:48:13.4769309Z Ran 25 tests in 0.000s
2025-07-08T18:48:13.4769522Z 
2025-07-08T18:48:13.4769644Z OK (skipped=25)
2025-07-08T18:48:13.6481390Z ✅ mvp_site/tests/test_main_route_edge_cases.py passed
2025-07-08T18:48:13.6482808Z ----------------------------------------
2025-07-08T18:48:13.6483288Z Running mvp_site/tests/test_main_routes.py...
2025-07-08T18:48:14.5298313Z 2025-07-08 18:48:14,529 - INFO - Received custom_options: []
2025-07-08T18:48:14.5299502Z 2025-07-08 18:48:14,529 - INFO - Selected attribute_system: D&D
2025-07-08T18:48:14.5352341Z .2025-07-08 18:48:14,535 - INFO - Received custom_options: ['companions', 'defaultWorld']
2025-07-08T18:48:14.5353581Z 2025-07-08 18:48:14,535 - INFO - Selected attribute_system: D&D
2025-07-08T18:48:14.5516351Z ...2025-07-08 18:48:14,551 - INFO - Exporting file '/tmp/campaign_exports/test-uuid.txt' with download_name='Test Campaign.txt'
2025-07-08T18:48:14.5889864Z ........Traceback (most recent call last):
2025-07-08T18:48:14.5891779Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 615, in update_campaign
2025-07-08T18:48:14.5893265Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T18:48:14.5897191Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T18:48:14.5899819Z     return self._mock_call(*args, **kwargs)
2025-07-08T18:48:14.5900594Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:14.5901738Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T18:48:14.5903219Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T18:48:14.5904078Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T18:48:14.5905181Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T18:48:14.5906184Z     raise effect
2025-07-08T18:48:14.5906525Z Exception: Update failed
2025-07-08T18:48:14.6067753Z .....
2025-07-08T18:48:14.6068636Z ----------------------------------------------------------------------
2025-07-08T18:48:14.6069497Z Ran 17 tests in 0.084s
2025-07-08T18:48:14.6070106Z 
2025-07-08T18:48:14.6070545Z OK
2025-07-08T18:48:14.7842036Z ✅ mvp_site/tests/test_main_routes.py passed
2025-07-08T18:48:14.7843589Z ----------------------------------------
2025-07-08T18:48:14.7844143Z Running mvp_site/tests/test_main_routes_comprehensive.py...
2025-07-08T18:48:15.6493834Z ...2025-07-08 18:48:15,649 - INFO - Legacy state cleanup complete. Removed 5 entries.
2025-07-08T18:48:15.6495447Z .
2025-07-08T18:48:15.6496004Z ----------------------------------------------------------------------
2025-07-08T18:48:15.6496979Z Ran 4 tests in 0.005s
2025-07-08T18:48:15.6497177Z 
2025-07-08T18:48:15.6497271Z OK
2025-07-08T18:48:15.7837268Z ✅ mvp_site/tests/test_main_routes_comprehensive.py passed
2025-07-08T18:48:15.7838830Z ----------------------------------------
2025-07-08T18:48:15.7839762Z Running mvp_site/tests/test_main_security_validation.py...
2025-07-08T18:48:15.9088956Z .........../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py:1567: UserWarning: Duplicate name: 'file1.txt'
2025-07-08T18:48:15.9091082Z   return self._open_to_write(zinfo, force_zip64=force_zip64)
2025-07-08T18:48:15.9197957Z .................
2025-07-08T18:48:15.9199465Z ----------------------------------------------------------------------
2025-07-08T18:48:15.9199957Z Ran 28 tests in 0.065s
2025-07-08T18:48:15.9200170Z 
2025-07-08T18:48:15.9200273Z OK
2025-07-08T18:48:15.9341540Z ✅ mvp_site/tests/test_main_security_validation.py passed
2025-07-08T18:48:15.9343059Z ----------------------------------------
2025-07-08T18:48:15.9343611Z Running mvp_site/tests/test_main_state_helper.py...
2025-07-08T18:48:16.8183473Z .........s.......
2025-07-08T18:48:16.8185061Z ----------------------------------------------------------------------
2025-07-08T18:48:16.8185579Z Ran 17 tests in 0.025s
2025-07-08T18:48:16.8186018Z 
2025-07-08T18:48:16.8186141Z OK (skipped=1)
2025-07-08T18:48:16.9712909Z ✅ mvp_site/tests/test_main_state_helper.py passed
2025-07-08T18:48:16.9714419Z ----------------------------------------
2025-07-08T18:48:16.9715030Z Running mvp_site/tests/test_milestone_4_interactive_features.py...
2025-07-08T18:48:17.0144626Z 🚀 Starting Milestone 4: Interactive Features Test Suite
2025-07-08T18:48:17.0145864Z ============================================================
2025-07-08T18:48:17.0146972Z 🧪 Testing Milestone 4: Interactive Features
2025-07-08T18:48:17.0147831Z ============================================================
2025-07-08T18:48:17.0148907Z test_accessibility_features (__main__.TestMilestone4InteractiveFeatures.test_accessibility_features)
2025-07-08T18:48:17.0152591Z Test that interactive features maintain accessibility ... ✅ Interactive features maintain accessibility standards
2025-07-08T18:48:17.0153423Z ok
2025-07-08T18:48:17.0158296Z test_backward_compatibility (__main__.TestMilestone4InteractiveFeatures.test_backward_compatibility)
2025-07-08T18:48:17.0161450Z Test that features maintain backward compatibility ... ✅ All features maintain backward compatibility
2025-07-08T18:48:17.0162234Z ok
2025-07-08T18:48:17.0162997Z test_campaign_wizard_html_structure (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_html_structure)
2025-07-08T18:48:17.0165132Z Test campaign wizard generates proper HTML structure ... ✅ Campaign wizard generates proper HTML structure
2025-07-08T18:48:17.0166132Z ok
2025-07-08T18:48:17.0169803Z test_campaign_wizard_js_exists (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_js_exists)
2025-07-08T18:48:17.0172240Z Test that campaign wizard JavaScript file exists ... ✅ Campaign Wizard JavaScript file exists and contains core functionality
2025-07-08T18:48:17.0173173Z ok
2025-07-08T18:48:17.0173941Z test_css_modern_mode_selectors (__main__.TestMilestone4InteractiveFeatures.test_css_modern_mode_selectors)
2025-07-08T18:48:17.0178875Z Test CSS has proper modern mode selectors ... ✅ CSS has proper modern mode selectors and responsive design
2025-07-08T18:48:17.0181364Z ok
2025-07-08T18:48:17.0184376Z test_css_theme_integration (__main__.TestMilestone4InteractiveFeatures.test_css_theme_integration)
2025-07-08T18:48:17.0186038Z Test CSS integrates properly with existing theme system ... ✅ CSS integrates properly with existing theme system
2025-07-08T18:48:17.0190450Z ok
2025-07-08T18:48:17.0191178Z test_enhanced_search_features (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_features)
2025-07-08T18:48:17.0192549Z Test enhanced search has all required features ... ✅ Enhanced search has all required features
2025-07-08T18:48:17.0193616Z ok
2025-07-08T18:48:17.0194329Z test_enhanced_search_js_exists (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_js_exists)
2025-07-08T18:48:17.0196309Z Test that enhanced search JavaScript file exists ... ✅ Enhanced Search JavaScript file exists and contains core functionality
2025-07-08T18:48:17.0197259Z ok
2025-07-08T18:48:17.0197843Z test_error_handling (__main__.TestMilestone4InteractiveFeatures.test_error_handling)
2025-07-08T18:48:17.0207021Z Test that features handle errors gracefully ... ✅ Features include proper error handling
2025-07-08T18:48:17.0211506Z ok
2025-07-08T18:48:17.0212242Z test_file_integration_order (__main__.TestMilestone4InteractiveFeatures.test_file_integration_order)
2025-07-08T18:48:17.0213597Z Test that files are loaded in the correct order ... ✅ JavaScript files are loaded in correct dependency order
2025-07-08T18:48:17.0214353Z ok
2025-07-08T18:48:17.0215138Z test_index_html_has_interface_toggle (__main__.TestMilestone4InteractiveFeatures.test_index_html_has_interface_toggle)
2025-07-08T18:48:17.0219898Z Test that index.html contains the interface mode toggle ... ✅ index.html contains interface mode toggle UI
2025-07-08T18:48:17.0220675Z ok
2025-07-08T18:48:17.0221393Z test_index_html_includes_scripts (__main__.TestMilestone4InteractiveFeatures.test_index_html_includes_scripts)
2025-07-08T18:48:17.0228448Z Test that index.html includes all necessary script files ... ✅ index.html includes all interactive features scripts and CSS
2025-07-08T18:48:17.0233008Z ok
2025-07-08T18:48:17.0233724Z test_interactive_features_css_exists (__main__.TestMilestone4InteractiveFeatures.test_interactive_features_css_exists)
2025-07-08T18:48:17.0235051Z Test that interactive features CSS file exists ... ✅ Interactive Features CSS file exists and contains styling rules
2025-07-08T18:48:17.0235943Z ok
2025-07-08T18:48:17.0236666Z test_interface_manager_feature_control (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_feature_control)
2025-07-08T18:48:17.0237971Z Test interface manager can control features ... ✅ Interface manager has proper feature control methods
2025-07-08T18:48:17.0238615Z ok
2025-07-08T18:48:17.0239246Z test_interface_manager_js_exists (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_js_exists)
2025-07-08T18:48:17.0240664Z Test that interface manager JavaScript file exists ... ✅ Interface Manager JavaScript file exists and contains core functionality
2025-07-08T18:48:17.0241505Z ok
2025-07-08T18:48:17.0242137Z test_javascript_file_structure (__main__.TestMilestone4InteractiveFeatures.test_javascript_file_structure)
2025-07-08T18:48:17.0243352Z Test JavaScript files have proper structure ... ✅ All JavaScript files have proper structure and integration
2025-07-08T18:48:17.0244063Z ok
2025-07-08T18:48:17.0244721Z test_performance_considerations (__main__.TestMilestone4InteractiveFeatures.test_performance_considerations)
2025-07-08T18:48:17.0246329Z Test that features are optimized for performance ... ✅ Features include performance optimizations
2025-07-08T18:48:17.0247038Z ok
2025-07-08T18:48:17.0247695Z test_progressive_enhancement (__main__.TestMilestone4InteractiveFeatures.test_progressive_enhancement)
2025-07-08T18:48:17.0248969Z Test that features use progressive enhancement ... ✅ Features use progressive enhancement and default to safe mode
2025-07-08T18:48:17.0249737Z ok
2025-07-08T18:48:17.0249880Z 
2025-07-08T18:48:17.0250096Z ----------------------------------------------------------------------
2025-07-08T18:48:17.0250546Z Ran 18 tests in 0.009s
2025-07-08T18:48:17.0250731Z 
2025-07-08T18:48:17.0250822Z OK
2025-07-08T18:48:17.0250954Z 
2025-07-08T18:48:17.0251078Z ============================================================
2025-07-08T18:48:17.0251539Z 🎯 MILESTONE 4 TEST SUMMARY
2025-07-08T18:48:17.0251925Z ============================================================
2025-07-08T18:48:17.0252372Z ✅ Passed: 18/18
2025-07-08T18:48:17.0252544Z 
2025-07-08T18:48:17.0252866Z 🎉 MILESTONE 4: INTERACTIVE FEATURES - ALL TESTS PASSED!
2025-07-08T18:48:17.0253701Z 📋 Features Ready:
2025-07-08T18:48:17.0254133Z    • Master Interface Toggle (Classic/Modern)
2025-07-08T18:48:17.0254647Z    • Campaign Wizard (Multi-step Creation)
2025-07-08T18:48:17.0255133Z    • Enhanced Search & Filter
2025-07-08T18:48:17.0255911Z    • Enhanced Modals
2025-07-08T18:48:17.0256347Z    • Backward Compatibility
2025-07-08T18:48:17.0256774Z    • Progressive Enhancement
2025-07-08T18:48:17.0315277Z ✅ mvp_site/tests/test_milestone_4_interactive_features.py passed
2025-07-08T18:48:17.0316928Z ----------------------------------------
2025-07-08T18:48:17.0317494Z Running mvp_site/tests/test_mission_conversion_helpers.py...
2025-07-08T18:48:17.3010186Z .........
2025-07-08T18:48:17.3010789Z ----------------------------------------------------------------------
2025-07-08T18:48:17.3011407Z Ran 9 tests in 0.003s
2025-07-08T18:48:17.3011614Z 
2025-07-08T18:48:17.3011766Z OK
2025-07-08T18:48:17.3514482Z ✅ mvp_site/tests/test_mission_conversion_helpers.py passed
2025-07-08T18:48:17.3515536Z ----------------------------------------
2025-07-08T18:48:17.3517614Z Running mvp_site/tests/test_mission_handling.py...
2025-07-08T18:48:17.6226062Z WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T18:48:17.6227282Z ..WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T18:48:17.6227935Z .
2025-07-08T18:48:17.6228263Z ----------------------------------------------------------------------
2025-07-08T18:48:17.6228700Z Ran 3 tests in 0.001s
2025-07-08T18:48:17.6228890Z 
2025-07-08T18:48:17.6229012Z OK
2025-07-08T18:48:17.6632663Z ✅ mvp_site/tests/test_mission_handling.py passed
2025-07-08T18:48:17.6635907Z ----------------------------------------
2025-07-08T18:48:17.6636431Z Running mvp_site/tests/test_narrative_cutoff_bug.py...
2025-07-08T18:48:17.7087977Z test_complex_nested_quotes (__main__.TestNarrativeCutoffBug.test_complex_nested_quotes)
2025-07-08T18:48:17.7091300Z Test extraction with complex nested quotes and escape sequences. ... ok
2025-07-08T18:48:17.7092310Z test_extraction_performance (__main__.TestNarrativeCutoffBug.test_extraction_performance)
2025-07-08T18:48:17.7110897Z Test that the fix handles very long narratives efficiently. ... ok
2025-07-08T18:48:17.7113085Z test_incomplete_json_narrative (__main__.TestNarrativeCutoffBug.test_incomplete_json_narrative)
2025-07-08T18:48:17.7114152Z Test that incomplete JSON (cut off mid-narrative) still extracts what's available. ... ok
2025-07-08T18:48:17.7115470Z test_narrative_extraction_with_quotes_GREEN_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_GREEN_phase)
2025-07-08T18:48:17.7120240Z GREEN PHASE: Demonstrate that the fixed implementation works correctly. ... ok
2025-07-08T18:48:17.7121524Z test_narrative_extraction_with_quotes_RED_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_RED_phase)
2025-07-08T18:48:17.7122664Z RED PHASE: Demonstrate that a naive regex approach would fail. ... ok
2025-07-08T18:48:17.7123687Z test_narrative_with_json_special_chars (__main__.TestNarrativeCutoffBug.test_narrative_with_json_special_chars)
2025-07-08T18:48:17.7124604Z Test narratives containing JSON special characters. ... ok
2025-07-08T18:48:17.7124988Z 
2025-07-08T18:48:17.7125195Z ----------------------------------------------------------------------
2025-07-08T18:48:17.7125848Z Ran 6 tests in 0.004s
2025-07-08T18:48:17.7126063Z 
2025-07-08T18:48:17.7126169Z OK
2025-07-08T18:48:17.7126320Z 
2025-07-08T18:48:17.7128222Z Actual result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T18:48:17.7130654Z 
2025-07-08T18:48:17.7132910Z Expected result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T18:48:17.7134938Z 
2025-07-08T18:48:17.7135548Z 🟢 GREEN PHASE: Fixed extraction successfully got all 691 chars
2025-07-08T18:48:17.7136526Z Narrative ends correctly with: ...g presence to get him to spill everything quickly.
2025-07-08T18:48:17.7137061Z 
2025-07-08T18:48:17.7137440Z 🔴 RED PHASE: Buggy extraction got only 177 chars instead of 691
2025-07-08T18:48:17.7138164Z Cutoff happened at: ...proaches you, his eyes gleaming with urgency.\n\n\
2025-07-08T18:48:17.7196633Z ✅ mvp_site/tests/test_narrative_cutoff_bug.py passed
2025-07-08T18:48:17.7198075Z ----------------------------------------
2025-07-08T18:48:17.7198576Z Running mvp_site/tests/test_npc_data_handling.py...
2025-07-08T18:48:17.9847062Z .....
2025-07-08T18:48:17.9849348Z ----------------------------------------------------------------------
2025-07-08T18:48:17.9849937Z Ran 5 tests in 0.001s
2025-07-08T18:48:17.9850154Z 
2025-07-08T18:48:17.9850265Z OK
2025-07-08T18:48:18.0294576Z ✅ mvp_site/tests/test_npc_data_handling.py passed
2025-07-08T18:48:18.0296229Z ----------------------------------------
2025-07-08T18:48:18.0296814Z Running mvp_site/tests/test_npc_gender_consistency_red_green.py...
2025-07-08T18:48:18.2067512Z .....
2025-07-08T18:48:18.2071131Z ----------------------------------------------------------------------
2025-07-08T18:48:18.2071637Z Ran 5 tests in 0.001s
2025-07-08T18:48:18.2071841Z 
2025-07-08T18:48:18.2071954Z OK
2025-07-08T18:48:18.2291650Z ✅ mvp_site/tests/test_npc_gender_consistency_red_green.py passed
2025-07-08T18:48:18.2293195Z ----------------------------------------
2025-07-08T18:48:18.2293727Z Running mvp_site/tests/test_null_narrative_bug_fix.py...
2025-07-08T18:48:18.2742287Z .....
2025-07-08T18:48:18.2743215Z ----------------------------------------------------------------------
2025-07-08T18:48:18.2743912Z Ran 5 tests in 0.000s
2025-07-08T18:48:18.2744141Z 
2025-07-08T18:48:18.2744256Z OK
2025-07-08T18:48:18.2820039Z ✅ mvp_site/tests/test_null_narrative_bug_fix.py passed
2025-07-08T18:48:18.2821580Z ----------------------------------------
2025-07-08T18:48:18.2822138Z Running mvp_site/tests/test_numeric_field_converter.py...
2025-07-08T18:48:18.3222695Z ...........
2025-07-08T18:48:18.3223571Z ----------------------------------------------------------------------
2025-07-08T18:48:18.3225022Z Ran 11 tests in 0.001s
2025-07-08T18:48:18.3225254Z 
2025-07-08T18:48:18.3225364Z OK
2025-07-08T18:48:18.3288950Z ✅ mvp_site/tests/test_numeric_field_converter.py passed
2025-07-08T18:48:18.3289802Z ----------------------------------------
2025-07-08T18:48:18.3291965Z Running mvp_site/tests/test_planning_block_enforcement.py...
2025-07-08T18:48:18.4646218Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4651308Z   @validator('strength', pre=True)
2025-07-08T18:48:18.4653964Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4657263Z   @validator('dexterity', pre=True)
2025-07-08T18:48:18.4659898Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4662125Z   @validator('constitution', pre=True)
2025-07-08T18:48:18.4664576Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4669843Z   @validator('intelligence', pre=True)
2025-07-08T18:48:18.4672567Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4675315Z   @validator('wisdom', pre=True)
2025-07-08T18:48:18.4678196Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4680918Z   @validator('charisma', pre=True)
2025-07-08T18:48:18.4830541Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4837853Z   @validator('hp', pre=True)
2025-07-08T18:48:18.4840544Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4843245Z   @validator('hp_max', pre=True)
2025-07-08T18:48:18.4846069Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4848804Z   @validator('temp_hp', pre=True)
2025-07-08T18:48:18.4879423Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4882134Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T18:48:18.4908711Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4912058Z   @validator('level', pre=True)
2025-07-08T18:48:18.4917024Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4919825Z   @validator('gender')
2025-07-08T18:48:18.4922531Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4925268Z   @validator('age')
2025-07-08T18:48:18.4930025Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4932763Z   @validator('mbti')
2025-07-08T18:48:18.4935374Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4938293Z   @validator('alignment')
2025-07-08T18:48:18.4940945Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.4943689Z   @validator('entity_type')
2025-07-08T18:48:18.5090571Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.5095365Z   @validator('participants')
2025-07-08T18:48:18.5107682Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.5113540Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T18:48:18.5116914Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:18.5119378Z   @validator('present_entities')
2025-07-08T18:48:18.5276443Z 2025-07-08 18:48:18,527 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:48:18.5293750Z 2025-07-08 18:48:18,529 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T18:48:18.5295243Z 2025-07-08 18:48:18,529 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:48:18.5310071Z 2025-07-08 18:48:18,530 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:48:18.5324247Z 2025-07-08 18:48:18,532 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5325936Z 2025-07-08 18:48:18,532 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5327190Z 2025-07-08 18:48:18,532 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T18:48:18.5354324Z .2025-07-08 18:48:18,535 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:48:18.5367978Z 2025-07-08 18:48:18,536 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T18:48:18.5369234Z 2025-07-08 18:48:18,536 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:48:18.5374030Z 2025-07-08 18:48:18,537 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:48:18.5379609Z 2025-07-08 18:48:18,537 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5380784Z 2025-07-08 18:48:18,537 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5383232Z 2025-07-08 18:48:18,537 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T18:48:18.5416895Z .2025-07-08 18:48:18,541 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:48:18.5430010Z 2025-07-08 18:48:18,542 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T18:48:18.5431597Z 2025-07-08 18:48:18,542 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:48:18.5432876Z 2025-07-08 18:48:18,543 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:48:18.5436219Z 2025-07-08 18:48:18,543 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5437197Z 2025-07-08 18:48:18,543 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5438409Z 2025-07-08 18:48:18,543 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T18:48:18.5444097Z 2025-07-08 18:48:18,543 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T18:48:18.5448924Z 2025-07-08 18:48:18,544 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T18:48:18.5450498Z 2025-07-08 18:48:18,544 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T18:48:18.5453120Z 2025-07-08 18:48:18,544 - INFO - Context is within token budget. No truncation needed.
2025-07-08T18:48:18.5454095Z 2025-07-08 18:48:18,545 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5454885Z 2025-07-08 18:48:18,545 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5456131Z 2025-07-08 18:48:18,545 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T18:48:18.5467480Z .2025-07-08 18:48:18,546 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5476665Z 2025-07-08 18:48:18,547 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T18:48:18.5486277Z .2025-07-08 18:48:18,548 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5497129Z 2025-07-08 18:48:18,549 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5498524Z 2025-07-08 18:48:18,549 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5500848Z 2025-07-08 18:48:18,549 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T18:48:18.5501849Z 2025-07-08 18:48:18,549 - INFO - Added LLM-generated standard planning block
2025-07-08T18:48:18.5508925Z .2025-07-08 18:48:18,550 - INFO - Skipping planning block for character creation step
2025-07-08T18:48:18.5510155Z 2025-07-08 18:48:18,550 - INFO - Skipping planning block for character creation step
2025-07-08T18:48:18.5512365Z 2025-07-08 18:48:18,550 - INFO - Skipping planning block for character creation step
2025-07-08T18:48:18.5515811Z 2025-07-08 18:48:18,550 - INFO - Skipping planning block for character creation step
2025-07-08T18:48:18.5538090Z ...2025-07-08 18:48:18,553 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T18:48:18.5539361Z 2025-07-08 18:48:18,553 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T18:48:18.5541604Z 2025-07-08 18:48:18,553 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T18:48:18.5544491Z 2025-07-08 18:48:18,553 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T18:48:18.5545366Z 2025-07-08 18:48:18,553 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T18:48:18.5552812Z .2025-07-08 18:48:18,555 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T18:48:18.5553963Z 2025-07-08 18:48:18,555 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T18:48:18.5556721Z 2025-07-08 18:48:18,555 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T18:48:18.5565245Z .2025-07-08 18:48:18,556 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5576779Z 2025-07-08 18:48:18,557 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5578291Z 2025-07-08 18:48:18,557 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5579819Z 2025-07-08 18:48:18,557 - INFO - Recovered from incomplete JSON response. Narrative length: 206 characters (~51 tokens)
2025-07-08T18:48:18.5582862Z 2025-07-08 18:48:18,557 - INFO - Added LLM-generated standard planning block
2025-07-08T18:48:18.5589270Z .2025-07-08 18:48:18,558 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5600186Z 2025-07-08 18:48:18,559 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5601984Z 2025-07-08 18:48:18,559 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5603324Z 2025-07-08 18:48:18,559 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T18:48:18.5604337Z 2025-07-08 18:48:18,560 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:18.5605531Z 2025-07-08 18:48:18,560 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5607155Z 2025-07-08 18:48:18,560 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5608883Z 2025-07-08 18:48:18,560 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5609934Z 2025-07-08 18:48:18,560 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T18:48:18.5611225Z 2025-07-08 18:48:18,560 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:18.5612442Z 2025-07-08 18:48:18,560 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5613973Z 2025-07-08 18:48:18,560 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5616148Z 2025-07-08 18:48:18,560 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5617174Z 2025-07-08 18:48:18,561 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T18:48:18.5618123Z 2025-07-08 18:48:18,561 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:18.5619258Z 2025-07-08 18:48:18,561 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5620298Z 2025-07-08 18:48:18,561 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5620998Z 2025-07-08 18:48:18,561 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5622033Z 2025-07-08 18:48:18,561 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T18:48:18.5622979Z 2025-07-08 18:48:18,561 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:18.5624030Z 2025-07-08 18:48:18,561 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5627848Z 2025-07-08 18:48:18,562 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5629595Z 2025-07-08 18:48:18,562 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5630653Z 2025-07-08 18:48:18,562 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T18:48:18.5631639Z 2025-07-08 18:48:18,562 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:18.5638704Z .2025-07-08 18:48:18,563 - INFO - Planning block found in response
2025-07-08T18:48:18.5648278Z .2025-07-08 18:48:18,564 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:18.5658494Z 2025-07-08 18:48:18,565 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:18.5660253Z 2025-07-08 18:48:18,565 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:18.5661206Z 2025-07-08 18:48:18,565 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T18:48:18.5662122Z 2025-07-08 18:48:18,565 - INFO - Added LLM-generated standard planning block
2025-07-08T18:48:18.5662636Z .
2025-07-08T18:48:18.5662964Z ----------------------------------------------------------------------
2025-07-08T18:48:18.5663409Z Ran 14 tests in 0.174s
2025-07-08T18:48:18.5663992Z 
2025-07-08T18:48:18.5664250Z OK
2025-07-08T18:48:18.5942754Z ✅ mvp_site/tests/test_planning_block_enforcement.py passed
2025-07-08T18:48:18.5944296Z ----------------------------------------
2025-07-08T18:48:18.5944949Z Running mvp_site/tests/test_planning_block_json_corruption_fix.py...
2025-07-08T18:48:19.2289762Z test_planning_block_api_failure_fallback (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_api_failure_fallback)
2025-07-08T18:48:19.2298712Z TEST: Verify that when planning block generation fails, ... 2025-07-08 18:48:19,229 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.2301286Z 2025-07-08 18:48:19,229 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T18:48:19.2301937Z ok
2025-07-08T18:48:19.2302878Z test_planning_block_json_response_gets_parsed (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_json_response_gets_parsed)
2025-07-08T18:48:19.2307529Z RED TEST: Verify that when planning block generation returns JSON, ... 2025-07-08 18:48:19,230 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.2310092Z 2025-07-08 18:48:19,230 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.2310697Z ok
2025-07-08T18:48:19.2311687Z test_planning_block_plain_text_response_unchanged (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_plain_text_response_unchanged)
2025-07-08T18:48:19.2317931Z GREEN TEST: Verify that when planning block generation returns plain text, ... 2025-07-08 18:48:19,231 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.2327881Z 2025-07-08 18:48:19,232 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.2329642Z 2025-07-08 18:48:19,232 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.2330666Z 2025-07-08 18:48:19,232 - INFO - Recovered from incomplete JSON response. Narrative length: 219 characters (~54 tokens)
2025-07-08T18:48:19.2331610Z 2025-07-08 18:48:19,232 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.2332201Z ok
2025-07-08T18:48:19.2332568Z 
2025-07-08T18:48:19.2332997Z 🔴 RUNNING RED/GREEN TESTS: Planning Block JSON Corruption Fix
2025-07-08T18:48:19.2333544Z ======================================================================
2025-07-08T18:48:19.2334186Z ----------------------------------------------------------------------
2025-07-08T18:48:19.2334862Z ✅ Test passed: Planning block API failure fallback works
2025-07-08T18:48:19.2335510Z ✅ Test passed: Planning block JSON response properly parsed
2025-07-08T18:48:19.2336389Z Ran 3 tests in 0.004s
2025-07-08T18:48:19.2336716Z Result length: 274 characters
2025-07-08T18:48:19.2336969Z 
2025-07-08T18:48:19.2338645Z Result preview: 'eed cautiously** - Move forward carefully\n3. **Cast a detection spell** - Use magic to sense dangers'
2025-07-08T18:48:19.2340330Z ✅ Test passed: Planning block plain text response works correctly
2025-07-08T18:48:19.2341792Z OK
2025-07-08T18:48:19.3122395Z ✅ mvp_site/tests/test_planning_block_json_corruption_fix.py passed
2025-07-08T18:48:19.3123579Z ----------------------------------------
2025-07-08T18:48:19.3125040Z Running mvp_site/tests/test_planning_block_simplified.py...
2025-07-08T18:48:19.9542790Z 2025-07-08 18:48:19,953 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9555965Z 2025-07-08 18:48:19,955 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9557530Z 2025-07-08 18:48:19,955 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9559615Z 2025-07-08 18:48:19,955 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9560608Z 2025-07-08 18:48:19,955 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9565893Z 2025-07-08 18:48:19,956 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9570000Z 2025-07-08 18:48:19,956 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9571428Z 2025-07-08 18:48:19,956 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9573777Z 2025-07-08 18:48:19,956 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9575175Z 2025-07-08 18:48:19,956 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9578351Z 2025-07-08 18:48:19,957 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9582626Z 2025-07-08 18:48:19,958 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9583455Z 2025-07-08 18:48:19,958 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9584486Z 2025-07-08 18:48:19,958 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9586180Z 2025-07-08 18:48:19,958 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9592544Z 2025-07-08 18:48:19,959 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9597283Z 2025-07-08 18:48:19,959 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9598136Z 2025-07-08 18:48:19,959 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9599171Z 2025-07-08 18:48:19,959 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9600140Z 2025-07-08 18:48:19,959 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9605126Z 2025-07-08 18:48:19,960 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9611681Z 2025-07-08 18:48:19,960 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9612534Z 2025-07-08 18:48:19,960 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9613548Z 2025-07-08 18:48:19,960 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9614501Z 2025-07-08 18:48:19,960 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9619036Z .2025-07-08 18:48:19,961 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9627216Z 2025-07-08 18:48:19,961 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9628048Z 2025-07-08 18:48:19,962 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9629081Z 2025-07-08 18:48:19,962 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9630050Z 2025-07-08 18:48:19,962 - INFO - Added LLM-generated standard planning block
2025-07-08T18:48:19.9631405Z .2025-07-08 18:48:19,962 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9635915Z 2025-07-08 18:48:19,963 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9639111Z 2025-07-08 18:48:19,963 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9644019Z 2025-07-08 18:48:19,963 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9645027Z 2025-07-08 18:48:19,963 - INFO - Added LLM-generated standard planning block
2025-07-08T18:48:19.9647654Z .2025-07-08 18:48:19,964 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T18:48:19.9649134Z 2025-07-08 18:48:19,964 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:19.9650262Z 2025-07-08 18:48:19,964 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T18:48:19.9653091Z 2025-07-08 18:48:19,964 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T18:48:19.9654273Z 2025-07-08 18:48:19,964 - INFO - Added LLM-generated deep think planning block
2025-07-08T18:48:19.9655027Z .
2025-07-08T18:48:19.9655526Z ----------------------------------------------------------------------
2025-07-08T18:48:19.9657309Z Ran 4 tests in 0.012s
2025-07-08T18:48:19.9657660Z 
2025-07-08T18:48:19.9658926Z OK
2025-07-08T18:48:20.0484054Z ✅ mvp_site/tests/test_planning_block_simplified.py passed
2025-07-08T18:48:20.0485920Z ----------------------------------------
2025-07-08T18:48:20.0486403Z Running mvp_site/tests/test_pr_changes_runner.py...
2025-07-08T18:48:20.2235367Z 
2025-07-08T18:48:20.2237291Z === Testing Debug Mode Default Change ===
2025-07-08T18:48:20.2239654Z ✓ GameState defaults to debug_mode=True
2025-07-08T18:48:20.2240169Z ✓ GameState can be set to debug_mode=False
2025-07-08T18:48:20.2240677Z ✓ debug_mode is included in serialization
2025-07-08T18:48:20.2241187Z ✓ debug_mode is preserved in deserialization
2025-07-08T18:48:20.2241481Z 
2025-07-08T18:48:20.2241632Z === Testing Entity Schema Constant ===
2025-07-08T18:48:20.2242740Z ✓ Entity schema has been properly integrated into game_state instructions
2025-07-08T18:48:20.2243179Z 
2025-07-08T18:48:20.2243327Z === Testing Manifest Cache Exclusion ===
2025-07-08T18:48:20.2243954Z ✓ Internal attributes starting with _ are excluded from serialization
2025-07-08T18:48:20.2244355Z 
2025-07-08T18:48:20.2244512Z === Testing Entity ID Format ===
2025-07-08T18:48:20.2244998Z ✓ PC entity ID format correct: pc_test_hero_001
2025-07-08T18:48:20.2245556Z ✓ NPC entity ID format correct: npc_guard_captain_001
2025-07-08T18:48:20.2246059Z 
2025-07-08T18:48:20.2246208Z === All PR Change Tests Passed! ===
2025-07-08T18:48:20.2479111Z ✅ mvp_site/tests/test_pr_changes_runner.py passed
2025-07-08T18:48:20.2480598Z ----------------------------------------
2025-07-08T18:48:20.2481144Z Running mvp_site/tests/test_prompt_mission_examples.py...
2025-07-08T18:48:20.2851237Z ....
2025-07-08T18:48:20.2856431Z ----------------------------------------------------------------------
2025-07-08T18:48:20.2857028Z Ran 4 tests in 0.001s
2025-07-08T18:48:20.2857251Z 
2025-07-08T18:48:20.2857376Z OK
2025-07-08T18:48:20.2908966Z ✅ mvp_site/tests/test_prompt_mission_examples.py passed
2025-07-08T18:48:20.2910369Z ----------------------------------------
2025-07-08T18:48:20.2910913Z Running mvp_site/tests/test_prompt_npc_examples.py...
2025-07-08T18:48:20.3281630Z ....
2025-07-08T18:48:20.3282470Z ----------------------------------------------------------------------
2025-07-08T18:48:20.3284118Z Ran 4 tests in 0.001s
2025-07-08T18:48:20.3284358Z 
2025-07-08T18:48:20.3284469Z OK
2025-07-08T18:48:20.3342375Z ✅ mvp_site/tests/test_prompt_npc_examples.py passed
2025-07-08T18:48:20.3343737Z ----------------------------------------
2025-07-08T18:48:20.3344219Z Running mvp_site/tests/test_prompts.py...
2025-07-08T18:48:20.9707398Z 2025-07-08 18:48:20,970 - INFO - --- Running Test: test_all_prompt_files_are_registered_in_service ---
2025-07-08T18:48:20.9708968Z .2025-07-08 18:48:20,970 - INFO - --- Running Test: test_all_prompts_are_loadable_via_service ---
2025-07-08T18:48:20.9714663Z .2025-07-08 18:48:20,971 - INFO - --- Running Test: test_all_registered_prompts_are_actually_used ---
2025-07-08T18:48:20.9792372Z .2025-07-08 18:48:20,979 - INFO - --- Running Test: test_loading_unknown_prompt_raises_error ---
2025-07-08T18:48:20.9794756Z 2025-07-08 18:48:20,979 - ERROR - 🔥🔴 FATAL: Unknown instruction type requested: this_is_not_a_real_prompt_type
2025-07-08T18:48:20.9795501Z .
2025-07-08T18:48:20.9796008Z ----------------------------------------------------------------------
2025-07-08T18:48:20.9796471Z Ran 4 tests in 0.009s
2025-07-08T18:48:20.9796664Z 
2025-07-08T18:48:20.9796783Z OK
2025-07-08T18:48:20.9797185Z ✓ Always-loaded prompts: 3/3 verified
2025-07-08T18:48:20.9797714Z ✓ Conditional prompts: 3/3 properly referenced
2025-07-08T18:48:21.0590070Z ✅ mvp_site/tests/test_prompts.py passed
2025-07-08T18:48:21.0593107Z ----------------------------------------
2025-07-08T18:48:21.0595413Z Running mvp_site/tests/test_raw_json_display_bug_reproduction.py...
2025-07-08T18:48:21.1038739Z ..
2025-07-08T18:48:21.1039200Z ----------------------------------------------------------------------
2025-07-08T18:48:21.1039705Z Ran 2 tests in 0.000s
2025-07-08T18:48:21.1039922Z 
2025-07-08T18:48:21.1040035Z OK
2025-07-08T18:48:21.1109050Z ✅ mvp_site/tests/test_raw_json_display_bug_reproduction.py passed
2025-07-08T18:48:21.1110509Z ----------------------------------------
2025-07-08T18:48:21.1111067Z Running mvp_site/tests/test_real_json_bug_reproduction.py...
2025-07-08T18:48:21.1559713Z ..
2025-07-08T18:48:21.1560071Z \nTesting exact user JSON structure...
2025-07-08T18:48:21.1560945Z Input length: 5399
2025-07-08T18:48:21.1561699Z Input preview: {
2025-07-08T18:48:21.1563271Z     "narrative": "[Mode: STORY MODE]\n[CHARACTER CREATION - Step 2 of 7]\n\n\"Understood,\" the voice echoes, a comforting presence as you consider your newfound destiny. \"Allow me to craft an iden...
2025-07-08T18:48:21.1564679Z \nResult length: 4239
2025-07-08T18:48:21.1565591Z ----------------------------------------------------------------------
2025-07-08T18:48:21.1566526Z Ran 2 tests in 0.000s
2025-07-08T18:48:21.1566945Z 
2025-07-08T18:48:21.1567280Z OK
2025-07-08T18:48:21.1567561Z Result preview: [Mode: STORY MODE]
2025-07-08T18:48:21.1568400Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T18:48:21.1568844Z 
2025-07-08T18:48:21.1569678Z "Understood," the voice echoes, a comforting presence as you consider your newfound destiny. "Allow me to craft an identity that truly reflects t...
2025-07-08T18:48:21.1640294Z ✅ mvp_site/tests/test_real_json_bug_reproduction.py passed
2025-07-08T18:48:21.1641668Z ----------------------------------------
2025-07-08T18:48:21.1642219Z Running mvp_site/tests/test_red_green_demonstration.py...
2025-07-08T18:48:21.2275524Z GeminiResponse Integration Bug Fix - TDD Demonstration
2025-07-08T18:48:21.2279254Z ============================================================
2025-07-08T18:48:21.2279548Z 
2025-07-08T18:48:21.2279972Z 🧪 TEST-DRIVEN DEVELOPMENT CYCLE
2025-07-08T18:48:21.2280396Z ============================================================
2025-07-08T18:48:21.2280655Z 
2025-07-08T18:48:21.2280862Z 1. 🔴 RED: Write failing test
2025-07-08T18:48:21.2281366Z    • Test expects GeminiResponse integration to work
2025-07-08T18:48:21.2281990Z    • Test fails because firestore can't encode GeminiResponse
2025-07-08T18:48:21.2282637Z    • Error: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T18:48:21.2282980Z 
2025-07-08T18:48:21.2283161Z 2. 🟢 GREEN: Make test pass
2025-07-08T18:48:21.2283606Z    • Extract .narrative_text from GeminiResponse
2025-07-08T18:48:21.2284108Z    • Pass string to firestore instead of object
2025-07-08T18:48:21.2284545Z    • Test now passes
2025-07-08T18:48:21.2284751Z 
2025-07-08T18:48:21.2284939Z 3. 🔄 REFACTOR: Clean up
2025-07-08T18:48:21.2285432Z    • Update all test mocks to return GeminiResponse
2025-07-08T18:48:21.2286179Z    • Ensure consistent interface
2025-07-08T18:48:21.2286660Z    • Maintain backward compatibility
2025-07-08T18:48:21.2286974Z 
2025-07-08T18:48:21.2287197Z 🔴 RED PHASE: Demonstrating the bug
2025-07-08T18:48:21.2287614Z ==================================================
2025-07-08T18:48:21.2288182Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T18:48:21.2289062Z ✅ GeminiResponse.narrative_text: 'Your adventure begins in a bustling tavern......'
2025-07-08T18:48:21.2289624Z 
2025-07-08T18:48:21.2290009Z ❌ BEFORE FIX: firestore_service.add_story_entry() tries to call:
2025-07-08T18:48:21.2290556Z    text.encode('utf-8')
2025-07-08T18:48:21.2290933Z    where text = gemini_response_object
2025-07-08T18:48:21.2291230Z 
2025-07-08T18:48:21.2291652Z    ❌ AttributeError: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T18:48:21.2292317Z    ❌ Campaign creation fails!
2025-07-08T18:48:21.2292584Z 
2025-07-08T18:48:21.2292819Z 🟢 GREEN PHASE: Demonstrating the fix
2025-07-08T18:48:21.2293255Z ==================================================
2025-07-08T18:48:21.2293839Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T18:48:21.2294163Z 
2025-07-08T18:48:21.2294419Z ✅ AFTER FIX: main.py extracts narrative_text:
2025-07-08T18:48:21.2295013Z    opening_story_response = gemini_service.get_initial_story(...)
2025-07-08T18:48:21.2297325Z    create_campaign(..., opening_story_response.narrative_text, ...)
2025-07-08T18:48:21.2297765Z 
2025-07-08T18:48:21.2298045Z ✅ Extracted narrative_text: str
2025-07-08T18:48:21.2298668Z ✅ Content: 'Your adventure begins in a bustling tavern......'
2025-07-08T18:48:21.2299335Z ✅ Successfully encoded: 45 bytes
2025-07-08T18:48:21.2299798Z ✅ Campaign creation succeeds!
2025-07-08T18:48:21.2300042Z 
2025-07-08T18:48:21.2300258Z 🔄 REFACTOR PHASE: Clean architecture
2025-07-08T18:48:21.2300616Z ==================================================
2025-07-08T18:48:21.2301034Z ✅ Clean separation of concerns:
2025-07-08T18:48:21.2301489Z    • GeminiResponse: Encapsulates AI service response
2025-07-08T18:48:21.2302105Z    • .narrative_text: Clean narrative for users
2025-07-08T18:48:21.2302954Z    • .structured_response: State updates and entities
2025-07-08T18:48:21.2303498Z    • .debug_tags_present: Debug monitoring
2025-07-08T18:48:21.2303801Z 
2025-07-08T18:48:21.2304029Z ✅ Backward compatibility maintained:
2025-07-08T18:48:21.2304578Z    • All existing functionality preserved
2025-07-08T18:48:21.2305125Z    • Tests updated to use new interface
2025-07-08T18:48:21.2305605Z    • No breaking changes
2025-07-08T18:48:21.2306012Z 
2025-07-08T18:48:21.2306205Z ✅ Benefits achieved:
2025-07-08T18:48:21.2306670Z    • Type safety with GeminiResponse objects
2025-07-08T18:48:21.2307212Z    • Clear interface between services
2025-07-08T18:48:21.2307730Z    • Debug monitoring capabilities
2025-07-08T18:48:21.2308252Z    • Consistent JSON response handling
2025-07-08T18:48:21.2308561Z 
2025-07-08T18:48:21.2308785Z 🎉 SUMMARY: TDD cycle complete!
2025-07-08T18:48:21.2309271Z    • Bug identified and reproduced (RED)
2025-07-08T18:48:21.2309799Z    • Fix implemented and tested (GREEN)
2025-07-08T18:48:21.2310349Z    • Architecture improved (REFACTOR)
2025-07-08T18:48:21.2310845Z    • All 67 tests passing ✅
2025-07-08T18:48:21.2391158Z ✅ mvp_site/tests/test_red_green_demonstration.py passed
2025-07-08T18:48:21.2392559Z ----------------------------------------
2025-07-08T18:48:21.2393110Z Running mvp_site/tests/test_red_green_json_fix.py...
2025-07-08T18:48:21.2807260Z test_green_state_comprehensive_fix (__main__.TestRedGreenJSONFix.test_green_state_comprehensive_fix)
2025-07-08T18:48:21.2818218Z GREEN TEST: Demonstrates the complete fix working ... ok
2025-07-08T18:48:21.2819774Z test_red_state_escaped_characters (__main__.TestRedGreenJSONFix.test_red_state_escaped_characters)
2025-07-08T18:48:21.2821084Z RED TEST: JSON with escaped characters like \n and \" ... ok
2025-07-08T18:48:21.2822469Z test_red_state_markdown_wrapped_json (__main__.TestRedGreenJSONFix.test_red_state_markdown_wrapped_json)
2025-07-08T18:48:21.2823845Z ============================================================
2025-07-08T18:48:21.2824373Z RED/GREEN TESTING: JSON Display Bug Fix
2025-07-08T18:48:21.2824779Z ============================================================
2025-07-08T18:48:21.2825064Z 
2025-07-08T18:48:21.2825271Z This demonstrates how the bug manifested (red state)
2025-07-08T18:48:21.2826020Z and how the fix resolves it (green state).
2025-07-08T18:48:21.2826310Z 
2025-07-08T18:48:21.2826324Z 
2025-07-08T18:48:21.2826471Z === GREEN STATE TEST: Complete Fix ===
2025-07-08T18:48:21.2827170Z   ✓ Plain JSON: Clean narrative extracted
2025-07-08T18:48:21.2827691Z   ✓ Markdown-wrapped: Clean narrative extracted
2025-07-08T18:48:21.2828197Z   ✓ Partial JSON: Clean narrative extracted
2025-07-08T18:48:21.2828687Z   ✓ Escaped chars: Clean narrative extracted
2025-07-08T18:48:21.2829158Z   ✓ Malformed: Clean narrative extracted
2025-07-08T18:48:21.2829676Z   ✓ Invalid field: Clean narrative extracted
2025-07-08T18:48:21.2829965Z 
2025-07-08T18:48:21.2830264Z ✓ GREEN: All test cases pass - users never see JSON!
2025-07-08T18:48:21.2830619Z 
2025-07-08T18:48:21.2830791Z === RED STATE TEST: Escaped Characters ===
2025-07-08T18:48:21.2831370Z Returned narrative: 'She said "Hello!"\nNew line here\nAnother line'...
2025-07-08T18:48:21.2832092Z ✓ GREEN: Escape sequences properly converted
2025-07-08T18:48:21.2832792Z 
2025-07-08T18:48:21.2832998Z === RED STATE TEST: Markdown-wrapped JSON ===
2025-07-08T18:48:21.2833706Z Returned narrative: [Mode: DM MODE] Understanding confirmed. Processing user request....
2025-07-08T18:48:21.2834543Z ✓ GREEN: Markdown unwrapped, JSON parsed correctly
2025-07-08T18:48:21.2834896Z 
2025-07-08T18:48:21.2835049Z === RED STATE TEST: Partial JSON ===
2025-07-08T18:48:21.2835504Z Returned narrative: The story continues...
2025-07-08T18:48:21.2842696Z ✓ GREEN: Narrative extracted from partial JSON
2025-07-08T18:48:21.2843053Z 
2025-07-08T18:48:21.2843208Z === RED STATE TEST: Raw JSON Bug ===
2025-07-08T18:48:21.2844003Z Returned narrative: Scene #14: [Mode: DM MODE] The party continues their journey through the mystical forest....
2025-07-08T18:48:21.2845193Z ✓ GREEN: JSON properly parsed, narrative extracted
2025-07-08T18:48:21.2845559Z 
2025-07-08T18:48:21.2845898Z === SIMULATING RED STATE (Bug Behavior) ===
2025-07-08T18:48:21.2846228Z 
2025-07-08T18:48:21.2846389Z BUG OUTPUT (what users saw):
2025-07-08T18:48:21.2846756Z ```json
2025-07-08T18:48:21.2847019Z {
2025-07-08T18:48:21.2847511Z   "narrative": "[Mode: DM MODE] Understanding confirmed. Processing user request.",
2025-07-08T18:48:21.2848153Z   "entities_mentioned": ["Test Entity"],
2025-07-08T18:48:21.2848584Z   "location_confirmed": "Test Location",
2025-07-08T18:48:21.2849010Z   "state_updates": {}
2025-07-08T18:48:21.2849339Z }
2025-07-08T18:48:21.2849592Z ```
2025-07-08T18:48:21.2849755Z 
2025-07-08T18:48:21.2849762Z 
2025-07-08T18:48:21.2849912Z FIXED OUTPUT (what users see now):
2025-07-08T18:48:21.2850468Z [Mode: DM MODE] Understanding confirmed. Processing user request.
2025-07-08T18:48:21.2850900Z 
2025-07-08T18:48:21.2851177Z ✓ Bug fixed: Users only see narrative text!
2025-07-08T18:48:21.2851465Z 
2025-07-08T18:48:21.2851606Z ============================================================
2025-07-08T18:48:21.2852024Z SUMMARY:
2025-07-08T18:48:21.2852292Z Tests run: 6
2025-07-08T18:48:21.2852567Z Failures: 0
2025-07-08T18:48:21.2852818Z Errors: 0
2025-07-08T18:48:21.2852957Z 
2025-07-08T18:48:21.2853180Z ✅ All tests GREEN - JSON display bug is FIXED!
2025-07-08T18:48:21.2853658Z Users will never see raw JSON in their game interface.
2025-07-08T18:48:21.2854171Z ============================================================
2025-07-08T18:48:21.2854728Z RED TEST: AI returns JSON wrapped in markdown code blocks ... ok
2025-07-08T18:48:21.2855795Z test_red_state_partial_json_fallback (__main__.TestRedGreenJSONFix.test_red_state_partial_json_fallback)
2025-07-08T18:48:21.2856642Z RED TEST: Partial JSON that can't be parsed ... ok
2025-07-08T18:48:21.2857366Z test_red_state_raw_json_displayed (__main__.TestRedGreenJSONFix.test_red_state_raw_json_displayed)
2025-07-08T18:48:21.2858276Z RED TEST: Demonstrates the bug where raw JSON is shown to users ... ok
2025-07-08T18:48:21.2859043Z test_simulate_red_state (__main__.TestRedGreenJSONFix.test_simulate_red_state)
2025-07-08T18:48:21.2859761Z SIMULATION: What the bug looked like before the fix ... ok
2025-07-08T18:48:21.2860161Z 
2025-07-08T18:48:21.2860386Z ----------------------------------------------------------------------
2025-07-08T18:48:21.2860883Z Ran 6 tests in 0.002s
2025-07-08T18:48:21.2861091Z 
2025-07-08T18:48:21.2861205Z OK
2025-07-08T18:48:21.2902997Z ✅ mvp_site/tests/test_red_green_json_fix.py passed
2025-07-08T18:48:21.2904314Z ----------------------------------------
2025-07-08T18:48:21.2904834Z Running mvp_site/tests/test_refactoring_coverage.py...
2025-07-08T18:48:21.4878781Z .....sss..........
2025-07-08T18:48:21.4880220Z ----------------------------------------------------------------------
2025-07-08T18:48:21.4880702Z Ran 18 tests in 0.006s
2025-07-08T18:48:21.4880969Z 
2025-07-08T18:48:21.4881081Z OK (skipped=3)
2025-07-08T18:48:21.5137844Z ✅ mvp_site/tests/test_refactoring_coverage.py passed
2025-07-08T18:48:21.5139280Z ----------------------------------------
2025-07-08T18:48:21.5139802Z Running mvp_site/tests/test_robust_json_parser.py...
2025-07-08T18:48:21.5840674Z ....ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:21.5860184Z .................
2025-07-08T18:48:21.5861383Z ----------------------------------------------------------------------
2025-07-08T18:48:21.5862543Z Ran 21 tests in 0.005s
2025-07-08T18:48:21.5862769Z 
2025-07-08T18:48:21.5862884Z OK
2025-07-08T18:48:21.5972744Z ✅ mvp_site/tests/test_robust_json_parser.py passed
2025-07-08T18:48:21.5974028Z ----------------------------------------
2025-07-08T18:48:21.5974536Z Running mvp_site/tests/test_scene_numbering.py...
2025-07-08T18:48:21.8568476Z .
2025-07-08T18:48:21.8569009Z ----------------------------------------------------------------------
2025-07-08T18:48:21.8570406Z ✓ User scene numbers correctly increment only for AI responses
2025-07-08T18:48:21.8572372Z Ran 1 test in 0.000s
2025-07-08T18:48:21.8572835Z ✓ Sequence IDs increment for all entries
2025-07-08T18:48:21.8574949Z 
2025-07-08T18:48:21.8575068Z OK
2025-07-08T18:48:21.8575492Z ✓ This fixes the increment-by-2 display issue
2025-07-08T18:48:21.8970673Z ✅ mvp_site/tests/test_scene_numbering.py passed
2025-07-08T18:48:21.8972080Z ----------------------------------------
2025-07-08T18:48:21.8972626Z Running mvp_site/tests/test_scene_prefix_json_bug.py...
2025-07-08T18:48:21.9434319Z .....
2025-07-08T18:48:21.9436083Z ----------------------------------------------------------------------
2025-07-08T18:48:21.9436628Z Ran 5 tests in 0.001s
2025-07-08T18:48:21.9436835Z 
2025-07-08T18:48:21.9436948Z OK
2025-07-08T18:48:21.9510985Z ✅ mvp_site/tests/test_scene_prefix_json_bug.py passed
2025-07-08T18:48:21.9512305Z ----------------------------------------
2025-07-08T18:48:21.9512838Z Running mvp_site/tests/test_simple_json_bug_check.py...
2025-07-08T18:48:21.9962236Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestSimpleJsonBugCheck.test_character_creation_json_parsing of <__main__.TestSimpleJsonBugCheck testMethod=test_character_creation_json_parsing>>)
2025-07-08T18:48:21.9965540Z   return self.run(*args, **kwds)
2025-07-08T18:48:21.9969552Z ..
2025-07-08T18:48:21.9977349Z ----------------------------------------------------------------------
2025-07-08T18:48:21.9977922Z \n=== Testing Character Creation JSON Parsing ===
2025-07-08T18:48:21.9978369Z Input JSON length: 1062
2025-07-08T18:48:21.9978964Z ✅ Parsing succeeded!
2025-07-08T18:48:21.9979311Z Result text length: 456
2025-07-08T18:48:21.9979729Z Result preview: [CHARACTER CREATION - Step 1 of 7]
2025-07-08T18:48:21.9980080Z 
2025-07-08T18:48:21.9980391Z Welcome, adventurer! Before we begin your journey, we need to cr...
2025-07-08T18:48:21.9981017Z Contains JSON artifacts: False
2025-07-08T18:48:21.9981437Z \n=== Testing Malformed JSON Handling ===
2025-07-08T18:48:21.9981885Z Result: Some content here
2025-07-08T18:48:21.9982253Z Contains original JSON: False
2025-07-08T18:48:21.9982681Z Ran 2 tests in 0.001s
2025-07-08T18:48:21.9983987Z 
2025-07-08T18:48:21.9984219Z OK
2025-07-08T18:48:22.0050579Z ✅ mvp_site/tests/test_simple_json_bug_check.py passed
2025-07-08T18:48:22.0051853Z ----------------------------------------
2025-07-08T18:48:22.0052414Z Running mvp_site/tests/test_state_updates_json_parsing.py...
2025-07-08T18:48:22.0725094Z .....
2025-07-08T18:48:22.0725591Z ----------------------------------------------------------------------
2025-07-08T18:48:22.0726286Z Ran 5 tests in 0.000s
2025-07-08T18:48:22.0726516Z 
2025-07-08T18:48:22.0727005Z OK
2025-07-08T18:48:22.0840045Z ✅ mvp_site/tests/test_state_updates_json_parsing.py passed
2025-07-08T18:48:22.0841516Z ----------------------------------------
2025-07-08T18:48:22.0842049Z Running mvp_site/tests/test_structured_generation.py...
2025-07-08T18:48:22.2630642Z test_entity_tracking_instruction (__main__.TestStructuredGeneration.test_entity_tracking_instruction)
2025-07-08T18:48:22.2633813Z Test EntityTrackingInstruction creation ... ok
2025-07-08T18:48:22.2635203Z test_integration_with_entity_tracking (__main__.TestStructuredGeneration.test_integration_with_entity_tracking)
2025-07-08T18:48:22.2639841Z Test integration with existing entity tracking system ... ok
2025-07-08T18:48:22.2640789Z test_narrative_response_schema (__main__.TestStructuredGeneration.test_narrative_response_schema)
2025-07-08T18:48:22.2641631Z Test NarrativeResponse model ... ok
2025-07-08T18:48:22.2642559Z test_parse_structured_response_fallback (__main__.TestStructuredGeneration.test_parse_structured_response_fallback)
2025-07-08T18:48:22.2651575Z Test fallback for invalid JSON ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T18:48:22.2656061Z ok
2025-07-08T18:48:22.2656881Z test_parse_structured_response_valid_json (__main__.TestStructuredGeneration.test_parse_structured_response_valid_json)
2025-07-08T18:48:22.2658090Z Test parsing valid JSON response ... ok
2025-07-08T18:48:22.2659086Z test_parse_structured_response_with_extra_text (__main__.TestStructuredGeneration.test_parse_structured_response_with_extra_text)
2025-07-08T18:48:22.2660021Z Test parsing JSON with extra text around it ... ok
2025-07-08T18:48:22.2660827Z test_structured_prompt_injection (__main__.TestStructuredGeneration.test_structured_prompt_injection)
2025-07-08T18:48:22.2661566Z Test prompt injection creation ... ok
2025-07-08T18:48:22.2662354Z test_validate_entity_coverage_missing (__main__.TestStructuredGeneration.test_validate_entity_coverage_missing)
2025-07-08T18:48:22.2663214Z Test entity coverage validation with missing entities ... ok
2025-07-08T18:48:22.2664076Z test_validate_entity_coverage_perfect (__main__.TestStructuredGeneration.test_validate_entity_coverage_perfect)
2025-07-08T18:48:22.2669799Z Test entity coverage validation with perfect coverage ... ok
2025-07-08T18:48:22.2670213Z 
2025-07-08T18:48:22.2670404Z ----------------------------------------------------------------------
2025-07-08T18:48:22.2670862Z Ran 9 tests in 0.003s
2025-07-08T18:48:22.2671053Z 
2025-07-08T18:48:22.2671394Z 🧪 Testing Structured Generation Implementation
2025-07-08T18:48:22.2671821Z ============================================================
2025-07-08T18:48:22.2672498Z ✅ Integration test: Structured generation works with entity tracking
2025-07-08T18:48:22.2673212Z OK
2025-07-08T18:48:22.2906125Z ✅ mvp_site/tests/test_structured_generation.py passed
2025-07-08T18:48:22.2908271Z ----------------------------------------
2025-07-08T18:48:22.2908653Z Running mvp_site/tests/test_syntax.py...
2025-07-08T18:48:22.9025136Z ./home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9028784Z   @validator('strength', pre=True)
2025-07-08T18:48:22.9031990Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9035121Z   @validator('dexterity', pre=True)
2025-07-08T18:48:22.9038222Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9041350Z   @validator('constitution', pre=True)
2025-07-08T18:48:22.9044684Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9048049Z   @validator('intelligence', pre=True)
2025-07-08T18:48:22.9051069Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9054581Z   @validator('wisdom', pre=True)
2025-07-08T18:48:22.9061617Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9072232Z   @validator('charisma', pre=True)
2025-07-08T18:48:22.9074946Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9077964Z   @validator('hp', pre=True)
2025-07-08T18:48:22.9080548Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9083178Z   @validator('hp_max', pre=True)
2025-07-08T18:48:22.9085953Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9088604Z   @validator('temp_hp', pre=True)
2025-07-08T18:48:22.9109106Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9113456Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T18:48:22.9139673Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9150509Z   @validator('level', pre=True)
2025-07-08T18:48:22.9153493Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9156399Z   @validator('gender')
2025-07-08T18:48:22.9159019Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9161948Z   @validator('age')
2025-07-08T18:48:22.9164582Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9167469Z   @validator('mbti')
2025-07-08T18:48:22.9170079Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9172802Z   @validator('alignment')
2025-07-08T18:48:22.9175325Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9178192Z   @validator('entity_type')
2025-07-08T18:48:22.9339298Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9344204Z   @validator('participants')
2025-07-08T18:48:22.9356617Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9363643Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T18:48:22.9366889Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:22.9369630Z   @validator('present_entities')
2025-07-08T18:48:22.9489245Z .
2025-07-08T18:48:22.9489428Z 
2025-07-08T18:48:22.9489971Z --- Attempting to import gemini_service.py ---
2025-07-08T18:48:22.9490511Z Setting dummy GEMINI_API_KEY for import test...
2025-07-08T18:48:22.9491079Z SUCCESS: gemini_service.py was imported without a syntax error.
2025-07-08T18:48:22.9493605Z ----------------------------------------------------------------------
2025-07-08T18:48:22.9495846Z Ran 2 tests in 0.622s
2025-07-08T18:48:22.9496063Z 
2025-07-08T18:48:22.9496162Z OK
2025-07-08T18:48:23.0322025Z ✅ mvp_site/tests/test_syntax.py passed
2025-07-08T18:48:23.0325528Z ----------------------------------------
2025-07-08T18:48:23.0326221Z Running mvp_site/tests/test_syntax_comprehensive.py...
2025-07-08T18:48:23.1193908Z test_all_python_files_syntax (__main__.TestComprehensiveSyntax.test_all_python_files_syntax)
2025-07-08T18:48:23.1600400Z Test that all Python files in the project have valid syntax using AST parsing. ... ok
2025-07-08T18:48:23.1603584Z test_basic_game_state_instantiation (__main__.TestComprehensiveSyntax.test_basic_game_state_instantiation)
2025-07-08T18:48:23.1661899Z Test basic GameState instantiation without combat-specific features. ... ok
2025-07-08T18:48:23.1663529Z test_game_state_syntax_and_import (__main__.TestComprehensiveSyntax.test_game_state_syntax_and_import)
2025-07-08T18:48:23.1686465Z Specifically test game_state.py syntax and import. ... ok
2025-07-08T18:48:23.1687616Z test_main_module_syntax (__main__.TestComprehensiveSyntax.test_main_module_syntax)
2025-07-08T18:48:24.0363741Z Test that main.py has valid syntax and can load its dependencies. ... /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0367552Z   @validator('strength', pre=True)
2025-07-08T18:48:24.0370710Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0373828Z   @validator('dexterity', pre=True)
2025-07-08T18:48:24.0376979Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0380131Z   @validator('constitution', pre=True)
2025-07-08T18:48:24.0383156Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0386472Z   @validator('intelligence', pre=True)
2025-07-08T18:48:24.0389473Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0392439Z   @validator('wisdom', pre=True)
2025-07-08T18:48:24.0395963Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0399514Z   @validator('charisma', pre=True)
2025-07-08T18:48:24.0402526Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0406188Z   @validator('hp', pre=True)
2025-07-08T18:48:24.0409084Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0412026Z   @validator('hp_max', pre=True)
2025-07-08T18:48:24.0414917Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0418384Z   @validator('temp_hp', pre=True)
2025-07-08T18:48:24.0441943Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0444617Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T18:48:24.0473801Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0478107Z   @validator('level', pre=True)
2025-07-08T18:48:24.0480812Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0483547Z   @validator('gender')
2025-07-08T18:48:24.0486401Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0489116Z   @validator('age')
2025-07-08T18:48:24.0491957Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0494701Z   @validator('mbti')
2025-07-08T18:48:24.0497501Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0500466Z   @validator('alignment')
2025-07-08T18:48:24.0503138Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0509440Z   @validator('entity_type')
2025-07-08T18:48:24.0652926Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0657971Z   @validator('participants')
2025-07-08T18:48:24.0670347Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0679150Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T18:48:24.0682195Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T18:48:24.0684910Z   @validator('present_entities')
2025-07-08T18:48:24.0822408Z ok
2025-07-08T18:48:24.0822646Z 
2025-07-08T18:48:24.0822880Z ----------------------------------------------------------------------
2025-07-08T18:48:24.0823360Z Ran 4 tests in 0.962s
2025-07-08T18:48:24.0823562Z 
2025-07-08T18:48:24.0823663Z OK
2025-07-08T18:48:24.0823942Z === Comprehensive Syntax Testing ===
2025-07-08T18:48:24.0824405Z This test would have caught the f-string syntax error.
2025-07-08T18:48:24.0824730Z 
2025-07-08T18:48:24.0824896Z --- Quick syntax check for all Python files ---
2025-07-08T18:48:24.0825781Z ✓ test_firestore_database_errors.py: Syntax OK
2025-07-08T18:48:24.0826298Z ✓ gemini_service.py: Syntax OK
2025-07-08T18:48:24.0826741Z ✓ inspect_sdk.py: Syntax OK
2025-07-08T18:48:24.0827145Z ✓ debug_mode_parser.py: Syntax OK
2025-07-08T18:48:24.0827594Z ✓ robust_json_parser.py: Syntax OK
2025-07-08T18:48:24.0828049Z ✓ narrative_sync_validator.py: Syntax OK
2025-07-08T18:48:24.0828557Z ✓ test_gemini_error_handling.py: Syntax OK
2025-07-08T18:48:24.0829023Z ✓ main.py: Syntax OK
2025-07-08T18:48:24.0829383Z ✓ logging_util.py: Syntax OK
2025-07-08T18:48:24.0830158Z ✓ json_utils.py: Syntax OK
2025-07-08T18:48:24.0830572Z ✓ entity_preloader.py: Syntax OK
2025-07-08T18:48:24.0830992Z ✓ gemini_response.py: Syntax OK
2025-07-08T18:48:24.0831416Z ✓ firestore_service.py: Syntax OK
2025-07-08T18:48:24.0831840Z ✓ world_loader.py: Syntax OK
2025-07-08T18:48:24.0832247Z ✓ main_parallel_dual_pass.py: Syntax OK
2025-07-08T18:48:24.0832685Z ✓ token_utils.py: Syntax OK
2025-07-08T18:48:24.0833093Z ✓ narrative_response_schema.py: Syntax OK
2025-07-08T18:48:24.0833517Z ✓ game_state.py: Syntax OK
2025-07-08T18:48:24.0833897Z ✓ __init__.py: Syntax OK
2025-07-08T18:48:24.0834308Z ✓ test_gemini_token_management.py: Syntax OK
2025-07-08T18:48:24.0834792Z ✓ test_gemini_generation.py: Syntax OK
2025-07-08T18:48:24.0835471Z ✓ dual_pass_generator.py: Syntax OK
2025-07-08T18:48:24.0836082Z ✓ entity_validator.py: Syntax OK
2025-07-08T18:48:24.0836558Z ✓ test_documentation_performance.py: Syntax OK
2025-07-08T18:48:24.0837077Z ✓ debug_json_response.py: Syntax OK
2025-07-08T18:48:24.0837592Z ✓ test_gemini_response_validation.py: Syntax OK
2025-07-08T18:48:24.0838092Z ✓ debug_hybrid_system.py: Syntax OK
2025-07-08T18:48:24.0838516Z ✓ decorators.py: Syntax OK
2025-07-08T18:48:24.0838900Z ✓ llm_response.py: Syntax OK
2025-07-08T18:48:24.0839289Z ✓ constants.py: Syntax OK
2025-07-08T18:48:24.0839688Z ✓ numeric_field_converter.py: Syntax OK
2025-07-08T18:48:24.0840142Z ✓ document_generator.py: Syntax OK
2025-07-08T18:48:24.0840568Z ✓ entity_instructions.py: Syntax OK
2025-07-08T18:48:24.0840980Z ✓ entity_tracking.py: Syntax OK
2025-07-08T18:48:24.0841208Z 
2025-07-08T18:48:24.0841367Z --- Running comprehensive test suite ---
2025-07-08T18:48:24.2528869Z ✅ mvp_site/tests/test_syntax_comprehensive.py passed
2025-07-08T18:48:24.2530488Z ----------------------------------------
2025-07-08T18:48:24.2531010Z Running mvp_site/tests/test_think_block_protocol.py...
2025-07-08T18:48:24.3168087Z test_error_response_format_defined (__main__.TestThinkBlockProtocol.test_error_response_format_defined)
2025-07-08T18:48:24.3175258Z Test that error response format is specified ... ok
2025-07-08T18:48:24.3178370Z test_forbidden_actions_defined (__main__.TestThinkBlockProtocol.test_forbidden_actions_defined)
2025-07-08T18:48:24.3211983Z Test that forbidden actions are clearly defined ... ok
2025-07-08T18:48:24.3213197Z test_invalid_input_definitions (__main__.TestThinkBlockProtocol.test_invalid_input_definitions)
2025-07-08T18:48:24.3219259Z Test that invalid post-think-block inputs are defined ... ok
2025-07-08T18:48:24.3220703Z test_protocol_overrides_other_instructions (__main__.TestThinkBlockProtocol.test_protocol_overrides_other_instructions)
2025-07-08T18:48:24.3223741Z Test that protocol explicitly states it overrides other instructions ... ok
2025-07-08T18:48:24.3225835Z test_protocol_priority_placement (__main__.TestThinkBlockProtocol.test_protocol_priority_placement)
2025-07-08T18:48:24.3231781Z Test that think block protocol is at the beginning of the file ... FAIL
2025-07-08T18:48:24.3233171Z test_state_validation_checkpoints (__main__.TestThinkBlockProtocol.test_state_validation_checkpoints)
2025-07-08T18:48:24.3240400Z Test that state validation checkpoints are defined ... ok
2025-07-08T18:48:24.3241777Z test_think_block_protocol_exists_in_prompt (__main__.TestThinkBlockProtocol.test_think_block_protocol_exists_in_prompt)
2025-07-08T18:48:24.3254070Z Test that think block protocol is present in the prompt file ... ok
2025-07-08T18:48:24.3255283Z test_think_keywords_detection (__main__.TestThinkBlockProtocol.test_think_keywords_detection)
2025-07-08T18:48:24.3272825Z Test that all think block keywords are properly defined ... ok
2025-07-08T18:48:24.3274098Z test_valid_input_definitions (__main__.TestThinkBlockProtocol.test_valid_input_definitions)
2025-07-08T18:48:24.3283994Z Test that valid post-think-block inputs are defined ... ok
2025-07-08T18:48:24.3285215Z test_complex_planning_scenario (__main__.TestThinkBlockScenarios.test_complex_planning_scenario)
2025-07-08T18:48:24.3296113Z Test complex planning scenario ... ok
2025-07-08T18:48:24.3297343Z test_invalid_continuation_scenario (__main__.TestThinkBlockScenarios.test_invalid_continuation_scenario)
2025-07-08T18:48:24.3298300Z Test invalid continuation after think block ... ok
2025-07-08T18:48:24.3299080Z test_simple_think_scenario (__main__.TestThinkBlockScenarios.test_simple_think_scenario)
2025-07-08T18:48:24.3299803Z Test simple think command scenario ... ok
2025-07-08T18:48:24.3300542Z test_valid_selection_scenario (__main__.TestThinkBlockScenarios.test_valid_selection_scenario)
2025-07-08T18:48:24.3301557Z Test valid option selection after think block ... ok
2025-07-08T18:48:24.3302371Z test_backup_file_exists (__main__.TestPromptFileIntegrity.test_backup_file_exists)
2025-07-08T18:48:24.3303906Z Test that backup file was created ... skipped 'Backup file is optional'
2025-07-08T18:48:24.3306382Z test_essential_protocols_preserved (__main__.TestPromptFileIntegrity.test_essential_protocols_preserved)
2025-07-08T18:48:24.3315411Z Test that essential game protocols are preserved ... ok
2025-07-08T18:48:24.3318163Z test_prompt_file_exists (__main__.TestPromptFileIntegrity.test_prompt_file_exists)
2025-07-08T18:48:24.3318863Z Test that the prompt file exists ... ok
2025-07-08T18:48:24.3319563Z test_prompt_file_readable (__main__.TestPromptFileIntegrity.test_prompt_file_readable)
2025-07-08T18:48:24.3320289Z Test that the prompt file is readable ... ok
2025-07-08T18:48:24.3321072Z test_state_transition_rules (__main__.TestThinkBlockStateManagement.test_state_transition_rules)
2025-07-08T18:48:24.3337936Z Test that state transition rules are clearly defined ... ok
2025-07-08T18:48:24.3340465Z test_waiting_state_definition (__main__.TestThinkBlockStateManagement.test_waiting_state_definition)
2025-07-08T18:48:24.3343602Z Test that planning block state is defined ... ok
2025-07-08T18:48:24.3344399Z 
2025-07-08T18:48:24.3344724Z ======================================================================
2025-07-08T18:48:24.3345199Z Running Think Block Protocol Tests...
2025-07-08T18:48:24.3345970Z ==================================================
2025-07-08T18:48:24.3346395Z 
2025-07-08T18:48:24.3347375Z ❌ Some think block tests failed!
2025-07-08T18:48:24.3348329Z FAIL: test_protocol_priority_placement (__main__.TestThinkBlockProtocol.test_protocol_priority_placement)
2025-07-08T18:48:24.3349416Z Test that think block protocol is at the beginning of the file
2025-07-08T18:48:24.3350229Z ----------------------------------------------------------------------
2025-07-08T18:48:24.3351078Z Traceback (most recent call last):
2025-07-08T18:48:24.3352362Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/tests/test_think_block_protocol.py", line 206, in test_protocol_priority_placement
2025-07-08T18:48:24.3353531Z     self.assertTrue(
2025-07-08T18:48:24.3354811Z AssertionError: False is not true : Think Block Protocol should appear near the beginning of the file for priority
2025-07-08T18:48:24.3355859Z 
2025-07-08T18:48:24.3356214Z ----------------------------------------------------------------------
2025-07-08T18:48:24.3356863Z Ran 19 tests in 0.018s
2025-07-08T18:48:24.3357199Z 
2025-07-08T18:48:24.3357470Z FAILED (failures=1, skipped=1)
2025-07-08T18:48:24.3471094Z ❌ mvp_site/tests/test_think_block_protocol.py failed
2025-07-08T18:48:24.3472668Z ----------------------------------------
2025-07-08T18:48:24.3473199Z Running mvp_site/tests/test_time_consolidation.py...
2025-07-08T18:48:24.3919358Z .........
2025-07-08T18:48:24.3920844Z ----------------------------------------------------------------------
2025-07-08T18:48:24.3921367Z Ran 9 tests in 0.001s
2025-07-08T18:48:24.3921584Z 
2025-07-08T18:48:24.3921694Z OK
2025-07-08T18:48:24.3992537Z ✅ mvp_site/tests/test_time_consolidation.py passed
2025-07-08T18:48:24.3993910Z ----------------------------------------
2025-07-08T18:48:24.3994411Z Running mvp_site/tests/test_time_pressure.py...
2025-07-08T18:48:25.0427716Z 2025-07-08 18:48:25,042 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0430781Z .2025-07-08 18:48:25,042 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0433449Z .2025-07-08 18:48:25,043 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0436255Z .2025-07-08 18:48:25,043 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0439119Z .2025-07-08 18:48:25,043 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0441664Z .2025-07-08 18:48:25,044 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0444254Z .2025-07-08 18:48:25,044 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T18:48:25.0445366Z .
2025-07-08T18:48:25.0446111Z ----------------------------------------------------------------------
2025-07-08T18:48:25.0447098Z Ran 7 tests in 0.002s
2025-07-08T18:48:25.0447348Z 
2025-07-08T18:48:25.0448562Z OK
2025-07-08T18:48:25.1409500Z ✅ mvp_site/tests/test_time_pressure.py passed
2025-07-08T18:48:25.1411093Z ----------------------------------------
2025-07-08T18:48:25.1411599Z Running mvp_site/tests/test_token_utils.py...
2025-07-08T18:48:25.2103721Z ...........
2025-07-08T18:48:25.2105205Z ----------------------------------------------------------------------
2025-07-08T18:48:25.2105997Z Ran 11 tests in 0.003s
2025-07-08T18:48:25.2106213Z 
2025-07-08T18:48:25.2106326Z OK
2025-07-08T18:48:25.2213390Z ✅ mvp_site/tests/test_token_utils.py passed
2025-07-08T18:48:25.2214671Z ----------------------------------------
2025-07-08T18:48:25.2215230Z Running mvp_site/tests/test_user_scenario_fix_validation.py...
2025-07-08T18:48:25.2676530Z ....
2025-07-08T18:48:25.2677391Z ----------------------------------------------------------------------
2025-07-08T18:48:25.2678683Z Ran 4 tests in 0.001s
2025-07-08T18:48:25.2678903Z 
2025-07-08T18:48:25.2679009Z OK
2025-07-08T18:48:25.2747829Z ✅ mvp_site/tests/test_user_scenario_fix_validation.py passed
2025-07-08T18:48:25.2749206Z ----------------------------------------
2025-07-08T18:48:25.2749782Z Running mvp_site/tests/test_validation_comparison.py...
2025-07-08T18:48:25.4523645Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T18:48:25.4526113Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T18:48:25.4573262Z ...
2025-07-08T18:48:25.4574822Z ----------------------------------------------------------------------
2025-07-08T18:48:25.4575312Z Ran 4 tests in 0.006s
2025-07-08T18:48:25.4575504Z 
2025-07-08T18:48:25.4575609Z OK
2025-07-08T18:48:25.4576098Z Pydantic: Handled invalid data gracefully
2025-07-08T18:48:25.4577401Z Pydantic validation: 100 iterations in 0.005s (21147 ops/sec)
2025-07-08T18:48:25.4836305Z ✅ mvp_site/tests/test_validation_comparison.py passed
2025-07-08T18:48:25.4837820Z ----------------------------------------
2025-07-08T18:48:25.4838331Z Running mvp_site/tests/test_world_loader.py...
2025-07-08T18:48:25.5471042Z test_development_scenario_parent_world (__main__.TestWorldLoader.test_development_scenario_parent_world)
2025-07-08T18:48:25.5486468Z Test loading from ../world in development environment. ... ok
2025-07-08T18:48:25.5488482Z test_missing_world_files_error_handling (__main__.TestWorldLoader.test_missing_world_files_error_handling)
2025-07-08T18:48:25.5499871Z Test error handling when world files are missing. ... ok
2025-07-08T18:48:25.5501612Z test_path_construction_logic (__main__.TestWorldLoader.test_path_construction_logic)
2025-07-08T18:48:25.5506117Z Test the path construction logic for both scenarios. ... ok
2025-07-08T18:48:25.5507948Z test_production_scenario_local_world (__main__.TestWorldLoader.test_production_scenario_local_world)
2025-07-08T18:48:25.5521621Z Test loading from world/ in production environment. ... ok
2025-07-08T18:48:25.5522885Z 
2025-07-08T18:48:25.5523117Z ----------------------------------------------------------------------
2025-07-08T18:48:25.5523591Z Ran 4 tests in 0.005s
2025-07-08T18:48:25.5523798Z 
2025-07-08T18:48:25.5523901Z OK
2025-07-08T18:48:25.5634075Z ✅ mvp_site/tests/test_world_loader.py passed
2025-07-08T18:48:25.5635133Z ----------------------------------------
2025-07-08T18:48:25.5646993Z Running mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py...
2025-07-08T18:48:29.0067093Z test_campaign_wizard_reset_issue_reproduction (__main__.CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction)
2025-07-08T18:48:43.5835079Z Reproduce the complete user workflow that leads to persistent spinner ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction of <__main__.CampaignWizardResetReproductionTest testMethod=test_campaign_wizard_reset_issue_reproduction>>)
2025-07-08T18:48:43.5839707Z   return self.run(*args, **kwds)
2025-07-08T18:48:43.5840581Z ok
2025-07-08T18:48:44.1376023Z 
2025-07-08T18:48:44.1376048Z 
2025-07-08T18:48:44.1379861Z 🧪 REPRODUCING CAMPAIGN WIZARD RESET ISSUE
2025-07-08T18:48:44.1380652Z 📱 Step 1: Loading application...
2025-07-08T18:48:44.1381295Z 🎮 Step 2: Simulating first campaign creation...
2025-07-08T18:48:44.1381957Z 🚀 Step 3: Clicking 'Begin Adventure' to create first campaign...
2025-07-08T18:48:44.1383630Z ----------------------------------------------------------------------
2025-07-08T18:48:44.1384099Z Ran 1 test in 18.379s
2025-07-08T18:48:44.1384296Z 
2025-07-08T18:48:44.1384401Z OK
2025-07-08T18:48:44.1385387Z ⏳ Step 4: Waiting for spinner to appear...
2025-07-08T18:48:44.1387386Z    Spinner visible: True
2025-07-08T18:48:44.1389240Z 📊 Step 5: Waiting for campaign creation to complete...
2025-07-08T18:48:44.1391126Z    Dashboard visible: True
2025-07-08T18:48:44.1393096Z 🎯 Step 6: Clicking 'Start Campaign' again (reproducing the bug)...
2025-07-08T18:48:44.1395317Z 🔍 Step 7: Checking what appears - fresh wizard or persistent spinner...
2025-07-08T18:48:44.1397296Z    ✅ Fresh wizard content present: True
2025-07-08T18:48:44.1398634Z    ✅ No persistent spinner found
2025-07-08T18:48:44.1400018Z 🔬 Step 8: Analyzing DOM state for debugging...
2025-07-08T18:48:44.1400467Z    Campaign wizard container contents:
2025-07-08T18:48:44.1400819Z    
2025-07-08T18:48:44.1401099Z                             <div class="wizard-content">
2025-07-08T18:48:44.1401520Z                                 <h3>Campaign Creation Wizard</h3>
2025-07-08T18:48:44.1402292Z                                 <div class="wizard-step">Step 1: Basic Detai...
2025-07-08T18:48:44.1402801Z 📋 Step 9: Test Results Summary
2025-07-08T18:48:44.1403143Z ==================================================
2025-07-08T18:48:44.1403740Z ✅ EXPECTED BEHAVIOR: Fresh wizard appears, no persistent spinner
2025-07-08T18:48:44.1404237Z Test Result: PASS
2025-07-08T18:48:44.1404537Z ==================================================
2025-07-08T18:48:44.1483339Z sys:1: ResourceWarning: unclosed <socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8766)>
2025-07-08T18:48:44.1627226Z ✅ mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py passed
2025-07-08T18:48:44.1630430Z ----------------------------------------
2025-07-08T18:48:44.1630709Z 
2025-07-08T18:48:44.1630846Z ========================================
2025-07-08T18:48:44.1631266Z TEST SUMMARY: 118/120 tests passed
2025-07-08T18:48:44.1631668Z ========================================
2025-07-08T18:48:44.1631937Z 
2025-07-08T18:48:44.1632418Z Failed tests:\n  - mvp_site/tests/test_debug_hybrid_system.py\n  - mvp_site/tests/test_think_block_protocol.py
2025-07-08T18:48:44.1632805Z 
2025-07-08T18:48:44.1632910Z Note: Some tests may fail in CI due to:
2025-07-08T18:48:44.1633204Z   - Missing local services (e.g., test server)
2025-07-08T18:48:44.1633488Z   - Test isolation issues
2025-07-08T18:48:44.1633717Z   - Timing-sensitive tests
2025-07-08T18:48:44.1644794Z ##[error]Process completed with exit code 1.
2025-07-08T18:48:44.1723908Z ##[group]Run actions/upload-artifact@v4
2025-07-08T18:48:44.1724193Z with:
2025-07-08T18:48:44.1724376Z   name: test-results
2025-07-08T18:48:44.1724681Z   path: mvp_site/test-results/
mvp_site/coverage.xml
mvp_site/*.log

2025-07-08T18:48:44.1725015Z   retention-days: 30
2025-07-08T18:48:44.1725212Z   if-no-files-found: warn
2025-07-08T18:48:44.1725425Z   compression-level: 6
2025-07-08T18:48:44.1725625Z   overwrite: false
2025-07-08T18:48:44.1726074Z   include-hidden-files: false
2025-07-08T18:48:44.1726287Z env:
2025-07-08T18:48:44.1726523Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:48:44.1726932Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T18:48:44.1727318Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:48:44.1727845Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:48:44.1728198Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T18:48:44.1728571Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T18:48:44.1728877Z ##[endgroup]
2025-07-08T18:48:44.4153159Z ##[warning]No files were found with the provided path: mvp_site/test-results/
mvp_site/coverage.xml
mvp_site/*.log. No artifacts will be uploaded.
2025-07-08T18:48:44.4299683Z Post job cleanup.
2025-07-08T18:48:44.5259140Z [command]/usr/bin/git version
2025-07-08T18:48:44.5299740Z git version 2.49.0
2025-07-08T18:48:44.5355332Z Temporarily overriding HOME='/home/runner/work/_temp/a48e911b-f6ab-45e2-bf4b-a21113aa4b4d' before making global git config changes
2025-07-08T18:48:44.5357456Z Adding repository directory to the temporary git global config as a safe directory
2025-07-08T18:48:44.5361761Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T18:48:44.5400263Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-07-08T18:48:44.5437255Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-07-08T18:48:44.5679530Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-07-08T18:48:44.5704459Z http.https://github.com/.extraheader
2025-07-08T18:48:44.5718358Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2025-07-08T18:48:44.5753467Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-07-08T18:48:44.6094699Z Cleaning up orphan processes
