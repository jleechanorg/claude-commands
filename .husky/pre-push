#!/bin/sh
# Husky pre-push hook for WorldArchitect.AI
# Runs comprehensive checks before pushing to remote

echo "ğŸš€ Running pre-push checks..."
echo ""

# Exit on first error
set -e

# 1. Python: Type checking with mypy (optional - can be slow)
echo "ğŸ” Running mypy type checking..."
if command -v mypy >/dev/null 2>&1; then
    mypy mvp_site --config-file pyproject.toml || true
    echo "âœ… Type checking completed (warnings allowed)"
else
    echo "âš ï¸  Warning: mypy not found, skipping type checking"
fi
echo ""

# 2. Security: Bandit security scanning
echo "ğŸ”’ Running security scan..."
if command -v bandit >/dev/null 2>&1; then
    bandit -r mvp_site -c pyproject.toml -ll || true
    echo "âœ… Security scan completed (warnings allowed)"
else
    echo "âš ï¸  Warning: bandit not found, skipping security scan"
fi
echo ""

# 3. Run unit tests (intelligent mode for speed)
echo "ğŸ§ª Running unit tests..."
if [ -f "run_tests.sh" ]; then
    ./run_tests.sh --unit
    echo "âœ… Unit tests passed"
else
    echo "âš ï¸  Warning: run_tests.sh not found, skipping tests"
fi
echo ""

echo "âœ… All pre-push checks passed!"
echo ""
echo "ğŸ’¡ Tip: Use 'git push --no-verify' to skip these checks if needed"
