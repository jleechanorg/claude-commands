{"id":"BD-6on","content_hash":"9bac54d641549a53e9892cfb33d802d376a6bd8e85498afa6431c3716ea76c29","title":"Create compressible entity summaries at multiple detail levels","description":"Generate entity summaries at 3 compression levels during campaign creation:\n- Full: Complete backstory, relationships, speech patterns (500 tokens)\n- Medium: Key traits, current goal, player relationship (200 tokens)\n- Minimal: Name, role, one-liner (50 tokens)\n\nSelect level based on available token budget and entity importance score.\n\nRequires changes to entity data model and entity_preloader.py.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-07T23:13:16.396242-05:00","updated_at":"2025-12-07T23:13:16.396242-05:00","source_repo":".","labels":["architecture","context-budget","entity-tracking"],"dependencies":[{"issue_id":"BD-6on","depends_on_id":"BD-a76","type":"blocks","created_at":"2025-12-07T23:13:27.51776-05:00","created_by":"daemon"}]}
{"id":"BD-78a","content_hash":"baf96f41f2c49d813ad8a79c2075eeb3cbcbccefb6663ba47c2dbd94abd72bb1","title":"Test auth bypass (X-Test-Bypass-Auth) removed breaks CI","description":"Removed X-Test-Bypass-Auth in mvp_site/main.py Lines 334-335, 331-382 breaks test suite. CI/CD cannot run tests.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-23T13:26:08.902485-08:00","updated_at":"2025-11-23T13:26:08.902485-08:00","source_repo":".","labels":["P0","blocks-testing","pr-2082"]}
{"id":"BD-7wz","content_hash":"c0a2938106955b30fe68330be98491f7ce016719426aefad29da8689011b8476","title":"Rate limiter IP spoofing vulnerability - uses load balancer IP","description":"mvp_site/main.py Lines 235-236, 246-253 uses load balancer IP instead of client IP. All users share one rate limit bucket causing global DoS. Fix: Use X-Forwarded-For with ProxyFix.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-23T13:26:10.035154-08:00","updated_at":"2025-11-23T13:26:10.035154-08:00","source_repo":".","labels":["P0","pr-2082","security"]}
{"id":"BD-8k9","content_hash":"d20e526e3efa12f718099764f2e45f99ce5d2f80cf82b9809dbed62f342838ad","title":"Flask-Limiter dependency missing from requirements.txt","description":"flask_limiter imported in mvp_site/main.py Line 79 but not in requirements.txt. Deployment will fail with ImportError.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-23T13:26:07.763756-08:00","updated_at":"2025-11-23T13:26:07.763756-08:00","source_repo":".","labels":["P0","blocks-deployment","pr-2082"]}
{"id":"BD-9u7","content_hash":"5508dafc82c7c56a7979913a00114e5ed2aa1af4f2ac15d58b8bead3a3e90f3e","title":"Multiple validation error types support (V2 feature)","description":"mvp_site/validation_recovery.py Lines 105-126 only extracts ONE HP error type. Current design intentional - handles one error type per response. Future enhancement to support multiple different error types.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-23T13:26:16.459718-08:00","updated_at":"2025-11-23T15:59:09.608643-08:00","closed_at":"2025-11-23T15:59:09.608643-08:00","source_repo":".","labels":["P3","future","pr-2082"]}
{"id":"BD-a2c","content_hash":"3451003ea63ad76ddb532cbc634539f8e605e6ceb8a91e1c808b4880f84de566","title":"S1 outage \u0026 PR #2327 merge readiness","description":"Track S1 preview 404 outage and merge readiness for PR #2327. Steps: restore S1 availability, rerun mature campaign VqqJLpABua9bvAG4ArTg with the fix; capture narrative and token logs; if S1 stays down, document local proof and risk for merge decision.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:26:44.363042-05:00","updated_at":"2025-12-08T23:29:58.912143-05:00","closed_at":"2025-12-08T23:29:58.912143-05:00","source_repo":".","labels":["context-budget","infra","release"]}
{"id":"BD-a76","content_hash":"b6c0549e62f6933378c8ed72e8b7b15c34f0b3562c9f9233acefe39acd7ddae9","title":"Add entity_tracking token measurement logging","description":"Add logging to measure actual entity_tracking_data token count before API call. This is needed to validate the hypothesis that entity_tracking exceeds its 10,500 token reserve.\n\nAdd after line 3342 in llm_service.py:\n```python\nentity_tracking_tokens = estimate_tokens(json.dumps(entity_tracking_data))\nlogging_util.info(f\"ENTITY_TRACKING_SIZE: {entity_tracking_tokens}tk (reserve: {ENTITY_TRACKING_TOKEN_RESERVE}tk)\")\n```\n\nThis is a prerequisite for all other entity truncation work.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T23:13:15.268259-05:00","updated_at":"2025-12-08T23:41:10.171336-05:00","closed_at":"2025-12-08T23:41:10.171336-05:00","source_repo":".","labels":["context-budget","logging","quick-win"]}
{"id":"BD-clg","content_hash":"8f11bba58ed7cebfad3c19366e4560e9b9b6b81363f326a6993921686e77e418","title":"Remove dead full_prompt code in continue_story","description":"The `full_prompt` variable built at lines 3319-3327 in llm_service.py is never used. The actual API call uses LLMRequest instead.\n\nThis dead code:\n1. Wastes CPU cycles building unused string\n2. Confuses maintainers about what's actually sent\n3. Includes timeline_log which caused the wrong hypothesis\n\nDelete lines 3319-3327 and any related dead code.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-07T23:13:17.262877-05:00","updated_at":"2025-12-08T23:41:09.682402-05:00","closed_at":"2025-12-08T23:41:09.682402-05:00","source_repo":".","labels":["cleanup","tech-debt"]}
{"id":"BD-fsr","content_hash":"3c154fe130436fac592f4fdfdec756cfab36e716bb6f7c10afb72985eb397c4e","title":"Add response_json_schema to Gemini provider for structured output enforcement","description":"Gemini provider currently only uses response_mime_type: \"application/json\" which guarantees valid JSON syntax but does NOT enforce schema structure. Add response_json_schema parameter to enforce NarrativeResponse schema like we did for Cerebras in PR #2377.","design":"File: mvp_site/llm_providers/gemini_provider.py\n\nCurrent (line 62-67):\n```python\ngeneration_config_params = {\n    \"max_output_tokens\": json_mode_max_output_tokens,\n    \"temperature\": temperature,\n    \"safety_settings\": safety_settings,\n    \"response_mime_type\": \"application/json\",\n}\n```\n\nTarget:\n```python\ngeneration_config_params = {\n    \"max_output_tokens\": json_mode_max_output_tokens,\n    \"temperature\": temperature,\n    \"safety_settings\": safety_settings,\n    \"response_mime_type\": \"application/json\",\n    \"response_json_schema\": NARRATIVE_RESPONSE_SCHEMA,  # Add schema\n}\n```\n\nReference: https://ai.google.dev/gemini-api/docs/structured-output","acceptance_criteria":"- [ ] Add NARRATIVE_RESPONSE_SCHEMA constant matching Cerebras schema\n- [ ] Add response_json_schema to generation_config_params\n- [ ] Write TDD tests for schema enforcement\n- [ ] Verify Gemini still works with schema (no API errors)\n- [ ] Monitor for reduced planning_block failures","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-10T01:51:33.747212-05:00","updated_at":"2025-12-10T02:11:39.468712-05:00","closed_at":"2025-12-10T02:11:39.468712-05:00","source_repo":".","labels":["gemini","json-schema","llm-provider"]}
{"id":"BD-ii5","content_hash":"d09f07593d6ce1be78b3e0c1d40a39c189ce2e94891d953096e06ad9a1f7120a","title":"Update RCA/docs to reflect story_history metadata as root cause","description":"Revise investigation docs (context_overflow* and timeline_log_claims) to correct the root cause: story_history metadata bloat, not entity tracking or timeline_log. Remove/replace the 4x entity reserve claim, summarize real measurements (story_history ~70K -\u003e ~26K; entity_tracking ~47), and note current mitigation (ESSENTIAL_STORY_FIELDS stripping, npc_data excluded).","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-08T23:27:51.916027-05:00","updated_at":"2025-12-08T23:35:14.564125-05:00","closed_at":"2025-12-08T23:35:14.564125-05:00","source_repo":".","labels":["context-budget","docs","rca"]}
{"id":"BD-jqy","content_hash":"4390a39d73be649752981a54c255c2b984c9dd9c64ea7ab3c7a5865982b40372","title":"Add XSS security warning to god mode documentation","description":"Example code in docs/god_mode_validation_recovery.md Lines 58-74 and docs/god_mode_implementation_complete.md Lines 173-189 uses innerHTML without sanitization. Add disclaimer about using textContent/DOMPurify in production.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-23T13:26:13.782779-08:00","updated_at":"2025-11-23T13:26:13.782779-08:00","source_repo":".","labels":["P2","documentation","pr-2082"]}
{"id":"BD-kln","content_hash":"7cacc22ef1a542d5de977ba93a0feaefddcbfad496af84ef58919d0320f62a87","title":"Inline re import violation in validation_recovery.py","description":"import re inside method at mvp_site/validation_recovery.py Line 69-70 violates CLAUDE.md standards. Must move to module level.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-23T13:26:11.388033-08:00","updated_at":"2025-11-23T15:59:06.173342-08:00","closed_at":"2025-11-23T15:59:06.173342-08:00","source_repo":".","labels":["P1","pr-2082","standards"]}
{"id":"BD-ms2","content_hash":"927bccbd07c23cb84f7488357dfd9b07e18a81fd0fbb22a94f2d8fd782861f6e","title":"Document rate limiter memory storage limitation","description":"memory:// storage at mvp_site/main.py Lines 235-236 not suitable for multi-worker production. Add comment explaining dev-only limitation.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-23T13:26:15.043282-08:00","updated_at":"2025-11-23T13:26:15.043282-08:00","source_repo":".","labels":["P2","documentation","pr-2082"]}
{"id":"BD-od8","content_hash":"ca19735c308129187d30efeed5097356bea43fdd7df7d88e79626bfdfcf5f947","title":"Implement tiered entity importance system","description":"Create a scoring system to prioritize entities by relevance:\n- +10 if mentioned in player's current input\n- +5 if appeared in last 3 turns  \n- +3 if in current location\n- +1 if in active quest\n\nOnly include top N entities in entity_tracking_data based on score.\n\nThis is a medium-sized refactor affecting entity_preloader.py and llm_service.py.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-07T23:13:15.870699-05:00","updated_at":"2025-12-07T23:13:15.870699-05:00","source_repo":".","labels":["architecture","context-budget","entity-tracking"],"dependencies":[{"issue_id":"BD-od8","depends_on_id":"BD-a76","type":"blocks","created_at":"2025-12-07T23:13:26.924903-05:00","created_by":"daemon"}]}
{"id":"BD-rys","content_hash":"aae2cdd4aec25d3c1ae60b875f6bda8e777bbf3081cc9779a2dc9bc29b34e749","title":"Evaluate PR #2384 and cherry-pick decision","description":"Review PR https://github.com/jleechanorg/worldarchitect.ai/pull/2384 (schema enforcement, provider fixes) and decide whether to cherry-pick onto fix/cerebras-json-schema. Summarize benefits/risks and action taken.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T03:23:01.195448-05:00","updated_at":"2025-12-10T03:24:28.701628-05:00","closed_at":"2025-12-10T03:24:28.701628-05:00","source_repo":".","labels":["decision","pr-2384","structured-output"]}
{"id":"BD-thg","content_hash":"774950eb3f021eed94654080309e5592d62161f43334909a4c8145c91b3c46a6","title":"Investigate Cerebras empty narrative / {\"type\":\"object\"} responses","description":"Reproduce and debug the Cerebras (zai-glm-4.6) empty narrative issue where raw response is {\"type\":\"object\"}. Determine if parsing, provider bug, or prompt change with stripped story_history. Try provider swap (Gemini) for comparison, capture raw response bodies, and propose mitigation (fallback provider or response validation).","notes":"Partial finding: Empty `{\"type\":\"object\"}` responses are TRANSIENT.\n\nEvidence:\n- Same campaign (VqqJL) tested twice on S1\n- First test (02:37 UTC): narrative_len=0, raw_response=`{\"type\":\"object\"}`\n- Second test (04:28 UTC): narrative_len=1876 âœ…\n\nThis is NOT a code bug - it's intermittent Cerebras API behavior. Consider:\n1. Adding retry logic on empty/malformed responses\n2. Response validation before accepting\n3. Fallback to Gemini if response is garbage\n\nKeep open to implement mitigation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-08T23:28:00.495572-05:00","updated_at":"2025-12-08T23:29:59.875629-05:00","source_repo":".","labels":["cerebras","llm-response","regression"]}
{"id":"BD-vdz","content_hash":"66338c7523efef38d22cc9ced2e4f7b2a6f072b7036a3509eecdf0ce89b8ebbb","title":"Unsafe type conversion in validation_recovery.py crashes recovery","description":"Direct int() casts without try/except at mvp_site/validation_recovery.py Lines 116-156 will crash on invalid types. Add try/except for defensive conversion.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-23T13:26:12.562354-08:00","updated_at":"2025-11-23T15:59:07.890132-08:00","closed_at":"2025-11-23T15:59:07.890132-08:00","source_repo":".","labels":["P1","crashes","pr-2082"]}
{"id":"BD-z5h","content_hash":"1f8af14e6f4a6214baf1ced3b980e8ea47a600e6b412dac6cb4fb6a45490238d","title":"Verify context fix \u0026 narrative on VqqJL campaign (dev vs s1)","description":"Reproduce the mature campaign VqqJLpABua9bvAG4ArTg turn on both dev and s1 with the latest context-stripping code. Capture actual request payload token breakdowns (story_history, entity_tracking, game_state, total) and provider raw responses. Confirm non-empty narrative/choices with the same provider. Clarify whether npc_data is excluded in the request or re-added later. Confirm dev deploy is the same commit as s1.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T23:26:39.762707-05:00","updated_at":"2025-12-08T23:29:59.403891-05:00","closed_at":"2025-12-08T23:29:59.403891-05:00","source_repo":".","labels":["context-budget","entity-tracking","regression"]}
{"id":"BD-zca","content_hash":"928e8f023cae49fa1b29b50e01181d66a272671ded7c2dde83e8c6ee87213b6f","title":"Instrument and capture request payloads for budget checks","description":"Add or run instrumentation to persist per-run token breakdowns and serialized LLMRequest payloads for targeted campaigns (including VqqJL) across dev and s1. Goal: attach actual request bodies and token counts (story_history, entity_tracking, game_state, total) to beads, not just log excerpts. Provide a repeatable script/command to gather these snapshots.","notes":"**COMPLETED: S1 payload captured and documented**\n\n**Artifact:** `/tmp/worldarchitect.ai/continue_camp5/s1_payload_capture.json`\n\n**Content summary:**\n```json\n{\n  \"success\": true,\n  \"narrative_len\": 1531,\n  \"sequence_id\": 138,\n  \"planning_choices\": [\"depart_immediately\", \"examine_equipment_closer\", ...]\n}\n```\n\n**Repeatable command:**\n```bash\ncurl -s -X POST https://mvp-site-app-s1-754683067800.us-central1.run.app/mcp \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"tools/call\",\"params\":{\"name\":\"process_action\",\"arguments\":{\"campaign_id\":\"VqqJLpABua9bvAG4ArTg\",\"user_id\":\"vnLp2G3m21PJL6kxcuAqmWSOtm73\",\"user_input\":\"What do I see?\"}}}'\n```\n\n**Token breakdown from logs:**\n```\nENTITY_TRACKING_SIZE: 47tk (reserve was 10500tk)\nGAME_STATE_BREAKDOWN: npc_data=162tk (EXCLUDED), world_data=77tk, player_data=109tk\nLLMREQUEST_PAYLOAD: story_history=26684tk, total_payload=30776tk\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T23:27:56.214509-05:00","updated_at":"2025-12-09T09:50:18.473082-05:00","closed_at":"2025-12-08T23:35:14.062806-05:00","source_repo":".","labels":["context-budget","instrumentation","observability"]}
