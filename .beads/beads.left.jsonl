{"id":"WA-935","content_hash":"34d2c54d0961a7c5d035f4ad5540c1fe9fe8826b15d023798ff5b30b30abd5ca","title":"Implement story pagination for campaign API","description":"The `/api/campaigns/\u003ccampaign_id\u003e` endpoint currently returns all story entries, causing response sizes to exceed Cloud Run's 32MB limit for large campaigns.\n\n**Problem discovered:**\n- Campaign `kuXKa6vrYY6P99MfhWBn` has 1620 story entries = 34.7MB response\n- Cloud Run limit is 32MB, causing intermittent 500 errors\n- GCP logs showed: \"Response size was too large\"\n\n**Current fix (temporary):**\n- Limited to last 300 entries in `main.py:837-844`\n- This is a band-aid, not a real solution\n\n**Real pagination needed:**\n1. Add query params: `?story_offset=0\u0026story_limit=100`\n2. Return pagination metadata: `{total_entries, offset, limit, has_more}`\n3. Frontend lazy-loads older entries on scroll\n4. Consider separate `/api/campaigns/\u003cid\u003e/story` endpoint for paginated access","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T01:29:23.848412-08:00","updated_at":"2026-01-05T01:29:23.848412-08:00","source_repo":".","labels":["api","cloud-run","pagination","performance"]}
{"id":"WA-hd1","content_hash":"d62400cf8fa6622bde926cc4af2c2b8af982732d038a54cb64821d87461741ce","title":"world_logic.py ignores mode='god' parameter - only checks text prefix","description":"## Bug\n\n`world_logic.py:1501` sets `is_god_mode` by checking only the text prefix:\n```python\nis_god_mode = normalized_input.startswith(\"GOD MODE:\")\n```\n\nThis ignores the `mode='god'` parameter from the UI dropdown. Even though `get_agent_for_input()` now correctly selects GodModeAgent, the `is_god_mode` flag in world_logic.py remains False.\n\n## Impact\nWhen users switch to god mode via UI (without typing \"GOD MODE:\" prefix):\n- Player turn incorrectly incremented\n- God mode directives not saved to Firestore\n- Backward time travel validation not bypassed\n- Temporal correction loop incorrectly triggered\n\n## Root Cause\nInconsistent mode detection patterns:\n- `is_think_mode` uses centralized `constants.is_think_mode(user_input, mode)` ✓\n- `is_god_mode` uses inline prefix check only ✗\n\n## Fix\n1. Add `is_god_mode()` function to `constants.py` (like `is_think_mode()`)\n2. Update `world_logic.py:1501` to use `constants.is_god_mode(user_input, mode)`\n3. Update `GodModeAgent.matches_input()` to use centralized function\n\n## Why Test Didn't Catch It\nThe end2end test `test_god_mode_via_mode_parameter_without_prefix` only verifies:\n- Correct agent selected (GodModeAgent) ✓\n- God mode prompts loaded ✓\n- Response contains god_mode_response ✓\n\nIt does NOT verify downstream state handling:\n- is_god_mode flag value in world_logic.py\n- Player turn NOT incremented\n- God mode directives saved to Firestore\n- Temporal validation bypassed\n\nThe test was narrowly scoped to agent selection, missing the integration with world_logic.py state flags.","design":"1. Add `GOD_MODE_PREFIX = \"GOD MODE:\"` to constants.py\n2. Add `is_god_mode(user_input, mode)` function to constants.py\n3. Update world_logic.py:1501 to use `constants.is_god_mode(user_input, mode)`\n4. Update GodModeAgent.matches_input() to use centralized function\n5. Add end2end test that verifies:\n   - Player turn NOT incremented when mode='god'\n   - Directives saved when mode='god' (mock Firestore check)\n   - Temporal validation bypassed","acceptance_criteria":"- [ ] `constants.is_god_mode()` function exists and handles both prefix and mode param\n- [ ] `world_logic.py` uses `constants.is_god_mode(user_input, mode)`\n- [ ] `GodModeAgent.matches_input()` uses centralized detection\n- [ ] End2end test verifies state handling (not just agent selection)\n- [ ] Player turn NOT incremented when mode='god' without prefix\n- [ ] God mode directives saved when mode='god' without prefix","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T22:59:32.26948-08:00","updated_at":"2026-01-04T23:05:54.152957-08:00","closed_at":"2026-01-04T23:05:54.152957-08:00","source_repo":"."}
