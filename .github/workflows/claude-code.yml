name: Claude Code Assistant

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened]
  pull_request:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: write
  actions: read

jobs:
  claude-code:
    runs-on: ubuntu-latest
    name: Claude Code Action
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Claude Code Action
        uses: anthropics/claude-code-action@beta
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          # OAuth alternative (for Pro/Max users):
          # claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          
          # Configuration
          trigger_phrase: "@claude"
          max_turns: 3
          timeout_minutes: 30
          base_branch: main
          
          # Custom instructions for WorldArchitect.AI context
          custom_instructions: |
            You are helping with WorldArchitect.AI, an AI-powered tabletop RPG platform.
            
            Key project details:
            - Stack: Python 3.11, Flask, Gunicorn, Gemini API, Firebase Firestore
            - Frontend: Vanilla JS with Bootstrap
            - Deployment: Docker on Google Cloud Run
            - Testing: Use 'TESTING=true vpython' for tests
            - Main directories: mvp_site/, testing_http/, testing_ui/
            
            Follow the project's CLAUDE.md rules when making changes.
            Always run tests before completing tasks.
            Use the project's logging_util instead of standard logging.