2025-07-08T20:02:39.0900666Z ##[group]Run # Find all test files in mvp_site/tests directory, excluding integration and manual tests
2025-07-08T20:02:39.0901382Z [36;1m# Find all test files in mvp_site/tests directory, excluding integration and manual tests[0m
2025-07-08T20:02:39.0902174Z [36;1mtest_files=$(find mvp_site/tests -name "test_*.py" -type f ! -path "*/integration/*" ! -path "*/test_integration/*" ! -path "*/manual_tests/*" ! -name "*integration*" | sort)[0m
2025-07-08T20:02:39.0902797Z [36;1m[0m
2025-07-08T20:02:39.0902984Z [36;1m# Run each test file[0m
2025-07-08T20:02:39.0903449Z [36;1mfailed_tests=0[0m
2025-07-08T20:02:39.0903744Z [36;1mtotal_tests=0[0m
2025-07-08T20:02:39.0904161Z [36;1mfailed_list=""[0m
2025-07-08T20:02:39.0904357Z [36;1m[0m
2025-07-08T20:02:39.0904545Z [36;1mfor test_file in $test_files; do[0m
2025-07-08T20:02:39.0904824Z [36;1m  echo "Running $test_file..."[0m
2025-07-08T20:02:39.0905090Z [36;1m  total_tests=$((total_tests + 1))[0m
2025-07-08T20:02:39.0905335Z [36;1m  [0m
2025-07-08T20:02:39.0905578Z [36;1m  if TESTING=true python "$test_file"; then[0m
2025-07-08T20:02:39.0905874Z [36;1m    echo "✅ $test_file passed"[0m
2025-07-08T20:02:39.0906127Z [36;1m  else[0m
2025-07-08T20:02:39.0906326Z [36;1m    echo "❌ $test_file failed"[0m
2025-07-08T20:02:39.0906590Z [36;1m    failed_tests=$((failed_tests + 1))[0m
2025-07-08T20:02:39.0906894Z [36;1m    failed_list="$failed_list\n  - $test_file"[0m
2025-07-08T20:02:39.0907170Z [36;1m  fi[0m
2025-07-08T20:02:39.0907381Z [36;1m  echo "----------------------------------------"[0m
2025-07-08T20:02:39.0907660Z [36;1mdone[0m
2025-07-08T20:02:39.0907839Z [36;1m[0m
2025-07-08T20:02:39.0908012Z [36;1m# Summary[0m
2025-07-08T20:02:39.0908205Z [36;1mecho ""[0m
2025-07-08T20:02:39.0908426Z [36;1mecho "========================================"[0m
2025-07-08T20:02:39.0908835Z [36;1mecho "TEST SUMMARY: $((total_tests - failed_tests))/$total_tests tests passed"[0m
2025-07-08T20:02:39.0909243Z [36;1mecho "========================================"[0m
2025-07-08T20:02:39.0909512Z [36;1m[0m
2025-07-08T20:02:39.0909705Z [36;1mif [ $failed_tests -gt 0 ]; then[0m
2025-07-08T20:02:39.0909950Z [36;1m  echo ""[0m
2025-07-08T20:02:39.0910169Z [36;1m  echo "Failed tests:$failed_list"[0m
2025-07-08T20:02:39.0910424Z [36;1m  echo ""[0m
2025-07-08T20:02:39.0910656Z [36;1m  echo "Note: Some tests may fail in CI due to:"[0m
2025-07-08T20:02:39.0911004Z [36;1m  echo "  - Missing local services (e.g., test server)"[0m
2025-07-08T20:02:39.0911332Z [36;1m  echo "  - Test isolation issues"[0m
2025-07-08T20:02:39.0911617Z [36;1m  echo "  - Timing-sensitive tests"[0m
2025-07-08T20:02:39.0911868Z [36;1m  exit 1[0m
2025-07-08T20:02:39.0912090Z [36;1mfi[0m
2025-07-08T20:02:39.0969281Z shell: /usr/bin/bash -e {0}
2025-07-08T20:02:39.0969520Z env:
2025-07-08T20:02:39.0969770Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0970196Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T20:02:39.0970617Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0970979Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0971338Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0971702Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T20:02:39.0972004Z   TESTING: true
2025-07-08T20:02:39.0972183Z ##[endgroup]
2025-07-08T20:02:39.1081792Z Running mvp_site/tests/auth/test_auth_resilience.py...
2025-07-08T20:02:39.2443179Z test_clock_skew_auto_retry_mechanism (__main__.AuthResilienceTest.test_clock_skew_auto_retry_mechanism)
2025-07-08T20:02:39.2446425Z 🔴 RED TEST: Verify that clock skew errors trigger auto-retry ... ok
2025-07-08T20:02:39.2447358Z test_connection_status_monitoring (__main__.AuthResilienceTest.test_connection_status_monitoring)
2025-07-08T20:02:39.2448477Z 🔴 RED TEST: Verify that connection status is monitored for smart UI adaptations ... ok
2025-07-08T20:02:39.2450147Z test_integrated_resilience_workflow (__main__.AuthResilienceTest.test_integrated_resilience_workflow)
2025-07-08T20:02:39.2453075Z 🟢 GREEN TEST: Test the complete resilience workflow end-to-end ... ok
2025-07-08T20:02:39.2454165Z test_offline_campaign_caching (__main__.AuthResilienceTest.test_offline_campaign_caching)
2025-07-08T20:02:39.2455436Z 🔴 RED TEST: Verify that successful campaign data is cached for offline viewing ... ok
2025-07-08T20:02:39.2457321Z test_user_friendly_error_messages (__main__.AuthResilienceTest.test_user_friendly_error_messages)
2025-07-08T20:02:39.2459632Z 🔴 RED TEST: Verify that user gets helpful error messages instead of generic failures ... ok
2025-07-08T20:02:39.2460410Z 
2025-07-08T20:02:39.2460623Z ----------------------------------------------------------------------
2025-07-08T20:02:39.2461138Z Ran 5 tests in 0.002s
2025-07-08T20:02:39.2461343Z 
2025-07-08T20:02:39.2461455Z OK
2025-07-08T20:02:39.2461612Z 
2025-07-08T20:02:39.2462852Z ============================================================
2025-07-08T20:02:39.2463636Z 🧪 AUTHENTICATION RESILIENCE: RED/GREEN TEST SUITE
2025-07-08T20:02:39.2464253Z ============================================================
2025-07-08T20:02:39.2464851Z 🔴 RED TEST: Testing clock skew auto-retry mechanism
2025-07-08T20:02:39.2465382Z ✅ Auto-retry mechanism implementation found
2025-07-08T20:02:39.2465912Z 🔴 RED TEST: Testing connection status monitoring
2025-07-08T20:02:39.2466472Z ✅ Connection status monitoring implementation found
2025-07-08T20:02:39.2467069Z 🟢 GREEN TEST: Testing integrated resilience workflow
2025-07-08T20:02:39.2467683Z ✅ All resilience components properly integrated
2025-07-08T20:02:39.2468289Z 🔴 RED TEST: Testing offline campaign caching
2025-07-08T20:02:39.2468862Z ✅ Offline campaign caching implementation found
2025-07-08T20:02:39.2469470Z 🔴 RED TEST: Testing user-friendly error messaging
2025-07-08T20:02:39.2470114Z ✅ User-friendly error messaging implementation found
2025-07-08T20:02:39.2470479Z 
2025-07-08T20:02:39.2470659Z ============================================================
2025-07-08T20:02:39.2471381Z 🟢 GREEN STATE ACHIEVED: All resilience features implemented correctly!
2025-07-08T20:02:39.2472035Z ✅ 5 tests passed
2025-07-08T20:02:39.2472235Z 
2025-07-08T20:02:39.2472471Z 🎯 RESILIENCE FEATURES VALIDATED:
2025-07-08T20:02:39.2472997Z    • JWT clock skew auto-retry ✅
2025-07-08T20:02:39.2473736Z    • User-friendly error messages ✅
2025-07-08T20:02:39.2474248Z    • Offline campaign caching ✅
2025-07-08T20:02:39.2474729Z    • Connection status monitoring ✅
2025-07-08T20:02:39.2475213Z    • Integrated workflow ✅
2025-07-08T20:02:39.2475617Z ============================================================
2025-07-08T20:02:39.2575207Z ✅ mvp_site/tests/auth/test_auth_resilience.py passed
2025-07-08T20:02:39.2577270Z ----------------------------------------
2025-07-08T20:02:39.2578804Z Running mvp_site/tests/test_age_field_validation.py...
2025-07-08T20:02:39.4622257Z .........
2025-07-08T20:02:39.4629258Z ----------------------------------------------------------------------
2025-07-08T20:02:39.4634882Z Ran 9 tests in 0.001s
2025-07-08T20:02:39.4635089Z 
2025-07-08T20:02:39.4635195Z OK
2025-07-08T20:02:39.4847511Z ✅ mvp_site/tests/test_age_field_validation.py passed
2025-07-08T20:02:39.4853420Z ----------------------------------------
2025-07-08T20:02:39.4853971Z Running mvp_site/tests/test_always_json_mode.py...
2025-07-08T20:02:40.2057855Z .2025-07-08 20:02:40,205 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:40.2061069Z 2025-07-08 20:02:40,205 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:40.2074409Z 2025-07-08 20:02:40,207 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:40.2079974Z 2025-07-08 20:02:40,207 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:40.2098746Z 2025-07-08 20:02:40,209 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:02:40.2100632Z 2025-07-08 20:02:40,209 - INFO - Added LLM-generated standard planning block
2025-07-08T20:02:40.2109482Z .2025-07-08 20:02:40,210 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:40.2110679Z 2025-07-08 20:02:40,210 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:40.2122962Z 2025-07-08 20:02:40,212 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:40.2130906Z 2025-07-08 20:02:40,212 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:40.2132525Z 2025-07-08 20:02:40,212 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:40.2135138Z 2025-07-08 20:02:40,213 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:40.2136069Z 2025-07-08 20:02:40,213 - INFO - Starting dual-pass generation
2025-07-08T20:02:40.2136764Z 2025-07-08 20:02:40,213 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:40.2145339Z 2025-07-08 20:02:40,213 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:40.2150691Z 2025-07-08 20:02:40,213 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:40.2151548Z 2025-07-08 20:02:40,213 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:40.2152221Z 2025-07-08 20:02:40,213 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:40.2152838Z 2025-07-08 20:02:40,213 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:40.2153793Z 2025-07-08 20:02:40,213 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:40.2154766Z 2025-07-08 20:02:40,213 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:40.2155475Z 2025-07-08 20:02:40,214 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:40.2156173Z 2025-07-08 20:02:40,214 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:40.2156972Z 2025-07-08 20:02:40,214 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:40.2157932Z 2025-07-08 20:02:40,214 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:40.2158731Z 2025-07-08 20:02:40,214 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:40.2159273Z 2025-07-08 20:02:40,214 - INFO - Planning block found in response
2025-07-08T20:02:40.2159699Z ...
2025-07-08T20:02:40.2160023Z ----------------------------------------------------------------------
2025-07-08T20:02:40.2160484Z Ran 5 tests in 0.011s
2025-07-08T20:02:40.2160677Z 
2025-07-08T20:02:40.2160785Z OK
2025-07-08T20:02:40.2967416Z ✅ mvp_site/tests/test_always_json_mode.py passed
2025-07-08T20:02:40.2973847Z ----------------------------------------
2025-07-08T20:02:40.2974390Z Running mvp_site/tests/test_animation_system.py...
2025-07-08T20:02:40.3612638Z test_accessibility_features (__main__.TestAnimationSystem.test_accessibility_features)
2025-07-08T20:02:40.3616402Z Test that accessibility features are properly implemented ... ok
2025-07-08T20:02:40.3621992Z test_animation_css_exists_and_valid (__main__.TestAnimationSystem.test_animation_css_exists_and_valid)
2025-07-08T20:02:40.3623185Z Test that animation CSS file exists and contains expected animations ... ok
2025-07-08T20:02:40.3624437Z test_animation_css_syntax_validation (__main__.TestAnimationSystem.test_animation_css_syntax_validation)
2025-07-08T20:02:40.3625352Z Test CSS syntax is valid (basic validation) ... ok
2025-07-08T20:02:40.3626220Z test_animation_js_exists_and_valid (__main__.TestAnimationSystem.test_animation_js_exists_and_valid)
2025-07-08T20:02:40.3631831Z Test that animation JavaScript file exists and is valid ... ok
2025-07-08T20:02:40.3641690Z test_animation_performance_properties (__main__.TestAnimationSystem.test_animation_performance_properties)
2025-07-08T20:02:40.3643105Z Test that performance-enhancing CSS properties are present ... ok
2025-07-08T20:02:40.3644335Z test_index_html_includes_animation_files (__main__.TestAnimationSystem.test_index_html_includes_animation_files)
2025-07-08T20:02:40.3645323Z Test that index.html includes animation CSS and JS ... ok
2025-07-08T20:02:40.3646156Z test_javascript_error_handling (__main__.TestAnimationSystem.test_javascript_error_handling)
2025-07-08T20:02:40.3675119Z Test that JavaScript has proper error handling patterns ... ok
2025-07-08T20:02:40.3675928Z test_theme_specific_animations (__main__.TestAnimationSystem.test_theme_specific_animations)
2025-07-08T20:02:40.3676693Z Test that theme-specific animations are included ... ok
2025-07-08T20:02:40.3677835Z test_animation_system_compatibility (__main__.TestAnimationIntegration.test_animation_system_compatibility)
2025-07-08T20:02:40.3678806Z Test that animation system doesn't conflict with existing app.js ... ok
2025-07-08T20:02:40.3679571Z test_loading_order_in_html (__main__.TestAnimationIntegration.test_loading_order_in_html)
2025-07-08T20:02:40.3680263Z Test that scripts are loaded in correct order ... ok
2025-07-08T20:02:40.3680907Z test_css_file_size (__main__.TestAnimationPerformance.test_css_file_size)
2025-07-08T20:02:40.3681499Z Test that CSS file size is reasonable ... ok
2025-07-08T20:02:40.3682184Z test_css_selector_efficiency (__main__.TestAnimationPerformance.test_css_selector_efficiency)
2025-07-08T20:02:40.3682881Z Test that CSS selectors are efficient ... ok
2025-07-08T20:02:40.3683751Z test_javascript_file_size (__main__.TestAnimationPerformance.test_javascript_file_size)
2025-07-08T20:02:40.3684392Z Test that JavaScript file size is reasonable ... ok
2025-07-08T20:02:40.3685084Z test_animation_duration_variables (__main__.TestAnimationFunctionality.test_animation_duration_variables)
2025-07-08T20:02:40.3685911Z Test that animation duration variables are properly defined ... ok
2025-07-08T20:02:40.3686746Z test_javascript_api_methods (__main__.TestAnimationFunctionality.test_javascript_api_methods)
2025-07-08T20:02:40.3687540Z Test that JavaScript API provides expected methods ... ok
2025-07-08T20:02:40.3688386Z test_keyframe_animations_defined (__main__.TestAnimationFunctionality.test_keyframe_animations_defined)
2025-07-08T20:02:40.3689217Z Test that essential keyframe animations are defined ... ok
2025-07-08T20:02:40.3689554Z 
2025-07-08T20:02:40.3689760Z ----------------------------------------------------------------------
2025-07-08T20:02:40.3690214Z Ran 16 tests in 0.004s
2025-07-08T20:02:40.3690427Z 
2025-07-08T20:02:40.3690533Z OK
2025-07-08T20:02:40.3691089Z 🧪 Running Animation System Tests...
2025-07-08T20:02:40.3691563Z ✅ All animation tests passed!
2025-07-08T20:02:40.3779235Z ✅ mvp_site/tests/test_animation_system.py passed
2025-07-08T20:02:40.3780676Z ----------------------------------------
2025-07-08T20:02:40.3781162Z Running mvp_site/tests/test_api_routes.py...
2025-07-08T20:02:41.3384602Z ......Traceback (most recent call last):
2025-07-08T20:02:41.3395062Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 620, in update_campaign
2025-07-08T20:02:41.3396846Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T20:02:41.3398558Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:02:41.3399945Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:02:41.3400605Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:41.3401713Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:02:41.3402948Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:02:41.3403976Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:41.3409319Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:02:41.3410251Z     raise effect
2025-07-08T20:02:41.3410903Z Exception: Update error
2025-07-08T20:02:41.3544623Z ...2025-07-08 20:02:41,354 - INFO - Received custom_options: ['destinySystem']
2025-07-08T20:02:41.3545949Z 2025-07-08 20:02:41,354 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3596290Z .2025-07-08 20:02:41,359 - INFO - Received custom_options: []
2025-07-08T20:02:41.3598427Z 2025-07-08 20:02:41,359 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3697904Z ..2025-07-08 20:02:41,369 - INFO - Received custom_options: ['destinySystem', 'companions', 'defaultWorld']
2025-07-08T20:02:41.3699370Z 2025-07-08 20:02:41,369 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3751258Z .2025-07-08 20:02:41,375 - INFO - Received custom_options: []
2025-07-08T20:02:41.3756656Z 2025-07-08 20:02:41,375 - INFO - Selected attribute_system: <MagicMock name='constants.ATTRIBUTE_SYSTEM_DND' id='140041096164496'>
2025-07-08T20:02:41.3869150Z ..2025-07-08 20:02:41,386 - INFO - Exporting file '/tmp/campaign_exports/ed99d3a2-a2a7-4cd8-9d32-3efbd11bd543.pdf' with download_name='Test Campaign.pdf'
2025-07-08T20:02:41.3915350Z ..
2025-07-08T20:02:41.3916653Z ----------------------------------------------------------------------
2025-07-08T20:02:41.3917313Z Ran 17 tests in 0.089s
2025-07-08T20:02:41.3918687Z 
2025-07-08T20:02:41.3918931Z OK
2025-07-08T20:02:41.5204244Z ✅ mvp_site/tests/test_api_routes.py passed
2025-07-08T20:02:41.5207712Z ----------------------------------------
2025-07-08T20:02:41.5208291Z Running mvp_site/tests/test_architectural_decisions.py...
2025-07-08T20:02:41.6513701Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6516928Z   @validator('strength', pre=True)
2025-07-08T20:02:41.6520026Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6523035Z   @validator('dexterity', pre=True)
2025-07-08T20:02:41.6525916Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6529598Z   @validator('constitution', pre=True)
2025-07-08T20:02:41.6532169Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6535056Z   @validator('intelligence', pre=True)
2025-07-08T20:02:41.6537675Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6540761Z   @validator('wisdom', pre=True)
2025-07-08T20:02:41.6543567Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6546210Z   @validator('charisma', pre=True)
2025-07-08T20:02:41.6711231Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6716009Z   @validator('hp', pre=True)
2025-07-08T20:02:41.6718561Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6721089Z   @validator('hp_max', pre=True)
2025-07-08T20:02:41.6723792Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6726411Z   @validator('temp_hp', pre=True)
2025-07-08T20:02:41.6758278Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6760993Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:02:41.6792704Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6796290Z   @validator('level', pre=True)
2025-07-08T20:02:41.6799545Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6802514Z   @validator('gender')
2025-07-08T20:02:41.6805472Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6808479Z   @validator('age')
2025-07-08T20:02:41.6811740Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6816509Z   @validator('mbti')
2025-07-08T20:02:41.6820768Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6824010Z   @validator('alignment')
2025-07-08T20:02:41.6826614Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6829260Z   @validator('entity_type')
2025-07-08T20:02:41.6982224Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6987033Z   @validator('participants')
2025-07-08T20:02:41.6999428Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.7003640Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:02:41.7006497Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.7009242Z   @validator('present_entities')
2025-07-08T20:02:41.7069773Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:41.7072534Z ..
2025-07-08T20:02:41.7073682Z ----------------------------------------------------------------------
2025-07-08T20:02:41.7074696Z Ran 6 tests in 0.149s
2025-07-08T20:02:41.7076373Z 
2025-07-08T20:02:41.7077840Z OK
2025-07-08T20:02:41.7380019Z ✅ mvp_site/tests/test_architectural_decisions.py passed
2025-07-08T20:02:41.7381528Z ----------------------------------------
2025-07-08T20:02:41.7382104Z Running mvp_site/tests/test_banned_name_prevention_v2.py...
2025-07-08T20:02:41.7763827Z ....
2025-07-08T20:02:41.7765420Z ----------------------------------------------------------------------
2025-07-08T20:02:41.7765977Z Ran 4 tests in 0.002s
2025-07-08T20:02:41.7766189Z 
2025-07-08T20:02:41.7766310Z OK
2025-07-08T20:02:41.7821557Z ✅ mvp_site/tests/test_banned_name_prevention_v2.py passed
2025-07-08T20:02:41.7823819Z ----------------------------------------
2025-07-08T20:02:41.7825021Z Running mvp_site/tests/test_banned_names_loading.py...
2025-07-08T20:02:41.8282145Z ........
2025-07-08T20:02:41.8283629Z ----------------------------------------------------------------------
2025-07-08T20:02:41.8285226Z Ran 8 tests in 0.001s
2025-07-08T20:02:41.8285447Z 
2025-07-08T20:02:41.8285569Z OK
2025-07-08T20:02:41.8355158Z ✅ mvp_site/tests/test_banned_names_loading.py passed
2025-07-08T20:02:41.8356920Z ----------------------------------------
2025-07-08T20:02:41.8358078Z Running mvp_site/tests/test_banned_names_visibility_v2.py...
2025-07-08T20:02:41.8802459Z ...
2025-07-08T20:02:41.8804133Z ----------------------------------------------------------------------
2025-07-08T20:02:41.8805735Z Ran 3 tests in 0.002s
2025-07-08T20:02:41.8807328Z 
2025-07-08T20:02:41.8807461Z OK
2025-07-08T20:02:41.8872481Z ✅ mvp_site/tests/test_banned_names_visibility_v2.py passed
2025-07-08T20:02:41.8874979Z ----------------------------------------
2025-07-08T20:02:41.8876389Z Running mvp_site/tests/test_campaign_clicks.py...
2025-07-08T20:02:41.9504573Z ....
2025-07-08T20:02:41.9506355Z ----------------------------------------------------------------------
2025-07-08T20:02:41.9506869Z Ran 4 tests in 0.001s
2025-07-08T20:02:41.9507088Z 
2025-07-08T20:02:41.9507203Z OK
2025-07-08T20:02:41.9618946Z ✅ mvp_site/tests/test_campaign_clicks.py passed
2025-07-08T20:02:41.9620642Z ----------------------------------------
2025-07-08T20:02:41.9621825Z Running mvp_site/tests/test_combat_bug_green.py...
2025-07-08T20:02:42.0048769Z test_cleanup_defeated_enemies_handles_list_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_handles_list_combatants)
2025-07-08T20:02:42.0053032Z ======================================================================
2025-07-08T20:02:42.0055810Z GREEN TEST: This should PASS without errors ... ok
2025-07-08T20:02:42.0056909Z test_cleanup_defeated_enemies_preserves_dict_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_preserves_dict_combatants)
2025-07-08T20:02:42.0058118Z Verify that dict format still works correctly (regression test) ... ok
2025-07-08T20:02:42.0059157Z test_cleanup_with_complex_list_structure (__main__.TestCombatBugGreen.test_cleanup_with_complex_list_structure)
2025-07-08T20:02:42.0060161Z Test with more complex list structure that AI might generate ... ok
2025-07-08T20:02:42.0060607Z 
2025-07-08T20:02:42.0060838Z ----------------------------------------------------------------------
2025-07-08T20:02:42.0061359Z Ran 3 tests in 0.000s
2025-07-08T20:02:42.0061591Z 
2025-07-08T20:02:42.0061722Z OK
2025-07-08T20:02:42.0062258Z 🟢 RUNNING GREEN TEST - THIS SHOULD PASS!
2025-07-08T20:02:42.0063975Z If this test PASSES, the bug is fixed.
2025-07-08T20:02:42.0064441Z ======================================================================
2025-07-08T20:02:42.0064757Z 
2025-07-08T20:02:42.0065148Z ✅ GREEN TEST: Attempting to call cleanup_defeated_enemies()...
2025-07-08T20:02:42.0065771Z Expected: No errors, returns list of defeated enemies
2025-07-08T20:02:42.0066381Z ✅ Successfully cleaned up defeated enemies: ['Dragon']
2025-07-08T20:02:42.0066951Z ✅ Combatants normalized to dict format and Dragon removed
2025-07-08T20:02:42.0067337Z 
2025-07-08T20:02:42.0067627Z ✅ Dict format still works correctly (no regression)
2025-07-08T20:02:42.0067992Z 
2025-07-08T20:02:42.0068244Z ✅ Complex list structure handled correctly
2025-07-08T20:02:42.0122943Z ✅ mvp_site/tests/test_combat_bug_green.py passed
2025-07-08T20:02:42.0124515Z ----------------------------------------
2025-07-08T20:02:42.0125078Z Running mvp_site/tests/test_combat_cleanup_comprehensive.py...
2025-07-08T20:02:42.9586809Z test_automatic_cleanup_via_state_updates_hp_defeat (__main__.TestCombatCleanupComprehensive.test_automatic_cleanup_via_state_updates_hp_defeat)
2025-07-08T20:02:42.9589101Z Test: Enemy defeated via AI HP update should be automatically cleaned up. ... 2025-07-08 20:02:42,958 - INFO - COMBAT STARTED - Participants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T20:02:42.9590998Z 2025-07-08 20:02:42,958 - INFO - COMBAT INITIALIZED - Initiative order: ['Hero(18)', 'Orc Warrior(14)', 'Goblin(12)']
2025-07-08T20:02:42.9592801Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9593750Z   "combat_state": {
2025-07-08T20:02:42.9594239Z     "combatants": {
2025-07-08T20:02:42.9595637Z       "Orc Warrior": {
2025-07-08T20:02:42.9595958Z         "hp_current": 0,
2025-07-08T20:02:42.9596249Z         "status": [
2025-07-08T20:02:42.9596526Z           "bloodied",
2025-07-08T20:02:42.9596811Z           "unconscious"
2025-07-08T20:02:42.9597097Z         ]
2025-07-08T20:02:42.9597333Z       }
2025-07-08T20:02:42.9597561Z     }
2025-07-08T20:02:42.9597804Z   }
2025-07-08T20:02:42.9598295Z }
2025-07-08T20:02:42.9598740Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9599310Z   "combatants": {
2025-07-08T20:02:42.9599607Z     "Orc Warrior": {
2025-07-08T20:02:42.9599941Z       "hp_current": 0,
2025-07-08T20:02:42.9600267Z       "status": [
2025-07-08T20:02:42.9600568Z         "bloodied",
2025-07-08T20:02:42.9600866Z         "unconscious"
2025-07-08T20:02:42.9601166Z       ]
2025-07-08T20:02:42.9601407Z     }
2025-07-08T20:02:42.9601661Z   }
2025-07-08T20:02:42.9601914Z }
2025-07-08T20:02:42.9602357Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9602943Z   "Orc Warrior": {
2025-07-08T20:02:42.9603427Z     "hp_current": 0,
2025-07-08T20:02:42.9603741Z     "status": [
2025-07-08T20:02:42.9604032Z       "bloodied",
2025-07-08T20:02:42.9604328Z       "unconscious"
2025-07-08T20:02:42.9604627Z     ]
2025-07-08T20:02:42.9604893Z   }
2025-07-08T20:02:42.9605162Z }
2025-07-08T20:02:42.9605622Z 2025-07-08 20:02:42,959 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9606210Z   "hp_current": 0,
2025-07-08T20:02:42.9606510Z   "status": [
2025-07-08T20:02:42.9606779Z     "bloodied",
2025-07-08T20:02:42.9607056Z     "unconscious"
2025-07-08T20:02:42.9607307Z   ]
2025-07-08T20:02:42.9607535Z }
2025-07-08T20:02:42.9610733Z 2025-07-08 20:02:42,960 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9612027Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9613443Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9614776Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9616116Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9617633Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Marking Orc Warrior (enemy) as defeated
2025-07-08T20:02:42.9618866Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Removed Orc Warrior from combat_state.combatants
2025-07-08T20:02:42.9619870Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Removed Orc Warrior from npc_data
2025-07-08T20:02:42.9621019Z 2025-07-08 20:02:42,961 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Orc Warrior']
2025-07-08T20:02:42.9621806Z ok
2025-07-08T20:02:42.9622871Z test_cleanup_without_explicit_combat_state_changes (__main__.TestCombatCleanupComprehensive.test_cleanup_without_explicit_combat_state_changes)
2025-07-08T20:02:42.9625449Z Test: Cleanup should trigger even when combat_state isn't explicitly in proposed_changes. ... 2025-07-08 20:02:42,961 - INFO - COMBAT STARTED - Participants: ['Ranger', 'Troll']
2025-07-08T20:02:42.9627391Z 2025-07-08 20:02:42,961 - INFO - COMBAT INITIALIZED - Initiative order: ['Ranger(16)', 'Troll(8)']
2025-07-08T20:02:42.9628755Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9638527Z   "combat_state": {
2025-07-08T20:02:42.9639430Z     "current_turn_index": 1,
2025-07-08T20:02:42.9640314Z     "current_round": 3
2025-07-08T20:02:42.9641077Z   },
2025-07-08T20:02:42.9641664Z   "world_data": {
2025-07-08T20:02:42.9642127Z     "current_weather": "stormy"
2025-07-08T20:02:42.9642632Z Running comprehensive combat cleanup tests
2025-07-08T20:02:42.9643666Z These tests verify the automatic cleanup system works correctly
2025-07-08T20:02:42.9644215Z ======================================================================
2025-07-08T20:02:42.9644537Z 
2025-07-08T20:02:42.9644732Z Testing: Automatic cleanup via HP state updates
2025-07-08T20:02:42.9645299Z Initial combatants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T20:02:42.9645832Z Initial NPC data: ['Orc Warrior', 'Goblin', 'Merchant']
2025-07-08T20:02:42.9646660Z AI proposed changes: {'combat_state': {'combatants': {'Orc Warrior': {'hp_current': 0, 'status': ['bloodied', 'unconscious']}}}}
2025-07-08T20:02:42.9647739Z After automatic cleanup - Combatants: ['Hero', 'Goblin']
2025-07-08T20:02:42.9648278Z After automatic cleanup - NPCs: ['Goblin', 'Merchant']
2025-07-08T20:02:42.9648603Z 
2025-07-08T20:02:42.9648805Z Testing: Cleanup without explicit combat state changes
2025-07-08T20:02:42.9649277Z Before update - Troll HP: 0
2025-07-08T20:02:42.9649678Z Before update - Combatants: ['Ranger', 'Troll']
2025-07-08T20:02:42.9650108Z After update - Combatants: ['Ranger']
2025-07-08T20:02:42.9650383Z 
2025-07-08T20:02:42.9650556Z Testing: Combat end with pre-defeated enemies
2025-07-08T20:02:42.9651113Z Before combat end - Combatants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T20:02:42.9651617Z Dead Orc HP: 0
2025-07-08T20:02:42.9651912Z After combat end - In combat: False
2025-07-08T20:02:42.9652370Z After combat end - Combatants: ['Player', 'Living Wolf']
2025-07-08T20:02:42.9652704Z 
2025-07-08T20:02:42.9652854Z Testing: Multiple simultaneous defeats
2025-07-08T20:02:42.9659395Z Before fireball - Combatants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T20:02:42.9660056Z After fireball - Combatants: ['Wizard', 'Orc Chief']
2025-07-08T20:02:42.9660555Z After fireball - NPCs: ['Orc Chief', 'Village Elder']
2025-07-08T20:02:42.9661059Z   }
2025-07-08T20:02:42.9661293Z }
2025-07-08T20:02:42.9661704Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9662262Z   "current_turn_index": 1,
2025-07-08T20:02:42.9662567Z   "current_round": 3
2025-07-08T20:02:42.9662849Z }
2025-07-08T20:02:42.9663403Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9664039Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9664560Z   "current_weather": "stormy"
2025-07-08T20:02:42.9664882Z }
2025-07-08T20:02:42.9665241Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9665843Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9666598Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP CHECK: Found 2 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9667384Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Marking Troll (enemy) as defeated
2025-07-08T20:02:42.9668079Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Troll from combat_state.combatants
2025-07-08T20:02:42.9668768Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Troll from npc_data
2025-07-08T20:02:42.9669430Z 2025-07-08 20:02:42,962 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Troll']
2025-07-08T20:02:42.9669938Z ok
2025-07-08T20:02:42.9670652Z test_combat_end_with_pre_defeated_enemies (__main__.TestCombatCleanupComprehensive.test_combat_end_with_pre_defeated_enemies)
2025-07-08T20:02:42.9672202Z Test: When combat ends and there are already defeated enemies, they should be cleaned up. ... 2025-07-08 20:02:42,962 - INFO - COMBAT STARTED - Participants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T20:02:42.9673701Z 2025-07-08 20:02:42,962 - INFO - COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dead Orc(12)', 'Living Wolf(10)']
2025-07-08T20:02:42.9674547Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9675054Z   "combat_state": {
2025-07-08T20:02:42.9675556Z     "in_combat": false,
2025-07-08T20:02:42.9675861Z     "current_round": 0
2025-07-08T20:02:42.9676167Z   }
2025-07-08T20:02:42.9676405Z }
2025-07-08T20:02:42.9676803Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9677329Z   "in_combat": false,
2025-07-08T20:02:42.9677624Z   "current_round": 0
2025-07-08T20:02:42.9677901Z }
2025-07-08T20:02:42.9678262Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9678858Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9679608Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9680569Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Marking Dead Orc (enemy) as defeated
2025-07-08T20:02:42.9681303Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Dead Orc from combat_state.combatants
2025-07-08T20:02:42.9682022Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Dead Orc from npc_data
2025-07-08T20:02:42.9682696Z 2025-07-08 20:02:42,962 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Dead Orc']
2025-07-08T20:02:42.9683393Z ok
2025-07-08T20:02:42.9684085Z test_multiple_enemies_defeated_same_turn (__main__.TestCombatCleanupComprehensive.test_multiple_enemies_defeated_same_turn)
2025-07-08T20:02:42.9685541Z Test: Multiple enemies defeated in the same AI response should all be cleaned up. ... 2025-07-08 20:02:42,963 - INFO - COMBAT STARTED - Participants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T20:02:42.9686918Z 2025-07-08 20:02:42,963 - INFO - COMBAT INITIALIZED - Initiative order: ['Wizard(20)', 'Goblin A(15)', 'Goblin B(14)', 'Orc Chief(13)']
2025-07-08T20:02:42.9687821Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9688331Z   "combat_state": {
2025-07-08T20:02:42.9688640Z     "combatants": {
2025-07-08T20:02:42.9688909Z       "Goblin A": {
2025-07-08T20:02:42.9689200Z         "hp_current": 0,
2025-07-08T20:02:42.9689486Z         "status": [
2025-07-08T20:02:42.9689737Z           "dead"
2025-07-08T20:02:42.9690004Z         ]
2025-07-08T20:02:42.9690242Z       },
2025-07-08T20:02:42.9690475Z       "Goblin B": {
2025-07-08T20:02:42.9690759Z         "hp_current": 0,
2025-07-08T20:02:42.9691050Z         "status": [
2025-07-08T20:02:42.9691298Z           "dead"
2025-07-08T20:02:42.9691557Z         ]
2025-07-08T20:02:42.9691784Z       },
2025-07-08T20:02:42.9692018Z       "Orc Chief": {
2025-07-08T20:02:42.9692311Z         "hp_current": 5,
2025-07-08T20:02:42.9692612Z         "status": [
2025-07-08T20:02:42.9692878Z           "wounded"
2025-07-08T20:02:42.9693158Z ... (truncated, showing 19/24 lines)
2025-07-08T20:02:42.9693883Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9694392Z   "combatants": {
2025-07-08T20:02:42.9694656Z     "Goblin A": {
2025-07-08T20:02:42.9694929Z       "hp_current": 0,
2025-07-08T20:02:42.9695217Z       "status": [
2025-07-08T20:02:42.9695472Z         "dead"
2025-07-08T20:02:42.9695721Z       ]
2025-07-08T20:02:42.9695957Z     },
2025-07-08T20:02:42.9696186Z     "Goblin B": {
2025-07-08T20:02:42.9696466Z       "hp_current": 0,
2025-07-08T20:02:42.9696753Z       "status": [
2025-07-08T20:02:42.9696999Z         "dead"
2025-07-08T20:02:42.9697247Z       ]
2025-07-08T20:02:42.9697470Z     },
2025-07-08T20:02:42.9697697Z     "Orc Chief": {
2025-07-08T20:02:42.9697973Z       "hp_current": 5,
2025-07-08T20:02:42.9698249Z       "status": [
2025-07-08T20:02:42.9698497Z         "wounded"
2025-07-08T20:02:42.9698740Z       ]
2025-07-08T20:02:42.9698997Z ... (truncated, showing 19/22 lines)
2025-07-08T20:02:42.9699495Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9699984Z   "Goblin A": {
2025-07-08T20:02:42.9700248Z     "hp_current": 0,
2025-07-08T20:02:42.9700529Z     "status": [
2025-07-08T20:02:42.9700775Z       "dead"
2025-07-08T20:02:42.9701220Z     ]
2025-07-08T20:02:42.9701445Z   },
2025-07-08T20:02:42.9701668Z   "Goblin B": {
2025-07-08T20:02:42.9701932Z     "hp_current": 0,
2025-07-08T20:02:42.9702204Z     "status": [
2025-07-08T20:02:42.9702451Z       "dead"
2025-07-08T20:02:42.9702696Z     ]
2025-07-08T20:02:42.9702924Z   },
2025-07-08T20:02:42.9703143Z   "Orc Chief": {
2025-07-08T20:02:42.9703570Z     "hp_current": 5,
2025-07-08T20:02:42.9703844Z     "status": [
2025-07-08T20:02:42.9704083Z       "wounded"
2025-07-08T20:02:42.9704327Z     ]
2025-07-08T20:02:42.9704560Z   }
2025-07-08T20:02:42.9704775Z }
2025-07-08T20:02:42.9705164Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9705857Z   "hp_current": 0,
2025-07-08T20:02:42.9706119Z   "status": [
2025-07-08T20:02:42.9706361Z     "dead"
2025-07-08T20:02:42.9706597Z   ]
2025-07-08T20:02:42.9706811Z }
2025-07-08T20:02:42.9707171Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9707831Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9708335Z   "hp_current": 0,
2025-07-08T20:02:42.9708612Z   "status": [
2025-07-08T20:02:42.9708858Z     "dead"
2025-07-08T20:02:42.9709090Z   ]
2025-07-08T20:02:42.9709311Z }
2025-07-08T20:02:42.9709683Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9710297Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9710800Z   "hp_current": 5,
2025-07-08T20:02:42.9711062Z   "status": [
2025-07-08T20:02:42.9711299Z     "wounded"
2025-07-08T20:02:42.9711546Z   ]
2025-07-08T20:02:42.9711766Z }
2025-07-08T20:02:42.9712128Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9712750Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9713468Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9714063Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9714857Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP CHECK: Found 4 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9715626Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Marking Goblin A (enemy) as defeated
2025-07-08T20:02:42.9716277Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Marking Goblin B (enemy) as defeated
2025-07-08T20:02:42.9716972Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin A from combat_state.combatants
2025-07-08T20:02:42.9717639Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin A from npc_data
2025-07-08T20:02:42.9718337Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin B from combat_state.combatants
2025-07-08T20:02:42.9719005Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin B from npc_data
2025-07-08T20:02:42.9719712Z 2025-07-08 20:02:42,964 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Goblin A', 'Goblin B']
2025-07-08T20:02:42.9720293Z ok
2025-07-08T20:02:42.9720423Z 
2025-07-08T20:02:42.9720615Z ----------------------------------------------------------------------
2025-07-08T20:02:42.9721033Z Ran 4 tests in 0.006s
2025-07-08T20:02:42.9721215Z 
2025-07-08T20:02:42.9721311Z OK
2025-07-08T20:02:43.1174868Z ✅ mvp_site/tests/test_combat_cleanup_comprehensive.py passed
2025-07-08T20:02:43.1176409Z ----------------------------------------
2025-07-08T20:02:43.1176964Z Running mvp_site/tests/test_complete_combined_approach.py...
2025-07-08T20:02:43.3001041Z test_complete_combined_approach_integration (__main__.TestCompleteCombinedApproach.test_complete_combined_approach_integration)
2025-07-08T20:02:43.3020600Z Test complete Combined approach integration flow ... ok
2025-07-08T20:02:43.3023009Z test_failure_case_handling (__main__.TestCompleteCombinedApproach.test_failure_case_handling)
2025-07-08T20:02:43.3032981Z Test how the system handles failure cases ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:43.3035751Z ok
2025-07-08T20:02:43.3038456Z test_step1_structured_generation_prompt_creation (__main__.TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation)
2025-07-08T20:02:43.3044092Z Step 1: Create structured generation prompt with entity manifest ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation of <__main__.TestCompleteCombinedApproach testMethod=test_step1_structured_generation_prompt_creation>>)
2025-07-08T20:02:43.3047133Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3047552Z ok
2025-07-08T20:02:43.3048325Z test_step2_structured_response_parsing (__main__.TestCompleteCombinedApproach.test_step2_structured_response_parsing)
2025-07-08T20:02:43.3051094Z Step 2: Parse structured JSON response from LLM ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step2_structured_response_parsing of <__main__.TestCompleteCombinedApproach testMethod=test_step2_structured_response_parsing>>)
2025-07-08T20:02:43.3053515Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3053853Z ok
2025-07-08T20:02:43.3054384Z test_step3_schema_validation (__main__.TestCompleteCombinedApproach.test_step3_schema_validation)
2025-07-08T20:02:43.3057120Z Step 3: Validate structured response against expected schema ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step3_schema_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step3_schema_validation>>)
2025-07-08T20:02:43.3059478Z 🎯 Complete Combined Approach Implementation Test
2025-07-08T20:02:43.3060296Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3060738Z Testing Milestone 1: Production Entity Tracking
2025-07-08T20:02:43.3061226Z ok
2025-07-08T20:02:43.3064569Z ======================================================================
2025-07-08T20:02:43.3072706Z 
2025-07-08T20:02:43.3073039Z 🚀 Complete Combined Approach Integration Test
2025-07-08T20:02:43.3073609Z ============================================================
2025-07-08T20:02:43.3082540Z 
2025-07-08T20:02:43.3082864Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T20:02:43.3088316Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3088926Z    ✅ Prompt injection created (836 chars)
2025-07-08T20:02:43.3089199Z 
2025-07-08T20:02:43.3089441Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T20:02:43.3089903Z    ✅ JSON parsed successfully
2025-07-08T20:02:43.3090325Z    ✅ Narrative extracted (380 chars)
2025-07-08T20:02:43.3090834Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3091121Z 
2025-07-08T20:02:43.3091381Z 🔧 Step 3: Schema validation of structured response
2025-07-08T20:02:43.3091889Z    ✅ Schema validation: True
2025-07-08T20:02:43.3092290Z    ✅ Narrative validation: True
2025-07-08T20:02:43.3092679Z    ✅ Coverage rate: 1.00
2025-07-08T20:02:43.3092892Z 
2025-07-08T20:02:43.3093135Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T20:02:43.3093781Z    ✅ All entities present: True
2025-07-08T20:02:43.3094249Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3094693Z    ✅ Confidence: 1.00
2025-07-08T20:02:43.3094907Z 
2025-07-08T20:02:43.3095099Z 📊 Combined Approach Results:
2025-07-08T20:02:43.3095537Z    🎯 Structured Generation: ✅ PASS
2025-07-08T20:02:43.3095990Z    🎯 Response Parsing: ✅ PASS
2025-07-08T20:02:43.3096467Z    🎯 Schema Validation: ✅ PASS (100% coverage)
2025-07-08T20:02:43.3096986Z    🎯 Sync Validation: ✅ PASS (100% confidence)
2025-07-08T20:02:43.3097695Z    🎯 Overall: ✅ 100% SUCCESS
2025-07-08T20:02:43.3097915Z 
2025-07-08T20:02:43.3098145Z 🎉 Combined Approach Implementation VERIFIED!
2025-07-08T20:02:43.3098574Z    The Cassian Problem is SOLVED!
2025-07-08T20:02:43.3098820Z 
2025-07-08T20:02:43.3099024Z 🧪 Testing failure case handling
2025-07-08T20:02:43.3099456Z    ✅ Graceful fallback for non-JSON response
2025-07-08T20:02:43.3100110Z    ✅ Validation still detects missing entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3100557Z 
2025-07-08T20:02:43.3100828Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T20:02:43.3101380Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3102087Z    ✅ Prompt injection created (836 chars)
2025-07-08T20:02:43.3102365Z 
2025-07-08T20:02:43.3102585Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T20:02:43.3103048Z    ✅ JSON parsed successfully
2025-07-08T20:02:43.3103630Z    ✅ Narrative extracted (380 chars)
2025-07-08T20:02:43.3104134Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3104454Z 
2025-07-08T20:02:43.3104707Z 🔧 Step 3: Schema validation of structured response
2025-07-08T20:02:43.3105193Z    ✅ Schema validation: True
2025-07-08T20:02:43.3105585Z    ✅ Narrative validation: True
2025-07-08T20:02:43.3105991Z    ✅ Coverage rate: 1.00
2025-07-08T20:02:43.3106191Z 
2025-07-08T20:02:43.3106432Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T20:02:43.3106916Z    ✅ All entities present: True
2025-07-08T20:02:43.3107389Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3107863Z    ✅ Confidence: 1.00
2025-07-08T20:02:43.3108595Z test_step4_narrative_sync_validation (__main__.TestCompleteCombinedApproach.test_step4_narrative_sync_validation)
2025-07-08T20:02:43.3111197Z Step 4: Additional validation with NarrativeSyncValidator ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step4_narrative_sync_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step4_narrative_sync_validation>>)
2025-07-08T20:02:43.3113648Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3113975Z ok
2025-07-08T20:02:43.3114105Z 
2025-07-08T20:02:43.3114298Z ----------------------------------------------------------------------
2025-07-08T20:02:43.3114732Z Ran 6 tests in 0.005s
2025-07-08T20:02:43.3114926Z 
2025-07-08T20:02:43.3115019Z OK
2025-07-08T20:02:43.3299020Z ✅ mvp_site/tests/test_complete_combined_approach.py passed
2025-07-08T20:02:43.3300695Z ----------------------------------------
2025-07-08T20:02:43.3301204Z Running mvp_site/tests/test_constants.py...
2025-07-08T20:02:43.3678920Z ...............
2025-07-08T20:02:43.3680504Z ----------------------------------------------------------------------
2025-07-08T20:02:43.3681986Z Ran 15 tests in 0.001s
2025-07-08T20:02:43.3682233Z 
2025-07-08T20:02:43.3682356Z OK
2025-07-08T20:02:43.3735198Z ✅ mvp_site/tests/test_constants.py passed
2025-07-08T20:02:43.3736768Z ----------------------------------------
2025-07-08T20:02:43.3737285Z Running mvp_site/tests/test_context_truncation.py...
2025-07-08T20:02:44.0064430Z 2025-07-08 20:02:44,005 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0082848Z 2025-07-08 20:02:44,005 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0084195Z 2025-07-08 20:02:44,005 - INFO - Initial context stats: Turns: 2, Tokens: 5 (est: 5), Core Memories: 0
2025-07-08T20:02:44.0084949Z 2025-07-08 20:02:44,005 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:44.0085617Z .2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0086644Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0087629Z 2025-07-08 20:02:44,006 - INFO - Initial context stats: Turns: 6, Tokens: 15 (est: 15), Core Memories: 0
2025-07-08T20:02:44.0088709Z 2025-07-08 20:02:44,006 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:44.0089296Z .2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0090272Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0091273Z 2025-07-08 20:02:44,006 - INFO - Initial context stats: Turns: 4, Tokens: 50 (est: 50), Core Memories: 0
2025-07-08T20:02:44.0092203Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Context (50 tokens) exceeds budget of 30 tokens. Truncating...
2025-07-08T20:02:44.0093076Z 2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0094297Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0095330Z 2025-07-08 20:02:44,006 - INFO - Final context stats after truncation: Turns: 4, Tokens: 67 (est: 67), Core Memories: 0
2025-07-08T20:02:44.0095978Z .
2025-07-08T20:02:44.0096299Z ----------------------------------------------------------------------
2025-07-08T20:02:44.0096734Z Ran 3 tests in 0.001s
2025-07-08T20:02:44.0096921Z 
2025-07-08T20:02:44.0097021Z OK
2025-07-08T20:02:44.0097408Z \n--- Running Test: test_does_not_truncate_if_within_all_limits ---
2025-07-08T20:02:44.0097900Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0098357Z \n--- Running Test: test_no_truncation_when_under_char_limit ---
2025-07-08T20:02:44.0098848Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0099340Z \n--- Running Test: test_truncates_when_few_turns_over_char_limit ---
2025-07-08T20:02:44.0099845Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0870168Z ✅ mvp_site/tests/test_context_truncation.py passed
2025-07-08T20:02:44.0872051Z ----------------------------------------
2025-07-08T20:02:44.0873082Z Running mvp_site/tests/test_data_integrity.py...
2025-07-08T20:02:44.3430735Z INFO: COMBAT STARTED - Participants: ['Player', 'Dragon Boss', 'Friendly Wolf']
2025-07-08T20:02:44.3432258Z INFO: COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dragon Boss(12)', 'Friendly Wolf(8)']
2025-07-08T20:02:44.3433649Z INFO: COMBAT CLEANUP: Marking Dragon Boss (enemy) as defeated
2025-07-08T20:02:44.3435164Z INFO: COMBAT CLEANUP: Removed Dragon Boss from combat_state.combatants
2025-07-08T20:02:44.3437431Z INFO: COMBAT CLEANUP: Removed Dragon Boss from npc_data
2025-07-08T20:02:44.3438239Z ..INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3438817Z   "custom_campaign_state": {
2025-07-08T20:02:44.3439251Z     "active_missions": {
2025-07-08T20:02:44.3439637Z       "rogue_mission": {
2025-07-08T20:02:44.3440029Z         "title": "This shouldn't be here"
2025-07-08T20:02:44.3440394Z       }
2025-07-08T20:02:44.3440646Z     }
2025-07-08T20:02:44.3440906Z   }
2025-07-08T20:02:44.3441159Z }
2025-07-08T20:02:44.3441540Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3442024Z   "active_missions": {
2025-07-08T20:02:44.3442317Z     "rogue_mission": {
2025-07-08T20:02:44.3442630Z       "title": "This shouldn't be here"
2025-07-08T20:02:44.3442977Z     }
2025-07-08T20:02:44.3443407Z   }
2025-07-08T20:02:44.3443633Z }
2025-07-08T20:02:44.3444512Z WARNING: ⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:02:44.3445219Z INFO: Adding new mission: rogue_mission
2025-07-08T20:02:44.3445649Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3446133Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3461981Z ........INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3462858Z   "npc_data": {
2025-07-08T20:02:44.3463669Z     "Grishnak": "defeated"
2025-07-08T20:02:44.3464316Z   }
2025-07-08T20:02:44.3464867Z }
2025-07-08T20:02:44.3465626Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3466649Z   "Grishnak": "defeated"
2025-07-08T20:02:44.3467267Z }
2025-07-08T20:02:44.3468297Z INFO: update_state: Preserving dict structure for key 'Grishnak', adding 'status' field.
2025-07-08T20:02:44.3470306Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3472124Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3474139Z .
2025-07-08T20:02:44.3475811Z ----------------------------------------------------------------------
2025-07-08T20:02:44.3477597Z Ran 11 tests in 0.002s
2025-07-08T20:02:44.3479332Z 
2025-07-08T20:02:44.3480461Z OK
2025-07-08T20:02:44.3828698Z ✅ mvp_site/tests/test_data_integrity.py passed
2025-07-08T20:02:44.3830912Z ----------------------------------------
2025-07-08T20:02:44.3831932Z Running mvp_site/tests/test_debug_hybrid_system.py...
2025-07-08T20:02:44.3932541Z Traceback (most recent call last):
2025-07-08T20:02:44.3934621Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/tests/test_debug_hybrid_system.py", line 5, in <module>
2025-07-08T20:02:44.3936768Z     import pytest
2025-07-08T20:02:44.3937154Z ModuleNotFoundError: No module named 'pytest'
2025-07-08T20:02:44.3956319Z ❌ mvp_site/tests/test_debug_hybrid_system.py failed
2025-07-08T20:02:44.3958105Z ----------------------------------------
2025-07-08T20:02:44.3959135Z Running mvp_site/tests/test_debug_logging.py...
2025-07-08T20:02:45.2650585Z ...
2025-07-08T20:02:45.2651690Z ----------------------------------------------------------------------
2025-07-08T20:02:45.2653112Z Ran 3 tests in 0.025s
2025-07-08T20:02:45.2653762Z 
2025-07-08T20:02:45.2654062Z OK
2025-07-08T20:02:45.3976963Z ✅ mvp_site/tests/test_debug_logging.py passed
2025-07-08T20:02:45.3978137Z ----------------------------------------
2025-07-08T20:02:45.3983755Z Running mvp_site/tests/test_debug_mode.py...
2025-07-08T20:02:46.2470380Z 2025-07-08 20:02:46,246 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2472436Z 2025-07-08 20:02:46,246 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2535810Z .2025-07-08 20:02:46,253 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2537701Z 2025-07-08 20:02:46,253 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2592309Z .2025-07-08 20:02:46,259 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2594638Z 2025-07-08 20:02:46,259 - WARNING - ⚠️ AI response missing debug content for campaign test_campaign_456
2025-07-08T20:02:46.2596322Z 2025-07-08 20:02:46,259 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:02:46.2597701Z 2025-07-08 20:02:46,259 - INFO - Response length: 40 characters (~10 tokens)
2025-07-08T20:02:46.2652354Z .2025-07-08 20:02:46,265 - INFO - Debug mode enabled for campaign test_campaign_456
2025-07-08T20:02:46.2672716Z 2025-07-08 20:02:46,267 - INFO - Debug mode disabled for campaign test_campaign_456
2025-07-08T20:02:46.2726200Z .2025-07-08 20:02:46,272 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2728014Z 2025-07-08 20:02:46,272 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': False, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2732514Z .
2025-07-08T20:02:46.2732924Z ----------------------------------------------------------------------
2025-07-08T20:02:46.2733672Z Ran 5 tests in 0.035s
2025-07-08T20:02:46.2733886Z 
2025-07-08T20:02:46.2734000Z OK
2025-07-08T20:02:46.3996036Z ✅ mvp_site/tests/test_debug_mode.py passed
2025-07-08T20:02:46.3999773Z ----------------------------------------
2025-07-08T20:02:46.4000567Z Running mvp_site/tests/test_debug_mode_e2e.py...
2025-07-08T20:02:47.2588233Z .2025-07-08 20:02:47,258 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:47.2590227Z 2025-07-08 20:02:47,258 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:47.2646707Z .2025-07-08 20:02:47,264 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:47.2648538Z 2025-07-08 20:02:47,264 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:47.2653448Z .
2025-07-08T20:02:47.2653845Z ----------------------------------------------------------------------
2025-07-08T20:02:47.2654333Z Ran 3 tests in 0.019s
2025-07-08T20:02:47.2654525Z 
2025-07-08T20:02:47.2654652Z OK
2025-07-08T20:02:47.3889954Z ✅ mvp_site/tests/test_debug_mode_e2e.py passed
2025-07-08T20:02:47.3891417Z ----------------------------------------
2025-07-08T20:02:47.3891949Z Running mvp_site/tests/test_debug_mode_game_state.py...
2025-07-08T20:02:47.4327878Z ......
2025-07-08T20:02:47.4329810Z ----------------------------------------------------------------------
2025-07-08T20:02:47.4330341Z Ran 6 tests in 0.000s
2025-07-08T20:02:47.4330558Z 
2025-07-08T20:02:47.4330681Z OK
2025-07-08T20:02:47.4395339Z ✅ mvp_site/tests/test_debug_mode_game_state.py passed
2025-07-08T20:02:47.4396259Z ----------------------------------------
2025-07-08T20:02:47.4397559Z Running mvp_site/tests/test_debug_mode_parser.py...
2025-07-08T20:02:47.4857915Z ...............
2025-07-08T20:02:47.4858798Z ----------------------------------------------------------------------
2025-07-08T20:02:47.4859653Z Ran 15 tests in 0.006s
2025-07-08T20:02:47.4860710Z 
2025-07-08T20:02:47.4860829Z OK
2025-07-08T20:02:47.4926839Z ✅ mvp_site/tests/test_debug_mode_parser.py passed
2025-07-08T20:02:47.4927689Z ----------------------------------------
2025-07-08T20:02:47.4928427Z Running mvp_site/tests/test_debug_mode_unit.py...
2025-07-08T20:02:47.5584595Z .......
2025-07-08T20:02:47.5585096Z ----------------------------------------------------------------------
2025-07-08T20:02:47.5585616Z Ran 7 tests in 0.001s
2025-07-08T20:02:47.5585836Z 
2025-07-08T20:02:47.5585954Z OK
2025-07-08T20:02:47.5689115Z ✅ mvp_site/tests/test_debug_mode_unit.py passed
2025-07-08T20:02:47.5690453Z ----------------------------------------
2025-07-08T20:02:47.5690958Z Running mvp_site/tests/test_debug_stripping.py...
2025-07-08T20:02:47.6186595Z ..............
2025-07-08T20:02:47.6187439Z ----------------------------------------------------------------------
2025-07-08T20:02:47.6188255Z Ran 14 tests in 0.001s
2025-07-08T20:02:47.6188811Z 
2025-07-08T20:02:47.6189143Z OK
2025-07-08T20:02:47.6258103Z ✅ mvp_site/tests/test_debug_stripping.py passed
2025-07-08T20:02:47.6258969Z ----------------------------------------
2025-07-08T20:02:47.6259752Z Running mvp_site/tests/test_debug_stripping_isolated.py...
2025-07-08T20:02:47.6634307Z .........
2025-07-08T20:02:47.6636511Z ----------------------------------------------------------------------
2025-07-08T20:02:47.6637061Z Ran 9 tests in 0.001s
2025-07-08T20:02:47.6637289Z 
2025-07-08T20:02:47.6637408Z OK
2025-07-08T20:02:47.6690518Z ✅ mvp_site/tests/test_debug_stripping_isolated.py passed
2025-07-08T20:02:47.6691877Z ----------------------------------------
2025-07-08T20:02:47.6692454Z Running mvp_site/tests/test_debug_stripping_json_safety.py...
2025-07-08T20:02:47.7355815Z .....
2025-07-08T20:02:47.7358928Z ----------------------------------------------------------------------
2025-07-08T20:02:47.7359691Z Ran 5 tests in 0.001s
2025-07-08T20:02:47.7360388Z 
2025-07-08T20:02:47.7360694Z OK
2025-07-08T20:02:47.7459292Z ✅ mvp_site/tests/test_debug_stripping_json_safety.py passed
2025-07-08T20:02:47.7460157Z ----------------------------------------
2025-07-08T20:02:47.7462019Z Running mvp_site/tests/test_decorators.py...
2025-07-08T20:02:47.8124189Z .........
2025-07-08T20:02:47.8125133Z ----------------------------------------------------------------------
2025-07-08T20:02:47.8126356Z Ran 9 tests in 0.004s
2025-07-08T20:02:47.8126806Z 
2025-07-08T20:02:47.8127228Z OK
2025-07-08T20:02:47.8227501Z ✅ mvp_site/tests/test_decorators.py passed
2025-07-08T20:02:47.8228862Z ----------------------------------------
2025-07-08T20:02:47.8229442Z Running mvp_site/tests/test_defensive_numeric_converter.py...
2025-07-08T20:02:47.9966118Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9967645Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9968722Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T20:02:47.9969802Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9970806Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9971750Z WARNING:root:⚠️ Invalid value 'Unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9972659Z WARNING:root:⚠️ Invalid value 'UNKNOWN' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9973905Z WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9974906Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'hp'. Using default: 1
2025-07-08T20:02:47.9975919Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9976868Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9977842Z WARNING:root:⚠️ Invalid value 'unknown' for field 'temp_hp'. Using default: 0
2025-07-08T20:02:47.9978759Z WARNING:root:⚠️ Invalid value 'None' for field 'temp_hp'. Using default: 0
2025-07-08T20:02:47.9979683Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:47.9980723Z WARNING:root:⚠️ Invalid value 'None' for field 'level'. Using default: 1
2025-07-08T20:02:47.9981716Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'level'. Using default: 1
2025-07-08T20:02:47.9982706Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'gold'. Using default: 0
2025-07-08T20:02:47.9983829Z WARNING:root:⚠️ Invalid value 'None' for field 'gold'. Using default: 0
2025-07-08T20:02:47.9984790Z WARNING:root:⚠️ Invalid value 'unknown' for field 'initiative'. Using default: 0
2025-07-08T20:02:47.9985711Z WARNING:root:⚠️ Invalid value 'None' for field 'initiative'. Using default: 0
2025-07-08T20:02:47.9986629Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:47.9987455Z WARNING:root:⚠️ Invalid value 'None' for field 'strength'. Using default: 10
2025-07-08T20:02:47.9988604Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T20:02:47.9989678Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9990636Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9991643Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9992693Z WARNING:root:⚠️ Invalid value 'unknown' for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9993825Z WARNING:root:⚠️ Invalid value 'None' for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9994875Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9995927Z WARNING:root:⚠️ Invalid value 'unknown' for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9996910Z WARNING:root:⚠️ Invalid value 'None' for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9997937Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9999246Z WARNING:root:⚠️ Invalid value 'unknown' for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0000164Z WARNING:root:⚠️ Invalid value 'None' for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0001135Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0002125Z WARNING:root:⚠️ Invalid value 'unknown' for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0003057Z WARNING:root:⚠️ Invalid value 'None' for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0004206Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0005392Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:48.0006290Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.0007181Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.0008138Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T20:02:48.0009068Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.0014177Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.0035667Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:48.0036619Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:48.0037618Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:48.0038288Z .
2025-07-08T20:02:48.0038660Z ----------------------------------------------------------------------
2025-07-08T20:02:48.0039198Z Ran 12 tests in 0.002s
2025-07-08T20:02:48.0039413Z 
2025-07-08T20:02:48.0041201Z OK
2025-07-08T20:02:48.0221140Z ✅ mvp_site/tests/test_defensive_numeric_converter.py passed
2025-07-08T20:02:48.0222551Z ----------------------------------------
2025-07-08T20:02:48.0223048Z Running mvp_site/tests/test_delete_fix.py...
2025-07-08T20:02:48.0327154Z === Testing __DELETE__ Token Processing ===
2025-07-08T20:02:48.0327595Z 
2025-07-08T20:02:48.0327747Z Test 1: Simple deletion
2025-07-08T20:02:48.0328705Z Before: {'npc_data': {'Drake 1': {'name': 'Drake 1', 'type': 'enemy'}, 'Drake 2': {'name': 'Drake 2', 'type': 'enemy'}, 'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T20:02:48.0329676Z Removed 'Drake 1' from state.
2025-07-08T20:02:48.0330058Z Removed 'Drake 2' from state.
2025-07-08T20:02:48.0330705Z After: {'npc_data': {'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T20:02:48.0331559Z ✅ Test 1 passed!
2025-07-08T20:02:48.0331759Z 
2025-07-08T20:02:48.0331902Z Test 2: Top-level deletion
2025-07-08T20:02:48.0332615Z Before: {'defeated_enemy': {'name': 'Orc', 'hp': 0}, 'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T20:02:48.0333576Z Removed 'defeated_enemy' from state.
2025-07-08T20:02:48.0334169Z After: {'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T20:02:48.0334797Z ✅ Test 2 passed!
2025-07-08T20:02:48.0334999Z 
2025-07-08T20:02:48.0335367Z 🎉 All tests passed! __DELETE__ token processing works correctly.
2025-07-08T20:02:48.0347327Z ✅ mvp_site/tests/test_delete_fix.py passed
2025-07-08T20:02:48.0348718Z ----------------------------------------
2025-07-08T20:02:48.0349268Z Running mvp_site/tests/test_delete_token_comprehensive.py...
2025-07-08T20:02:48.1049059Z .....
2025-07-08T20:02:48.1049572Z ----------------------------------------------------------------------
2025-07-08T20:02:48.1050142Z Ran 5 tests in 0.004s
2025-07-08T20:02:48.1050356Z 
2025-07-08T20:02:48.1053587Z OK
2025-07-08T20:02:48.1164765Z ✅ mvp_site/tests/test_delete_token_comprehensive.py passed
2025-07-08T20:02:48.1166373Z ----------------------------------------
2025-07-08T20:02:48.1166881Z Running mvp_site/tests/test_deployment_build.py...
2025-07-08T20:02:48.1651106Z ...
2025-07-08T20:02:48.1652966Z ----------------------------------------------------------------------
2025-07-08T20:02:48.1654887Z Ran 3 tests in 0.007s
2025-07-08T20:02:48.1656148Z 
2025-07-08T20:02:48.1657262Z OK
2025-07-08T20:02:48.1728437Z ✅ mvp_site/tests/test_deployment_build.py passed
2025-07-08T20:02:48.1729115Z ----------------------------------------
2025-07-08T20:02:48.1764054Z Running mvp_site/tests/test_dual_pass_generator.py...
2025-07-08T20:02:48.2414499Z .....................
2025-07-08T20:02:48.2416090Z ----------------------------------------------------------------------
2025-07-08T20:02:48.2417990Z Ran 21 tests in 0.003s
2025-07-08T20:02:48.2419166Z 
2025-07-08T20:02:48.2420261Z OK
2025-07-08T20:02:48.2515323Z ✅ mvp_site/tests/test_dual_pass_generator.py passed
2025-07-08T20:02:48.2515812Z ----------------------------------------
2025-07-08T20:02:48.2516424Z Running mvp_site/tests/test_entity_classes.py...
2025-07-08T20:02:48.4328286Z ......WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:48.4331995Z .....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.4334198Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.4335230Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T20:02:48.4339921Z ..........WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:48.4341792Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:48.4342776Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:48.4343594Z .
2025-07-08T20:02:48.4343934Z ----------------------------------------------------------------------
2025-07-08T20:02:48.4344406Z Ran 22 tests in 0.002s
2025-07-08T20:02:48.4344606Z 
2025-07-08T20:02:48.4344707Z OK
2025-07-08T20:02:48.4563673Z ✅ mvp_site/tests/test_entity_classes.py passed
2025-07-08T20:02:48.4565033Z ----------------------------------------
2025-07-08T20:02:48.4565569Z Running mvp_site/tests/test_entity_instructions.py...
2025-07-08T20:02:48.5226875Z ............................
2025-07-08T20:02:48.5228398Z ----------------------------------------------------------------------
2025-07-08T20:02:48.5228925Z Ran 28 tests in 0.002s
2025-07-08T20:02:48.5229124Z 
2025-07-08T20:02:48.5229238Z OK
2025-07-08T20:02:48.5337180Z ✅ mvp_site/tests/test_entity_instructions.py passed
2025-07-08T20:02:48.5338302Z ----------------------------------------
2025-07-08T20:02:48.5339121Z Running mvp_site/tests/test_entity_preloader.py...
2025-07-08T20:02:48.7121835Z .............
2025-07-08T20:02:48.7125032Z ----------------------------------------------------------------------
2025-07-08T20:02:48.7125509Z Ran 13 tests in 0.003s
2025-07-08T20:02:48.7125724Z 
2025-07-08T20:02:48.7125832Z OK
2025-07-08T20:02:48.7341618Z ✅ mvp_site/tests/test_entity_preloader.py passed
2025-07-08T20:02:48.7343068Z ----------------------------------------
2025-07-08T20:02:48.7343789Z Running mvp_site/tests/test_entity_tracking.py...
2025-07-08T20:02:48.9128601Z test_entity_id_format_standardization (__main__.TestEntityTracking.test_entity_id_format_standardization)
2025-07-08T20:02:48.9133964Z Test that entity IDs follow underscore format like 'pc_name_001' ... ok
2025-07-08T20:02:48.9135575Z test_existing_string_ids_preserved (__main__.TestEntityTracking.test_existing_string_ids_preserved)
2025-07-08T20:02:48.9137921Z Test that existing string_ids from game state are preserved ... ok
2025-07-08T20:02:48.9138876Z test_expected_entities_filtering (__main__.TestEntityTracking.test_expected_entities_filtering)
2025-07-08T20:02:48.9139881Z Test that expected entities correctly filters visible, conscious entities ... ok
2025-07-08T20:02:48.9140803Z test_get_validation_info (__main__.TestEntityTracking.test_get_validation_info)
2025-07-08T20:02:48.9141659Z Test get_validation_info function returns correct information. ... ok
2025-07-08T20:02:48.9142860Z test_integration_flow (__main__.TestEntityTracking.test_integration_flow)
2025-07-08T20:02:48.9154807Z Test the complete entity tracking flow ... ok
2025-07-08T20:02:48.9161279Z test_manifest_prompt_format (__main__.TestEntityTracking.test_manifest_prompt_format)
2025-07-08T20:02:48.9162089Z Test manifest to prompt format conversion ... ok
2025-07-08T20:02:48.9162864Z test_narrative_sync_validator (__main__.TestEntityTracking.test_narrative_sync_validator)
2025-07-08T20:02:48.9164434Z Test NarrativeSyncValidator functionality ... ok
2025-07-08T20:02:48.9165272Z 🧪 Testing Entity Tracking Production Implementation
2025-07-08T20:02:48.9166652Z test_scene_manifest_creation (__main__.TestEntityTracking.test_scene_manifest_creation)
2025-07-08T20:02:48.9167300Z ============================================================
2025-07-08T20:02:48.9168090Z Test SceneManifest creation from game state ... ok
2025-07-08T20:02:48.9168605Z ✅ Integration test passed!
2025-07-08T20:02:48.9169729Z test_validator_presence_detection (__main__.TestEntityTracking.test_validator_presence_detection)
2025-07-08T20:02:48.9170490Z    Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:48.9171363Z Test validator's presence detection logic ... ok
2025-07-08T20:02:48.9178686Z 
2025-07-08T20:02:48.9178938Z ----------------------------------------------------------------------
2025-07-08T20:02:48.9179392Z Ran 9 tests in 0.004s
2025-07-08T20:02:48.9179593Z 
2025-07-08T20:02:48.9179695Z OK
2025-07-08T20:02:48.9180000Z    Found entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:48.9180779Z    Confidence: 1.00
2025-07-08T20:02:48.9414768Z ✅ mvp_site/tests/test_entity_tracking.py passed
2025-07-08T20:02:48.9416192Z ----------------------------------------
2025-07-08T20:02:48.9416757Z Running mvp_site/tests/test_entity_tracking_generic.py...
2025-07-08T20:02:49.1169222Z ..........
2025-07-08T20:02:49.1170120Z ----------------------------------------------------------------------
2025-07-08T20:02:49.1170986Z Ran 10 tests in 0.001s
2025-07-08T20:02:49.1171371Z 
2025-07-08T20:02:49.1171682Z OK
2025-07-08T20:02:49.1415720Z ✅ mvp_site/tests/test_entity_tracking_generic.py passed
2025-07-08T20:02:49.1417425Z ----------------------------------------
2025-07-08T20:02:49.1417925Z Running mvp_site/tests/test_entity_validator.py...
2025-07-08T20:02:49.2062647Z .Entity validation failed after 2 retries. Missing: ['Cassian']
2025-07-08T20:02:49.2069539Z .Entity validation failed after 0 retries. Missing: ['Cassian']
2025-07-08T20:02:49.2088252Z ...............
2025-07-08T20:02:49.2089031Z ----------------------------------------------------------------------
2025-07-08T20:02:49.2090195Z Ran 17 tests in 0.004s
2025-07-08T20:02:49.2090669Z 
2025-07-08T20:02:49.2091004Z OK
2025-07-08T20:02:49.2199823Z ✅ mvp_site/tests/test_entity_validator.py passed
2025-07-08T20:02:49.2201165Z ----------------------------------------
2025-07-08T20:02:49.2201680Z Running mvp_site/tests/test_extra_json_fields.py...
2025-07-08T20:02:49.2639919Z ..
2025-07-08T20:02:49.2640934Z ----------------------------------------------------------------------
2025-07-08T20:02:49.2641632Z Ran 2 tests in 0.000s
2025-07-08T20:02:49.2642031Z 
2025-07-08T20:02:49.2642339Z OK
2025-07-08T20:02:49.2709210Z ✅ mvp_site/tests/test_extra_json_fields.py passed
2025-07-08T20:02:49.2710788Z ----------------------------------------
2025-07-08T20:02:49.2711322Z Running mvp_site/tests/test_fallback_logic_json_bug.py...
2025-07-08T20:02:49.3162871Z ....
2025-07-08T20:02:49.3163798Z ----------------------------------------------------------------------
2025-07-08T20:02:49.3165769Z Ran 4 tests in 0.001s
2025-07-08T20:02:49.3166265Z 
2025-07-08T20:02:49.3166500Z OK
2025-07-08T20:02:49.3231215Z ✅ mvp_site/tests/test_fallback_logic_json_bug.py passed
2025-07-08T20:02:49.3232634Z ----------------------------------------
2025-07-08T20:02:49.3233410Z Running mvp_site/tests/test_firestore_helper_functions_fixed.py...
2025-07-08T20:02:49.5805714Z test_perform_append_all_duplicates (__main__.TestFirestoreHelperFunctions.test_perform_append_all_duplicates)
2025-07-08T20:02:49.5813795Z Test _perform_append when all items are duplicates ... ok
2025-07-08T20:02:49.5815420Z test_perform_append_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_complex_objects)
2025-07-08T20:02:49.5818581Z Test _perform_append with complex objects ... ok
2025-07-08T20:02:49.5819841Z test_perform_append_deduplicate_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_complex_objects)
2025-07-08T20:02:49.5826772Z Test _perform_append deduplication with complex objects ... ok
2025-07-08T20:02:49.5829619Z test_perform_append_deduplicate_false (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_false)
2025-07-08T20:02:49.5830731Z Test _perform_append with deduplication disabled ... ok
2025-07-08T20:02:49.5831865Z test_perform_append_deduplicate_true (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_true)
2025-07-08T20:02:49.5837831Z Test _perform_append with deduplication enabled ... ok
2025-07-08T20:02:49.5840710Z test_perform_append_empty_list (__main__.TestFirestoreHelperFunctions.test_perform_append_empty_list)
2025-07-08T20:02:49.5842039Z Test _perform_append with empty items list ... ok
2025-07-08T20:02:49.5842951Z test_perform_append_list_items (__main__.TestFirestoreHelperFunctions.test_perform_append_list_items)
2025-07-08T20:02:49.5849098Z Test _perform_append with list of items ... ok
2025-07-08T20:02:49.5850469Z test_perform_append_none_item (__main__.TestFirestoreHelperFunctions.test_perform_append_none_item)
2025-07-08T20:02:49.5853488Z Test _perform_append with None as single item ... ok
2025-07-08T20:02:49.5854566Z test_perform_append_single_item (__main__.TestFirestoreHelperFunctions.test_perform_append_single_item)
2025-07-08T20:02:49.5860061Z Test _perform_append with single item (not a list) ... ok
2025-07-08T20:02:49.5862378Z test_truncate_log_json_circular_reference (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_circular_reference)
2025-07-08T20:02:49.5863627Z Test _truncate_log_json with circular reference ... ok
2025-07-08T20:02:49.5864533Z test_truncate_log_json_empty_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_empty_data)
2025-07-08T20:02:49.5865419Z Test _truncate_log_json with empty data ... ok
2025-07-08T20:02:49.5866331Z test_truncate_log_json_exact_boundary (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_exact_boundary)
2025-07-08T20:02:49.5867285Z Test _truncate_log_json with exactly max_lines ... ok
2025-07-08T20:02:49.5868203Z test_truncate_log_json_invalid_json (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_invalid_json)
2025-07-08T20:02:49.5869316Z Test _truncate_log_json exception handling with non-serializable data ... ok
2025-07-08T20:02:49.5873892Z test_truncate_log_json_large_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_large_data)
2025-07-08T20:02:49.5880648Z Test _truncate_log_json with data exceeding max_lines ... ok
2025-07-08T20:02:49.5881596Z test_truncate_log_json_max_lines_parameter (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_max_lines_parameter)
2025-07-08T20:02:49.5882532Z Test _truncate_log_json respects max_lines parameter ... ok
2025-07-08T20:02:49.5883555Z test_truncate_log_json_none_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_none_data)
2025-07-08T20:02:49.5884283Z Test _truncate_log_json with None ... ok
2025-07-08T20:02:49.5884996Z test_truncate_log_json_small_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_small_data)
2025-07-08T20:02:49.5885826Z Test _truncate_log_json with data smaller than max_lines ... ok
2025-07-08T20:02:49.5886203Z 
2025-07-08T20:02:49.5886402Z ----------------------------------------------------------------------
2025-07-08T20:02:49.5886840Z Ran 17 tests in 0.007s
2025-07-08T20:02:49.5887039Z 
2025-07-08T20:02:49.5887157Z OK
2025-07-08T20:02:49.6258862Z ✅ mvp_site/tests/test_firestore_helper_functions_fixed.py passed
2025-07-08T20:02:49.6260841Z ----------------------------------------
2025-07-08T20:02:49.6261341Z Running mvp_site/tests/test_firestore_helpers.py...
2025-07-08T20:02:49.7014803Z ...............
2025-07-08T20:02:49.7017446Z ----------------------------------------------------------------------
2025-07-08T20:02:49.7017939Z Ran 15 tests in 0.008s
2025-07-08T20:02:49.7018141Z 
2025-07-08T20:02:49.7018259Z OK
2025-07-08T20:02:49.7119677Z ✅ mvp_site/tests/test_firestore_helpers.py passed
2025-07-08T20:02:49.7120987Z ----------------------------------------
2025-07-08T20:02:49.7121547Z Running mvp_site/tests/test_firestore_mission_handler.py...
2025-07-08T20:02:49.9707703Z test_find_existing_mission_index_empty_list (__main__.TestMissionHandler.test_find_existing_mission_index_empty_list)
2025-07-08T20:02:49.9710670Z Test find_existing_mission_index with empty list ... ok
2025-07-08T20:02:49.9711584Z test_find_existing_mission_index_found (__main__.TestMissionHandler.test_find_existing_mission_index_found)
2025-07-08T20:02:49.9712561Z Test find_existing_mission_index when mission exists ... ok
2025-07-08T20:02:49.9713875Z test_find_existing_mission_index_invalid_mission_objects (__main__.TestMissionHandler.test_find_existing_mission_index_invalid_mission_objects)
2025-07-08T20:02:49.9715069Z Test find_existing_mission_index with non-dict items in list ... ok
2025-07-08T20:02:49.9716193Z test_find_existing_mission_index_missing_mission_id (__main__.TestMissionHandler.test_find_existing_mission_index_missing_mission_id)
2025-07-08T20:02:49.9717299Z Test find_existing_mission_index when dicts lack mission_id ... ok
2025-07-08T20:02:49.9718313Z test_find_existing_mission_index_not_found (__main__.TestMissionHandler.test_find_existing_mission_index_not_found)
2025-07-08T20:02:49.9719325Z Test find_existing_mission_index when mission doesn't exist ... ok
2025-07-08T20:02:49.9720316Z test_handle_active_missions_conversion_dict (__main__.TestMissionHandler.test_handle_active_missions_conversion_dict)
2025-07-08T20:02:49.9721578Z Test handle_active_missions_conversion with dict value ... ok
2025-07-08T20:02:49.9722814Z test_handle_active_missions_conversion_invalid_type (__main__.TestMissionHandler.test_handle_active_missions_conversion_invalid_type)
2025-07-08T20:02:49.9733071Z Test handle_active_missions_conversion with non-dict, non-list value ... ok
2025-07-08T20:02:49.9736278Z test_handle_missions_dict_conversion (__main__.TestMissionHandler.test_handle_missions_dict_conversion)
2025-07-08T20:02:49.9742873Z Test handle_missions_dict_conversion with dict of missions ... ok
2025-07-08T20:02:49.9744121Z test_handle_missions_dict_conversion_empty (__main__.TestMissionHandler.test_handle_missions_dict_conversion_empty)
2025-07-08T20:02:49.9745154Z Test handle_missions_dict_conversion with empty dict ... ok
2025-07-08T20:02:49.9746236Z test_handle_missions_dict_conversion_mixed_types (__main__.TestMissionHandler.test_handle_missions_dict_conversion_mixed_types)
2025-07-08T20:02:49.9749605Z Test handle_missions_dict_conversion with various invalid types ... ok
2025-07-08T20:02:49.9760711Z test_initialize_missions_list_already_list (__main__.TestMissionHandler.test_initialize_missions_list_already_list)
2025-07-08T20:02:49.9761771Z Test initialize_missions_list when key already has a list ... ok
2025-07-08T20:02:49.9762786Z test_initialize_missions_list_missing_key (__main__.TestMissionHandler.test_initialize_missions_list_missing_key)
2025-07-08T20:02:49.9763963Z Test initialize_missions_list when key doesn't exist ... ok
2025-07-08T20:02:49.9764920Z test_initialize_missions_list_non_list_value (__main__.TestMissionHandler.test_initialize_missions_list_non_list_value)
2025-07-08T20:02:49.9765945Z Test initialize_missions_list when key exists but isn't a list ... ok
2025-07-08T20:02:49.9766822Z test_initialize_missions_list_none_value (__main__.TestMissionHandler.test_initialize_missions_list_none_value)
2025-07-08T20:02:49.9767695Z Test initialize_missions_list when key has None value ... ok
2025-07-08T20:02:49.9768896Z test_process_mission_data_adds_missing_id (__main__.TestMissionHandler.test_process_mission_data_adds_missing_id)
2025-07-08T20:02:49.9769745Z Test process_mission_data adds mission_id if missing ... ok
2025-07-08T20:02:49.9770549Z test_process_mission_data_new_mission (__main__.TestMissionHandler.test_process_mission_data_new_mission)
2025-07-08T20:02:49.9771335Z Test process_mission_data adding a new mission ... ok
2025-07-08T20:02:49.9772146Z test_process_mission_data_update_existing (__main__.TestMissionHandler.test_process_mission_data_update_existing)
2025-07-08T20:02:49.9777931Z Test process_mission_data updating an existing mission ... ok
2025-07-08T20:02:49.9778607Z 
2025-07-08T20:02:49.9778820Z ----------------------------------------------------------------------
2025-07-08T20:02:49.9779289Z Ran 17 tests in 0.006s
2025-07-08T20:02:49.9779495Z 
2025-07-08T20:02:49.9779600Z OK
2025-07-08T20:02:50.0170212Z ✅ mvp_site/tests/test_firestore_mission_handler.py passed
2025-07-08T20:02:50.0171786Z ----------------------------------------
2025-07-08T20:02:50.0172296Z Running mvp_site/tests/test_firestore_service.py...
2025-07-08T20:02:50.2823561Z .............WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2826040Z .WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2829616Z .....WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2830598Z ..
2025-07-08T20:02:50.2831046Z ----------------------------------------------------------------------
2025-07-08T20:02:50.2831659Z Ran 21 tests in 0.003s
2025-07-08T20:02:50.2833443Z 
2025-07-08T20:02:50.2834223Z OK
2025-07-08T20:02:50.3221878Z ✅ mvp_site/tests/test_firestore_service.py passed
2025-07-08T20:02:50.3223696Z ----------------------------------------
2025-07-08T20:02:50.3224269Z Running mvp_site/tests/test_firestore_state_helpers.py...
2025-07-08T20:02:50.5814884Z test_handle_append_syntax_core_memories_dedup (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_core_memories_dedup)
2025-07-08T20:02:50.5826364Z Test _handle_append_syntax with core_memories uses deduplication ... ok
2025-07-08T20:02:50.5829081Z test_handle_append_syntax_creates_list (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_creates_list)
2025-07-08T20:02:50.5835545Z Test _handle_append_syntax creates list if missing ... ok
2025-07-08T20:02:50.5837109Z test_handle_append_syntax_no_append_key (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_no_append_key)
2025-07-08T20:02:50.5839699Z Test _handle_append_syntax with dict missing 'append' key ... ok
2025-07-08T20:02:50.5842595Z test_handle_append_syntax_not_dict (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_not_dict)
2025-07-08T20:02:50.5843766Z Test _handle_append_syntax with non-dict value ... ok
2025-07-08T20:02:50.5844658Z test_handle_append_syntax_valid (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_valid)
2025-07-08T20:02:50.5846679Z Test _handle_append_syntax with valid append syntax ... ok
2025-07-08T20:02:50.5847940Z test_handle_core_memories_safeguard_creates_list (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_creates_list)
2025-07-08T20:02:50.5856638Z Test _handle_core_memories_safeguard creates list if missing ... ok
2025-07-08T20:02:50.5858528Z test_handle_core_memories_safeguard_other_key (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_other_key)
2025-07-08T20:02:50.5859879Z Test _handle_core_memories_safeguard ignores other keys ... ok
2025-07-08T20:02:50.5861179Z test_handle_core_memories_safeguard_triggered (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_triggered)
2025-07-08T20:02:50.5867897Z Test _handle_core_memories_safeguard prevents overwrite ... ok
2025-07-08T20:02:50.5869602Z test_handle_delete_token_deletes_existing (__main__.TestFirestoreStateHelpers.test_handle_delete_token_deletes_existing)
2025-07-08T20:02:50.5874897Z Test _handle_delete_token removes existing key ... ok
2025-07-08T20:02:50.5877599Z test_handle_delete_token_missing_key (__main__.TestFirestoreStateHelpers.test_handle_delete_token_missing_key)
2025-07-08T20:02:50.5880099Z Test _handle_delete_token with non-existent key ... ok
2025-07-08T20:02:50.5882550Z test_handle_delete_token_wrong_value (__main__.TestFirestoreStateHelpers.test_handle_delete_token_wrong_value)
2025-07-08T20:02:50.5883963Z Test _handle_delete_token with value not DELETE_TOKEN ... ok
2025-07-08T20:02:50.5886217Z test_handle_dict_merge_existing_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_existing_dict)
2025-07-08T20:02:50.5887154Z Test _handle_dict_merge merges with existing dict ... ok
2025-07-08T20:02:50.5888022Z test_handle_dict_merge_new_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_new_dict)
2025-07-08T20:02:50.5894925Z Test _handle_dict_merge creates new dict when key missing ... ok
2025-07-08T20:02:50.5895933Z test_handle_dict_merge_non_dict_value (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_non_dict_value)
2025-07-08T20:02:50.5896858Z Test _handle_dict_merge with non-dict value ... ok
2025-07-08T20:02:50.5897813Z test_handle_dict_merge_overwrite_non_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_overwrite_non_dict)
2025-07-08T20:02:50.5898891Z Test _handle_dict_merge overwrites non-dict existing value ... ok
2025-07-08T20:02:50.5899991Z test_handle_string_to_dict_update_missing_key (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_missing_key)
2025-07-08T20:02:50.5901059Z Test _handle_string_to_dict_update with missing key ... ok
2025-07-08T20:02:50.5902162Z test_handle_string_to_dict_update_non_dict_existing (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_non_dict_existing)
2025-07-08T20:02:50.5903527Z Test _handle_string_to_dict_update with non-dict existing value ... ok
2025-07-08T20:02:50.5904758Z test_handle_string_to_dict_update_overwrites_status (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_overwrites_status)
2025-07-08T20:02:50.5911280Z Test _handle_string_to_dict_update overwrites existing status ... ok
2025-07-08T20:02:50.5915816Z test_handle_string_to_dict_update_preserves_dict (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_preserves_dict)
2025-07-08T20:02:50.5916941Z Test _handle_string_to_dict_update preserves dict structure ... ok
2025-07-08T20:02:50.5917985Z test_update_state_with_changes_integration (__main__.TestFirestoreStateHelpers.test_update_state_with_changes_integration)
2025-07-08T20:02:50.5919107Z Test update_state_with_changes with various scenarios ... ok
2025-07-08T20:02:50.5920515Z 
2025-07-08T20:02:50.5920838Z ----------------------------------------------------------------------
2025-07-08T20:02:50.5921975Z Ran 20 tests in 0.011s
2025-07-08T20:02:50.5922204Z 
2025-07-08T20:02:50.5922308Z OK
2025-07-08T20:02:50.6307309Z ✅ mvp_site/tests/test_firestore_state_helpers.py passed
2025-07-08T20:02:50.6308771Z ----------------------------------------
2025-07-08T20:02:50.6309372Z Running mvp_site/tests/test_firestore_state_helpers_edge_cases.py...
2025-07-08T20:02:50.8917793Z test_handle_append_syntax_nested_append_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_append_syntax_nested_append_structure)
2025-07-08T20:02:50.8928122Z Test append syntax with nested append structure ... ok
2025-07-08T20:02:50.8930481Z test_handle_dict_merge_with_delete_token_in_value (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_dict_merge_with_delete_token_in_value)
2025-07-08T20:02:50.8935975Z Test dict merge where new dict contains DELETE_TOKEN ... ok
2025-07-08T20:02:50.8938365Z test_update_state_complex_nested_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_complex_nested_structure)
2025-07-08T20:02:50.8944514Z Test deeply nested structure updates ... ok
2025-07-08T20:02:50.8946720Z test_update_state_core_memories_multiple_attempts (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_core_memories_multiple_attempts)
2025-07-08T20:02:50.8951100Z Test multiple types of core_memories updates in one call ... ok
2025-07-08T20:02:50.8953170Z test_update_state_delete_nested_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_delete_nested_keys)
2025-07-08T20:02:50.8957423Z Test DELETE_TOKEN on nested dictionary keys ... ok
2025-07-08T20:02:50.8959275Z test_update_state_empty_changes (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_empty_changes)
2025-07-08T20:02:50.8960572Z Test update_state_with_changes with empty changes dict ... ok
2025-07-08T20:02:50.8961572Z test_update_state_list_overwrite (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_list_overwrite)
2025-07-08T20:02:50.8962604Z Test that non-append list updates do overwrite ... ok
2025-07-08T20:02:50.8965065Z test_update_state_nested_append_syntax (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_nested_append_syntax)
2025-07-08T20:02:50.8968096Z Test nested append syntax in dict values ... ok
2025-07-08T20:02:50.8969919Z test_update_state_none_values (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_none_values)
2025-07-08T20:02:50.8970836Z Test update_state_with_changes with None values ... ok
2025-07-08T20:02:50.8971852Z test_update_state_preserve_unchanged_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_preserve_unchanged_keys)
2025-07-08T20:02:50.8972843Z Test that unchanged keys are preserved ... ok
2025-07-08T20:02:50.8974378Z 
2025-07-08T20:02:50.8974708Z ----------------------------------------------------------------------
2025-07-08T20:02:50.8975836Z Ran 10 tests in 0.006s
2025-07-08T20:02:50.8976042Z 
2025-07-08T20:02:50.8976158Z OK
2025-07-08T20:02:50.9350648Z ✅ mvp_site/tests/test_firestore_state_helpers_edge_cases.py passed
2025-07-08T20:02:50.9352168Z ----------------------------------------
2025-07-08T20:02:50.9352697Z Running mvp_site/tests/test_game_state.py...
2025-07-08T20:02:51.8634366Z ....................2025-07-08 20:02:51,863 - INFO - Performing one-time cleanup. Deleting 3 legacy keys: ['player.name', 'player.level', 'world.location']
2025-07-08T20:02:51.8636830Z .2025-07-08 20:02:51,863 - INFO - Performing one-time cleanup. Deleting 1 legacy keys: ['world_time']
2025-07-08T20:02:51.8640037Z .......2025-07-08 20:02:51,863 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: invalid_key = invalid_json
2025-07-08T20:02:51.8642637Z ....2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 7 new items to 'test_key'.
2025-07-08T20:02:51.8645251Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: No new items were added to 'test_key' (duplicates may have been found).
2025-07-08T20:02:51.8646309Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T20:02:51.8647575Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T20:02:51.8649497Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T20:02:51.8650513Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T20:02:51.8651347Z .2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8652005Z   "core_memories": [
2025-07-08T20:02:51.8652362Z     "memory2",
2025-07-08T20:02:51.8652680Z     "memory3"
2025-07-08T20:02:51.8652988Z   ]
2025-07-08T20:02:51.8653438Z }
2025-07-08T20:02:51.8654576Z 2025-07-08 20:02:51,864 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8655825Z 2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T20:02:51.8656564Z 2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8657319Z .2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8659344Z   "core_memories": [
2025-07-08T20:02:51.8660119Z     "new_memory1",
2025-07-08T20:02:51.8660470Z     "new_memory2"
2025-07-08T20:02:51.8660793Z   ]
2025-07-08T20:02:51.8661063Z }
2025-07-08T20:02:51.8662180Z 2025-07-08 20:02:51,865 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8663642Z 2025-07-08 20:02:51,865 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T20:02:51.8664486Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8665578Z .2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8666231Z   "core_memories": [
2025-07-08T20:02:51.8666586Z     "memory1",
2025-07-08T20:02:51.8666902Z     "memory2"
2025-07-08T20:02:51.8667216Z   ]
2025-07-08T20:02:51.8667488Z }
2025-07-08T20:02:51.8668555Z 2025-07-08 20:02:51,865 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8669772Z 2025-07-08 20:02:51,865 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T20:02:51.8670599Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8671385Z .2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8671978Z   "level1": {
2025-07-08T20:02:51.8672273Z     "level2": {
2025-07-08T20:02:51.8672590Z       "level3": {
2025-07-08T20:02:51.8672923Z         "value": "new",
2025-07-08T20:02:51.8673580Z         "add": "this"
2025-07-08T20:02:51.8673939Z       }
2025-07-08T20:02:51.8674226Z     }
2025-07-08T20:02:51.8674516Z   }
2025-07-08T20:02:51.8674805Z }
2025-07-08T20:02:51.8675294Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8675927Z   "level2": {
2025-07-08T20:02:51.8676270Z     "level3": {
2025-07-08T20:02:51.8676598Z       "value": "new",
2025-07-08T20:02:51.8676932Z       "add": "this"
2025-07-08T20:02:51.8677247Z     }
2025-07-08T20:02:51.8677518Z   }
2025-07-08T20:02:51.8677778Z }
2025-07-08T20:02:51.8678268Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8678888Z   "level3": {
2025-07-08T20:02:51.8679204Z     "value": "new",
2025-07-08T20:02:51.8679534Z     "add": "this"
2025-07-08T20:02:51.8679852Z   }
2025-07-08T20:02:51.8680122Z }
2025-07-08T20:02:51.8680608Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8681214Z   "value": "new",
2025-07-08T20:02:51.8681521Z   "add": "this"
2025-07-08T20:02:51.8681818Z }
2025-07-08T20:02:51.8682243Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8684771Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8685578Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8686330Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8687110Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8687801Z   "items": {
2025-07-08T20:02:51.8688128Z     "append": [
2025-07-08T20:02:51.8688453Z       "potion",
2025-07-08T20:02:51.8688768Z       "key"
2025-07-08T20:02:51.8689067Z     ]
2025-07-08T20:02:51.8689344Z   }
2025-07-08T20:02:51.8689629Z }
2025-07-08T20:02:51.8690153Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'items'.
2025-07-08T20:02:51.8690975Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'items'.
2025-07-08T20:02:51.8691756Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8692546Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8693591Z   "key": {
2025-07-08T20:02:51.8693901Z     "append": [
2025-07-08T20:02:51.8694216Z       "item1"
2025-07-08T20:02:51.8694528Z     ]
2025-07-08T20:02:51.8694805Z   }
2025-07-08T20:02:51.8695077Z }
2025-07-08T20:02:51.8695572Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'key'.
2025-07-08T20:02:51.8696336Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'key'.
2025-07-08T20:02:51.8697069Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8697843Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8698706Z   "new_list": {
2025-07-08T20:02:51.8699048Z     "append": [
2025-07-08T20:02:51.8699367Z       "item1",
2025-07-08T20:02:51.8699676Z       "item2"
2025-07-08T20:02:51.8699976Z     ]
2025-07-08T20:02:51.8700259Z   }
2025-07-08T20:02:51.8700512Z }
2025-07-08T20:02:51.8700988Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'new_list'.
2025-07-08T20:02:51.8701750Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'new_list'.
2025-07-08T20:02:51.8702437Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8703174Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8703899Z   "player": {
2025-07-08T20:02:51.8704163Z     "level": 2,
2025-07-08T20:02:51.8704411Z     "gold": 100
2025-07-08T20:02:51.8704664Z   },
2025-07-08T20:02:51.8704904Z   "inventory": {
2025-07-08T20:02:51.8705183Z     "append": [
2025-07-08T20:02:51.8705454Z       "potion"
2025-07-08T20:02:51.8705716Z     ]
2025-07-08T20:02:51.8705937Z   },
2025-07-08T20:02:51.8706178Z   "core_memories": [
2025-07-08T20:02:51.8706469Z     "memory1",
2025-07-08T20:02:51.8706730Z     "memory2"
2025-07-08T20:02:51.8706977Z   ],
2025-07-08T20:02:51.8707230Z   "simple_value": "new",
2025-07-08T20:02:51.8707536Z   "new_key": "new_value"
2025-07-08T20:02:51.8707830Z }
2025-07-08T20:02:51.8708230Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8708743Z   "level": 2,
2025-07-08T20:02:51.8708995Z   "gold": 100
2025-07-08T20:02:51.8709242Z }
2025-07-08T20:02:51.8709595Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8710239Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'inventory'.
2025-07-08T20:02:51.8710923Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'inventory'.
2025-07-08T20:02:51.8712108Z 2025-07-08 20:02:51,866 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8713114Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T20:02:51.8713953Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8714601Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8715092Z   "player": {
2025-07-08T20:02:51.8715343Z     "level": 2,
2025-07-08T20:02:51.8715617Z     "stats": {
2025-07-08T20:02:51.8715865Z       "mp": 50
2025-07-08T20:02:51.8716100Z     }
2025-07-08T20:02:51.8716323Z   },
2025-07-08T20:02:51.8716551Z   "world": {
2025-07-08T20:02:51.8716802Z     "weather": "sunny"
2025-07-08T20:02:51.8717083Z   }
2025-07-08T20:02:51.8717321Z }
2025-07-08T20:02:51.8717729Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8718234Z   "level": 2,
2025-07-08T20:02:51.8718501Z   "stats": {
2025-07-08T20:02:51.8718749Z     "mp": 50
2025-07-08T20:02:51.8718988Z   }
2025-07-08T20:02:51.8719202Z }
2025-07-08T20:02:51.8719577Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8720088Z   "mp": 50
2025-07-08T20:02:51.8720321Z }
2025-07-08T20:02:51.8720904Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8721494Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8722126Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8722622Z   "weather": "sunny"
2025-07-08T20:02:51.8722891Z }
2025-07-08T20:02:51.8723376Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8723970Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8724595Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8725302Z   "key1": "new_value",
2025-07-08T20:02:51.8725586Z   "key3": "added_value"
2025-07-08T20:02:51.8725864Z }
2025-07-08T20:02:51.8726212Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8726822Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8727345Z   "game_data": {
2025-07-08T20:02:51.8727614Z     "player_info": {
2025-07-08T20:02:51.8727900Z       "character_sheet": {
2025-07-08T20:02:51.8728222Z         "name": "UpdatedHero",
2025-07-08T20:02:51.8728549Z         "level": 5,
2025-07-08T20:02:51.8728835Z         "health_ratio": 0.8,
2025-07-08T20:02:51.8729159Z         "is_active": false,
2025-07-08T20:02:51.8729471Z         "special_items": [
2025-07-08T20:02:51.8729770Z           "magic_ring"
2025-07-08T20:02:51.8730043Z         ],
2025-07-08T20:02:51.8730286Z         "skills": {
2025-07-08T20:02:51.8730553Z           "append": [
2025-07-08T20:02:51.8730848Z             "fireball",
2025-07-08T20:02:51.8731139Z             "heal"
2025-07-08T20:02:51.8731393Z           ]
2025-07-08T20:02:51.8731631Z         },
2025-07-08T20:02:51.8731881Z         "attributes": {
2025-07-08T20:02:51.8732172Z           "strength": 15,
2025-07-08T20:02:51.8732497Z ... (truncated, showing 19/60 lines)
2025-07-08T20:02:51.8733032Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8733718Z   "player_info": {
2025-07-08T20:02:51.8734004Z     "character_sheet": {
2025-07-08T20:02:51.8734314Z       "name": "UpdatedHero",
2025-07-08T20:02:51.8734623Z       "level": 5,
2025-07-08T20:02:51.8734900Z       "health_ratio": 0.8,
2025-07-08T20:02:51.8735228Z       "is_active": false,
2025-07-08T20:02:51.8735527Z       "special_items": [
2025-07-08T20:02:51.8735821Z         "magic_ring"
2025-07-08T20:02:51.8736124Z       ],
2025-07-08T20:02:51.8736369Z       "skills": {
2025-07-08T20:02:51.8736640Z         "append": [
2025-07-08T20:02:51.8736935Z           "fireball",
2025-07-08T20:02:51.8737213Z           "heal"
2025-07-08T20:02:51.8737468Z         ]
2025-07-08T20:02:51.8737707Z       },
2025-07-08T20:02:51.8737947Z       "attributes": {
2025-07-08T20:02:51.8738227Z         "strength": 15,
2025-07-08T20:02:51.8738521Z         "wisdom": 14
2025-07-08T20:02:51.8738830Z ... (truncated, showing 19/23 lines)
2025-07-08T20:02:51.8739354Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8739866Z   "character_sheet": {
2025-07-08T20:02:51.8740167Z     "name": "UpdatedHero",
2025-07-08T20:02:51.8740471Z     "level": 5,
2025-07-08T20:02:51.8740738Z     "health_ratio": 0.8,
2025-07-08T20:02:51.8741037Z     "is_active": false,
2025-07-08T20:02:51.8741325Z     "special_items": [
2025-07-08T20:02:51.8741605Z       "magic_ring"
2025-07-08T20:02:51.8741882Z     ],
2025-07-08T20:02:51.8742137Z     "skills": {
2025-07-08T20:02:51.8742406Z       "append": [
2025-07-08T20:02:51.8742668Z         "fireball",
2025-07-08T20:02:51.8742935Z         "heal"
2025-07-08T20:02:51.8743180Z       ]
2025-07-08T20:02:51.8743569Z     },
2025-07-08T20:02:51.8743809Z     "attributes": {
2025-07-08T20:02:51.8744082Z       "strength": 15,
2025-07-08T20:02:51.8744362Z       "wisdom": 14
2025-07-08T20:02:51.8744615Z     }
2025-07-08T20:02:51.8744870Z ... (truncated, showing 19/21 lines)
2025-07-08T20:02:51.8745574Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8746096Z   "name": "UpdatedHero",
2025-07-08T20:02:51.8746397Z   "level": 5,
2025-07-08T20:02:51.8746652Z   "health_ratio": 0.8,
2025-07-08T20:02:51.8746948Z   "is_active": false,
2025-07-08T20:02:51.8747243Z   "special_items": [
2025-07-08T20:02:51.8747511Z     "magic_ring"
2025-07-08T20:02:51.8747771Z   ],
2025-07-08T20:02:51.8748002Z   "skills": {
2025-07-08T20:02:51.8748246Z     "append": [
2025-07-08T20:02:51.8748510Z       "fireball",
2025-07-08T20:02:51.8748767Z       "heal"
2025-07-08T20:02:51.8749188Z     ]
2025-07-08T20:02:51.8749409Z   },
2025-07-08T20:02:51.8749646Z   "attributes": {
2025-07-08T20:02:51.8749907Z     "strength": 15,
2025-07-08T20:02:51.8750173Z     "wisdom": 14
2025-07-08T20:02:51.8750419Z   }
2025-07-08T20:02:51.8750630Z }
2025-07-08T20:02:51.8751027Z 2025-07-08 20:02:51,868 - INFO - update_state: Detected explicit append for 'skills'.
2025-07-08T20:02:51.8751675Z 2025-07-08 20:02:51,868 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'skills'.
2025-07-08T20:02:51.8752312Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8752807Z   "strength": 15,
2025-07-08T20:02:51.8753076Z   "wisdom": 14
2025-07-08T20:02:51.8753455Z }
2025-07-08T20:02:51.8754494Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8755370Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8756199Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8757083Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8757881Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8758583Z   "environment": {
2025-07-08T20:02:51.8759047Z     "current_location": {
2025-07-08T20:02:51.8759549Z       "danger_level": 2,
2025-07-08T20:02:51.8760048Z       "weather_factor": 0.3,
2025-07-08T20:02:51.8760584Z       "is_discovered": false,
2025-07-08T20:02:51.8761102Z       "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8761605Z       "npcs": {
2025-07-08T20:02:51.8762058Z         "append": [
2025-07-08T20:02:51.8762647Z           "merchant",
2025-07-08T20:02:51.8763101Z           "guard"
2025-07-08T20:02:51.8763721Z         ]
2025-07-08T20:02:51.8764301Z       },
2025-07-08T20:02:51.8764786Z       "connections": {
2025-07-08T20:02:51.8765289Z         "east": "mountain",
2025-07-08T20:02:51.8765771Z         "west": null
2025-07-08T20:02:51.8766181Z       }
2025-07-08T20:02:51.8766561Z     }
2025-07-08T20:02:51.8766987Z   }
2025-07-08T20:02:51.8767445Z }
2025-07-08T20:02:51.8768082Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8768923Z   "current_location": {
2025-07-08T20:02:51.8769553Z     "danger_level": 2,
2025-07-08T20:02:51.8770196Z     "weather_factor": 0.3,
2025-07-08T20:02:51.8770676Z     "is_discovered": false,
2025-07-08T20:02:51.8772282Z     "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8772638Z     "npcs": {
2025-07-08T20:02:51.8772901Z       "append": [
2025-07-08T20:02:51.8773185Z         "merchant",
2025-07-08T20:02:51.8773615Z         "guard"
2025-07-08T20:02:51.8773903Z       ]
2025-07-08T20:02:51.8774160Z     },
2025-07-08T20:02:51.8774429Z     "connections": {
2025-07-08T20:02:51.8774745Z       "east": "mountain",
2025-07-08T20:02:51.8775044Z       "west": null
2025-07-08T20:02:51.8775294Z     }
2025-07-08T20:02:51.8775520Z   }
2025-07-08T20:02:51.8775749Z }
2025-07-08T20:02:51.8776154Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8776655Z   "danger_level": 2,
2025-07-08T20:02:51.8776960Z   "weather_factor": 0.3,
2025-07-08T20:02:51.8777268Z   "is_discovered": false,
2025-07-08T20:02:51.8777587Z   "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8778126Z   "npcs": {
2025-07-08T20:02:51.8778370Z     "append": [
2025-07-08T20:02:51.8778628Z       "merchant",
2025-07-08T20:02:51.8778898Z       "guard"
2025-07-08T20:02:51.8779137Z     ]
2025-07-08T20:02:51.8779357Z   },
2025-07-08T20:02:51.8779592Z   "connections": {
2025-07-08T20:02:51.8779864Z     "east": "mountain",
2025-07-08T20:02:51.8780145Z     "west": null
2025-07-08T20:02:51.8780396Z   }
2025-07-08T20:02:51.8780617Z }
2025-07-08T20:02:51.8781000Z 2025-07-08 20:02:51,868 - INFO - update_state: Detected explicit append for 'npcs'.
2025-07-08T20:02:51.8781647Z 2025-07-08 20:02:51,868 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'npcs'.
2025-07-08T20:02:51.8782463Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8782962Z   "east": "mountain",
2025-07-08T20:02:51.8783401Z   "west": null
2025-07-08T20:02:51.8783661Z }
2025-07-08T20:02:51.8784015Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8784623Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8785217Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8785774Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8786350Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8786861Z   "session_info": {
2025-07-08T20:02:51.8787174Z     "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T20:02:51.8787518Z     "session_id": 12345,
2025-07-08T20:02:51.8787862Z     "is_tutorial": false,
2025-07-08T20:02:51.8788168Z     "notes": null,
2025-07-08T20:02:51.8788437Z     "participants": [
2025-07-08T20:02:51.8788729Z       "player1"
2025-07-08T20:02:51.8788982Z     ],
2025-07-08T20:02:51.8789220Z     "settings": {
2025-07-08T20:02:51.8789505Z       "difficulty": "normal",
2025-07-08T20:02:51.8789826Z       "auto_save": true
2025-07-08T20:02:51.8790097Z     }
2025-07-08T20:02:51.8790329Z   }
2025-07-08T20:02:51.8790552Z }
2025-07-08T20:02:51.8790942Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8791457Z   "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T20:02:51.8791817Z   "session_id": 12345,
2025-07-08T20:02:51.8792109Z   "is_tutorial": false,
2025-07-08T20:02:51.8792388Z   "notes": null,
2025-07-08T20:02:51.8792665Z   "participants": [
2025-07-08T20:02:51.8792944Z     "player1"
2025-07-08T20:02:51.8793185Z   ],
2025-07-08T20:02:51.8793570Z   "settings": {
2025-07-08T20:02:51.8793844Z     "difficulty": "normal",
2025-07-08T20:02:51.8794147Z     "auto_save": true
2025-07-08T20:02:51.8794419Z   }
2025-07-08T20:02:51.8794640Z }
2025-07-08T20:02:51.8795010Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8795515Z   "difficulty": "normal",
2025-07-08T20:02:51.8795814Z   "auto_save": true
2025-07-08T20:02:51.8796077Z }
2025-07-08T20:02:51.8796418Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8797005Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8797590Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8798140Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8798740Z .2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8799229Z   "container1": {
2025-07-08T20:02:51.8799490Z     "container2": {
2025-07-08T20:02:51.8799765Z       "container3": {
2025-07-08T20:02:51.8800060Z         "empty_list": {
2025-07-08T20:02:51.8800354Z           "append": [
2025-07-08T20:02:51.8800633Z             "first_item"
2025-07-08T20:02:51.8800915Z           ]
2025-07-08T20:02:51.8801149Z         },
2025-07-08T20:02:51.8801390Z         "empty_dict": {
2025-07-08T20:02:51.8801688Z           "new_key": "new_value"
2025-07-08T20:02:51.8802182Z         },
2025-07-08T20:02:51.8802421Z         "zero_int": 42,
2025-07-08T20:02:51.8802706Z         "zero_float": 3.14,
2025-07-08T20:02:51.8803016Z         "false_bool": true,
2025-07-08T20:02:51.8803481Z         "empty_string": "now_has_content",
2025-07-08T20:02:51.8803868Z         "completely_new": "brand_new_value"
2025-07-08T20:02:51.8804218Z       }
2025-07-08T20:02:51.8804445Z     }
2025-07-08T20:02:51.8804696Z ... (truncated, showing 19/21 lines)
2025-07-08T20:02:51.8805183Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8805672Z   "container2": {
2025-07-08T20:02:51.8805944Z     "container3": {
2025-07-08T20:02:51.8806391Z       "empty_list": {
2025-07-08T20:02:51.8806666Z         "append": [
2025-07-08T20:02:51.8806937Z           "first_item"
2025-07-08T20:02:51.8807210Z         ]
2025-07-08T20:02:51.8807444Z       },
2025-07-08T20:02:51.8807674Z       "empty_dict": {
2025-07-08T20:02:51.8807958Z         "new_key": "new_value"
2025-07-08T20:02:51.8808276Z       },
2025-07-08T20:02:51.8808510Z       "zero_int": 42,
2025-07-08T20:02:51.8808787Z       "zero_float": 3.14,
2025-07-08T20:02:51.8809080Z       "false_bool": true,
2025-07-08T20:02:51.8809388Z       "empty_string": "now_has_content",
2025-07-08T20:02:51.8809768Z       "completely_new": "brand_new_value"
2025-07-08T20:02:51.8810113Z     }
2025-07-08T20:02:51.8810328Z   }
2025-07-08T20:02:51.8810551Z }
2025-07-08T20:02:51.8810937Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8811428Z   "container3": {
2025-07-08T20:02:51.8811685Z     "empty_list": {
2025-07-08T20:02:51.8811965Z       "append": [
2025-07-08T20:02:51.8812233Z         "first_item"
2025-07-08T20:02:51.8812490Z       ]
2025-07-08T20:02:51.8812727Z     },
2025-07-08T20:02:51.8812976Z     "empty_dict": {
2025-07-08T20:02:51.8813394Z       "new_key": "new_value"
2025-07-08T20:02:51.8813703Z     },
2025-07-08T20:02:51.8813942Z     "zero_int": 42,
2025-07-08T20:02:51.8814221Z     "zero_float": 3.14,
2025-07-08T20:02:51.8814517Z     "false_bool": true,
2025-07-08T20:02:51.8814828Z     "empty_string": "now_has_content",
2025-07-08T20:02:51.8815207Z     "completely_new": "brand_new_value"
2025-07-08T20:02:51.8815552Z   }
2025-07-08T20:02:51.8815780Z }
2025-07-08T20:02:51.8816158Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8816653Z   "empty_list": {
2025-07-08T20:02:51.8816924Z     "append": [
2025-07-08T20:02:51.8817171Z       "first_item"
2025-07-08T20:02:51.8817423Z     ]
2025-07-08T20:02:51.8817650Z   },
2025-07-08T20:02:51.8817880Z   "empty_dict": {
2025-07-08T20:02:51.8818153Z     "new_key": "new_value"
2025-07-08T20:02:51.8818447Z   },
2025-07-08T20:02:51.8818678Z   "zero_int": 42,
2025-07-08T20:02:51.8818937Z   "zero_float": 3.14,
2025-07-08T20:02:51.8819229Z   "false_bool": true,
2025-07-08T20:02:51.8819538Z   "empty_string": "now_has_content",
2025-07-08T20:02:51.8819901Z   "completely_new": "brand_new_value"
2025-07-08T20:02:51.8820252Z }
2025-07-08T20:02:51.8820668Z 2025-07-08 20:02:51,869 - INFO - update_state: Detected explicit append for 'empty_list'.
2025-07-08T20:02:51.8821334Z 2025-07-08 20:02:51,869 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'empty_list'.
2025-07-08T20:02:51.8821976Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8822475Z   "new_key": "new_value"
2025-07-08T20:02:51.8822755Z }
2025-07-08T20:02:51.8823105Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8823823Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8824402Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8824951Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8825529Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8826148Z .
2025-07-08T20:02:51.8826461Z ----------------------------------------------------------------------
2025-07-08T20:02:51.8826908Z Ran 50 tests in 0.009s
2025-07-08T20:02:51.8827098Z 
2025-07-08T20:02:51.8827196Z OK
2025-07-08T20:02:52.0459435Z ✅ mvp_site/tests/test_game_state.py passed
2025-07-08T20:02:52.0462145Z ----------------------------------------
2025-07-08T20:02:52.0464792Z Running mvp_site/tests/test_gemini_response.py...
2025-07-08T20:02:52.6748919Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6759412Z   @validator('strength', pre=True)
2025-07-08T20:02:52.6762096Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6764961Z   @validator('dexterity', pre=True)
2025-07-08T20:02:52.6767613Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6770308Z   @validator('constitution', pre=True)
2025-07-08T20:02:52.6772946Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6782791Z   @validator('intelligence', pre=True)
2025-07-08T20:02:52.6785640Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6788286Z   @validator('wisdom', pre=True)
2025-07-08T20:02:52.6790931Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6798776Z   @validator('charisma', pre=True)
2025-07-08T20:02:52.6801347Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6803990Z   @validator('hp', pre=True)
2025-07-08T20:02:52.6818866Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6821595Z   @validator('hp_max', pre=True)
2025-07-08T20:02:52.6824374Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6827238Z   @validator('temp_hp', pre=True)
2025-07-08T20:02:52.6838020Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6842288Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:02:52.6867502Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6877267Z   @validator('level', pre=True)
2025-07-08T20:02:52.6879902Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6882569Z   @validator('gender')
2025-07-08T20:02:52.6885320Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6887958Z   @validator('age')
2025-07-08T20:02:52.6890570Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6893438Z   @validator('mbti')
2025-07-08T20:02:52.6896011Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6898694Z   @validator('alignment')
2025-07-08T20:02:52.6901219Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6904259Z   @validator('entity_type')
2025-07-08T20:02:52.7046067Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7051043Z   @validator('participants')
2025-07-08T20:02:52.7063001Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7066793Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:02:52.7069760Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7072475Z   @validator('present_entities')
2025-07-08T20:02:52.7176139Z 2025-07-08 20:02:52,717 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:02:52.7180703Z 2025-07-08 20:02:52,717 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:52.7183653Z 2025-07-08 20:02:52,717 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:52.7189425Z 2025-07-08 20:02:52,718 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:52.7194806Z 2025-07-08 20:02:52,719 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:52.7210285Z 2025-07-08 20:02:52,720 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:52.7211859Z 2025-07-08 20:02:52,720 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:52.7214977Z 2025-07-08 20:02:52,720 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:52.7215909Z 2025-07-08 20:02:52,720 - INFO - Starting dual-pass generation
2025-07-08T20:02:52.7216598Z 2025-07-08 20:02:52,721 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:52.7217425Z 2025-07-08 20:02:52,721 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:52.7229273Z 2025-07-08 20:02:52,721 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:52.7230168Z 2025-07-08 20:02:52,721 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:52.7230885Z 2025-07-08 20:02:52,721 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:52.7231595Z 2025-07-08 20:02:52,721 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:52.7232438Z 2025-07-08 20:02:52,721 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:52.7233763Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:52.7234594Z 2025-07-08 20:02:52,722 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:52.7235441Z 2025-07-08 20:02:52,722 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:52.7236664Z 2025-07-08 20:02:52,722 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:52.7237817Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:52.7238775Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:52.7252742Z ......2025-07-08 20:02:52,725 - WARNING - ⚠️ No specific system prompts selected for initial story. Using none.
2025-07-08T20:02:52.7261170Z 2025-07-08 20:02:52,725 - INFO - Using model: gemini-1.5-flash for initial story generation.
2025-07-08T20:02:52.7266793Z .2025-07-08 20:02:52,726 - WARNING - Using deprecated create_legacy method. Switch to create() with raw response.
2025-07-08T20:02:52.7278852Z ...2025-07-08 20:02:52,727 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:52.7280190Z 2025-07-08 20:02:52,727 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:02:52.7283089Z 2025-07-08 20:02:52,727 - INFO - Recovered from incomplete JSON response. Narrative length: 42 characters (~10 tokens)
2025-07-08T20:02:52.7283974Z ..
2025-07-08T20:02:52.7284330Z ----------------------------------------------------------------------
2025-07-08T20:02:52.7284795Z Ran 12 tests in 0.616s
2025-07-08T20:02:52.7284995Z 
2025-07-08T20:02:52.7285099Z OK
2025-07-08T20:02:52.7999976Z ✅ mvp_site/tests/test_gemini_response.py passed
2025-07-08T20:02:52.8001455Z ----------------------------------------
2025-07-08T20:02:52.8001962Z Running mvp_site/tests/test_generator_isolated.py...
2025-07-08T20:02:53.2204097Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:579: ResourceWarning: unclosed file <_io.BufferedReader name='/tmp/tmp5gzrqg4p.pdf'>
2025-07-08T20:02:53.2205361Z   if method() is not None:
2025-07-08T20:02:53.2205941Z ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-07-08T20:02:53.2206524Z .
2025-07-08T20:02:53.2206942Z ----------------------------------------------------------------------
2025-07-08T20:02:53.2207463Z Ran 1 test in 0.098s
2025-07-08T20:02:53.2207666Z 
2025-07-08T20:02:53.2207771Z OK
2025-07-08T20:02:53.2208077Z \n--- Running PDF Generation Test ---
2025-07-08T20:02:53.2208489Z INFO: DejaVuSans.ttf found and loaded.
2025-07-08T20:02:53.2208926Z --- PDF Generation Test Finished Successfully ---
2025-07-08T20:02:53.2847895Z ✅ mvp_site/tests/test_generator_isolated.py passed
2025-07-08T20:02:53.2851470Z ----------------------------------------
2025-07-08T20:02:53.2852064Z Running mvp_site/tests/test_god_mode_json_display_red_green.py...
2025-07-08T20:02:53.3300870Z .......
2025-07-08T20:02:53.3303514Z ----------------------------------------------------------------------
2025-07-08T20:02:53.3304071Z Ran 7 tests in 0.001s
2025-07-08T20:02:53.3304301Z 
2025-07-08T20:02:53.3304419Z OK
2025-07-08T20:02:53.3369804Z ✅ mvp_site/tests/test_god_mode_json_display_red_green.py passed
2025-07-08T20:02:53.3371193Z ----------------------------------------
2025-07-08T20:02:53.3371728Z Running mvp_site/tests/test_god_mode_json_logging_bug.py...
2025-07-08T20:02:53.3827853Z ....
2025-07-08T20:02:53.3828321Z POTENTIAL BUG: Double JSON encoding detected
2025-07-08T20:02:53.3828883Z BUG DETECTED: Raw JSON would be logged instead of narrative
2025-07-08T20:02:53.3829795Z ----------------------------------------------------------------------
2025-07-08T20:02:53.3830399Z Ran 4 tests in 0.000s
2025-07-08T20:02:53.3831406Z 
2025-07-08T20:02:53.3831546Z OK
2025-07-08T20:02:53.3897857Z ✅ mvp_site/tests/test_god_mode_json_logging_bug.py passed
2025-07-08T20:02:53.3899219Z ----------------------------------------
2025-07-08T20:02:53.3899777Z Running mvp_site/tests/test_god_mode_response_field.py...
2025-07-08T20:02:53.4348477Z ........
2025-07-08T20:02:53.4350710Z ----------------------------------------------------------------------
2025-07-08T20:02:53.4351256Z Ran 8 tests in 0.001s
2025-07-08T20:02:53.4351653Z 
2025-07-08T20:02:53.4352209Z OK
2025-07-08T20:02:53.4415702Z ✅ mvp_site/tests/test_god_mode_response_field.py passed
2025-07-08T20:02:53.4417051Z ----------------------------------------
2025-07-08T20:02:53.4417620Z Running mvp_site/tests/test_god_mode_response_parsing_debug.py...
2025-07-08T20:02:53.4965800Z test_check_narrative_response_schema (__main__.TestGodModeResponseParsingDebug.test_check_narrative_response_schema)
2025-07-08T20:02:53.4966769Z NarrativeResponse fields: {}
2025-07-08T20:02:53.4969441Z Check if NarrativeResponse schema supports god_mode_response field. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_check_narrative_response_schema of <__main__.TestGodModeResponseParsingDebug testMethod=test_check_narrative_response_schema>>)
2025-07-08T20:02:53.4981131Z   return self.run(*args, **kwds)
2025-07-08T20:02:53.4981550Z ok
2025-07-08T20:02:53.4982344Z test_luke_campaign_scene_31_exact_debug (__main__.TestGodModeResponseParsingDebug.test_luke_campaign_scene_31_exact_debug)
2025-07-08T20:02:53.4983609Z Debug the exact Scene #31 response from Luke's campaign. ... ok
2025-07-08T20:02:53.4984761Z test_narrative_response_creation_with_god_mode (__main__.TestGodModeResponseParsingDebug.test_narrative_response_creation_with_god_mode)
2025-07-08T20:02:53.4985933Z Test if NarrativeResponse creation fails with god mode data. ... ok
2025-07-08T20:02:53.4986848Z test_simulate_parsing_paths (__main__.TestGodModeResponseParsingDebug.test_simulate_parsing_paths)
2025-07-08T20:02:53.4989537Z Simulate different parsing paths to see which one is taken. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_simulate_parsing_paths of <__main__.TestGodModeResponseParsingDebug testMethod=test_simulate_parsing_paths>>)
2025-07-08T20:02:53.4991683Z   return self.run(*args, **kwds)
2025-07-08T20:02:53.4992040Z ok
2025-07-08T20:02:53.4992191Z 
2025-07-08T20:02:53.4992418Z ----------------------------------------------------------------------
2025-07-08T20:02:53.4992906Z Ran 4 tests in 0.001s
2025-07-08T20:02:53.4993112Z 
2025-07-08T20:02:53.4993357Z OK
2025-07-08T20:02:53.4993671Z God mode response creation succeeded
2025-07-08T20:02:53.4994873Z JSON parsing successful. Keys: ['narrative', 'god_mode_response', 'entities_mentioned', 'location_confirmed', 'state_updates', 'debug_info']
2025-07-08T20:02:53.4995825Z narrative: ''
2025-07-08T20:02:53.4996229Z god_mode_response length: 1322
2025-07-08T20:02:53.4996733Z parse_structured_response succeeded
2025-07-08T20:02:53.4997750Z Returned narrative_text: 'That's another excellent point, and I understand why you'd expect EXP for such a significant and imp...' (length: 1322)
2025-07-08T20:02:53.4998985Z Structured response type: <class 'narrative_response_schema.NarrativeResponse'>
2025-07-08T20:02:53.5000432Z NarrativeResponse creation succeeded
2025-07-08T20:02:53.5000875Z Has god_mode_response attr: True
2025-07-08T20:02:53.5001313Z god_mode_response value: Test god mode response
2025-07-08T20:02:53.5001812Z MAIN PATH: NarrativeResponse creation succeeded
2025-07-08T20:02:53.5002302Z MAIN PATH: god_mode_response detected
2025-07-08T20:02:53.5002852Z MAIN PATH: Combined response: 'Test response for path debugging'
2025-07-08T20:02:53.5046013Z ✅ mvp_site/tests/test_god_mode_response_parsing_debug.py passed
2025-07-08T20:02:53.5046816Z ----------------------------------------
2025-07-08T20:02:53.5047440Z Running mvp_site/tests/test_hp_unknown_values.py...
2025-07-08T20:02:53.6789929Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6791675Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6798230Z .WARNING:root:⚠️ Failed to convert '' to int for field 'hp'. Using default: 1
2025-07-08T20:02:53.6800476Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6801382Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp'. Using default: 1
2025-07-08T20:02:53.6802321Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6803165Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6804110Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6804862Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6805873Z ..WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6806377Z ....
2025-07-08T20:02:53.6806698Z ----------------------------------------------------------------------
2025-07-08T20:02:53.6807160Z Ran 13 tests in 0.001s
2025-07-08T20:02:53.6807371Z 
2025-07-08T20:02:53.6807478Z OK
2025-07-08T20:02:53.7013746Z ✅ mvp_site/tests/test_hp_unknown_values.py passed
2025-07-08T20:02:53.7017159Z ----------------------------------------
2025-07-08T20:02:53.7017672Z Running mvp_site/tests/test_incomplete_json_recovery.py...
2025-07-08T20:02:53.7714011Z .......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:53.7722426Z ...
2025-07-08T20:02:53.7723900Z ----------------------------------------------------------------------
2025-07-08T20:02:53.7724457Z Ran 10 tests in 0.005s
2025-07-08T20:02:53.7724669Z 
2025-07-08T20:02:53.7724786Z OK
2025-07-08T20:02:53.7831004Z ✅ mvp_site/tests/test_incomplete_json_recovery.py passed
2025-07-08T20:02:53.7832069Z ----------------------------------------
2025-07-08T20:02:53.7834242Z Running mvp_site/tests/test_json_bug_fix.py...
2025-07-08T20:02:53.8114668Z ============================================================
2025-07-08T20:02:53.8116450Z JSON Bug Root Cause Test
2025-07-08T20:02:53.8118828Z ============================================================
2025-07-08T20:02:53.8119420Z Testing parse_structured_response with raw JSON...
2025-07-08T20:02:53.8119921Z Input (first 100 chars): {
2025-07-08T20:02:53.8120586Z     "narrative": "[Mode: STORY MODE]\n[SESSION_HEADER]\nTimestamp: Year 11 New Peace, Kythorn Day ...
2025-07-08T20:02:53.8121162Z 
2025-07-08T20:02:53.8121456Z 🔍 Results:
2025-07-08T20:02:53.8121791Z    response_text type: <class 'str'>
2025-07-08T20:02:53.8122238Z    response_text starts with '{': False
2025-07-08T20:02:53.8122711Z    response_text first 200 chars: [Mode: STORY MODE]
2025-07-08T20:02:53.8123167Z [SESSION_HEADER]
2025-07-08T20:02:53.8123771Z Timestamp: Year 11 New Peace, Kythorn Day 2, 08:00
2025-07-08T20:02:53.8124223Z Location: Character Creation
2025-07-08T20:02:53.8124642Z Status: Lvl 1 Unknown | HP: 0/0 (Temp: 0) | XP: 0/300 | Gold: 0gp
2025-07-08T20:02:53.8125152Z Resources: HD: 0/0
2025-07-08T20:02:53.8125476Z    structured_response exists: True
2025-07-08T20:02:53.8125754Z 
2025-07-08T20:02:53.8126132Z ✅ parse_structured_response correctly extracted narrative!
2025-07-08T20:02:53.8126549Z 
2025-07-08T20:02:53.8126820Z 🟢 parse_structured_response works correctly
2025-07-08T20:02:53.8164785Z ✅ mvp_site/tests/test_json_bug_fix.py passed
2025-07-08T20:02:53.8166090Z ----------------------------------------
2025-07-08T20:02:53.8166586Z Running mvp_site/tests/test_json_bug_green.py...
2025-07-08T20:02:53.8538009Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:53.8540318Z ============================================================
2025-07-08T20:02:53.8541132Z 🟢 GREEN TEST: JSON Bug Fix Verification
2025-07-08T20:02:53.8542573Z ============================================================
2025-07-08T20:02:53.8543546Z Test 1: Well-formed JSON
2025-07-08T20:02:53.8543923Z   Result starts with '{': False
2025-07-08T20:02:53.8544289Z   Result: [Mode: STORY MODE]
2025-07-08T20:02:53.8544674Z You enter the dark cave......
2025-07-08T20:02:53.8544936Z 
2025-07-08T20:02:53.8545145Z Test 2: Malformed JSON without proper structure
2025-07-08T20:02:53.8545844Z   Result starts with '{': True
2025-07-08T20:02:53.8546335Z   Result: {"Some malformed JSON that would cause the bug...
2025-07-08T20:02:53.8547058Z   ⚠️  EXPECTED: Malformed JSON returned as fallback
2025-07-08T20:02:53.8547632Z   This is expected behavior for completely broken JSON
2025-07-08T20:02:53.8548007Z 
2025-07-08T20:02:53.8548196Z Test 3: JSON that triggers the temporary fix
2025-07-08T20:02:53.8548714Z   Result: The story text that should be extracted
2025-07-08T20:02:53.8549292Z   ✅ Narrative correctly extracted
2025-07-08T20:02:53.8549576Z 
2025-07-08T20:02:53.8549770Z Test 4: Full flow with GeminiResponse creation
2025-07-08T20:02:53.8550423Z   narrative_text: You chose option 2. Let me create a character for ...
2025-07-08T20:02:53.8550989Z   narrative_text starts with '{': False
2025-07-08T20:02:53.8551566Z   ✅ Full flow works correctly - no JSON in narrative_text
2025-07-08T20:02:53.8551924Z 
2025-07-08T20:02:53.8552092Z ✅ TESTS PASSED!
2025-07-08T20:02:53.8552448Z The JSON bug has been fixed successfully.
2025-07-08T20:02:53.8552895Z Note: Malformed JSON fallback is expected behavior.
2025-07-08T20:02:53.8604000Z ✅ mvp_site/tests/test_json_bug_green.py passed
2025-07-08T20:02:53.8605320Z ----------------------------------------
2025-07-08T20:02:53.8605820Z Running mvp_site/tests/test_json_bug_scenario.py...
2025-07-08T20:02:54.5198167Z 2025-07-08 20:02:54,519 - INFO - STRUCTURED_GENERATION: Coverage rate 1.00, Schema valid: True
2025-07-08T20:02:54.5198924Z ============================================================
2025-07-08T20:02:54.5199353Z Exact JSON Bug Scenario Test
2025-07-08T20:02:54.5199765Z ============================================================
2025-07-08T20:02:54.5200227Z 1. Testing _get_text_from_response simulation...
2025-07-08T20:02:54.5200710Z 2. Testing _process_structured_response...
2025-07-08T20:02:54.5201007Z 
2025-07-08T20:02:54.5201423Z 🔍 After _process_structured_response:
2025-07-08T20:02:54.5201827Z    response_text type: <class 'str'>
2025-07-08T20:02:54.5202240Z    response_text starts with '{': False
2025-07-08T20:02:54.5202634Z    response_text[:100]: [Mode: STORY MODE]
2025-07-08T20:02:54.5203054Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:02:54.5203533Z 
2025-07-08T20:02:54.5203705Z "Excellent choice, adventurer!" The voice tha
2025-07-08T20:02:54.5203998Z 
2025-07-08T20:02:54.5204261Z ✅ No bug found - response_text is clean narrative
2025-07-08T20:02:54.5204569Z 
2025-07-08T20:02:54.5204801Z 🟢 Could not reproduce bug with this scenario
2025-07-08T20:02:54.5933073Z ✅ mvp_site/tests/test_json_bug_scenario.py passed
2025-07-08T20:02:54.5934801Z ----------------------------------------
2025-07-08T20:02:54.5935385Z Running mvp_site/tests/test_json_bug_state_updates.py...
2025-07-08T20:02:54.6227871Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.6228390Z Initial response_text (clean):
2025-07-08T20:02:54.6228784Z   Starts with '{': False
2025-07-08T20:02:54.6229168Z   First 100 chars: [Mode: STORY MODE]
2025-07-08T20:02:54.6229644Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:02:54.6229931Z 
2025-07-08T20:02:54.6230117Z "Excellent choice, adventurer!" The voice tha
2025-07-08T20:02:54.6230448Z 
2025-07-08T20:02:54.6230607Z After appending state updates:
2025-07-08T20:02:54.6231021Z   Length increased from 155 to 315
2025-07-08T20:02:54.6231432Z   Still starts with '{': False
2025-07-08T20:02:54.6231861Z   Contains 'STATE_UPDATES_PROPOSED': True
2025-07-08T20:02:54.6232185Z 
2025-07-08T20:02:54.6232400Z Conclusion: State updates don't cause the JSON bug
2025-07-08T20:02:54.6232770Z 
2025-07-08T20:02:54.6232937Z ============================================================
2025-07-08T20:02:54.6234116Z Testing edge cases where parse_structured_response might return JSON
2025-07-08T20:02:54.6234576Z 
2025-07-08T20:02:54.6234848Z Test case 1: {"narrative": "Test story", "entities_mentioned": ...
2025-07-08T20:02:54.6235403Z   Result starts with '{': False
2025-07-08T20:02:54.6235961Z   Result: Test story
2025-07-08T20:02:54.6236153Z 
2025-07-08T20:02:54.6236372Z Test case 2: {"narrative": "Test story" "broken json here...
2025-07-08T20:02:54.6236882Z   Result starts with '{': False
2025-07-08T20:02:54.6237253Z   Result: Test story
2025-07-08T20:02:54.6237452Z 
2025-07-08T20:02:54.6237633Z Test case 3: {"Some weird text that starts with brace...
2025-07-08T20:02:54.6238041Z   Result starts with '{': True
2025-07-08T20:02:54.6238479Z   Result: {"Some weird text that starts with brace
2025-07-08T20:02:54.6239114Z   🚨 FOUND IT! This input causes JSON to be returned!
2025-07-08T20:02:54.6239477Z 
2025-07-08T20:02:54.6239830Z 🔴 Found a case where parse_structured_response returns JSON!
2025-07-08T20:02:54.6276726Z ✅ mvp_site/tests/test_json_bug_state_updates.py passed
2025-07-08T20:02:54.6278089Z ----------------------------------------
2025-07-08T20:02:54.6278626Z Running mvp_site/tests/test_json_cleanup_safety.py...
2025-07-08T20:02:54.6741622Z ..ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.6747787Z .....
2025-07-08T20:02:54.6748170Z ----------------------------------------------------------------------
2025-07-08T20:02:54.6748661Z Ran 7 tests in 0.002s
2025-07-08T20:02:54.6748858Z 
2025-07-08T20:02:54.6748963Z OK
2025-07-08T20:02:54.6820579Z ✅ mvp_site/tests/test_json_cleanup_safety.py passed
2025-07-08T20:02:54.6821979Z ----------------------------------------
2025-07-08T20:02:54.6822475Z Running mvp_site/tests/test_json_display_bugs.py...
2025-07-08T20:02:54.7497637Z test_empty_response_handling (__main__.TestIntegrationBugs.test_empty_response_handling)
2025-07-08T20:02:54.7499245Z Test handling of empty or null responses ... INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T20:02:54.7501972Z INFO:root:Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T20:02:54.7511912Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.7512962Z INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T20:02:54.7516249Z INFO:root:Recovered from incomplete JSON response. Narrative length: 9 characters (~2 tokens)
2025-07-08T20:02:54.7517272Z ok
2025-07-08T20:02:54.7519969Z test_state_updates_with_malformed_json (__main__.TestIntegrationBugs.test_state_updates_with_malformed_json)
2025-07-08T20:02:54.7521245Z Test that state updates work even when JSON is malformed ... INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T20:02:54.7522429Z INFO:root:Recovered from incomplete JSON response. Narrative length: 19 characters (~4 tokens)
2025-07-08T20:02:54.7523178Z ok
2025-07-08T20:02:54.7524100Z test_unicode_and_special_characters (__main__.TestIntegrationBugs.test_unicode_and_special_characters)
2025-07-08T20:02:54.7525056Z Test handling of unicode and special characters ... ok
2025-07-08T20:02:54.7525861Z test_very_long_json_response (__main__.TestIntegrationBugs.test_very_long_json_response)
2025-07-08T20:02:54.7526658Z Test handling of very long JSON responses ... ok
2025-07-08T20:02:54.7527736Z test_code_block_json_extraction (__main__.TestRawJsonDisplayBugs.test_code_block_json_extraction)
2025-07-08T20:02:54.7528953Z Test extraction of JSON from code blocks ... INFO:root:Extracted JSON from markdown code block
2025-07-08T20:02:54.7529795Z ok
2025-07-08T20:02:54.7530507Z test_debug_mode_content_stripping (__main__.TestRawJsonDisplayBugs.test_debug_mode_content_stripping)
2025-07-08T20:02:54.7538315Z Test that debug mode content is properly stripped ... WARNING:root:⚠️ Invalid debug_info type: str, expected dict. Using empty dict instead.
2025-07-08T20:02:54.7553551Z ok
2025-07-08T20:02:54.7554157Z test_json_artifact_cleaning (__main__.TestRawJsonDisplayBugs.test_json_artifact_cleaning)
2025-07-08T20:02:54.7555329Z Test that JSON artifacts are cleaned from narrative ... ok
2025-07-08T20:02:54.7556133Z test_malformed_json_fallback (__main__.TestRawJsonDisplayBugs.test_malformed_json_fallback)
2025-07-08T20:02:54.7557153Z Test that malformed JSON falls back to cleaned text ... INFO:root:Successfully completed incomplete JSON
2025-07-08T20:02:54.7558307Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7559008Z INFO:root:Successfully fixed JSON boundaries
2025-07-08T20:02:54.7559727Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7560469Z INFO:root:Successfully parsed with aggressive fixes
2025-07-08T20:02:54.7561203Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7561983Z INFO:root:Extracted JSON from markdown code block
2025-07-08T20:02:54.7562584Z INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T20:02:54.7563568Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7564273Z ok
2025-07-08T20:02:54.7564923Z test_narrative_extraction_utility (__main__.TestRawJsonDisplayBugs.test_narrative_extraction_utility)
2025-07-08T20:02:54.7565742Z Test the narrative extraction utility function ... ok
2025-07-08T20:02:54.7566473Z test_narrative_field_extraction (__main__.TestRawJsonDisplayBugs.test_narrative_field_extraction)
2025-07-08T20:02:54.7567294Z Test extraction of narrative field from complex JSON ... ok
2025-07-08T20:02:54.7568095Z test_robust_json_parser_fallback (__main__.TestRawJsonDisplayBugs.test_robust_json_parser_fallback)
2025-07-08T20:02:54.7569072Z Test the robust JSON parser as fallback ... INFO:root:Successfully completed incomplete JSON
2025-07-08T20:02:54.7569659Z ok
2025-07-08T20:02:54.7570070Z test_valid_json_parsing (__main__.TestRawJsonDisplayBugs.test_valid_json_parsing)
2025-07-08T20:02:54.7570640Z Test that valid JSON is parsed correctly ... ok
2025-07-08T20:02:54.7571266Z test_empty_state_updates (__main__.TestStateUpdateBugs.test_empty_state_updates)
2025-07-08T20:02:54.7572006Z Test handling of responses with empty state updates ... ok
2025-07-08T20:02:54.7572817Z test_json_state_updates_extraction (__main__.TestStateUpdateBugs.test_json_state_updates_extraction)
2025-07-08T20:02:54.7573869Z Test that state updates are properly extracted from JSON format ... ok
2025-07-08T20:02:54.7574677Z test_malformed_state_updates (__main__.TestStateUpdateBugs.test_malformed_state_updates)
2025-07-08T20:02:54.7576060Z Test handling of malformed state updates ... WARNING:root:⚠️ Invalid state_updates type: str, expected dict. Using empty dict instead.
2025-07-08T20:02:54.7577026Z ok
2025-07-08T20:02:54.7577687Z test_markdown_state_updates_deprecated (__main__.TestStateUpdateBugs.test_markdown_state_updates_deprecated)
2025-07-08T20:02:54.7578903Z Test that old markdown state updates are handled gracefully ... INFO:root:Successfully parsed with aggressive fixes
2025-07-08T20:02:54.7579995Z INFO:root:Recovered from incomplete JSON response. Narrative length: 2 characters (~0 tokens)
2025-07-08T20:02:54.7580690Z ok
2025-07-08T20:02:54.7581209Z test_mixed_format_handling (__main__.TestStateUpdateBugs.test_mixed_format_handling)
2025-07-08T20:02:54.7582236Z Test handling of responses with both JSON and markdown formats ... INFO:root:Successfully fixed JSON boundaries
2025-07-08T20:02:54.7583436Z INFO:root:Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:02:54.7584135Z ok
2025-07-08T20:02:54.7584757Z test_state_updates_not_in_narrative (__main__.TestStateUpdateBugs.test_state_updates_not_in_narrative)
2025-07-08T20:02:54.7585641Z Test that state updates don't leak into narrative text ... ok
2025-07-08T20:02:54.7586055Z 
2025-07-08T20:02:54.7586289Z ----------------------------------------------------------------------
2025-07-08T20:02:54.7586999Z Ran 18 tests in 0.005s
2025-07-08T20:02:54.7587227Z 
2025-07-08T20:02:54.7587344Z OK
2025-07-08T20:02:54.7667129Z ✅ mvp_site/tests/test_json_display_bugs.py passed
2025-07-08T20:02:54.7668548Z ----------------------------------------
2025-07-08T20:02:54.7669048Z Running mvp_site/tests/test_json_display_fix.py...
2025-07-08T20:02:54.8138778Z ......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.8141435Z ...
2025-07-08T20:02:54.8141878Z ----------------------------------------------------------------------
2025-07-08T20:02:54.8142460Z Ran 9 tests in 0.002s
2025-07-08T20:02:54.8145437Z 
2025-07-08T20:02:54.8145704Z OK
2025-07-08T20:02:54.8211759Z ✅ mvp_site/tests/test_json_display_fix.py passed
2025-07-08T20:02:54.8215333Z ----------------------------------------
2025-07-08T20:02:54.8215850Z Running mvp_site/tests/test_json_mode_constants.py...
2025-07-08T20:02:54.8573074Z ..
2025-07-08T20:02:54.8578735Z ----------------------------------------------------------------------
2025-07-08T20:02:54.8579320Z Ran 2 tests in 0.000s
2025-07-08T20:02:54.8579559Z 
2025-07-08T20:02:54.8579679Z OK
2025-07-08T20:02:54.8630740Z ✅ mvp_site/tests/test_json_mode_constants.py passed
2025-07-08T20:02:54.8631726Z ----------------------------------------
2025-07-08T20:02:54.8632703Z Running mvp_site/tests/test_json_mode_preference.py...
2025-07-08T20:02:55.7871217Z 2025-07-08 20:02:55,786 - INFO - Extracted JSON from markdown code block
2025-07-08T20:02:55.7872639Z 2025-07-08 20:02:55,787 - INFO - Extracted JSON from generic code block
2025-07-08T20:02:55.7874820Z ....2025-07-08 20:02:55,787 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:55.7884232Z ..
2025-07-08T20:02:55.7886240Z ----------------------------------------------------------------------
2025-07-08T20:02:55.7887217Z Ran 6 tests in 0.002s
2025-07-08T20:02:55.7888610Z 
2025-07-08T20:02:55.7889858Z OK
2025-07-08T20:02:55.9383566Z ✅ mvp_site/tests/test_json_mode_preference.py passed
2025-07-08T20:02:55.9386850Z ----------------------------------------
2025-07-08T20:02:55.9387419Z Running mvp_site/tests/test_json_mode_state_updates.py...
2025-07-08T20:02:56.0039303Z ...
2025-07-08T20:02:56.0039964Z ✅ Empty state updates handled correctly
2025-07-08T20:02:56.0040576Z ✅ JSON response with state updates properly converted
2025-07-08T20:02:56.0041257Z ✅ JSON response without state updates handled correctly
2025-07-08T20:02:56.0042091Z ----------------------------------------------------------------------
2025-07-08T20:02:56.0042692Z Ran 3 tests in 0.000s
2025-07-08T20:02:56.0042997Z 
2025-07-08T20:02:56.0043382Z OK
2025-07-08T20:02:56.0141912Z ✅ mvp_site/tests/test_json_mode_state_updates.py passed
2025-07-08T20:02:56.0143499Z ----------------------------------------
2025-07-08T20:02:56.0144056Z Running mvp_site/tests/test_json_only_comprehensive.py...
2025-07-08T20:02:56.9371437Z ..2025-07-08 20:02:56,936 - INFO - Calling Gemini API with prompt: test logging...
2025-07-08T20:02:56.9372644Z 2025-07-08 20:02:56,937 - INFO - Calling Gemini API: 11 characters (~2 tokens)
2025-07-08T20:02:56.9378273Z 2025-07-08 20:02:56,937 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'int'
2025-07-08T20:02:56.9379558Z 2025-07-08 20:02:56,937 - INFO - Using model: gemini-2.5-flash
2025-07-08T20:02:56.9380436Z 2025-07-08 20:02:56,937 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:56.9386057Z ..2025-07-08 20:02:56,938 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:56.9391693Z ....
2025-07-08T20:02:56.9392409Z ----------------------------------------------------------------------
2025-07-08T20:02:56.9393114Z Ran 8 tests in 0.003s
2025-07-08T20:02:56.9393677Z 
2025-07-08T20:02:56.9393884Z OK
2025-07-08T20:02:57.0998024Z ✅ mvp_site/tests/test_json_only_comprehensive.py passed
2025-07-08T20:02:57.0999514Z ----------------------------------------
2025-07-08T20:02:57.1000435Z Running mvp_site/tests/test_json_only_mode.py...
2025-07-08T20:02:57.7366449Z 2025-07-08 20:02:57,736 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:02:57.7371741Z 2025-07-08 20:02:57,736 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:57.7374036Z 2025-07-08 20:02:57,736 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:57.7379931Z 2025-07-08 20:02:57,737 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:57.7385407Z 2025-07-08 20:02:57,738 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:57.7386506Z 2025-07-08 20:02:57,738 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7390206Z 2025-07-08 20:02:57,738 - INFO - Calling Gemini API: 65253 characters (~16313 tokens)
2025-07-08T20:02:57.7395269Z 2025-07-08 20:02:57,739 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7396472Z 2025-07-08 20:02:57,739 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7397277Z 2025-07-08 20:02:57,739 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7415353Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:57.7416708Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:57.7418934Z 2025-07-08 20:02:57,741 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:57.7419896Z 2025-07-08 20:02:57,741 - INFO - Starting dual-pass generation
2025-07-08T20:02:57.7422014Z 2025-07-08 20:02:57,741 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:57.7422799Z 2025-07-08 20:02:57,741 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7423873Z 2025-07-08 20:02:57,741 - INFO - Calling Gemini API: 65253 characters (~16313 tokens)
2025-07-08T20:02:57.7426792Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7427814Z 2025-07-08 20:02:57,742 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7428517Z 2025-07-08 20:02:57,742 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7429410Z 2025-07-08 20:02:57,742 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:57.7430538Z 2025-07-08 20:02:57,742 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:57.7435001Z 2025-07-08 20:02:57,742 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:57.7435747Z 2025-07-08 20:02:57,742 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:57.7436468Z 2025-07-08 20:02:57,743 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:57.7437308Z 2025-07-08 20:02:57,743 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7438186Z 2025-07-08 20:02:57,743 - INFO - Calling Gemini API: 63701 characters (~15925 tokens)
2025-07-08T20:02:57.7439470Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7440467Z 2025-07-08 20:02:57,743 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7441125Z 2025-07-08 20:02:57,743 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7442549Z 2025-07-08 20:02:57,743 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:57.7444326Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:57.7445635Z 2025-07-08 20:02:57,743 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:57.7446876Z 2025-07-08 20:02:57,743 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:57.7448579Z 2025-07-08 20:02:57,743 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:57.7450609Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:57.7451571Z 2025-07-08 20:02:57,744 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:57.7452734Z .2025-07-08 20:02:57,744 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:57.7461660Z ..2025-07-08 20:02:57,745 - ERROR - 🔥🔴 --- EXCEPTION IN: continue_story ---
2025-07-08T20:02:57.7462304Z Args: ([], 'prompt', 'story')
2025-07-08T20:02:57.7462664Z Kwargs: {}
2025-07-08T20:02:57.7463176Z Error: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T20:02:57.7463984Z Traceback:
2025-07-08T20:02:57.7464295Z Traceback (most recent call last):
2025-07-08T20:02:57.7465311Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/decorators.py", line 35, in wrapper
2025-07-08T20:02:57.7466222Z     return func(*args, **kwargs)
2025-07-08T20:02:57.7466611Z            ^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:57.7467254Z TypeError: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T20:02:57.7467951Z --- END EXCEPTION ---
2025-07-08T20:02:58.0507499Z ....2025-07-08 20:02:58,050 - INFO - Extracted JSON from markdown code block
2025-07-08T20:02:58.0513024Z 2025-07-08 20:02:58,050 - INFO - Successfully completed incomplete JSON
2025-07-08T20:02:58.0514111Z 2025-07-08 20:02:58,050 - INFO - Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T20:02:58.0514786Z ..
2025-07-08T20:02:58.0515133Z ----------------------------------------------------------------------
2025-07-08T20:02:58.0515575Z Ran 9 tests in 0.316s
2025-07-08T20:02:58.0515777Z 
2025-07-08T20:02:58.0515877Z OK
2025-07-08T20:02:58.2044377Z ✅ mvp_site/tests/test_json_only_mode.py passed
2025-07-08T20:02:58.2045903Z ----------------------------------------
2025-07-08T20:02:58.2046435Z Running mvp_site/tests/test_json_state_updates_fix.py...
2025-07-08T20:02:59.1402621Z 2025-07-08 20:02:59,140 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:59.1404232Z 2025-07-08 20:02:59,140 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:02:59.1405715Z 2025-07-08 20:02:59,140 - INFO - Recovered from incomplete JSON response. Narrative length: 197 characters (~49 tokens)
2025-07-08T20:02:59.1426463Z 2025-07-08 20:02:59,142 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:59.1432596Z 2025-07-08 20:02:59,143 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T20:02:59.1434711Z 2025-07-08 20:02:59,143 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:02:59.1436780Z 2025-07-08 20:02:59,143 - INFO - Response length: 197 characters (~49 tokens)
2025-07-08T20:02:59.1493428Z .2025-07-08 20:02:59,149 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:59.1500024Z 2025-07-08 20:02:59,149 - INFO - Debug content generated for campaign test-campaign: {'dm_notes': False, 'dice_rolls': False, 'state_changes': True}
2025-07-08T20:02:59.1501775Z 2025-07-08 20:02:59,149 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1503052Z   "player_character_data": {
2025-07-08T20:02:59.1504094Z     "hp_current": 15,
2025-07-08T20:02:59.1504596Z     "combat_state": {
2025-07-08T20:02:59.1504951Z       "is_in_combat": true,
2025-07-08T20:02:59.1505312Z       "current_turn": "player"
2025-07-08T20:02:59.1505661Z     }
2025-07-08T20:02:59.1505922Z   },
2025-07-08T20:02:59.1506179Z   "npc_data": {
2025-07-08T20:02:59.1506478Z     "Goblin_1": {
2025-07-08T20:02:59.1506789Z       "hp_current": 8,
2025-07-08T20:02:59.1507500Z       "status": "wounded"
2025-07-08T20:02:59.1507830Z     }
2025-07-08T20:02:59.1508086Z   }
2025-07-08T20:02:59.1508333Z }
2025-07-08T20:02:59.1508773Z 2025-07-08 20:02:59,149 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1509344Z   "hp_current": 15,
2025-07-08T20:02:59.1509848Z   "combat_state": {
2025-07-08T20:02:59.1510167Z     "is_in_combat": true,
2025-07-08T20:02:59.1510521Z     "current_turn": "player"
2025-07-08T20:02:59.1510869Z   }
2025-07-08T20:02:59.1511117Z }
2025-07-08T20:02:59.1511573Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1512150Z   "is_in_combat": true,
2025-07-08T20:02:59.1512486Z   "current_turn": "player"
2025-07-08T20:02:59.1512821Z }
2025-07-08T20:02:59.1513425Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1514161Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1514897Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1515478Z   "Goblin_1": {
2025-07-08T20:02:59.1515817Z     "hp_current": 8,
2025-07-08T20:02:59.1516144Z     "status": "wounded"
2025-07-08T20:02:59.1516465Z   }
2025-07-08T20:02:59.1516706Z }
2025-07-08T20:02:59.1517153Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1517758Z   "hp_current": 8,
2025-07-08T20:02:59.1518088Z   "status": "wounded"
2025-07-08T20:02:59.1518398Z }
2025-07-08T20:02:59.1518800Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1519501Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1520167Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1522959Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1524690Z   "player_character_data": {
2025-07-08T20:02:59.1527392Z     "hp_current": 15,
2025-07-08T20:02:59.1528229Z     "combat_state": {
2025-07-08T20:02:59.1528571Z       "is_in_combat": true,
2025-07-08T20:02:59.1528947Z       "current_turn": "player"
2025-07-08T20:02:59.1529334Z     }
2025-07-08T20:02:59.1529620Z   },
2025-07-08T20:02:59.1529900Z   "npc_data": {
2025-07-08T20:02:59.1530252Z     "Goblin_1": {
2025-07-08T20:02:59.1530591Z       "hp_current": 8,
2025-07-08T20:02:59.1530952Z       "status": "wounded"
2025-07-08T20:02:59.1531316Z     }
2025-07-08T20:02:59.1531604Z   }
2025-07-08T20:02:59.1531875Z }
2025-07-08T20:02:59.1532368Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1533009Z   "hp_current": 15,
2025-07-08T20:02:59.1533507Z   "combat_state": {
2025-07-08T20:02:59.1533850Z     "is_in_combat": true,
2025-07-08T20:02:59.1534229Z     "current_turn": "player"
2025-07-08T20:02:59.1534575Z   }
2025-07-08T20:02:59.1534840Z }
2025-07-08T20:02:59.1535335Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1535939Z   "is_in_combat": true,
2025-07-08T20:02:59.1536305Z   "current_turn": "player"
2025-07-08T20:02:59.1536654Z }
2025-07-08T20:02:59.1537079Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1537835Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1538609Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1539232Z   "Goblin_1": {
2025-07-08T20:02:59.1539558Z     "hp_current": 8,
2025-07-08T20:02:59.1539917Z     "status": "wounded"
2025-07-08T20:02:59.1540254Z   }
2025-07-08T20:02:59.1540513Z }
2025-07-08T20:02:59.1540994Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1541620Z   "hp_current": 8,
2025-07-08T20:02:59.1541953Z   "status": "wounded"
2025-07-08T20:02:59.1542274Z }
2025-07-08T20:02:59.1542984Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1543864Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1545414Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1546299Z 2025-07-08 20:02:59,152 - INFO - AI proposed changes for campaign test-campaign:\n{
2025-07-08T20:02:59.1547394Z   "custom_campaign_state": {
2025-07-08T20:02:59.1547790Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1548180Z   },
2025-07-08T20:02:59.1548470Z   "player_character_data": {
2025-07-08T20:02:59.1548833Z     "hp_current": 15,
2025-07-08T20:02:59.1549161Z     "combat_state": {
2025-07-08T20:02:59.1549488Z       "is_in_combat": true,
2025-07-08T20:02:59.1549868Z       "current_turn": "player"
2025-07-08T20:02:59.1550220Z     }
2025-07-08T20:02:59.1550477Z   },
2025-07-08T20:02:59.1550737Z   "npc_data": {
2025-07-08T20:02:59.1551037Z     "Goblin_1": {
2025-07-08T20:02:59.1551360Z       "hp_current": 8,
2025-07-08T20:02:59.1551686Z       "status": "wounded"
2025-07-08T20:02:59.1552000Z     }
2025-07-08T20:02:59.1552258Z   }
2025-07-08T20:02:59.1552514Z }
2025-07-08T20:02:59.1554848Z 2025-07-08 20:02:59,153 - INFO - Applying formatted state changes for campaign test-campaign:\nGame state updated (6 entries):\n  - custom_campaign_state.last_story_mode_sequence_id: 2\n  - player_character_data.hp_current: 15\n  - player_character_data.combat_state.is_in_combat: true\n  - player_character_data.combat_state.current_turn: "player"\n  - npc_data.Goblin_1.hp_current: 8\n  - npc_data.Goblin_1.status: "wounded"
2025-07-08T20:02:59.1560579Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1561205Z   "custom_campaign_state": {
2025-07-08T20:02:59.1561597Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1561981Z   },
2025-07-08T20:02:59.1562262Z   "player_character_data": {
2025-07-08T20:02:59.1562637Z     "hp_current": 15,
2025-07-08T20:02:59.1562988Z     "combat_state": {
2025-07-08T20:02:59.1563494Z       "is_in_combat": true,
2025-07-08T20:02:59.1563866Z       "current_turn": "player"
2025-07-08T20:02:59.1564217Z     }
2025-07-08T20:02:59.1564466Z   },
2025-07-08T20:02:59.1564730Z   "npc_data": {
2025-07-08T20:02:59.1565034Z     "Goblin_1": {
2025-07-08T20:02:59.1565348Z       "hp_current": 8,
2025-07-08T20:02:59.1565674Z       "status": "wounded"
2025-07-08T20:02:59.1565994Z     }
2025-07-08T20:02:59.1566240Z   }
2025-07-08T20:02:59.1566490Z }
2025-07-08T20:02:59.1566952Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1567552Z   "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1567929Z }
2025-07-08T20:02:59.1568337Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1569030Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1569581Z   "hp_current": 15,
2025-07-08T20:02:59.1569899Z   "combat_state": {
2025-07-08T20:02:59.1570219Z     "is_in_combat": true,
2025-07-08T20:02:59.1570587Z     "current_turn": "player"
2025-07-08T20:02:59.1570942Z   }
2025-07-08T20:02:59.1571196Z }
2025-07-08T20:02:59.1571627Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1572210Z   "is_in_combat": true,
2025-07-08T20:02:59.1572551Z   "current_turn": "player"
2025-07-08T20:02:59.1572880Z }
2025-07-08T20:02:59.1573439Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1574145Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1574865Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1575427Z   "Goblin_1": {
2025-07-08T20:02:59.1575730Z     "hp_current": 8,
2025-07-08T20:02:59.1576053Z     "status": "wounded"
2025-07-08T20:02:59.1576359Z   }
2025-07-08T20:02:59.1576613Z }
2025-07-08T20:02:59.1577289Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1577841Z   "hp_current": 8,
2025-07-08T20:02:59.1578151Z   "status": "wounded"
2025-07-08T20:02:59.1578464Z }
2025-07-08T20:02:59.1578892Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1579765Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1580380Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1581074Z 2025-07-08 20:02:59,153 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:02:59.1581806Z 2025-07-08 20:02:59,154 - INFO - New complete game state for campaign test-campaign:\n{
2025-07-08T20:02:59.1582361Z   "game_state_version": 1,
2025-07-08T20:02:59.1582706Z   "player_character_data": {
2025-07-08T20:02:59.1583024Z     "hp_current": 15,
2025-07-08T20:02:59.1583619Z     "combat_state": {
2025-07-08T20:02:59.1583935Z       "is_in_combat": true,
2025-07-08T20:02:59.1584254Z       "current_turn": "player"
2025-07-08T20:02:59.1584573Z     }
2025-07-08T20:02:59.1584806Z   },
2025-07-08T20:02:59.1585048Z   "world_data": {},
2025-07-08T20:02:59.1585316Z   "npc_data": {
2025-07-08T20:02:59.1585578Z     "Goblin_1": {
2025-07-08T20:02:59.1585856Z       "hp_current": 8,
2025-07-08T20:02:59.1586161Z       "status": "wounded"
2025-07-08T20:02:59.1586454Z     }
2025-07-08T20:02:59.1586677Z   },
2025-07-08T20:02:59.1586934Z   "custom_campaign_state": {
2025-07-08T20:02:59.1587281Z     "attribute_system": "D&D",
2025-07-08T20:02:59.1587638Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1587976Z   },
2025-07-08T20:02:59.1588231Z ... (truncated, showing 20/30 lines)
2025-07-08T20:02:59.1588587Z .
2025-07-08T20:02:59.1588910Z ----------------------------------------------------------------------
2025-07-08T20:02:59.1589353Z Ran 2 tests in 0.022s
2025-07-08T20:02:59.1589544Z 
2025-07-08T20:02:59.1590864Z OK
2025-07-08T20:02:59.3248817Z ✅ mvp_site/tests/test_json_state_updates_fix.py passed
2025-07-08T20:02:59.3250285Z ----------------------------------------
2025-07-08T20:02:59.3250763Z Running mvp_site/tests/test_json_utils.py...
2025-07-08T20:02:59.3727162Z ........................................................
2025-07-08T20:02:59.3729181Z ----------------------------------------------------------------------
2025-07-08T20:02:59.3730917Z Ran 56 tests in 0.004s
2025-07-08T20:02:59.3731144Z 
2025-07-08T20:02:59.3731263Z OK
2025-07-08T20:02:59.3793153Z ✅ mvp_site/tests/test_json_utils.py passed
2025-07-08T20:02:59.3794689Z ----------------------------------------
2025-07-08T20:02:59.3795179Z Running mvp_site/tests/test_llm_response.py...
2025-07-08T20:02:59.4260870Z test_backwards_compatibility (__main__.TestLLMResponse.test_backwards_compatibility)
2025-07-08T20:02:59.4264015Z Test that old GeminiResponse interface still works. ... ok
2025-07-08T20:02:59.4264791Z test_debug_tag_detection (__main__.TestLLMResponse.test_debug_tag_detection)
2025-07-08T20:02:59.4265528Z Test automatic debug tag detection. ... ok
2025-07-08T20:02:59.4266190Z test_factory_function (__main__.TestLLMResponse.test_factory_function)
2025-07-08T20:02:59.4266926Z Test the factory function for creating responses. ... ok
2025-07-08T20:02:59.4267757Z test_gemini_llm_response_creation (__main__.TestLLMResponse.test_gemini_llm_response_creation)
2025-07-08T20:02:59.4268574Z Test creating GeminiLLMResponse directly. ... ok
2025-07-08T20:02:59.4269256Z test_invalid_response_handling (__main__.TestLLMResponse.test_invalid_response_handling)
2025-07-08T20:02:59.4270431Z Test handling of invalid responses. ... ERROR:root:ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:59.4280282Z ok
2025-07-08T20:02:59.4280861Z test_to_dict_serialization (__main__.TestLLMResponse.test_to_dict_serialization)
2025-07-08T20:02:59.4281649Z Test converting response to dictionary for API usage. ... ok
2025-07-08T20:02:59.4282751Z test_unsupported_provider (__main__.TestLLMResponse.test_unsupported_provider)
2025-07-08T20:02:59.4283686Z Test that unsupported providers raise appropriate errors. ... ok
2025-07-08T20:02:59.4284084Z 
2025-07-08T20:02:59.4284291Z ----------------------------------------------------------------------
2025-07-08T20:02:59.4284784Z Ran 7 tests in 0.001s
2025-07-08T20:02:59.4285231Z 
2025-07-08T20:02:59.4285337Z OK
2025-07-08T20:02:59.4350590Z ✅ mvp_site/tests/test_llm_response.py passed
2025-07-08T20:02:59.4351926Z ----------------------------------------
2025-07-08T20:02:59.4352434Z Running mvp_site/tests/test_loading_messages.py...
2025-07-08T20:02:59.4725417Z .....
2025-07-08T20:02:59.4726459Z ----------------------------------------------------------------------
2025-07-08T20:02:59.4727997Z Ran 5 tests in 0.001s
2025-07-08T20:02:59.4728470Z 
2025-07-08T20:02:59.4728736Z OK
2025-07-08T20:02:59.4785448Z ✅ mvp_site/tests/test_loading_messages.py passed
2025-07-08T20:02:59.4786765Z ----------------------------------------
2025-07-08T20:02:59.4787375Z Running mvp_site/tests/test_luke_campaign_god_mode_json_bug.py...
2025-07-08T20:02:59.5246215Z ....
2025-07-08T20:02:59.5248098Z ----------------------------------------------------------------------
2025-07-08T20:02:59.5248605Z Ran 4 tests in 0.000s
2025-07-08T20:02:59.5248818Z 
2025-07-08T20:02:59.5248979Z OK
2025-07-08T20:02:59.5318334Z ✅ mvp_site/tests/test_luke_campaign_god_mode_json_bug.py passed
2025-07-08T20:02:59.5319395Z ----------------------------------------
2025-07-08T20:02:59.5320438Z Running mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py...
2025-07-08T20:02:59.7462358Z ...
2025-07-08T20:02:59.7462859Z ----------------------------------------------------------------------
2025-07-08T20:02:59.7463510Z Ran 3 tests in 0.000s
2025-07-08T20:02:59.7463711Z 
2025-07-08T20:02:59.7463824Z OK
2025-07-08T20:02:59.7696934Z ✅ mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py passed
2025-07-08T20:02:59.7699180Z ----------------------------------------
2025-07-08T20:02:59.7699616Z Running mvp_site/tests/test_main.py...
2025-07-08T20:03:00.6538930Z 2025-07-08 20:03:00,653 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6600489Z .2025-07-08 20:03:00,659 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6602084Z 2025-07-08 20:03:00,659 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:00.6603129Z 2025-07-08 20:03:00,659 - INFO - GOD_MODE_SET raw payload:\n---\n
2025-07-08T20:03:00.6606429Z player.level = 5
2025-07-08T20:03:00.6606793Z player.hp = 50\n---
2025-07-08T20:03:00.6607322Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:00.6607909Z   "player": {
2025-07-08T20:03:00.6608220Z     "level": 5,
2025-07-08T20:03:00.6608522Z     "hp": 50
2025-07-08T20:03:00.6608810Z   }
2025-07-08T20:03:00.6609097Z }
2025-07-08T20:03:00.6609524Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:00.6614746Z   "game_state_version": 1,
2025-07-08T20:03:00.6615181Z   "player_character_data": {},
2025-07-08T20:03:00.6615591Z   "world_data": {},
2025-07-08T20:03:00.6615943Z   "npc_data": {},
2025-07-08T20:03:00.6616324Z   "custom_campaign_state": {
2025-07-08T20:03:00.6616735Z     "attribute_system": "D&D"
2025-07-08T20:03:00.6617115Z   },
2025-07-08T20:03:00.6617402Z   "combat_state": {
2025-07-08T20:03:00.6617733Z     "in_combat": false
2025-07-08T20:03:00.6618074Z   },
2025-07-08T20:03:00.6618522Z   "last_state_update_timestamp": "2025-07-08 20:03:00.659823+00:00",
2025-07-08T20:03:00.6619113Z   "time_sensitive_events": {},
2025-07-08T20:03:00.6619530Z   "npc_agendas": {},
2025-07-08T20:03:00.6619887Z   "world_resources": {},
2025-07-08T20:03:00.6620272Z   "time_pressure_warnings": {},
2025-07-08T20:03:00.6620649Z   "debug_mode": true,
2025-07-08T20:03:00.6620985Z   "player": {
2025-07-08T20:03:00.6621788Z     "name": "Hero",
2025-07-08T20:03:00.6622149Z ... (truncated, showing 19/22 lines)
2025-07-08T20:03:00.6622849Z 2025-07-08 20:03:00,660 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:00.6623853Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:00.6624633Z   "player": {
2025-07-08T20:03:00.6624949Z     "name": "Hero",
2025-07-08T20:03:00.6625271Z     "level": 5,
2025-07-08T20:03:00.6625581Z     "hp": 50
2025-07-08T20:03:00.6625882Z   }
2025-07-08T20:03:00.6626156Z }
2025-07-08T20:03:00.6630572Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - player.level: 5\n  - player.hp: 50
2025-07-08T20:03:00.6631864Z 2025-07-08 20:03:00,661 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:00.6678422Z .2025-07-08 20:03:00,667 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6681673Z 2025-07-08 20:03:00,667 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:00.6736442Z .2025-07-08 20:03:00,673 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6785429Z .2025-07-08 20:03:00,678 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6840490Z .2025-07-08 20:03:00,683 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6846694Z 2025-07-08 20:03:00,684 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T20:03:00.6848593Z 2025-07-08 20:03:00,684 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:03:00.6850911Z 2025-07-08 20:03:00,684 - INFO - Response length: 47 characters (~11 tokens)
2025-07-08T20:03:00.6892332Z .........2025-07-08 20:03:00,689 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: player.data = {invalid json}
2025-07-08T20:03:00.6976754Z ......
2025-07-08T20:03:00.6978688Z ----------------------------------------------------------------------
2025-07-08T20:03:00.6980231Z Ran 20 tests in 0.043s
2025-07-08T20:03:00.6981904Z 
2025-07-08T20:03:00.6982560Z OK
2025-07-08T20:03:00.8464094Z ✅ mvp_site/tests/test_main.py passed
2025-07-08T20:03:00.8465553Z ----------------------------------------
2025-07-08T20:03:00.8466030Z Running mvp_site/tests/test_main_auth.py...
2025-07-08T20:03:01.7537548Z ............
2025-07-08T20:03:01.7538528Z ----------------------------------------------------------------------
2025-07-08T20:03:01.7539334Z Ran 12 tests in 0.057s
2025-07-08T20:03:01.7540571Z 
2025-07-08T20:03:01.7540716Z OK
2025-07-08T20:03:01.9081889Z ✅ mvp_site/tests/test_main_auth.py passed
2025-07-08T20:03:01.9083901Z ----------------------------------------
2025-07-08T20:03:01.9084446Z Running mvp_site/tests/test_main_auth_state_phase2.py...
2025-07-08T20:03:02.8031499Z .................
2025-07-08T20:03:02.8035704Z ----------------------------------------------------------------------
2025-07-08T20:03:02.8039345Z Ran 17 tests in 0.037s
2025-07-08T20:03:02.8042308Z 
2025-07-08T20:03:02.8044396Z OK
2025-07-08T20:03:02.9320430Z ✅ mvp_site/tests/test_main_auth_state_phase2.py passed
2025-07-08T20:03:02.9321914Z ----------------------------------------
2025-07-08T20:03:02.9322478Z Running mvp_site/tests/test_main_authentication_advanced.py...
2025-07-08T20:03:03.8646261Z sssssssssssssssssssssssss
2025-07-08T20:03:03.8647265Z ----------------------------------------------------------------------
2025-07-08T20:03:03.8648072Z Ran 25 tests in 0.000s
2025-07-08T20:03:03.8649380Z 
2025-07-08T20:03:03.8649530Z OK (skipped=25)
2025-07-08T20:03:04.0502674Z ✅ mvp_site/tests/test_main_authentication_advanced.py passed
2025-07-08T20:03:04.0506686Z ----------------------------------------
2025-07-08T20:03:04.0507260Z Running mvp_site/tests/test_main_error_handling_final.py...
2025-07-08T20:03:04.9696805Z test_arrays_and_objects (__main__.TestParseSetCommandErrorHandling.test_arrays_and_objects)
2025-07-08T20:03:04.9698155Z Test complex JSON structures ... ok
2025-07-08T20:03:04.9702120Z test_edge_cases (__main__.TestParseSetCommandErrorHandling.test_edge_cases)
2025-07-08T20:03:04.9708984Z Test various edge cases ... ok
2025-07-08T20:03:04.9710196Z test_empty_values_and_whitespace (__main__.TestParseSetCommandErrorHandling.test_empty_values_and_whitespace)
2025-07-08T20:03:04.9711482Z Test handling of empty values and whitespace ... ok
2025-07-08T20:03:04.9712515Z test_escaped_characters (__main__.TestParseSetCommandErrorHandling.test_escaped_characters)
2025-07-08T20:03:04.9714502Z Test escaped characters in JSON strings ... ok
2025-07-08T20:03:04.9715297Z test_json_decode_errors (__main__.TestParseSetCommandErrorHandling.test_json_decode_errors)
2025-07-08T20:03:04.9717529Z Test handling of invalid JSON values ... ok
2025-07-08T20:03:04.9718726Z test_lines_without_equals (__main__.TestParseSetCommandErrorHandling.test_lines_without_equals)
2025-07-08T20:03:04.9719863Z Test lines that don't contain equals sign are ignored ... ok
2025-07-08T20:03:04.9721124Z test_numeric_boolean_null_values (__main__.TestParseSetCommandErrorHandling.test_numeric_boolean_null_values)
2025-07-08T20:03:04.9722686Z Test various value types ... ok
2025-07-08T20:03:04.9723861Z test_special_characters_in_values (__main__.TestParseSetCommandErrorHandling.test_special_characters_in_values)
2025-07-08T20:03:04.9724868Z Test values containing special characters ... ok
2025-07-08T20:03:04.9726325Z test_unicode_and_emoji (__main__.TestParseSetCommandErrorHandling.test_unicode_and_emoji)
2025-07-08T20:03:04.9727006Z Test unicode characters and emoji ... ok
2025-07-08T20:03:04.9727634Z test_very_long_values (__main__.TestParseSetCommandErrorHandling.test_very_long_values)
2025-07-08T20:03:04.9728306Z Test handling of very long values ... ok
2025-07-08T20:03:04.9728574Z 
2025-07-08T20:03:04.9728770Z ----------------------------------------------------------------------
2025-07-08T20:03:04.9729223Z Ran 10 tests in 0.003s
2025-07-08T20:03:04.9729417Z 
2025-07-08T20:03:04.9729521Z OK
2025-07-08T20:03:05.1329851Z ✅ mvp_site/tests/test_main_error_handling_final.py passed
2025-07-08T20:03:05.1330462Z ----------------------------------------
2025-07-08T20:03:05.1330920Z Running mvp_site/tests/test_main_god_mode.py...
2025-07-08T20:03:05.9733878Z 2025-07-08 20:03:05,973 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9806656Z .2025-07-08 20:03:05,980 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9809295Z 2025-07-08 20:03:05,980 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9810404Z 2025-07-08 20:03:05,980 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = {invalid: json, missing_quotes: true}\n---
2025-07-08T20:03:05.9812165Z 2025-07-08 20:03:05,980 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: current_scene = {invalid: json, missing_quotes: true}
2025-07-08T20:03:05.9813526Z 2025-07-08 20:03:05,980 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T20:03:05.9814570Z 2025-07-08 20:03:05,980 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T20:03:05.9860965Z .2025-07-08 20:03:05,985 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9864138Z 2025-07-08 20:03:05,985 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9865003Z 2025-07-08 20:03:05,985 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2\n---
2025-07-08T20:03:05.9866220Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:05.9866795Z   "current_scene": 2
2025-07-08T20:03:05.9867127Z }
2025-07-08T20:03:05.9867540Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:05.9868094Z   "game_state_version": 1,
2025-07-08T20:03:05.9868727Z   "player_character_data": {},
2025-07-08T20:03:05.9869119Z   "world_data": {},
2025-07-08T20:03:05.9869436Z   "npc_data": {},
2025-07-08T20:03:05.9869779Z   "custom_campaign_state": {
2025-07-08T20:03:05.9870193Z     "attribute_system": "D&D"
2025-07-08T20:03:05.9870571Z   },
2025-07-08T20:03:05.9870862Z   "combat_state": {
2025-07-08T20:03:05.9871214Z     "in_combat": false
2025-07-08T20:03:05.9871559Z   },
2025-07-08T20:03:05.9871999Z   "last_state_update_timestamp": "2025-07-08 20:03:05.985783+00:00",
2025-07-08T20:03:05.9872605Z   "time_sensitive_events": {},
2025-07-08T20:03:05.9873018Z   "npc_agendas": {},
2025-07-08T20:03:05.9873570Z   "world_resources": {},
2025-07-08T20:03:05.9873981Z   "time_pressure_warnings": {},
2025-07-08T20:03:05.9874392Z   "debug_mode": true
2025-07-08T20:03:05.9874715Z }
2025-07-08T20:03:05.9875199Z 2025-07-08 20:03:05,986 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:05.9875835Z   "current_scene": 2
2025-07-08T20:03:05.9876165Z }
2025-07-08T20:03:05.9876627Z 2025-07-08 20:03:05,986 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:05.9890293Z 2025-07-08 20:03:05,986 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:05.9891153Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:05.9891726Z   "game_state_version": 1,
2025-07-08T20:03:05.9892129Z   "player_character_data": {},
2025-07-08T20:03:05.9892521Z   "world_data": {},
2025-07-08T20:03:05.9893812Z   "npc_data": {},
2025-07-08T20:03:05.9894372Z   "custom_campaign_state": {
2025-07-08T20:03:05.9895033Z     "attribute_system": "D&D"
2025-07-08T20:03:05.9897823Z   },
2025-07-08T20:03:05.9901768Z   "combat_state": {
2025-07-08T20:03:05.9902144Z     "in_combat": false
2025-07-08T20:03:05.9902478Z   },
2025-07-08T20:03:05.9902900Z   "last_state_update_timestamp": "2025-07-08 20:03:05.985783+00:00",
2025-07-08T20:03:05.9903651Z   "time_sensitive_events": {},
2025-07-08T20:03:05.9904070Z   "npc_agendas": {},
2025-07-08T20:03:05.9904458Z   "world_resources": {},
2025-07-08T20:03:05.9904856Z   "time_pressure_warnings": {},
2025-07-08T20:03:05.9905254Z   "debug_mode": true,
2025-07-08T20:03:05.9905601Z   "current_scene": 2
2025-07-08T20:03:05.9905922Z }
2025-07-08T20:03:05.9906711Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (1 entry):\n  - current_scene: 2
2025-07-08T20:03:05.9907866Z 2025-07-08 20:03:05,987 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:05.9938107Z .2025-07-08 20:03:05,993 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9943882Z 2025-07-08 20:03:05,993 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9944772Z 2025-07-08 20:03:05,993 - INFO - GOD_MODE_SET raw payload:\n---\n ["not", "an", "object"]\n---
2025-07-08T20:03:05.9945621Z 2025-07-08 20:03:05,993 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T20:03:05.9946666Z 2025-07-08 20:03:05,993 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T20:03:05.9992656Z .2025-07-08 20:03:05,999 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9994361Z 2025-07-08 20:03:05,999 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9996592Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2
2025-07-08T20:03:05.9998485Z npcs = [{"name": "Test NPC"}]\n---
2025-07-08T20:03:05.9999088Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:05.9999907Z   "current_scene": 2,
2025-07-08T20:03:06.0000255Z   "npcs": [
2025-07-08T20:03:06.0000533Z     {
2025-07-08T20:03:06.0000832Z       "name": "Test NPC"
2025-07-08T20:03:06.0001173Z     }
2025-07-08T20:03:06.0001433Z   ]
2025-07-08T20:03:06.0001893Z }
2025-07-08T20:03:06.0002308Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:06.0008872Z   "game_state_version": 1,
2025-07-08T20:03:06.0009323Z   "player_character_data": {},
2025-07-08T20:03:06.0009737Z   "world_data": {},
2025-07-08T20:03:06.0010069Z   "npc_data": {},
2025-07-08T20:03:06.0010413Z   "custom_campaign_state": {
2025-07-08T20:03:06.0010824Z     "attribute_system": "D&D"
2025-07-08T20:03:06.0011200Z   },
2025-07-08T20:03:06.0011477Z   "combat_state": {
2025-07-08T20:03:06.0011822Z     "in_combat": false
2025-07-08T20:03:06.0012156Z   },
2025-07-08T20:03:06.0012582Z   "last_state_update_timestamp": "2025-07-08 20:03:05.999065+00:00",
2025-07-08T20:03:06.0013181Z   "time_sensitive_events": {},
2025-07-08T20:03:06.0013745Z   "npc_agendas": {},
2025-07-08T20:03:06.0014100Z   "world_resources": {},
2025-07-08T20:03:06.0014507Z   "time_pressure_warnings": {},
2025-07-08T20:03:06.0014932Z   "debug_mode": true,
2025-07-08T20:03:06.0015297Z   "current_scene": 1,
2025-07-08T20:03:06.0015650Z   "npcs": []
2025-07-08T20:03:06.0015959Z }
2025-07-08T20:03:06.0016456Z 2025-07-08 20:03:05,999 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:06.0017084Z   "current_scene": 2,
2025-07-08T20:03:06.0017429Z   "npcs": [
2025-07-08T20:03:06.0017777Z     {
2025-07-08T20:03:06.0018065Z       "name": "Test NPC"
2025-07-08T20:03:06.0018409Z     }
2025-07-08T20:03:06.0018665Z   ]
2025-07-08T20:03:06.0018925Z }
2025-07-08T20:03:06.0019371Z 2025-07-08 20:03:05,999 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:06.0020129Z 2025-07-08 20:03:05,999 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:06.0020874Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:06.0021403Z   "game_state_version": 1,
2025-07-08T20:03:06.0021790Z   "player_character_data": {},
2025-07-08T20:03:06.0022165Z   "world_data": {},
2025-07-08T20:03:06.0022477Z   "npc_data": {},
2025-07-08T20:03:06.0022822Z   "custom_campaign_state": {
2025-07-08T20:03:06.0023392Z     "attribute_system": "D&D"
2025-07-08T20:03:06.0023754Z   },
2025-07-08T20:03:06.0024039Z   "combat_state": {
2025-07-08T20:03:06.0024346Z     "in_combat": false
2025-07-08T20:03:06.0024659Z   },
2025-07-08T20:03:06.0025033Z   "last_state_update_timestamp": "2025-07-08 20:03:05.999065+00:00",
2025-07-08T20:03:06.0025562Z   "time_sensitive_events": {},
2025-07-08T20:03:06.0025941Z   "npc_agendas": {},
2025-07-08T20:03:06.0026320Z   "world_resources": {},
2025-07-08T20:03:06.0026663Z   "time_pressure_warnings": {},
2025-07-08T20:03:06.0027034Z   "debug_mode": true,
2025-07-08T20:03:06.0027382Z   "current_scene": 2,
2025-07-08T20:03:06.0027725Z   "npcs": [
2025-07-08T20:03:06.0028042Z ... (truncated, showing 19/24 lines)
2025-07-08T20:03:06.0029106Z 2025-07-08 20:03:06,000 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - current_scene: 2\n  - npcs: [{"name": "Test NPC"}]
2025-07-08T20:03:06.0030266Z 2025-07-08 20:03:06,000 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:06.0076487Z .2025-07-08 20:03:06,007 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Invalid state data
2025-07-08T20:03:06.0079370Z 2025-07-08 20:03:06,007 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T20:03:06.0086493Z 2025-07-08 20:03:06,008 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T20:03:06.0088333Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 645, in handle_interaction
2025-07-08T20:03:06.0095190Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0098031Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0099109Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 73, in _prepare_game_state
2025-07-08T20:03:06.0100427Z     current_game_state = GameState.from_dict(current_game_state_doc.to_dict())
2025-07-08T20:03:06.0101130Z                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0102199Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:06.0103020Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:06.0103647Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0104484Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:06.0105373Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:06.0105896Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0106841Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:06.0107697Z     raise effect
2025-07-08T20:03:06.0108057Z ValueError: Invalid state data
2025-07-08T20:03:06.0108347Z 
2025-07-08T20:03:06.0173459Z .2025-07-08 20:03:06,017 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0217363Z .2025-07-08 20:03:06,021 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0261941Z .2025-07-08 20:03:06,025 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0306838Z .2025-07-08 20:03:06,030 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Unexpected database error
2025-07-08T20:03:06.0313127Z 2025-07-08 20:03:06,030 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T20:03:06.0314313Z 2025-07-08 20:03:06,030 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T20:03:06.0315428Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 645, in handle_interaction
2025-07-08T20:03:06.0316598Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0317359Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0318433Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 69, in _prepare_game_state
2025-07-08T20:03:06.0319573Z     current_game_state_doc = firestore_service.get_campaign_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0320332Z                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0321419Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:06.0322280Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:06.0322750Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0323805Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:06.0324694Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:06.0325208Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0326174Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:06.0327058Z     raise effect
2025-07-08T20:03:06.0327418Z Exception: Unexpected database error
2025-07-08T20:03:06.0327733Z 
2025-07-08T20:03:06.0384418Z .2025-07-08 20:03:06,038 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0386250Z 2025-07-08 20:03:06,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:06.0388075Z   "current_scene": 2,
2025-07-08T20:03:06.0388658Z   "hp": 80
2025-07-08T20:03:06.0389139Z }
2025-07-08T20:03:06.0390755Z 2025-07-08 20:03:06,038 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:06.0405620Z 2025-07-08 20:03:06,040 - INFO - COMBAT CLEANUP CHECK: Found 0 combatants, scanning for defeated enemies...
2025-07-08T20:03:06.0413896Z 2025-07-08 20:03:06,041 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: <MagicMock name='GameState.from_dict().cleanup_defeated_enemies()' id='139849902954320'>
2025-07-08T20:03:06.0597597Z ......
2025-07-08T20:03:06.0599085Z ----------------------------------------------------------------------
2025-07-08T20:03:06.0599558Z Ran 16 tests in 0.094s
2025-07-08T20:03:06.0599755Z 
2025-07-08T20:03:06.0599868Z OK
2025-07-08T20:03:06.1921872Z ✅ mvp_site/tests/test_main_god_mode.py passed
2025-07-08T20:03:06.1923551Z ----------------------------------------
2025-07-08T20:03:06.1924069Z Running mvp_site/tests/test_main_route_edge_cases.py...
2025-07-08T20:03:07.1343036Z sssssssssssssssssssssssss
2025-07-08T20:03:07.1344365Z ----------------------------------------------------------------------
2025-07-08T20:03:07.1345068Z Ran 25 tests in 0.000s
2025-07-08T20:03:07.1345303Z 
2025-07-08T20:03:07.1345436Z OK (skipped=25)
2025-07-08T20:03:07.2803712Z ✅ mvp_site/tests/test_main_route_edge_cases.py passed
2025-07-08T20:03:07.2805293Z ----------------------------------------
2025-07-08T20:03:07.2805789Z Running mvp_site/tests/test_main_routes.py...
2025-07-08T20:03:08.1485913Z 2025-07-08 20:03:08,148 - INFO - Received custom_options: []
2025-07-08T20:03:08.1487132Z 2025-07-08 20:03:08,148 - INFO - Selected attribute_system: D&D
2025-07-08T20:03:08.1539946Z .2025-07-08 20:03:08,153 - INFO - Received custom_options: ['companions', 'defaultWorld']
2025-07-08T20:03:08.1541162Z 2025-07-08 20:03:08,153 - INFO - Selected attribute_system: D&D
2025-07-08T20:03:08.1705073Z ...2025-07-08 20:03:08,170 - INFO - Exporting file '/tmp/campaign_exports/test-uuid.txt' with download_name='Test Campaign.txt'
2025-07-08T20:03:08.2078775Z ........Traceback (most recent call last):
2025-07-08T20:03:08.2081935Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 620, in update_campaign
2025-07-08T20:03:08.2083112Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T20:03:08.2084424Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:08.2085286Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:08.2085737Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:08.2086613Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:08.2087525Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:08.2088028Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:08.2088952Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:08.2089865Z     raise effect
2025-07-08T20:03:08.2090233Z Exception: Update failed
2025-07-08T20:03:08.2244052Z .....
2025-07-08T20:03:08.2246295Z ----------------------------------------------------------------------
2025-07-08T20:03:08.2246800Z Ran 17 tests in 0.083s
2025-07-08T20:03:08.2248074Z 
2025-07-08T20:03:08.2251341Z OK
2025-07-08T20:03:08.3629618Z ✅ mvp_site/tests/test_main_routes.py passed
2025-07-08T20:03:08.3632433Z ----------------------------------------
2025-07-08T20:03:08.3633000Z Running mvp_site/tests/test_main_routes_comprehensive.py...
2025-07-08T20:03:09.2169556Z ...2025-07-08 20:03:09,216 - INFO - Legacy state cleanup complete. Removed 5 entries.
2025-07-08T20:03:09.2171658Z .
2025-07-08T20:03:09.2172009Z ----------------------------------------------------------------------
2025-07-08T20:03:09.2173020Z Ran 4 tests in 0.006s
2025-07-08T20:03:09.2173495Z 
2025-07-08T20:03:09.2173603Z OK
2025-07-08T20:03:09.3745908Z ✅ mvp_site/tests/test_main_routes_comprehensive.py passed
2025-07-08T20:03:09.3747761Z ----------------------------------------
2025-07-08T20:03:09.3748291Z Running mvp_site/tests/test_main_security_validation.py...
2025-07-08T20:03:09.4798549Z .........../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py:1567: UserWarning: Duplicate name: 'file1.txt'
2025-07-08T20:03:09.4799918Z   return self._open_to_write(zinfo, force_zip64=force_zip64)
2025-07-08T20:03:09.4897974Z .................
2025-07-08T20:03:09.4898907Z ----------------------------------------------------------------------
2025-07-08T20:03:09.4900036Z Ran 28 tests in 0.045s
2025-07-08T20:03:09.4900917Z 
2025-07-08T20:03:09.4902169Z OK
2025-07-08T20:03:09.5046039Z ✅ mvp_site/tests/test_main_security_validation.py passed
2025-07-08T20:03:09.5048002Z ----------------------------------------
2025-07-08T20:03:09.5048553Z Running mvp_site/tests/test_main_state_helper.py...
2025-07-08T20:03:10.3897950Z .........s.......
2025-07-08T20:03:10.3899516Z ----------------------------------------------------------------------
2025-07-08T20:03:10.3900026Z Ran 17 tests in 0.019s
2025-07-08T20:03:10.3900230Z 
2025-07-08T20:03:10.3900387Z OK (skipped=1)
2025-07-08T20:03:10.5249789Z ✅ mvp_site/tests/test_main_state_helper.py passed
2025-07-08T20:03:10.5251280Z ----------------------------------------
2025-07-08T20:03:10.5251885Z Running mvp_site/tests/test_milestone_4_interactive_features.py...
2025-07-08T20:03:10.5657812Z 🚀 Starting Milestone 4: Interactive Features Test Suite
2025-07-08T20:03:10.5659494Z ============================================================
2025-07-08T20:03:10.5660190Z 🧪 Testing Milestone 4: Interactive Features
2025-07-08T20:03:10.5660671Z ============================================================
2025-07-08T20:03:10.5661486Z test_accessibility_features (__main__.TestMilestone4InteractiveFeatures.test_accessibility_features)
2025-07-08T20:03:10.5666070Z Test that interactive features maintain accessibility ... ✅ Interactive features maintain accessibility standards
2025-07-08T20:03:10.5667732Z ok
2025-07-08T20:03:10.5668448Z test_backward_compatibility (__main__.TestMilestone4InteractiveFeatures.test_backward_compatibility)
2025-07-08T20:03:10.5671854Z Test that features maintain backward compatibility ... ✅ All features maintain backward compatibility
2025-07-08T20:03:10.5673781Z ok
2025-07-08T20:03:10.5674540Z test_campaign_wizard_html_structure (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_html_structure)
2025-07-08T20:03:10.5677846Z Test campaign wizard generates proper HTML structure ... ✅ Campaign wizard generates proper HTML structure
2025-07-08T20:03:10.5679503Z ok
2025-07-08T20:03:10.5680196Z test_campaign_wizard_js_exists (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_js_exists)
2025-07-08T20:03:10.5683832Z Test that campaign wizard JavaScript file exists ... ✅ Campaign Wizard JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5685639Z ok
2025-07-08T20:03:10.5686358Z test_css_modern_mode_selectors (__main__.TestMilestone4InteractiveFeatures.test_css_modern_mode_selectors)
2025-07-08T20:03:10.5687951Z Test CSS has proper modern mode selectors ... ✅ CSS has proper modern mode selectors and responsive design
2025-07-08T20:03:10.5688918Z ok
2025-07-08T20:03:10.5689618Z test_css_theme_integration (__main__.TestMilestone4InteractiveFeatures.test_css_theme_integration)
2025-07-08T20:03:10.5691072Z Test CSS integrates properly with existing theme system ... ✅ CSS integrates properly with existing theme system
2025-07-08T20:03:10.5693045Z ok
2025-07-08T20:03:10.5694921Z test_enhanced_search_features (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_features)
2025-07-08T20:03:10.5696251Z Test enhanced search has all required features ... ✅ Enhanced search has all required features
2025-07-08T20:03:10.5697295Z ok
2025-07-08T20:03:10.5699271Z test_enhanced_search_js_exists (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_js_exists)
2025-07-08T20:03:10.5701570Z Test that enhanced search JavaScript file exists ... ✅ Enhanced Search JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5702706Z ok
2025-07-08T20:03:10.5703474Z test_error_handling (__main__.TestMilestone4InteractiveFeatures.test_error_handling)
2025-07-08T20:03:10.5706240Z Test that features handle errors gracefully ... ✅ Features include proper error handling
2025-07-08T20:03:10.5707744Z ok
2025-07-08T20:03:10.5708445Z test_file_integration_order (__main__.TestMilestone4InteractiveFeatures.test_file_integration_order)
2025-07-08T20:03:10.5709963Z Test that files are loaded in the correct order ... ✅ JavaScript files are loaded in correct dependency order
2025-07-08T20:03:10.5710941Z ok
2025-07-08T20:03:10.5711742Z test_index_html_has_interface_toggle (__main__.TestMilestone4InteractiveFeatures.test_index_html_has_interface_toggle)
2025-07-08T20:03:10.5714757Z Test that index.html contains the interface mode toggle ... ✅ index.html contains interface mode toggle UI
2025-07-08T20:03:10.5716406Z ok
2025-07-08T20:03:10.5717155Z test_index_html_includes_scripts (__main__.TestMilestone4InteractiveFeatures.test_index_html_includes_scripts)
2025-07-08T20:03:10.5718724Z Test that index.html includes all necessary script files ... ✅ index.html includes all interactive features scripts and CSS
2025-07-08T20:03:10.5719627Z ok
2025-07-08T20:03:10.5720632Z test_interactive_features_css_exists (__main__.TestMilestone4InteractiveFeatures.test_interactive_features_css_exists)
2025-07-08T20:03:10.5722445Z Test that interactive features CSS file exists ... ✅ Interactive Features CSS file exists and contains styling rules
2025-07-08T20:03:10.5723640Z ok
2025-07-08T20:03:10.5725675Z test_interface_manager_feature_control (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_feature_control)
2025-07-08T20:03:10.5728093Z Test interface manager can control features ... ✅ Interface manager has proper feature control methods
2025-07-08T20:03:10.5728826Z ok
2025-07-08T20:03:10.5729553Z test_interface_manager_js_exists (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_js_exists)
2025-07-08T20:03:10.5731128Z Test that interface manager JavaScript file exists ... ✅ Interface Manager JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5732549Z ok
2025-07-08T20:03:10.5733450Z test_javascript_file_structure (__main__.TestMilestone4InteractiveFeatures.test_javascript_file_structure)
2025-07-08T20:03:10.5735406Z Test JavaScript files have proper structure ... ✅ All JavaScript files have proper structure and integration
2025-07-08T20:03:10.5736164Z ok
2025-07-08T20:03:10.5736869Z test_performance_considerations (__main__.TestMilestone4InteractiveFeatures.test_performance_considerations)
2025-07-08T20:03:10.5739175Z Test that features are optimized for performance ... ✅ Features include performance optimizations
2025-07-08T20:03:10.5740731Z ok
2025-07-08T20:03:10.5741452Z test_progressive_enhancement (__main__.TestMilestone4InteractiveFeatures.test_progressive_enhancement)
2025-07-08T20:03:10.5745542Z Test that features use progressive enhancement ... ✅ Features use progressive enhancement and default to safe mode
2025-07-08T20:03:10.5747170Z ok
2025-07-08T20:03:10.5747324Z 
2025-07-08T20:03:10.5747533Z ----------------------------------------------------------------------
2025-07-08T20:03:10.5748043Z Ran 18 tests in 0.009s
2025-07-08T20:03:10.5748259Z 
2025-07-08T20:03:10.5748371Z OK
2025-07-08T20:03:10.5748516Z 
2025-07-08T20:03:10.5748663Z ============================================================
2025-07-08T20:03:10.5749152Z 🎯 MILESTONE 4 TEST SUMMARY
2025-07-08T20:03:10.5749507Z ============================================================
2025-07-08T20:03:10.5749951Z ✅ Passed: 18/18
2025-07-08T20:03:10.5750124Z 
2025-07-08T20:03:10.5750439Z 🎉 MILESTONE 4: INTERACTIVE FEATURES - ALL TESTS PASSED!
2025-07-08T20:03:10.5751224Z 📋 Features Ready:
2025-07-08T20:03:10.5751636Z    • Master Interface Toggle (Classic/Modern)
2025-07-08T20:03:10.5752146Z    • Campaign Wizard (Multi-step Creation)
2025-07-08T20:03:10.5752599Z    • Enhanced Search & Filter
2025-07-08T20:03:10.5752994Z    • Enhanced Modals
2025-07-08T20:03:10.5753792Z    • Backward Compatibility
2025-07-08T20:03:10.5754232Z    • Progressive Enhancement
2025-07-08T20:03:10.5817533Z ✅ mvp_site/tests/test_milestone_4_interactive_features.py passed
2025-07-08T20:03:10.5819087Z ----------------------------------------
2025-07-08T20:03:10.5819657Z Running mvp_site/tests/test_mission_conversion_helpers.py...
2025-07-08T20:03:10.8440152Z .........
2025-07-08T20:03:10.8443876Z ----------------------------------------------------------------------
2025-07-08T20:03:10.8444395Z Ran 9 tests in 0.002s
2025-07-08T20:03:10.8444594Z 
2025-07-08T20:03:10.8444700Z OK
2025-07-08T20:03:10.8827980Z ✅ mvp_site/tests/test_mission_conversion_helpers.py passed
2025-07-08T20:03:10.8829093Z ----------------------------------------
2025-07-08T20:03:10.8829873Z Running mvp_site/tests/test_mission_handling.py...
2025-07-08T20:03:11.1398582Z WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:03:11.1401686Z ..WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:03:11.1402457Z .
2025-07-08T20:03:11.1402792Z ----------------------------------------------------------------------
2025-07-08T20:03:11.1403473Z Ran 3 tests in 0.001s
2025-07-08T20:03:11.1403678Z 
2025-07-08T20:03:11.1403788Z OK
2025-07-08T20:03:11.1788824Z ✅ mvp_site/tests/test_mission_handling.py passed
2025-07-08T20:03:11.1789948Z ----------------------------------------
2025-07-08T20:03:11.1791730Z Running mvp_site/tests/test_narrative_cutoff_bug.py...
2025-07-08T20:03:11.2192241Z test_complex_nested_quotes (__main__.TestNarrativeCutoffBug.test_complex_nested_quotes)
2025-07-08T20:03:11.2196210Z Test extraction with complex nested quotes and escape sequences. ... ok
2025-07-08T20:03:11.2197366Z test_extraction_performance (__main__.TestNarrativeCutoffBug.test_extraction_performance)
2025-07-08T20:03:11.2215670Z Test that the fix handles very long narratives efficiently. ... ok
2025-07-08T20:03:11.2216912Z test_incomplete_json_narrative (__main__.TestNarrativeCutoffBug.test_incomplete_json_narrative)
2025-07-08T20:03:11.2218290Z Test that incomplete JSON (cut off mid-narrative) still extracts what's available. ... ok
2025-07-08T20:03:11.2221322Z test_narrative_extraction_with_quotes_GREEN_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_GREEN_phase)
2025-07-08T20:03:11.2223838Z GREEN PHASE: Demonstrate that the fixed implementation works correctly. ... ok
2025-07-08T20:03:11.2225325Z test_narrative_extraction_with_quotes_RED_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_RED_phase)
2025-07-08T20:03:11.2226186Z 
2025-07-08T20:03:11.2226681Z RED PHASE: Demonstrate that a naive regex approach would fail. ... ok
2025-07-08T20:03:11.2229581Z test_narrative_with_json_special_chars (__main__.TestNarrativeCutoffBug.test_narrative_with_json_special_chars)
2025-07-08T20:03:11.2230784Z Test narratives containing JSON special characters. ... ok
2025-07-08T20:03:11.2232475Z 
2025-07-08T20:03:11.2232717Z ----------------------------------------------------------------------
2025-07-08T20:03:11.2233428Z Ran 6 tests in 0.003s
2025-07-08T20:03:11.2233652Z 
2025-07-08T20:03:11.2233764Z OK
2025-07-08T20:03:11.2235884Z Actual result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T20:03:11.2238390Z 
2025-07-08T20:03:11.2240306Z Expected result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T20:03:11.2242428Z 
2025-07-08T20:03:11.2242946Z 🟢 GREEN PHASE: Fixed extraction successfully got all 691 chars
2025-07-08T20:03:11.2243905Z Narrative ends correctly with: ...g presence to get him to spill everything quickly.
2025-07-08T20:03:11.2244605Z 
2025-07-08T20:03:11.2245067Z 🔴 RED PHASE: Buggy extraction got only 177 chars instead of 691
2025-07-08T20:03:11.2245793Z Cutoff happened at: ...proaches you, his eyes gleaming with urgency.\n\n\
2025-07-08T20:03:11.2293739Z ✅ mvp_site/tests/test_narrative_cutoff_bug.py passed
2025-07-08T20:03:11.2295146Z ----------------------------------------
2025-07-08T20:03:11.2295644Z Running mvp_site/tests/test_npc_data_handling.py...
2025-07-08T20:03:11.4837520Z .....
2025-07-08T20:03:11.4838407Z ----------------------------------------------------------------------
2025-07-08T20:03:11.4840820Z Ran 5 tests in 0.001s
2025-07-08T20:03:11.4841081Z 
2025-07-08T20:03:11.4841184Z OK
2025-07-08T20:03:11.5230366Z ✅ mvp_site/tests/test_npc_data_handling.py passed
2025-07-08T20:03:11.5231912Z ----------------------------------------
2025-07-08T20:03:11.5232497Z Running mvp_site/tests/test_npc_gender_consistency_red_green.py...
2025-07-08T20:03:11.6976203Z .....
2025-07-08T20:03:11.6978389Z ----------------------------------------------------------------------
2025-07-08T20:03:11.6978887Z Ran 5 tests in 0.001s
2025-07-08T20:03:11.6979089Z 
2025-07-08T20:03:11.6979191Z OK
2025-07-08T20:03:11.7194169Z ✅ mvp_site/tests/test_npc_gender_consistency_red_green.py passed
2025-07-08T20:03:11.7195790Z ----------------------------------------
2025-07-08T20:03:11.7196325Z Running mvp_site/tests/test_null_narrative_bug_fix.py...
2025-07-08T20:03:11.7639102Z .....
2025-07-08T20:03:11.7639892Z ----------------------------------------------------------------------
2025-07-08T20:03:11.7642185Z Ran 5 tests in 0.000s
2025-07-08T20:03:11.7642699Z 
2025-07-08T20:03:11.7644456Z OK
2025-07-08T20:03:11.7707607Z ✅ mvp_site/tests/test_null_narrative_bug_fix.py passed
2025-07-08T20:03:11.7708980Z ----------------------------------------
2025-07-08T20:03:11.7709529Z Running mvp_site/tests/test_numeric_field_converter.py...
2025-07-08T20:03:11.8106244Z ...........
2025-07-08T20:03:11.8107801Z ----------------------------------------------------------------------
2025-07-08T20:03:11.8108333Z Ran 11 tests in 0.001s
2025-07-08T20:03:11.8108560Z 
2025-07-08T20:03:11.8108682Z OK
2025-07-08T20:03:11.8166974Z ✅ mvp_site/tests/test_numeric_field_converter.py passed
2025-07-08T20:03:11.8168364Z ----------------------------------------
2025-07-08T20:03:11.8168971Z Running mvp_site/tests/test_planning_block_enforcement.py...
2025-07-08T20:03:11.9502529Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9508843Z   @validator('strength', pre=True)
2025-07-08T20:03:11.9511530Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9514673Z   @validator('dexterity', pre=True)
2025-07-08T20:03:11.9517206Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9520002Z   @validator('constitution', pre=True)
2025-07-08T20:03:11.9522361Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9525208Z   @validator('intelligence', pre=True)
2025-07-08T20:03:11.9527841Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9530493Z   @validator('wisdom', pre=True)
2025-07-08T20:03:11.9533093Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9535927Z   @validator('charisma', pre=True)
2025-07-08T20:03:11.9678596Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9691698Z   @validator('hp', pre=True)
2025-07-08T20:03:11.9694496Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9697158Z   @validator('hp_max', pre=True)
2025-07-08T20:03:11.9699789Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9702462Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:11.9726454Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9731334Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:11.9757203Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9760632Z   @validator('level', pre=True)
2025-07-08T20:03:11.9764028Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9767007Z   @validator('gender')
2025-07-08T20:03:11.9769812Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9772847Z   @validator('age')
2025-07-08T20:03:11.9776012Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9779008Z   @validator('mbti')
2025-07-08T20:03:11.9781752Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9784837Z   @validator('alignment')
2025-07-08T20:03:11.9787694Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9790755Z   @validator('entity_type')
2025-07-08T20:03:11.9939933Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9943015Z   @validator('participants')
2025-07-08T20:03:11.9958286Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9965634Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:11.9968646Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9971538Z   @validator('present_entities')
2025-07-08T20:03:12.0116441Z 2025-07-08 20:03:12,011 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0133044Z 2025-07-08 20:03:12,013 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0134214Z 2025-07-08 20:03:12,013 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0148864Z 2025-07-08 20:03:12,014 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0163659Z 2025-07-08 20:03:12,016 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0165452Z 2025-07-08 20:03:12,016 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0167351Z 2025-07-08 20:03:12,016 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0198717Z .2025-07-08 20:03:12,019 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0211658Z 2025-07-08 20:03:12,020 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0213609Z 2025-07-08 20:03:12,021 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0224149Z 2025-07-08 20:03:12,022 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0229005Z 2025-07-08 20:03:12,022 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0230899Z 2025-07-08 20:03:12,022 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0233149Z 2025-07-08 20:03:12,022 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0272126Z .2025-07-08 20:03:12,026 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0277856Z 2025-07-08 20:03:12,027 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0280176Z 2025-07-08 20:03:12,027 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0280971Z 2025-07-08 20:03:12,027 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0284306Z 2025-07-08 20:03:12,028 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0286468Z 2025-07-08 20:03:12,028 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0288717Z 2025-07-08 20:03:12,028 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0290075Z 2025-07-08 20:03:12,028 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0294161Z 2025-07-08 20:03:12,029 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0296786Z 2025-07-08 20:03:12,029 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0297706Z 2025-07-08 20:03:12,029 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0299055Z 2025-07-08 20:03:12,029 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0301067Z 2025-07-08 20:03:12,029 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0303471Z 2025-07-08 20:03:12,029 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0312324Z .2025-07-08 20:03:12,031 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0321283Z 2025-07-08 20:03:12,031 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T20:03:12.0331041Z .2025-07-08 20:03:12,032 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0341039Z 2025-07-08 20:03:12,033 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0343028Z 2025-07-08 20:03:12,033 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0345917Z 2025-07-08 20:03:12,034 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T20:03:12.0346919Z 2025-07-08 20:03:12,034 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0353712Z .2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0355955Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0356798Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0357602Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0382361Z ...2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0384787Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0385673Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0386522Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0387375Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0394479Z .2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0396621Z 2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0397513Z 2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0406048Z .2025-07-08 20:03:12,040 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0416993Z 2025-07-08 20:03:12,041 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0418926Z 2025-07-08 20:03:12,041 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0421217Z 2025-07-08 20:03:12,041 - INFO - Recovered from incomplete JSON response. Narrative length: 206 characters (~51 tokens)
2025-07-08T20:03:12.0422200Z 2025-07-08 20:03:12,041 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0429258Z .2025-07-08 20:03:12,042 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0440248Z 2025-07-08 20:03:12,043 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0442163Z 2025-07-08 20:03:12,043 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0444702Z 2025-07-08 20:03:12,043 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0445976Z 2025-07-08 20:03:12,043 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0447196Z 2025-07-08 20:03:12,044 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0449026Z 2025-07-08 20:03:12,044 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0451217Z 2025-07-08 20:03:12,044 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0452276Z 2025-07-08 20:03:12,044 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0453664Z 2025-07-08 20:03:12,044 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0454854Z 2025-07-08 20:03:12,044 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0455956Z 2025-07-08 20:03:12,044 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0456779Z 2025-07-08 20:03:12,044 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0457825Z 2025-07-08 20:03:12,044 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0458822Z 2025-07-08 20:03:12,044 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0459931Z 2025-07-08 20:03:12,045 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0461785Z 2025-07-08 20:03:12,045 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0463756Z 2025-07-08 20:03:12,045 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0464808Z 2025-07-08 20:03:12,045 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0465721Z 2025-07-08 20:03:12,045 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0466821Z 2025-07-08 20:03:12,045 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0467836Z 2025-07-08 20:03:12,045 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0468558Z 2025-07-08 20:03:12,045 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0469529Z 2025-07-08 20:03:12,045 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0470469Z 2025-07-08 20:03:12,045 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0479108Z .2025-07-08 20:03:12,047 - INFO - Planning block found in response
2025-07-08T20:03:12.0489174Z .2025-07-08 20:03:12,048 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0499518Z 2025-07-08 20:03:12,049 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0501377Z 2025-07-08 20:03:12,049 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0503681Z 2025-07-08 20:03:12,049 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T20:03:12.0504538Z 2025-07-08 20:03:12,049 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0505022Z .
2025-07-08T20:03:12.0505353Z ----------------------------------------------------------------------
2025-07-08T20:03:12.0505815Z Ran 14 tests in 0.171s
2025-07-08T20:03:12.0506011Z 
2025-07-08T20:03:12.0506122Z OK
2025-07-08T20:03:12.0771962Z ✅ mvp_site/tests/test_planning_block_enforcement.py passed
2025-07-08T20:03:12.0773991Z ----------------------------------------
2025-07-08T20:03:12.0774631Z Running mvp_site/tests/test_planning_block_json_corruption_fix.py...
2025-07-08T20:03:12.7088652Z test_planning_block_api_failure_fallback (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_api_failure_fallback)
2025-07-08T20:03:12.7097193Z TEST: Verify that when planning block generation fails, ... 2025-07-08 20:03:12,709 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7100105Z 2025-07-08 20:03:12,709 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T20:03:12.7100741Z ok
2025-07-08T20:03:12.7101655Z test_planning_block_json_response_gets_parsed (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_json_response_gets_parsed)
2025-07-08T20:03:12.7106483Z RED TEST: Verify that when planning block generation returns JSON, ... 2025-07-08 20:03:12,710 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7109060Z 2025-07-08 20:03:12,710 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.7109655Z ok
2025-07-08T20:03:12.7110608Z test_planning_block_plain_text_response_unchanged (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_plain_text_response_unchanged)
2025-07-08T20:03:12.7116071Z GREEN TEST: Verify that when planning block generation returns plain text, ... 2025-07-08 20:03:12,711 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7126258Z 2025-07-08 20:03:12,712 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.7128386Z 2025-07-08 20:03:12,712 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.7129692Z 2025-07-08 20:03:12,712 - INFO - Recovered from incomplete JSON response. Narrative length: 219 characters (~54 tokens)
2025-07-08T20:03:12.7130558Z 2025-07-08 20:03:12,712 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.7131080Z ok
2025-07-08T20:03:12.7131502Z 
2025-07-08T20:03:12.7131897Z 🔴 RUNNING RED/GREEN TESTS: Planning Block JSON Corruption Fix
2025-07-08T20:03:12.7132428Z ======================================================================
2025-07-08T20:03:12.7133037Z ✅ Test passed: Planning block API failure fallback works
2025-07-08T20:03:12.7133880Z ✅ Test passed: Planning block JSON response properly parsed
2025-07-08T20:03:12.7134384Z Result length: 274 characters
2025-07-08T20:03:12.7135101Z Result preview: 'eed cautiously** - Move forward carefully\n3. **Cast a detection spell** - Use magic to sense dangers'
2025-07-08T20:03:12.7136050Z ✅ Test passed: Planning block plain text response works correctly
2025-07-08T20:03:12.7137352Z ----------------------------------------------------------------------
2025-07-08T20:03:12.7137815Z Ran 3 tests in 0.004s
2025-07-08T20:03:12.7138005Z 
2025-07-08T20:03:12.7138111Z OK
2025-07-08T20:03:12.7837276Z ✅ mvp_site/tests/test_planning_block_json_corruption_fix.py passed
2025-07-08T20:03:12.7839127Z ----------------------------------------
2025-07-08T20:03:12.7839665Z Running mvp_site/tests/test_planning_block_simplified.py...
2025-07-08T20:03:13.4144360Z 2025-07-08 20:03:13,414 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4157416Z 2025-07-08 20:03:13,415 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4158917Z 2025-07-08 20:03:13,415 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4161815Z 2025-07-08 20:03:13,415 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4162818Z 2025-07-08 20:03:13,415 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4165621Z 2025-07-08 20:03:13,416 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4171096Z 2025-07-08 20:03:13,416 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4171970Z 2025-07-08 20:03:13,416 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4173713Z 2025-07-08 20:03:13,417 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4175022Z 2025-07-08 20:03:13,417 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4180379Z 2025-07-08 20:03:13,417 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4183162Z 2025-07-08 20:03:13,418 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4184735Z 2025-07-08 20:03:13,418 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4186248Z 2025-07-08 20:03:13,418 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4187537Z 2025-07-08 20:03:13,418 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4193179Z 2025-07-08 20:03:13,419 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4196818Z 2025-07-08 20:03:13,419 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4197993Z 2025-07-08 20:03:13,419 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4199545Z 2025-07-08 20:03:13,419 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4200743Z 2025-07-08 20:03:13,419 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4205725Z 2025-07-08 20:03:13,420 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4208509Z 2025-07-08 20:03:13,420 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4209672Z 2025-07-08 20:03:13,420 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4211012Z 2025-07-08 20:03:13,420 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4213463Z 2025-07-08 20:03:13,420 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4217658Z .2025-07-08 20:03:13,421 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4222062Z 2025-07-08 20:03:13,422 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4223438Z 2025-07-08 20:03:13,422 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4225023Z 2025-07-08 20:03:13,422 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4227330Z 2025-07-08 20:03:13,422 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:13.4231185Z .2025-07-08 20:03:13,422 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4234364Z 2025-07-08 20:03:13,423 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4235582Z 2025-07-08 20:03:13,423 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4237127Z 2025-07-08 20:03:13,423 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4239446Z 2025-07-08 20:03:13,423 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:13.4243828Z .2025-07-08 20:03:13,424 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4248540Z 2025-07-08 20:03:13,424 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4249934Z 2025-07-08 20:03:13,424 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4251132Z 2025-07-08 20:03:13,424 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4253157Z 2025-07-08 20:03:13,424 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4254565Z .
2025-07-08T20:03:13.4255049Z ----------------------------------------------------------------------
2025-07-08T20:03:13.4255602Z Ran 4 tests in 0.012s
2025-07-08T20:03:13.4260605Z 
2025-07-08T20:03:13.4260918Z OK
2025-07-08T20:03:13.4970397Z ✅ mvp_site/tests/test_planning_block_simplified.py passed
2025-07-08T20:03:13.4972490Z ----------------------------------------
2025-07-08T20:03:13.4972997Z Running mvp_site/tests/test_planning_blocks_ui.py...
2025-07-08T20:03:13.5328052Z ....
2025-07-08T20:03:13.5328824Z ----------------------------------------------------------------------
2025-07-08T20:03:13.5329653Z Ran 4 tests in 0.000s
2025-07-08T20:03:13.5330176Z 
2025-07-08T20:03:13.5330446Z OK
2025-07-08T20:03:13.5384961Z ✅ mvp_site/tests/test_planning_blocks_ui.py passed
2025-07-08T20:03:13.5386325Z ----------------------------------------
2025-07-08T20:03:13.5386824Z Running mvp_site/tests/test_pr_changes_runner.py...
2025-07-08T20:03:13.7108594Z 
2025-07-08T20:03:13.7110364Z === Testing Debug Mode Default Change ===
2025-07-08T20:03:13.7111545Z ✓ GameState defaults to debug_mode=True
2025-07-08T20:03:13.7114326Z ✓ GameState can be set to debug_mode=False
2025-07-08T20:03:13.7114822Z ✓ debug_mode is included in serialization
2025-07-08T20:03:13.7115312Z ✓ debug_mode is preserved in deserialization
2025-07-08T20:03:13.7115646Z 
2025-07-08T20:03:13.7115791Z === Testing Entity Schema Constant ===
2025-07-08T20:03:13.7116442Z ✓ Entity schema has been properly integrated into game_state instructions
2025-07-08T20:03:13.7116874Z 
2025-07-08T20:03:13.7117022Z === Testing Manifest Cache Exclusion ===
2025-07-08T20:03:13.7117673Z ✓ Internal attributes starting with _ are excluded from serialization
2025-07-08T20:03:13.7118091Z 
2025-07-08T20:03:13.7118230Z === Testing Entity ID Format ===
2025-07-08T20:03:13.7118711Z ✓ PC entity ID format correct: pc_test_hero_001
2025-07-08T20:03:13.7119270Z ✓ NPC entity ID format correct: npc_guard_captain_001
2025-07-08T20:03:13.7119612Z 
2025-07-08T20:03:13.7119747Z === All PR Change Tests Passed! ===
2025-07-08T20:03:13.7352561Z ✅ mvp_site/tests/test_pr_changes_runner.py passed
2025-07-08T20:03:13.7354161Z ----------------------------------------
2025-07-08T20:03:13.7354703Z Running mvp_site/tests/test_prompt_mission_examples.py...
2025-07-08T20:03:13.7720667Z ....
2025-07-08T20:03:13.7722396Z ----------------------------------------------------------------------
2025-07-08T20:03:13.7724752Z Ran 4 tests in 0.001s
2025-07-08T20:03:13.7725160Z 
2025-07-08T20:03:13.7725842Z OK
2025-07-08T20:03:13.7777045Z ✅ mvp_site/tests/test_prompt_mission_examples.py passed
2025-07-08T20:03:13.7777919Z ----------------------------------------
2025-07-08T20:03:13.7778812Z Running mvp_site/tests/test_prompt_npc_examples.py...
2025-07-08T20:03:13.8141585Z ....
2025-07-08T20:03:13.8142438Z ----------------------------------------------------------------------
2025-07-08T20:03:13.8144504Z Ran 4 tests in 0.001s
2025-07-08T20:03:13.8144733Z 
2025-07-08T20:03:13.8144891Z OK
2025-07-08T20:03:13.8198495Z ✅ mvp_site/tests/test_prompt_npc_examples.py passed
2025-07-08T20:03:13.8200036Z ----------------------------------------
2025-07-08T20:03:13.8200515Z Running mvp_site/tests/test_prompts.py...
2025-07-08T20:03:14.4521823Z 2025-07-08 20:03:14,451 - INFO - --- Running Test: test_all_prompt_files_are_registered_in_service ---
2025-07-08T20:03:14.4524139Z .2025-07-08 20:03:14,452 - INFO - --- Running Test: test_all_prompts_are_loadable_via_service ---
2025-07-08T20:03:14.4529635Z .2025-07-08 20:03:14,452 - INFO - --- Running Test: test_all_registered_prompts_are_actually_used ---
2025-07-08T20:03:14.4608502Z .2025-07-08 20:03:14,460 - INFO - --- Running Test: test_loading_unknown_prompt_raises_error ---
2025-07-08T20:03:14.4609659Z ✓ Always-loaded prompts: 3/3 verified
2025-07-08T20:03:14.4610924Z 2025-07-08 20:03:14,460 - ERROR - 🔥🔴 FATAL: Unknown instruction type requested: this_is_not_a_real_prompt_type
2025-07-08T20:03:14.4611921Z .
2025-07-08T20:03:14.4612521Z ----------------------------------------------------------------------
2025-07-08T20:03:14.4613498Z Ran 4 tests in 0.009s
2025-07-08T20:03:14.4614012Z 
2025-07-08T20:03:14.4614317Z OK
2025-07-08T20:03:14.4624187Z ✓ Conditional prompts: 3/3 properly referenced
2025-07-08T20:03:14.5451623Z ✅ mvp_site/tests/test_prompts.py passed
2025-07-08T20:03:14.5454251Z ----------------------------------------
2025-07-08T20:03:14.5454843Z Running mvp_site/tests/test_raw_json_display_bug_reproduction.py...
2025-07-08T20:03:14.5891579Z ..
2025-07-08T20:03:14.5892394Z ----------------------------------------------------------------------
2025-07-08T20:03:14.5894293Z Ran 2 tests in 0.000s
2025-07-08T20:03:14.5894562Z 
2025-07-08T20:03:14.5894675Z OK
2025-07-08T20:03:14.5962898Z ✅ mvp_site/tests/test_raw_json_display_bug_reproduction.py passed
2025-07-08T20:03:14.5972629Z ----------------------------------------
2025-07-08T20:03:14.5974316Z Running mvp_site/tests/test_real_json_bug_reproduction.py...
2025-07-08T20:03:14.6402910Z ..
2025-07-08T20:03:14.6407709Z \nTesting exact user JSON structure...
2025-07-08T20:03:14.6408197Z Input length: 5399
2025-07-08T20:03:14.6408541Z Input preview: {
2025-07-08T20:03:14.6409668Z     "narrative": "[Mode: STORY MODE]\n[CHARACTER CREATION - Step 2 of 7]\n\n\"Understood,\" the voice echoes, a comforting presence as you consider your newfound destiny. \"Allow me to craft an iden...
2025-07-08T20:03:14.6410885Z \nResult length: 4239
2025-07-08T20:03:14.6411268Z Result preview: [Mode: STORY MODE]
2025-07-08T20:03:14.6411717Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:03:14.6412000Z 
2025-07-08T20:03:14.6412713Z "Understood," the voice echoes, a comforting presence as you consider your newfound destiny. "Allow me to craft an identity that truly reflects t...
2025-07-08T20:03:14.6413945Z ----------------------------------------------------------------------
2025-07-08T20:03:14.6414463Z Ran 2 tests in 0.000s
2025-07-08T20:03:14.6414687Z 
2025-07-08T20:03:14.6414810Z OK
2025-07-08T20:03:14.6472557Z ✅ mvp_site/tests/test_real_json_bug_reproduction.py passed
2025-07-08T20:03:14.6474026Z ----------------------------------------
2025-07-08T20:03:14.6475482Z Running mvp_site/tests/test_red_green_demonstration.py...
2025-07-08T20:03:14.7104382Z GeminiResponse Integration Bug Fix - TDD Demonstration
2025-07-08T20:03:14.7107049Z ============================================================
2025-07-08T20:03:14.7107413Z 
2025-07-08T20:03:14.7107823Z 🧪 TEST-DRIVEN DEVELOPMENT CYCLE
2025-07-08T20:03:14.7108242Z ============================================================
2025-07-08T20:03:14.7108534Z 
2025-07-08T20:03:14.7108745Z 1. 🔴 RED: Write failing test
2025-07-08T20:03:14.7109274Z    • Test expects GeminiResponse integration to work
2025-07-08T20:03:14.7109927Z    • Test fails because firestore can't encode GeminiResponse
2025-07-08T20:03:14.7110634Z    • Error: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T20:03:14.7111042Z 
2025-07-08T20:03:14.7111251Z 2. 🟢 GREEN: Make test pass
2025-07-08T20:03:14.7111783Z    • Extract .narrative_text from GeminiResponse
2025-07-08T20:03:14.7112366Z    • Pass string to firestore instead of object
2025-07-08T20:03:14.7112860Z    • Test now passes
2025-07-08T20:03:14.7113080Z 
2025-07-08T20:03:14.7113457Z 3. 🔄 REFACTOR: Clean up
2025-07-08T20:03:14.7113981Z    • Update all test mocks to return GeminiResponse
2025-07-08T20:03:14.7114556Z    • Ensure consistent interface
2025-07-08T20:03:14.7115046Z    • Maintain backward compatibility
2025-07-08T20:03:14.7115334Z 
2025-07-08T20:03:14.7115571Z 🔴 RED PHASE: Demonstrating the bug
2025-07-08T20:03:14.7116003Z ==================================================
2025-07-08T20:03:14.7116573Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T20:03:14.7117408Z ✅ GeminiResponse.narrative_text: 'Your adventure begins in a bustling tavern......'
2025-07-08T20:03:14.7117960Z 
2025-07-08T20:03:14.7118345Z ❌ BEFORE FIX: firestore_service.add_story_entry() tries to call:
2025-07-08T20:03:14.7118904Z    text.encode('utf-8')
2025-07-08T20:03:14.7119307Z    where text = gemini_response_object
2025-07-08T20:03:14.7119608Z 
2025-07-08T20:03:14.7120022Z    ❌ AttributeError: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T20:03:14.7120687Z    ❌ Campaign creation fails!
2025-07-08T20:03:14.7120930Z 
2025-07-08T20:03:14.7121149Z 🟢 GREEN PHASE: Demonstrating the fix
2025-07-08T20:03:14.7121891Z ==================================================
2025-07-08T20:03:14.7122426Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T20:03:14.7122745Z 
2025-07-08T20:03:14.7122999Z ✅ AFTER FIX: main.py extracts narrative_text:
2025-07-08T20:03:14.7123740Z    opening_story_response = gemini_service.get_initial_story(...)
2025-07-08T20:03:14.7124432Z    create_campaign(..., opening_story_response.narrative_text, ...)
2025-07-08T20:03:14.7124811Z 
2025-07-08T20:03:14.7125003Z ✅ Extracted narrative_text: str
2025-07-08T20:03:14.7125485Z ✅ Content: 'Your adventure begins in a bustling tavern......'
2025-07-08T20:03:14.7126250Z ✅ Successfully encoded: 45 bytes
2025-07-08T20:03:14.7126740Z ✅ Campaign creation succeeds!
2025-07-08T20:03:14.7127000Z 
2025-07-08T20:03:14.7127219Z 🔄 REFACTOR PHASE: Clean architecture
2025-07-08T20:03:14.7127624Z ==================================================
2025-07-08T20:03:14.7128093Z ✅ Clean separation of concerns:
2025-07-08T20:03:14.7128674Z    • GeminiResponse: Encapsulates AI service response
2025-07-08T20:03:14.7129285Z    • .narrative_text: Clean narrative for users
2025-07-08T20:03:14.7129906Z    • .structured_response: State updates and entities
2025-07-08T20:03:14.7130547Z    • .debug_tags_present: Debug monitoring
2025-07-08T20:03:14.7130855Z 
2025-07-08T20:03:14.7131083Z ✅ Backward compatibility maintained:
2025-07-08T20:03:14.7131609Z    • All existing functionality preserved
2025-07-08T20:03:14.7132138Z    • Tests updated to use new interface
2025-07-08T20:03:14.7132610Z    • No breaking changes
2025-07-08T20:03:14.7132845Z 
2025-07-08T20:03:14.7133024Z ✅ Benefits achieved:
2025-07-08T20:03:14.7133665Z    • Type safety with GeminiResponse objects
2025-07-08T20:03:14.7134201Z    • Clear interface between services
2025-07-08T20:03:14.7134698Z    • Debug monitoring capabilities
2025-07-08T20:03:14.7135205Z    • Consistent JSON response handling
2025-07-08T20:03:14.7135502Z 
2025-07-08T20:03:14.7135719Z 🎉 SUMMARY: TDD cycle complete!
2025-07-08T20:03:14.7136198Z    • Bug identified and reproduced (RED)
2025-07-08T20:03:14.7136713Z    • Fix implemented and tested (GREEN)
2025-07-08T20:03:14.7137233Z    • Architecture improved (REFACTOR)
2025-07-08T20:03:14.7137719Z    • All 67 tests passing ✅
2025-07-08T20:03:14.7210658Z ✅ mvp_site/tests/test_red_green_demonstration.py passed
2025-07-08T20:03:14.7212013Z ----------------------------------------
2025-07-08T20:03:14.7212508Z Running mvp_site/tests/test_red_green_json_fix.py...
2025-07-08T20:03:14.7617146Z test_green_state_comprehensive_fix (__main__.TestRedGreenJSONFix.test_green_state_comprehensive_fix)
2025-07-08T20:03:14.7627265Z GREEN TEST: Demonstrates the complete fix working ... ok
2025-07-08T20:03:14.7629091Z test_red_state_escaped_characters (__main__.TestRedGreenJSONFix.test_red_state_escaped_characters)
2025-07-08T20:03:14.7630027Z RED TEST: JSON with escaped characters like \n and \" ... ok
2025-07-08T20:03:14.7631027Z test_red_state_markdown_wrapped_json (__main__.TestRedGreenJSONFix.test_red_state_markdown_wrapped_json)
2025-07-08T20:03:14.7632073Z RED TEST: AI returns JSON wrapped in markdown code blocks ... ok
2025-07-08T20:03:14.7633698Z ============================================================
2025-07-08T20:03:14.7634197Z RED/GREEN TESTING: JSON Display Bug Fix
2025-07-08T20:03:14.7634662Z ============================================================
2025-07-08T20:03:14.7634987Z 
2025-07-08T20:03:14.7635203Z This demonstrates how the bug manifested (red state)
2025-07-08T20:03:14.7635710Z and how the fix resolves it (green state).
2025-07-08T20:03:14.7636015Z 
2025-07-08T20:03:14.7636024Z 
2025-07-08T20:03:14.7636212Z === GREEN STATE TEST: Complete Fix ===
2025-07-08T20:03:14.7636841Z   ✓ Plain JSON: Clean narrative extracted
2025-07-08T20:03:14.7637407Z   ✓ Markdown-wrapped: Clean narrative extracted
2025-07-08T20:03:14.7637990Z   ✓ Partial JSON: Clean narrative extracted
2025-07-08T20:03:14.7638539Z   ✓ Escaped chars: Clean narrative extracted
2025-07-08T20:03:14.7639381Z   ✓ Malformed: Clean narrative extracted
2025-07-08T20:03:14.7640464Z test_red_state_partial_json_fallback (__main__.TestRedGreenJSONFix.test_red_state_partial_json_fallback)
2025-07-08T20:03:14.7641379Z   ✓ Invalid field: Clean narrative extracted
2025-07-08T20:03:14.7642118Z RED TEST: Partial JSON that can't be parsed ... ok
2025-07-08T20:03:14.7642924Z test_red_state_raw_json_displayed (__main__.TestRedGreenJSONFix.test_red_state_raw_json_displayed)
2025-07-08T20:03:14.7643699Z 
2025-07-08T20:03:14.7644217Z RED TEST: Demonstrates the bug where raw JSON is shown to users ... ok
2025-07-08T20:03:14.7644982Z ✓ GREEN: All test cases pass - users never see JSON!
2025-07-08T20:03:14.7646132Z test_simulate_red_state (__main__.TestRedGreenJSONFix.test_simulate_red_state)
2025-07-08T20:03:14.7646638Z 
2025-07-08T20:03:14.7647066Z SIMULATION: What the bug looked like before the fix ... ok
2025-07-08T20:03:14.7647625Z === RED STATE TEST: Escaped Characters ===
2025-07-08T20:03:14.7648254Z Returned narrative: 'She said "Hello!"\nNew line here\nAnother line'...
2025-07-08T20:03:14.7648927Z 
2025-07-08T20:03:14.7649204Z ✓ GREEN: Escape sequences properly converted
2025-07-08T20:03:14.7649571Z 
2025-07-08T20:03:14.7651009Z ----------------------------------------------------------------------
2025-07-08T20:03:14.7652195Z Ran 6 tests in 0.002s
2025-07-08T20:03:14.7652376Z 
2025-07-08T20:03:14.7652478Z OK
2025-07-08T20:03:14.7656903Z === RED STATE TEST: Markdown-wrapped JSON ===
2025-07-08T20:03:14.7658470Z Returned narrative: [Mode: DM MODE] Understanding confirmed. Processing user request....
2025-07-08T20:03:14.7659373Z ✓ GREEN: Markdown unwrapped, JSON parsed correctly
2025-07-08T20:03:14.7659756Z 
2025-07-08T20:03:14.7659916Z === RED STATE TEST: Partial JSON ===
2025-07-08T20:03:14.7660355Z Returned narrative: The story continues...
2025-07-08T20:03:14.7660928Z ✓ GREEN: Narrative extracted from partial JSON
2025-07-08T20:03:14.7661282Z 
2025-07-08T20:03:14.7661452Z === RED STATE TEST: Raw JSON Bug ===
2025-07-08T20:03:14.7662262Z Returned narrative: Scene #14: [Mode: DM MODE] The party continues their journey through the mystical forest....
2025-07-08T20:03:14.7663396Z ✓ GREEN: JSON properly parsed, narrative extracted
2025-07-08T20:03:14.7663729Z 
2025-07-08T20:03:14.7663890Z === SIMULATING RED STATE (Bug Behavior) ===
2025-07-08T20:03:14.7664191Z 
2025-07-08T20:03:14.7664337Z BUG OUTPUT (what users saw):
2025-07-08T20:03:14.7664684Z ```json
2025-07-08T20:03:14.7664925Z {
2025-07-08T20:03:14.7665319Z   "narrative": "[Mode: DM MODE] Understanding confirmed. Processing user request.",
2025-07-08T20:03:14.7665898Z   "entities_mentioned": ["Test Entity"],
2025-07-08T20:03:14.7666384Z   "location_confirmed": "Test Location",
2025-07-08T20:03:14.7666774Z   "state_updates": {}
2025-07-08T20:03:14.7667101Z }
2025-07-08T20:03:14.7667357Z ```
2025-07-08T20:03:14.7667516Z 
2025-07-08T20:03:14.7667523Z 
2025-07-08T20:03:14.7667673Z FIXED OUTPUT (what users see now):
2025-07-08T20:03:14.7668221Z [Mode: DM MODE] Understanding confirmed. Processing user request.
2025-07-08T20:03:14.7668633Z 
2025-07-08T20:03:14.7668862Z ✓ Bug fixed: Users only see narrative text!
2025-07-08T20:03:14.7669128Z 
2025-07-08T20:03:14.7669274Z ============================================================
2025-07-08T20:03:14.7669702Z SUMMARY:
2025-07-08T20:03:14.7669982Z Tests run: 6
2025-07-08T20:03:14.7670262Z Failures: 0
2025-07-08T20:03:14.7670539Z Errors: 0
2025-07-08T20:03:14.7670697Z 
2025-07-08T20:03:14.7670970Z ✅ All tests GREEN - JSON display bug is FIXED!
2025-07-08T20:03:14.7671508Z Users will never see raw JSON in their game interface.
2025-07-08T20:03:14.7672025Z ============================================================
2025-07-08T20:03:14.7710512Z ✅ mvp_site/tests/test_red_green_json_fix.py passed
2025-07-08T20:03:14.7711777Z ----------------------------------------
2025-07-08T20:03:14.7712302Z Running mvp_site/tests/test_refactoring_coverage.py...
2025-07-08T20:03:14.9633179Z .....sss..........
2025-07-08T20:03:14.9633843Z ----------------------------------------------------------------------
2025-07-08T20:03:14.9634767Z Ran 18 tests in 0.006s
2025-07-08T20:03:14.9634972Z 
2025-07-08T20:03:14.9636246Z OK (skipped=3)
2025-07-08T20:03:14.9890446Z ✅ mvp_site/tests/test_refactoring_coverage.py passed
2025-07-08T20:03:14.9891832Z ----------------------------------------
2025-07-08T20:03:14.9892353Z Running mvp_site/tests/test_robust_json_parser.py...
2025-07-08T20:03:15.0557490Z ....ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:15.0577206Z .................
2025-07-08T20:03:15.0578414Z ----------------------------------------------------------------------
2025-07-08T20:03:15.0580038Z Ran 21 tests in 0.004s
2025-07-08T20:03:15.0580253Z 
2025-07-08T20:03:15.0580371Z OK
2025-07-08T20:03:15.0680188Z ✅ mvp_site/tests/test_robust_json_parser.py passed
2025-07-08T20:03:15.0681503Z ----------------------------------------
2025-07-08T20:03:15.0682002Z Running mvp_site/tests/test_scene_numbering.py...
2025-07-08T20:03:15.3252428Z .
2025-07-08T20:03:15.3254945Z ----------------------------------------------------------------------
2025-07-08T20:03:15.3255842Z ✓ User scene numbers correctly increment only for AI responses
2025-07-08T20:03:15.3256359Z Ran 1 test in 0.000s
2025-07-08T20:03:15.3256557Z 
2025-07-08T20:03:15.3256664Z OK
2025-07-08T20:03:15.3257009Z ✓ Sequence IDs increment for all entries
2025-07-08T20:03:15.3257523Z ✓ This fixes the increment-by-2 display issue
2025-07-08T20:03:15.3622235Z ✅ mvp_site/tests/test_scene_numbering.py passed
2025-07-08T20:03:15.3628358Z ----------------------------------------
2025-07-08T20:03:15.3628914Z Running mvp_site/tests/test_scene_prefix_json_bug.py...
2025-07-08T20:03:15.4082780Z .....
2025-07-08T20:03:15.4085441Z ----------------------------------------------------------------------
2025-07-08T20:03:15.4085991Z Ran 5 tests in 0.001s
2025-07-08T20:03:15.4087389Z 
2025-07-08T20:03:15.4090854Z OK
2025-07-08T20:03:15.4155116Z ✅ mvp_site/tests/test_scene_prefix_json_bug.py passed
2025-07-08T20:03:15.4156509Z ----------------------------------------
2025-07-08T20:03:15.4157020Z Running mvp_site/tests/test_simple_json_bug_check.py...
2025-07-08T20:03:15.4602752Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestSimpleJsonBugCheck.test_character_creation_json_parsing of <__main__.TestSimpleJsonBugCheck testMethod=test_character_creation_json_parsing>>)
2025-07-08T20:03:15.4605067Z   return self.run(*args, **kwds)
2025-07-08T20:03:15.4612237Z ..
2025-07-08T20:03:15.4613173Z ----------------------------------------------------------------------
2025-07-08T20:03:15.4614007Z \n=== Testing Character Creation JSON Parsing ===
2025-07-08T20:03:15.4614484Z Ran 2 tests in 0.001s
2025-07-08T20:03:15.4614717Z 
2025-07-08T20:03:15.4614836Z OK
2025-07-08T20:03:15.4616265Z Input JSON length: 1062
2025-07-08T20:03:15.4616870Z ✅ Parsing succeeded!
2025-07-08T20:03:15.4617205Z Result text length: 456
2025-07-08T20:03:15.4617632Z Result preview: [CHARACTER CREATION - Step 1 of 7]
2025-07-08T20:03:15.4617966Z 
2025-07-08T20:03:15.4618276Z Welcome, adventurer! Before we begin your journey, we need to cr...
2025-07-08T20:03:15.4618856Z Contains JSON artifacts: False
2025-07-08T20:03:15.4619259Z \n=== Testing Malformed JSON Handling ===
2025-07-08T20:03:15.4619677Z Result: Some content here
2025-07-08T20:03:15.4620036Z Contains original JSON: False
2025-07-08T20:03:15.4690559Z ✅ mvp_site/tests/test_simple_json_bug_check.py passed
2025-07-08T20:03:15.4691952Z ----------------------------------------
2025-07-08T20:03:15.4692495Z Running mvp_site/tests/test_state_updates_json_parsing.py...
2025-07-08T20:03:15.5354020Z .....
2025-07-08T20:03:15.5354695Z ----------------------------------------------------------------------
2025-07-08T20:03:15.5355230Z Ran 5 tests in 0.000s
2025-07-08T20:03:15.5355443Z 
2025-07-08T20:03:15.5355566Z OK
2025-07-08T20:03:15.5465849Z ✅ mvp_site/tests/test_state_updates_json_parsing.py passed
2025-07-08T20:03:15.5467194Z ----------------------------------------
2025-07-08T20:03:15.5468282Z Running mvp_site/tests/test_structured_generation.py...
2025-07-08T20:03:15.7248671Z test_entity_tracking_instruction (__main__.TestStructuredGeneration.test_entity_tracking_instruction)
2025-07-08T20:03:15.7252603Z Test EntityTrackingInstruction creation ... ok
2025-07-08T20:03:15.7253804Z test_integration_with_entity_tracking (__main__.TestStructuredGeneration.test_integration_with_entity_tracking)
2025-07-08T20:03:15.7255010Z Test integration with existing entity tracking system ... ok
2025-07-08T20:03:15.7256053Z test_narrative_response_schema (__main__.TestStructuredGeneration.test_narrative_response_schema)
2025-07-08T20:03:15.7257414Z Test NarrativeResponse model ... ok
2025-07-08T20:03:15.7263639Z test_parse_structured_response_fallback (__main__.TestStructuredGeneration.test_parse_structured_response_fallback)
2025-07-08T20:03:15.7271488Z Test fallback for invalid JSON ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:15.7280524Z ok
2025-07-08T20:03:15.7281265Z test_parse_structured_response_valid_json (__main__.TestStructuredGeneration.test_parse_structured_response_valid_json)
2025-07-08T20:03:15.7282087Z Test parsing valid JSON response ... ok
2025-07-08T20:03:15.7282957Z test_parse_structured_response_with_extra_text (__main__.TestStructuredGeneration.test_parse_structured_response_with_extra_text)
2025-07-08T20:03:15.7284024Z Test parsing JSON with extra text around it ... ok
2025-07-08T20:03:15.7284787Z test_structured_prompt_injection (__main__.TestStructuredGeneration.test_structured_prompt_injection)
2025-07-08T20:03:15.7285555Z Test prompt injection creation ... ok
2025-07-08T20:03:15.7286307Z test_validate_entity_coverage_missing (__main__.TestStructuredGeneration.test_validate_entity_coverage_missing)
2025-07-08T20:03:15.7287160Z Test entity coverage validation with missing entities ... ok
2025-07-08T20:03:15.7287992Z test_validate_entity_coverage_perfect (__main__.TestStructuredGeneration.test_validate_entity_coverage_perfect)
2025-07-08T20:03:15.7288859Z Test entity coverage validation with perfect coverage ... ok
2025-07-08T20:03:15.7289211Z 
2025-07-08T20:03:15.7289406Z ----------------------------------------------------------------------
2025-07-08T20:03:15.7289857Z Ran 9 tests in 0.003s
2025-07-08T20:03:15.7290051Z 
2025-07-08T20:03:15.7290148Z OK
2025-07-08T20:03:15.7290639Z 🧪 Testing Structured Generation Implementation
2025-07-08T20:03:15.7291072Z ============================================================
2025-07-08T20:03:15.7291698Z ✅ Integration test: Structured generation works with entity tracking
2025-07-08T20:03:15.7553125Z ✅ mvp_site/tests/test_structured_generation.py passed
2025-07-08T20:03:15.7554847Z ----------------------------------------
2025-07-08T20:03:15.7555314Z Running mvp_site/tests/test_syntax.py...
2025-07-08T20:03:16.3628526Z ./home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3631793Z   @validator('strength', pre=True)
2025-07-08T20:03:16.3635112Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3638208Z   @validator('dexterity', pre=True)
2025-07-08T20:03:16.3641040Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3644550Z   @validator('constitution', pre=True)
2025-07-08T20:03:16.3647421Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3650702Z   @validator('intelligence', pre=True)
2025-07-08T20:03:16.3653735Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3657327Z   @validator('wisdom', pre=True)
2025-07-08T20:03:16.3660203Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3663719Z   @validator('charisma', pre=True)
2025-07-08T20:03:16.3666626Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3669541Z   @validator('hp', pre=True)
2025-07-08T20:03:16.3672338Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3675959Z   @validator('hp_max', pre=True)
2025-07-08T20:03:16.3678771Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3681613Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:16.3708052Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3710677Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:16.3739735Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3743540Z   @validator('level', pre=True)
2025-07-08T20:03:16.3746753Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3749916Z   @validator('gender')
2025-07-08T20:03:16.3752730Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3755768Z   @validator('age')
2025-07-08T20:03:16.3758536Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3761620Z   @validator('mbti')
2025-07-08T20:03:16.3764629Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3767709Z   @validator('alignment')
2025-07-08T20:03:16.3770559Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3773774Z   @validator('entity_type')
2025-07-08T20:03:16.3934134Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3937359Z   @validator('participants')
2025-07-08T20:03:16.3952483Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3959929Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:16.3962914Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3966137Z   @validator('present_entities')
2025-07-08T20:03:16.4074734Z .
2025-07-08T20:03:16.4075657Z ----------------------------------------------------------------------
2025-07-08T20:03:16.4076051Z 
2025-07-08T20:03:16.4076398Z --- Attempting to import gemini_service.py ---
2025-07-08T20:03:16.4076972Z Setting dummy GEMINI_API_KEY for import test...
2025-07-08T20:03:16.4077781Z Ran 2 tests in 0.616s
2025-07-08T20:03:16.4078460Z 
2025-07-08T20:03:16.4078793Z OK
2025-07-08T20:03:16.4083698Z SUCCESS: gemini_service.py was imported without a syntax error.
2025-07-08T20:03:16.4833742Z ✅ mvp_site/tests/test_syntax.py passed
2025-07-08T20:03:16.4837153Z ----------------------------------------
2025-07-08T20:03:16.4837667Z Running mvp_site/tests/test_syntax_comprehensive.py...
2025-07-08T20:03:16.5706918Z test_all_python_files_syntax (__main__.TestComprehensiveSyntax.test_all_python_files_syntax)
2025-07-08T20:03:16.6113727Z Test that all Python files in the project have valid syntax using AST parsing. ... ok
2025-07-08T20:03:16.6115519Z test_basic_game_state_instantiation (__main__.TestComprehensiveSyntax.test_basic_game_state_instantiation)
2025-07-08T20:03:16.6172993Z Test basic GameState instantiation without combat-specific features. ... ok
2025-07-08T20:03:16.6175921Z test_game_state_syntax_and_import (__main__.TestComprehensiveSyntax.test_game_state_syntax_and_import)
2025-07-08T20:03:16.6198267Z Specifically test game_state.py syntax and import. ... ok
2025-07-08T20:03:16.6199560Z test_main_module_syntax (__main__.TestComprehensiveSyntax.test_main_module_syntax)
2025-07-08T20:03:17.4735400Z Test that main.py has valid syntax and can load its dependencies. ... /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4739110Z   @validator('strength', pre=True)
2025-07-08T20:03:17.4741990Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4746081Z   @validator('dexterity', pre=True)
2025-07-08T20:03:17.4748715Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4751406Z   @validator('constitution', pre=True)
2025-07-08T20:03:17.4754203Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4756882Z   @validator('intelligence', pre=True)
2025-07-08T20:03:17.4759514Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4769728Z   @validator('wisdom', pre=True)
2025-07-08T20:03:17.4772373Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4775489Z   @validator('charisma', pre=True)
2025-07-08T20:03:17.4778093Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4780716Z   @validator('hp', pre=True)
2025-07-08T20:03:17.4783433Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4786040Z   @validator('hp_max', pre=True)
2025-07-08T20:03:17.4788610Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4791227Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:17.4811807Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4816321Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:17.4841944Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4850694Z   @validator('level', pre=True)
2025-07-08T20:03:17.4853513Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4856221Z   @validator('gender')
2025-07-08T20:03:17.4858778Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4861664Z   @validator('age')
2025-07-08T20:03:17.4864369Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4867287Z   @validator('mbti')
2025-07-08T20:03:17.4869862Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4872537Z   @validator('alignment')
2025-07-08T20:03:17.4875311Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4877900Z   @validator('entity_type')
2025-07-08T20:03:17.5029208Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5034170Z   @validator('participants')
2025-07-08T20:03:17.5046386Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5055546Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:17.5058517Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5061232Z   @validator('present_entities')
2025-07-08T20:03:17.5173824Z ok
2025-07-08T20:03:17.5174066Z 
2025-07-08T20:03:17.5174284Z ----------------------------------------------------------------------
2025-07-08T20:03:17.5174777Z === Comprehensive Syntax Testing ===
2025-07-08T20:03:17.5175244Z This test would have caught the f-string syntax error.
2025-07-08T20:03:17.5175599Z 
2025-07-08T20:03:17.5175772Z --- Quick syntax check for all Python files ---
2025-07-08T20:03:17.5176510Z ✓ test_firestore_database_errors.py: Syntax OK
2025-07-08T20:03:17.5176988Z ✓ gemini_service.py: Syntax OK
2025-07-08T20:03:17.5177394Z ✓ inspect_sdk.py: Syntax OK
2025-07-08T20:03:17.5177788Z ✓ debug_mode_parser.py: Syntax OK
2025-07-08T20:03:17.5178491Z ✓ robust_json_parser.py: Syntax OK
2025-07-08T20:03:17.5178938Z ✓ narrative_sync_validator.py: Syntax OK
2025-07-08T20:03:17.5179423Z ✓ test_gemini_error_handling.py: Syntax OK
2025-07-08T20:03:17.5179844Z ✓ main.py: Syntax OK
2025-07-08T20:03:17.5180193Z ✓ logging_util.py: Syntax OK
2025-07-08T20:03:17.5180567Z ✓ json_utils.py: Syntax OK
2025-07-08T20:03:17.5180964Z ✓ entity_preloader.py: Syntax OK
2025-07-08T20:03:17.5181369Z ✓ gemini_response.py: Syntax OK
2025-07-08T20:03:17.5181780Z ✓ firestore_service.py: Syntax OK
2025-07-08T20:03:17.5182176Z ✓ world_loader.py: Syntax OK
2025-07-08T20:03:17.5182579Z ✓ main_parallel_dual_pass.py: Syntax OK
2025-07-08T20:03:17.5183344Z ✓ token_utils.py: Syntax OK
2025-07-08T20:03:17.5183765Z ✓ narrative_response_schema.py: Syntax OK
2025-07-08T20:03:17.5184190Z ✓ game_state.py: Syntax OK
2025-07-08T20:03:17.5184548Z ✓ __init__.py: Syntax OK
2025-07-08T20:03:17.5184955Z ✓ test_gemini_token_management.py: Syntax OK
2025-07-08T20:03:17.5185455Z ✓ test_gemini_generation.py: Syntax OK
2025-07-08T20:03:17.5185914Z ✓ dual_pass_generator.py: Syntax OK
2025-07-08T20:03:17.5186330Z ✓ entity_validator.py: Syntax OK
2025-07-08T20:03:17.5186784Z ✓ test_documentation_performance.py: Syntax OK
2025-07-08T20:03:17.5187261Z ✓ debug_json_response.py: Syntax OK
2025-07-08T20:03:17.5187737Z ✓ test_gemini_response_validation.py: Syntax OK
2025-07-08T20:03:17.5188212Z ✓ debug_hybrid_system.py: Syntax OK
2025-07-08T20:03:17.5188634Z ✓ decorators.py: Syntax OK
2025-07-08T20:03:17.5189007Z ✓ llm_response.py: Syntax OK
2025-07-08T20:03:17.5189387Z ✓ constants.py: Syntax OK
2025-07-08T20:03:17.5189782Z ✓ numeric_field_converter.py: Syntax OK
2025-07-08T20:03:17.5190232Z ✓ document_generator.py: Syntax OK
2025-07-08T20:03:17.5190652Z ✓ entity_instructions.py: Syntax OK
2025-07-08T20:03:17.5191104Z ✓ gemini_response_simplified.py: Syntax OK
2025-07-08T20:03:17.5191547Z ✓ entity_tracking.py: Syntax OK
2025-07-08T20:03:17.5191770Z 
2025-07-08T20:03:17.5191920Z --- Running comprehensive test suite ---
2025-07-08T20:03:17.5192622Z Ran 4 tests in 0.946s
2025-07-08T20:03:17.5193026Z 
2025-07-08T20:03:17.5193451Z OK
2025-07-08T20:03:17.6618740Z ✅ mvp_site/tests/test_syntax_comprehensive.py passed
2025-07-08T20:03:17.6620202Z ----------------------------------------
2025-07-08T20:03:17.6620702Z Running mvp_site/tests/test_think_block_protocol.py...
2025-07-08T20:03:18.2900815Z test_error_response_format_defined (__main__.TestThinkBlockProtocol.test_error_response_format_defined)
2025-07-08T20:03:18.2906631Z Test that error response format is specified ... ok
2025-07-08T20:03:18.2909324Z test_forbidden_actions_defined (__main__.TestThinkBlockProtocol.test_forbidden_actions_defined)
2025-07-08T20:03:18.2945121Z Test that forbidden actions are clearly defined ... ok
2025-07-08T20:03:18.2947904Z test_invalid_input_definitions (__main__.TestThinkBlockProtocol.test_invalid_input_definitions)
2025-07-08T20:03:18.2953009Z Test that invalid post-think-block inputs are defined ... ok
2025-07-08T20:03:18.2954884Z test_protocol_overrides_other_instructions (__main__.TestThinkBlockProtocol.test_protocol_overrides_other_instructions)
2025-07-08T20:03:18.2956816Z Test that protocol explicitly states it overrides other instructions ... ok
2025-07-08T20:03:18.2958000Z test_protocol_priority_placement (__main__.TestThinkBlockProtocol.test_protocol_priority_placement)
2025-07-08T20:03:18.2964161Z Test that think block protocol is at the beginning of the file ... ok
2025-07-08T20:03:18.2965190Z test_state_validation_checkpoints (__main__.TestThinkBlockProtocol.test_state_validation_checkpoints)
2025-07-08T20:03:18.2970307Z Test that state validation checkpoints are defined ... ok
2025-07-08T20:03:18.2971801Z test_think_block_protocol_exists_in_prompt (__main__.TestThinkBlockProtocol.test_think_block_protocol_exists_in_prompt)
2025-07-08T20:03:18.2982302Z Test that think block protocol is present in the prompt file ... ok
2025-07-08T20:03:18.2983713Z test_think_keywords_detection (__main__.TestThinkBlockProtocol.test_think_keywords_detection)
2025-07-08T20:03:18.3001709Z Test that all think block keywords are properly defined ... ok
2025-07-08T20:03:18.3002936Z test_valid_input_definitions (__main__.TestThinkBlockProtocol.test_valid_input_definitions)
2025-07-08T20:03:18.3015452Z Test that valid post-think-block inputs are defined ... ok
2025-07-08T20:03:18.3016574Z test_complex_planning_scenario (__main__.TestThinkBlockScenarios.test_complex_planning_scenario)
2025-07-08T20:03:18.3018658Z Test complex planning scenario ... ok
2025-07-08T20:03:18.3019511Z test_invalid_continuation_scenario (__main__.TestThinkBlockScenarios.test_invalid_continuation_scenario)
2025-07-08T20:03:18.3023140Z Test invalid continuation after think block ... ok
2025-07-08T20:03:18.3024042Z test_simple_think_scenario (__main__.TestThinkBlockScenarios.test_simple_think_scenario)
2025-07-08T20:03:18.3028197Z Test simple think command scenario ... ok
2025-07-08T20:03:18.3029409Z test_valid_selection_scenario (__main__.TestThinkBlockScenarios.test_valid_selection_scenario)
2025-07-08T20:03:18.3030544Z Test valid option selection after think block ... ok
2025-07-08T20:03:18.3032101Z test_backup_file_exists (__main__.TestPromptFileIntegrity.test_backup_file_exists)
2025-07-08T20:03:18.3032908Z Test that backup file was created ... skipped 'Backup file is optional'
2025-07-08T20:03:18.3033999Z test_essential_protocols_preserved (__main__.TestPromptFileIntegrity.test_essential_protocols_preserved)
2025-07-08T20:03:18.3052788Z Test that essential game protocols are preserved ... ok
2025-07-08T20:03:18.3056015Z test_prompt_file_exists (__main__.TestPromptFileIntegrity.test_prompt_file_exists)
2025-07-08T20:03:18.3056713Z Test that the prompt file exists ... ok
2025-07-08T20:03:18.3057385Z test_prompt_file_readable (__main__.TestPromptFileIntegrity.test_prompt_file_readable)
2025-07-08T20:03:18.3058081Z Test that the prompt file is readable ... ok
2025-07-08T20:03:18.3058839Z test_state_transition_rules (__main__.TestThinkBlockStateManagement.test_state_transition_rules)
2025-07-08T20:03:18.3074827Z Test that state transition rules are clearly defined ... ok
2025-07-08T20:03:18.3077365Z test_waiting_state_definition (__main__.TestThinkBlockStateManagement.test_waiting_state_definition)
2025-07-08T20:03:18.3080088Z Test that planning block state is defined ... ok
2025-07-08T20:03:18.3080626Z Running Think Block Protocol Tests...
2025-07-08T20:03:18.3081179Z ==================================================
2025-07-08T20:03:18.3081588Z 
2025-07-08T20:03:18.3081769Z 
2025-07-08T20:03:18.3082216Z ✅ All think block tests passed!
2025-07-08T20:03:18.3082823Z ----------------------------------------------------------------------
2025-07-08T20:03:18.3084203Z Ran 19 tests in 0.018s
2025-07-08T20:03:18.3084411Z 
2025-07-08T20:03:18.3084548Z OK (skipped=1)
2025-07-08T20:03:18.3874547Z ✅ mvp_site/tests/test_think_block_protocol.py passed
2025-07-08T20:03:18.3875632Z ----------------------------------------
2025-07-08T20:03:18.3876196Z Running mvp_site/tests/test_time_consolidation.py...
2025-07-08T20:03:18.4330615Z .........
2025-07-08T20:03:18.4331445Z ----------------------------------------------------------------------
2025-07-08T20:03:18.4332778Z Ran 9 tests in 0.001s
2025-07-08T20:03:18.4333530Z 
2025-07-08T20:03:18.4333670Z OK
2025-07-08T20:03:18.4404306Z ✅ mvp_site/tests/test_time_consolidation.py passed
2025-07-08T20:03:18.4405147Z ----------------------------------------
2025-07-08T20:03:18.4405809Z Running mvp_site/tests/test_time_pressure.py...
2025-07-08T20:03:19.0711760Z 2025-07-08 20:03:19,070 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0716461Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0719295Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0723693Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0725614Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0726776Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0729147Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0730042Z .
2025-07-08T20:03:19.0730706Z ----------------------------------------------------------------------
2025-07-08T20:03:19.0731447Z Ran 7 tests in 0.002s
2025-07-08T20:03:19.0731822Z 
2025-07-08T20:03:19.0732379Z OK
2025-07-08T20:03:19.1508510Z ✅ mvp_site/tests/test_time_pressure.py passed
2025-07-08T20:03:19.1509989Z ----------------------------------------
2025-07-08T20:03:19.1510475Z Running mvp_site/tests/test_token_utils.py...
2025-07-08T20:03:19.2161347Z ...........
2025-07-08T20:03:19.2163924Z ----------------------------------------------------------------------
2025-07-08T20:03:19.2164425Z Ran 11 tests in 0.003s
2025-07-08T20:03:19.2164630Z 
2025-07-08T20:03:19.2164733Z OK
2025-07-08T20:03:19.2263175Z ✅ mvp_site/tests/test_token_utils.py passed
2025-07-08T20:03:19.2264700Z ----------------------------------------
2025-07-08T20:03:19.2265249Z Running mvp_site/tests/test_user_scenario_fix_validation.py...
2025-07-08T20:03:19.2719200Z ....
2025-07-08T20:03:19.2720026Z ----------------------------------------------------------------------
2025-07-08T20:03:19.2721552Z Ran 4 tests in 0.001s
2025-07-08T20:03:19.2721773Z 
2025-07-08T20:03:19.2721890Z OK
2025-07-08T20:03:19.2790344Z ✅ mvp_site/tests/test_user_scenario_fix_validation.py passed
2025-07-08T20:03:19.2791249Z ----------------------------------------
2025-07-08T20:03:19.2791954Z Running mvp_site/tests/test_validation_comparison.py...
2025-07-08T20:03:19.4533143Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:03:19.4536614Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:03:19.4579801Z ...
2025-07-08T20:03:19.4580157Z Pydantic: Handled invalid data gracefully
2025-07-08T20:03:19.4581031Z Pydantic validation: 100 iterations in 0.004s (22471 ops/sec)
2025-07-08T20:03:19.4581930Z ----------------------------------------------------------------------
2025-07-08T20:03:19.4582645Z Ran 4 tests in 0.005s
2025-07-08T20:03:19.4584254Z 
2025-07-08T20:03:19.4584553Z OK
2025-07-08T20:03:19.4860173Z ✅ mvp_site/tests/test_validation_comparison.py passed
2025-07-08T20:03:19.4861168Z ----------------------------------------
2025-07-08T20:03:19.4862025Z Running mvp_site/tests/test_world_loader.py...
2025-07-08T20:03:19.5499108Z test_development_scenario_parent_world (__main__.TestWorldLoader.test_development_scenario_parent_world)
2025-07-08T20:03:19.5515348Z Test loading from ../world in development environment. ... ok
2025-07-08T20:03:19.5516986Z test_missing_world_files_error_handling (__main__.TestWorldLoader.test_missing_world_files_error_handling)
2025-07-08T20:03:19.5528801Z Test error handling when world files are missing. ... ok
2025-07-08T20:03:19.5529961Z test_path_construction_logic (__main__.TestWorldLoader.test_path_construction_logic)
2025-07-08T20:03:19.5536346Z Test the path construction logic for both scenarios. ... ok
2025-07-08T20:03:19.5537284Z test_production_scenario_local_world (__main__.TestWorldLoader.test_production_scenario_local_world)
2025-07-08T20:03:19.5552087Z Test loading from world/ in production environment. ... ok
2025-07-08T20:03:19.5552966Z 
2025-07-08T20:03:19.5553671Z ----------------------------------------------------------------------
2025-07-08T20:03:19.5554528Z Ran 4 tests in 0.005s
2025-07-08T20:03:19.5554977Z 
2025-07-08T20:03:19.5557111Z OK
2025-07-08T20:03:19.5660685Z ✅ mvp_site/tests/test_world_loader.py passed
2025-07-08T20:03:19.5661523Z ----------------------------------------
2025-07-08T20:03:19.5662429Z Running mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py...
2025-07-08T20:03:29.0649198Z test_campaign_wizard_reset_issue_reproduction (__main__.CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction)
2025-07-08T20:03:43.9888176Z Reproduce the complete user workflow that leads to persistent spinner ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction of <__main__.CampaignWizardResetReproductionTest testMethod=test_campaign_wizard_reset_issue_reproduction>>)
2025-07-08T20:03:43.9891285Z   return self.run(*args, **kwds)
2025-07-08T20:03:43.9891642Z ok
2025-07-08T20:03:44.5116265Z 
2025-07-08T20:03:44.5116845Z 
2025-07-08T20:03:44.5119264Z ----------------------------------------------------------------------
2025-07-08T20:03:44.5120614Z 🧪 REPRODUCING CAMPAIGN WIZARD RESET ISSUE
2025-07-08T20:03:44.5121497Z Ran 1 test in 24.758s
2025-07-08T20:03:44.5124687Z 
2025-07-08T20:03:44.5124993Z 📱 Step 1: Loading application...
2025-07-08T20:03:44.5133471Z OK
2025-07-08T20:03:44.5133941Z 🎮 Step 2: Simulating first campaign creation...
2025-07-08T20:03:44.5134588Z 🚀 Step 3: Clicking 'Begin Adventure' to create first campaign...
2025-07-08T20:03:44.5135143Z ⏳ Step 4: Waiting for spinner to appear...
2025-07-08T20:03:44.5135525Z    Spinner visible: True
2025-07-08T20:03:44.5135988Z 📊 Step 5: Waiting for campaign creation to complete...
2025-07-08T20:03:44.5136403Z    Dashboard visible: True
2025-07-08T20:03:44.5136930Z 🎯 Step 6: Clicking 'Start Campaign' again (reproducing the bug)...
2025-07-08T20:03:44.5137651Z 🔍 Step 7: Checking what appears - fresh wizard or persistent spinner...
2025-07-08T20:03:44.5138232Z    ✅ Fresh wizard content present: True
2025-07-08T20:03:44.5138666Z    ✅ No persistent spinner found
2025-07-08T20:03:44.5139134Z 🔬 Step 8: Analyzing DOM state for debugging...
2025-07-08T20:03:44.5139547Z    Campaign wizard container contents:
2025-07-08T20:03:44.5139884Z    
2025-07-08T20:03:44.5140158Z                             <div class="wizard-content">
2025-07-08T20:03:44.5140579Z                                 <h3>Campaign Creation Wizard</h3>
2025-07-08T20:03:44.5141053Z                                 <div class="wizard-step">Step 1: Basic Detai...
2025-07-08T20:03:44.5141554Z 📋 Step 9: Test Results Summary
2025-07-08T20:03:44.5141897Z ==================================================
2025-07-08T20:03:44.5142469Z ✅ EXPECTED BEHAVIOR: Fresh wizard appears, no persistent spinner
2025-07-08T20:03:44.5142938Z Test Result: PASS
2025-07-08T20:03:44.5143387Z ==================================================
2025-07-08T20:03:44.5223784Z sys:1: ResourceWarning: unclosed <socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8766)>
2025-07-08T20:03:44.5378559Z ✅ mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py passed
2025-07-08T20:03:44.5379674Z ----------------------------------------
2025-07-08T20:03:44.5380107Z 
2025-07-08T20:03:44.5380249Z ========================================
2025-07-08T20:03:44.5380665Z TEST SUMMARY: 120/121 tests passed
2025-07-08T20:03:44.5385228Z ========================================
2025-07-08T20:03:44.5385551Z 
2025-07-08T20:03:44.5385805Z Failed tests:\n  - mvp_site/tests/test_debug_hybrid_system.py
2025-07-08T20:03:44.5386201Z 
2025-07-08T20:03:44.5386373Z Note: Some tests may fail in CI due to:
2025-07-08T20:03:44.5386667Z   - Missing local services (e.g., test server)
2025-07-08T20:03:44.5386943Z   - Test isolation issues
2025-07-08T20:03:44.5387190Z   - Timing-sensitive tests
2025-07-08T20:03:44.5398180Z ##[error]Process completed with exit code 1.
