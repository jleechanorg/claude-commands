2025-07-08T20:02:21.4060605Z Current runner version: '2.325.0'
2025-07-08T20:02:21.4097539Z ##[group]Runner Image Provisioner
2025-07-08T20:02:21.4098897Z Hosted Compute Agent
2025-07-08T20:02:21.4099749Z Version: 20250620.352
2025-07-08T20:02:21.4100688Z Commit: f262f3aba23b10ea191b2a62bdee1ca4c3d344da
2025-07-08T20:02:21.4101779Z Build Date: 2025-06-20T19:27:17Z
2025-07-08T20:02:21.4102896Z ##[endgroup]
2025-07-08T20:02:21.4104367Z ##[group]Operating System
2025-07-08T20:02:21.4105243Z Ubuntu
2025-07-08T20:02:21.4106177Z 24.04.2
2025-07-08T20:02:21.4106876Z LTS
2025-07-08T20:02:21.4107637Z ##[endgroup]
2025-07-08T20:02:21.4108391Z ##[group]Runner Image
2025-07-08T20:02:21.4109387Z Image: ubuntu-24.04
2025-07-08T20:02:21.4110143Z Version: 20250629.1.0
2025-07-08T20:02:21.4111975Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250629.1/images/ubuntu/Ubuntu2404-Readme.md
2025-07-08T20:02:21.4114875Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250629.1
2025-07-08T20:02:21.4116621Z ##[endgroup]
2025-07-08T20:02:21.4118555Z ##[group]GITHUB_TOKEN Permissions
2025-07-08T20:02:21.4121053Z Contents: read
2025-07-08T20:02:21.4121970Z Metadata: read
2025-07-08T20:02:21.4122850Z Packages: read
2025-07-08T20:02:21.4123799Z ##[endgroup]
2025-07-08T20:02:21.4126814Z Secret source: Actions
2025-07-08T20:02:21.4127814Z Prepare workflow directory
2025-07-08T20:02:21.4591421Z Prepare all required actions
2025-07-08T20:02:21.4647601Z Getting action download info
2025-07-08T20:02:21.8067661Z ##[group]Download immutable action package 'actions/checkout@v4'
2025-07-08T20:02:21.8068855Z Version: 4.2.2
2025-07-08T20:02:21.8069862Z Digest: sha256:ccb2698953eaebd21c7bf6268a94f9c26518a7e38e27e0b83c1fe1ad049819b1
2025-07-08T20:02:21.8071066Z Source commit SHA: 11bd71901bbe5b1630ceea73d27597364c9af683
2025-07-08T20:02:21.8071885Z ##[endgroup]
2025-07-08T20:02:21.9132643Z ##[group]Download immutable action package 'actions/setup-python@v4'
2025-07-08T20:02:21.9133927Z Version: 4.9.1
2025-07-08T20:02:21.9134840Z Digest: sha256:f03e505388af670b5a108629e0ba26befc08d5c62b41f46146a45fe29ae509a5
2025-07-08T20:02:21.9135869Z Source commit SHA: 7f4fc3e22c37d6ff65e88745f38bd3157c663f7c
2025-07-08T20:02:21.9136700Z ##[endgroup]
2025-07-08T20:02:22.1559068Z ##[group]Download immutable action package 'actions/cache@v4'
2025-07-08T20:02:22.1559890Z Version: 4.2.3
2025-07-08T20:02:22.1560696Z Digest: sha256:c8a3bb963e1f1826d8fcc8d1354f0dd29d8ac1db1d4f6f20247055ae11b81ed9
2025-07-08T20:02:22.1561872Z Source commit SHA: 5a3ec84eff668545956fd18022155c47e93e2684
2025-07-08T20:02:22.1562607Z ##[endgroup]
2025-07-08T20:02:22.2764535Z ##[group]Download immutable action package 'actions/upload-artifact@v4'
2025-07-08T20:02:22.2765345Z Version: 4.6.2
2025-07-08T20:02:22.2766042Z Digest: sha256:290722aa3281d5caf23d0acdc3dbeb3424786a1a01a9cc97e72f147225e37c38
2025-07-08T20:02:22.2766963Z Source commit SHA: ea165f8d65b6e75b540449e92b4886f43607fa02
2025-07-08T20:02:22.2767623Z ##[endgroup]
2025-07-08T20:02:22.4776207Z Complete job name: test
2025-07-08T20:02:22.5456572Z ##[group]Run actions/checkout@v4
2025-07-08T20:02:22.5457463Z with:
2025-07-08T20:02:22.5457953Z   repository: jleechan2015/worldarchitect.ai
2025-07-08T20:02:22.5458728Z   token: ***
2025-07-08T20:02:22.5459153Z   ssh-strict: true
2025-07-08T20:02:22.5459584Z   ssh-user: git
2025-07-08T20:02:22.5460034Z   persist-credentials: true
2025-07-08T20:02:22.5460530Z   clean: true
2025-07-08T20:02:22.5460987Z   sparse-checkout-cone-mode: true
2025-07-08T20:02:22.5461556Z   fetch-depth: 1
2025-07-08T20:02:22.5461988Z   fetch-tags: false
2025-07-08T20:02:22.5462437Z   show-progress: true
2025-07-08T20:02:22.5462882Z   lfs: false
2025-07-08T20:02:22.5463628Z   submodules: false
2025-07-08T20:02:22.5464096Z   set-safe-directory: true
2025-07-08T20:02:22.5464880Z ##[endgroup]
2025-07-08T20:02:22.6628709Z Syncing repository: jleechan2015/worldarchitect.ai
2025-07-08T20:02:22.6630565Z ##[group]Getting Git version info
2025-07-08T20:02:22.6631505Z Working directory is '/home/runner/work/worldarchitect.ai/worldarchitect.ai'
2025-07-08T20:02:22.6633824Z [command]/usr/bin/git version
2025-07-08T20:02:22.6694520Z git version 2.49.0
2025-07-08T20:02:22.6727115Z ##[endgroup]
2025-07-08T20:02:22.6739224Z Temporarily overriding HOME='/home/runner/work/_temp/571e6102-25f9-4379-abf4-99c366e70170' before making global git config changes
2025-07-08T20:02:22.6744359Z Adding repository directory to the temporary git global config as a safe directory
2025-07-08T20:02:22.6747926Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T20:02:22.6783773Z Deleting the contents of '/home/runner/work/worldarchitect.ai/worldarchitect.ai'
2025-07-08T20:02:22.6788626Z ##[group]Initializing the repository
2025-07-08T20:02:22.6794449Z [command]/usr/bin/git init /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T20:02:22.6867539Z hint: Using 'master' as the name for the initial branch. This default branch name
2025-07-08T20:02:22.6869678Z hint: is subject to change. To configure the initial branch name to use in all
2025-07-08T20:02:22.6872839Z hint: of your new repositories, which will suppress this warning, call:
2025-07-08T20:02:22.6874633Z hint:
2025-07-08T20:02:22.6875630Z hint: 	git config --global init.defaultBranch <name>
2025-07-08T20:02:22.6876823Z hint:
2025-07-08T20:02:22.6878131Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2025-07-08T20:02:22.6879985Z hint: 'development'. The just-created branch can be renamed via this command:
2025-07-08T20:02:22.6881448Z hint:
2025-07-08T20:02:22.6882211Z hint: 	git branch -m <name>
2025-07-08T20:02:22.6884273Z Initialized empty Git repository in /home/runner/work/worldarchitect.ai/worldarchitect.ai/.git/
2025-07-08T20:02:22.6889564Z [command]/usr/bin/git remote add origin https://github.com/jleechan2015/worldarchitect.ai
2025-07-08T20:02:22.6929271Z ##[endgroup]
2025-07-08T20:02:22.6932378Z ##[group]Disabling automatic garbage collection
2025-07-08T20:02:22.6933868Z [command]/usr/bin/git config --local gc.auto 0
2025-07-08T20:02:22.6963761Z ##[endgroup]
2025-07-08T20:02:22.6966896Z ##[group]Setting up auth
2025-07-08T20:02:22.6970133Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-07-08T20:02:22.7003578Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-07-08T20:02:22.7308646Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-07-08T20:02:22.7342818Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-07-08T20:02:22.7727772Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2025-07-08T20:02:22.7940949Z ##[endgroup]
2025-07-08T20:02:22.7943114Z ##[group]Fetching the repository
2025-07-08T20:02:22.7955177Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +b7708f9ed7dd1aba860690c60aa5afcb10a21326:refs/remotes/pull/430/merge
2025-07-08T20:02:23.8704827Z From https://github.com/jleechan2015/worldarchitect.ai
2025-07-08T20:02:23.8707684Z  * [new ref]         b7708f9ed7dd1aba860690c60aa5afcb10a21326 -> pull/430/merge
2025-07-08T20:02:23.8712158Z ##[endgroup]
2025-07-08T20:02:23.8714102Z ##[group]Determining the checkout info
2025-07-08T20:02:23.8716250Z ##[endgroup]
2025-07-08T20:02:23.8718725Z [command]/usr/bin/git sparse-checkout disable
2025-07-08T20:02:23.8753787Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2025-07-08T20:02:23.8787797Z ##[group]Checking out the ref
2025-07-08T20:02:23.8791574Z [command]/usr/bin/git checkout --progress --force refs/remotes/pull/430/merge
2025-07-08T20:02:23.9639098Z Note: switching to 'refs/remotes/pull/430/merge'.
2025-07-08T20:02:23.9641303Z 
2025-07-08T20:02:23.9644250Z You are in 'detached HEAD' state. You can look around, make experimental
2025-07-08T20:02:23.9648608Z changes and commit them, and you can discard any commits you make in this
2025-07-08T20:02:23.9651676Z state without impacting any branches by switching back to a branch.
2025-07-08T20:02:23.9653831Z 
2025-07-08T20:02:23.9654984Z If you want to create a new branch to retain commits you create, you may
2025-07-08T20:02:23.9657668Z do so (now or later) by using -c with the switch command. Example:
2025-07-08T20:02:23.9659258Z 
2025-07-08T20:02:23.9659884Z   git switch -c <new-branch-name>
2025-07-08T20:02:23.9660978Z 
2025-07-08T20:02:23.9661560Z Or undo this operation with:
2025-07-08T20:02:23.9662563Z 
2025-07-08T20:02:23.9663076Z   git switch -
2025-07-08T20:02:23.9664807Z 
2025-07-08T20:02:23.9666118Z Turn off this advice by setting config variable advice.detachedHead to false
2025-07-08T20:02:23.9668108Z 
2025-07-08T20:02:23.9670480Z HEAD is now at b7708f9 Merge 5efa2ca09e766516d8962d109b9c416876fffeeb into d7f7eee17c0156a164f97723bfd44ca440ee0194
2025-07-08T20:02:23.9677549Z ##[endgroup]
2025-07-08T20:02:23.9679978Z [command]/usr/bin/git log -1 --format=%H
2025-07-08T20:02:23.9681311Z b7708f9ed7dd1aba860690c60aa5afcb10a21326
2025-07-08T20:02:23.9912931Z ##[group]Run actions/setup-python@v4
2025-07-08T20:02:23.9914332Z with:
2025-07-08T20:02:23.9915078Z   python-version: 3.11
2025-07-08T20:02:23.9915942Z   check-latest: false
2025-07-08T20:02:23.9917021Z   token: ***
2025-07-08T20:02:23.9917786Z   update-environment: true
2025-07-08T20:02:23.9918729Z   allow-prereleases: false
2025-07-08T20:02:23.9919642Z ##[endgroup]
2025-07-08T20:02:24.1790073Z ##[group]Installed versions
2025-07-08T20:02:24.1936860Z Successfully set up CPython (3.11.13)
2025-07-08T20:02:24.1952187Z ##[endgroup]
2025-07-08T20:02:24.3762884Z ##[group]Run actions/cache@v4
2025-07-08T20:02:24.3764192Z with:
2025-07-08T20:02:24.3764831Z   path: ~/.cache/pip
2025-07-08T20:02:24.3766070Z   key: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T20:02:24.3767447Z   restore-keys: Linux-pip-

2025-07-08T20:02:24.3768272Z   enableCrossOsArchive: false
2025-07-08T20:02:24.3769095Z   fail-on-cache-miss: false
2025-07-08T20:02:24.3769869Z   lookup-only: false
2025-07-08T20:02:24.3770572Z   save-always: false
2025-07-08T20:02:24.3771249Z env:
2025-07-08T20:02:24.3772054Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:24.3774152Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T20:02:24.3775516Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:24.3776741Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:24.3777961Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:24.3779247Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T20:02:24.3780270Z ##[endgroup]
2025-07-08T20:02:24.6918183Z Cache hit for: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T20:02:25.2820490Z Received 65069192 of 65069192 (100.0%), 117.1 MBs/sec
2025-07-08T20:02:25.2823612Z Cache Size: ~62 MB (65069192 B)
2025-07-08T20:02:25.2855924Z [command]/usr/bin/tar -xf /home/runner/work/_temp/f5fce610-991d-413c-a069-2040284e5dc9/cache.tzst -P -C /home/runner/work/worldarchitect.ai/worldarchitect.ai --use-compress-program unzstd
2025-07-08T20:02:25.4660374Z Cache restored successfully
2025-07-08T20:02:25.4985785Z Cache restored from key: Linux-pip-c1cc63b232b8875ac04c87ca8b5e97a1253f24efacf8680942841e1f864eb279
2025-07-08T20:02:25.5157436Z ##[group]Run python -m pip install --upgrade pip
2025-07-08T20:02:25.5157859Z [36;1mpython -m pip install --upgrade pip[0m
2025-07-08T20:02:25.5158187Z [36;1mpip install -r mvp_site/requirements.txt[0m
2025-07-08T20:02:25.5266617Z shell: /usr/bin/bash -e {0}
2025-07-08T20:02:25.5266874Z env:
2025-07-08T20:02:25.5267137Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:25.5267789Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T20:02:25.5268197Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:25.5268557Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:25.5268921Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:25.5269283Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T20:02:25.5269587Z ##[endgroup]
2025-07-08T20:02:26.2574689Z Requirement already satisfied: pip in /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages (25.1.1)
2025-07-08T20:02:26.7995014Z Collecting Flask==3.0.0 (from -r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:26.8010887Z   Using cached flask-3.0.0-py3-none-any.whl.metadata (3.6 kB)
2025-07-08T20:02:26.8277827Z Collecting gunicorn==21.2.0 (from -r mvp_site/requirements.txt (line 2))
2025-07-08T20:02:26.8299825Z   Using cached gunicorn-21.2.0-py3-none-any.whl.metadata (4.1 kB)
2025-07-08T20:02:26.9014631Z Collecting firebase-admin==6.5.0 (from -r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:26.9030741Z   Using cached firebase_admin-6.5.0-py3-none-any.whl.metadata (1.5 kB)
2025-07-08T20:02:26.9254858Z Collecting google-cloud-firestore==2.16.0 (from -r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:26.9271054Z   Using cached google_cloud_firestore-2.16.0-py2.py3-none-any.whl.metadata (5.7 kB)
2025-07-08T20:02:26.9451311Z Collecting google-genai (from -r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:26.9491345Z   Using cached google_genai-1.24.0-py3-none-any.whl.metadata (40 kB)
2025-07-08T20:02:27.1052411Z Collecting protobuf==4.25.3 (from -r mvp_site/requirements.txt (line 6))
2025-07-08T20:02:27.1069242Z   Using cached protobuf-4.25.3-cp37-abi3-manylinux2014_x86_64.whl.metadata (541 bytes)
2025-07-08T20:02:27.1250015Z Collecting Flask-Cors==4.0.0 (from -r mvp_site/requirements.txt (line 7))
2025-07-08T20:02:27.1264125Z   Using cached Flask_Cors-4.0.0-py2.py3-none-any.whl.metadata (5.4 kB)
2025-07-08T20:02:27.1457101Z Collecting fpdf2 (from -r mvp_site/requirements.txt (line 8))
2025-07-08T20:02:27.1471101Z   Using cached fpdf2-2.8.3-py2.py3-none-any.whl.metadata (69 kB)
2025-07-08T20:02:27.1629082Z Collecting python-docx (from -r mvp_site/requirements.txt (line 9))
2025-07-08T20:02:27.1648983Z   Using cached python_docx-1.2.0-py3-none-any.whl.metadata (2.0 kB)
2025-07-08T20:02:27.1875061Z Collecting google-cloud-secret-manager (from -r mvp_site/requirements.txt (line 10))
2025-07-08T20:02:27.1882667Z   Using cached google_cloud_secret_manager-2.24.0-py3-none-any.whl.metadata (9.7 kB)
2025-07-08T20:02:27.2301641Z Collecting selenium (from -r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:27.2748660Z   Downloading selenium-4.34.2-py3-none-any.whl.metadata (7.5 kB)
2025-07-08T20:02:27.3005670Z Collecting Werkzeug>=3.0.0 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:27.3023919Z   Using cached werkzeug-3.1.3-py3-none-any.whl.metadata (3.7 kB)
2025-07-08T20:02:27.3205810Z Collecting Jinja2>=3.1.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:27.3221436Z   Using cached jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
2025-07-08T20:02:27.3397866Z Collecting itsdangerous>=2.1.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:27.3421384Z   Using cached itsdangerous-2.2.0-py3-none-any.whl.metadata (1.9 kB)
2025-07-08T20:02:27.3611144Z Collecting click>=8.1.3 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:27.3631577Z   Using cached click-8.2.1-py3-none-any.whl.metadata (2.5 kB)
2025-07-08T20:02:27.3759662Z Collecting blinker>=1.6.2 (from Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:27.3773622Z   Using cached blinker-1.9.0-py3-none-any.whl.metadata (1.6 kB)
2025-07-08T20:02:27.3955567Z Collecting packaging (from gunicorn==21.2.0->-r mvp_site/requirements.txt (line 2))
2025-07-08T20:02:27.3969463Z   Using cached packaging-25.0-py3-none-any.whl.metadata (3.3 kB)
2025-07-08T20:02:27.4132049Z Collecting cachecontrol>=0.12.6 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.4146080Z   Using cached cachecontrol-0.14.3-py3-none-any.whl.metadata (3.1 kB)
2025-07-08T20:02:27.4863622Z Collecting google-api-python-client>=1.7.8 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.4934545Z   Downloading google_api_python_client-2.176.0-py3-none-any.whl.metadata (7.0 kB)
2025-07-08T20:02:27.5280222Z Collecting google-cloud-storage>=1.37.1 (from firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.5354069Z   Downloading google_cloud_storage-3.2.0-py3-none-any.whl.metadata (13 kB)
2025-07-08T20:02:27.5596689Z Collecting pyjwt>=2.5.0 (from pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.5610514Z   Using cached PyJWT-2.10.1-py3-none-any.whl.metadata (4.0 kB)
2025-07-08T20:02:27.6032036Z Collecting google-api-core<3.0.0dev,>=1.22.1 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.6045945Z   Using cached google_api_core-2.25.1-py3-none-any.whl.metadata (3.0 kB)
2025-07-08T20:02:27.7428376Z Collecting google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:27.7445023Z   Using cached google_auth-2.40.3-py2.py3-none-any.whl.metadata (6.2 kB)
2025-07-08T20:02:27.7725261Z Collecting google-cloud-core<3.0.0dev,>=1.4.1 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:27.7738805Z   Using cached google_cloud_core-2.4.3-py2.py3-none-any.whl.metadata (2.7 kB)
2025-07-08T20:02:27.7989167Z Collecting proto-plus<2.0.0dev,>=1.22.0 (from google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:27.8002736Z   Using cached proto_plus-1.26.1-py3-none-any.whl.metadata (2.2 kB)
2025-07-08T20:02:27.8543768Z Collecting googleapis-common-protos<2.0.0,>=1.56.2 (from google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.8560767Z   Using cached googleapis_common_protos-1.70.0-py3-none-any.whl.metadata (9.3 kB)
2025-07-08T20:02:27.9508270Z Collecting requests<3.0.0,>=2.18.0 (from google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:27.9523615Z   Using cached requests-2.32.4-py3-none-any.whl.metadata (4.9 kB)
2025-07-08T20:02:28.4381022Z Collecting grpcio<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:28.4398290Z   Using cached grpcio-1.73.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.8 kB)
2025-07-08T20:02:28.5153514Z Collecting grpcio-status<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:28.5168948Z   Using cached grpcio_status-1.73.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.5515547Z Collecting cachetools<6.0,>=2.0.0 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:28.5529368Z   Using cached cachetools-5.5.2-py3-none-any.whl.metadata (5.4 kB)
2025-07-08T20:02:28.5725182Z Collecting pyasn1-modules>=0.2.1 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:28.5738990Z   Using cached pyasn1_modules-0.4.2-py3-none-any.whl.metadata (3.5 kB)
2025-07-08T20:02:28.5907233Z Collecting rsa<5,>=3.1.4 (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:28.5919753Z   Using cached rsa-4.9.1-py3-none-any.whl.metadata (5.6 kB)
2025-07-08T20:02:28.6787857Z INFO: pip is looking at multiple versions of grpcio-status to determine which version is compatible with other requirements. This could take a while.
2025-07-08T20:02:28.6795970Z Collecting grpcio-status<2.0.0,>=1.33.2 (from google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:28.6816089Z   Using cached grpcio_status-1.73.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.6857749Z   Using cached grpcio_status-1.72.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.6895601Z   Using cached grpcio_status-1.72.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.6933503Z   Using cached grpcio_status-1.71.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7226675Z   Using cached grpcio_status-1.71.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7264276Z   Using cached grpcio_status-1.70.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7301916Z   Using cached grpcio_status-1.69.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7326700Z INFO: pip is still looking at multiple versions of grpcio-status to determine which version is compatible with other requirements. This could take a while.
2025-07-08T20:02:28.7342611Z   Using cached grpcio_status-1.68.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7380647Z   Using cached grpcio_status-1.68.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7417917Z   Using cached grpcio_status-1.67.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7463047Z   Using cached grpcio_status-1.67.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7509826Z   Using cached grpcio_status-1.66.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7535841Z INFO: This is taking longer than usual. You might need to provide the dependency resolver with stricter constraints to reduce runtime. See https://pip.pypa.io/warnings/backtracking for guidance. If you want to abort this run, press Ctrl + C.
2025-07-08T20:02:28.7554333Z   Using cached grpcio_status-1.66.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7592253Z   Using cached grpcio_status-1.66.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7629927Z   Using cached grpcio_status-1.65.5-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7669985Z   Using cached grpcio_status-1.65.4-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7707753Z   Using cached grpcio_status-1.65.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7746013Z   Using cached grpcio_status-1.65.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7783753Z   Using cached grpcio_status-1.64.3-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7822264Z   Using cached grpcio_status-1.64.1-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7859804Z   Using cached grpcio_status-1.64.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7897290Z   Using cached grpcio_status-1.63.2-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7935170Z   Using cached grpcio_status-1.63.0-py3-none-any.whl.metadata (1.1 kB)
2025-07-08T20:02:28.7972454Z   Using cached grpcio_status-1.62.3-py3-none-any.whl.metadata (1.3 kB)
2025-07-08T20:02:28.9869159Z Collecting charset_normalizer<4,>=2 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:28.9889692Z   Using cached charset_normalizer-3.4.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (35 kB)
2025-07-08T20:02:29.0119761Z Collecting idna<4,>=2.5 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:29.0135769Z   Using cached idna-3.10-py3-none-any.whl.metadata (10 kB)
2025-07-08T20:02:29.0415865Z Collecting urllib3<3,>=1.21.1 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:29.0429492Z   Using cached urllib3-2.5.0-py3-none-any.whl.metadata (6.5 kB)
2025-07-08T20:02:29.0652208Z Collecting certifi>=2017.4.17 (from requests<3.0.0,>=2.18.0->google-api-core<3.0.0dev,>=1.22.1->google-api-core[grpc]<3.0.0dev,>=1.22.1; platform_python_implementation != "PyPy"->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:29.0666128Z   Using cached certifi-2025.6.15-py3-none-any.whl.metadata (2.4 kB)
2025-07-08T20:02:29.0912895Z Collecting pyasn1>=0.1.3 (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-firestore==2.16.0->-r mvp_site/requirements.txt (line 4))
2025-07-08T20:02:29.0926573Z   Using cached pyasn1-0.6.1-py3-none-any.whl.metadata (8.4 kB)
2025-07-08T20:02:29.1135502Z Collecting anyio<5.0.0,>=4.8.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.1149137Z   Using cached anyio-4.9.0-py3-none-any.whl.metadata (4.7 kB)
2025-07-08T20:02:29.1428714Z Collecting httpx<1.0.0,>=0.28.1 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.1442952Z   Using cached httpx-0.28.1-py3-none-any.whl.metadata (7.1 kB)
2025-07-08T20:02:29.2576238Z Collecting pydantic<3.0.0,>=2.0.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.2592644Z   Using cached pydantic-2.11.7-py3-none-any.whl.metadata (67 kB)
2025-07-08T20:02:29.2868664Z Collecting tenacity<9.0.0,>=8.2.3 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.2882864Z   Using cached tenacity-8.5.0-py3-none-any.whl.metadata (1.2 kB)
2025-07-08T20:02:29.3726463Z Collecting websockets<15.1.0,>=13.0.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.3743611Z   Using cached websockets-15.0.1-cp311-cp311-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.8 kB)
2025-07-08T20:02:29.3972021Z Collecting typing-extensions<5.0.0,>=4.11.0 (from google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.4044776Z   Downloading typing_extensions-4.14.1-py3-none-any.whl.metadata (3.0 kB)
2025-07-08T20:02:29.4225133Z Collecting sniffio>=1.1 (from anyio<5.0.0,>=4.8.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.4239534Z   Using cached sniffio-1.3.1-py3-none-any.whl.metadata (3.9 kB)
2025-07-08T20:02:29.4482429Z Collecting httpcore==1.* (from httpx<1.0.0,>=0.28.1->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.4495314Z   Using cached httpcore-1.0.9-py3-none-any.whl.metadata (21 kB)
2025-07-08T20:02:29.4644374Z Collecting h11>=0.16 (from httpcore==1.*->httpx<1.0.0,>=0.28.1->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.4658335Z   Using cached h11-0.16.0-py3-none-any.whl.metadata (8.3 kB)
2025-07-08T20:02:29.4805604Z Collecting annotated-types>=0.6.0 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:29.4819526Z   Using cached annotated_types-0.7.0-py3-none-any.whl.metadata (15 kB)
2025-07-08T20:02:30.1189993Z Collecting pydantic-core==2.33.2 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:30.1207991Z   Using cached pydantic_core-2.33.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.8 kB)
2025-07-08T20:02:30.1366262Z Collecting typing-inspection>=0.4.0 (from pydantic<3.0.0,>=2.0.0->google-genai->-r mvp_site/requirements.txt (line 5))
2025-07-08T20:02:30.1379705Z   Using cached typing_inspection-0.4.1-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T20:02:30.1618995Z Collecting defusedxml (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T20:02:30.1633921Z   Using cached defusedxml-0.7.1-py2.py3-none-any.whl.metadata (32 kB)
2025-07-08T20:02:30.3592094Z Collecting Pillow!=9.2.*,>=6.2.2 (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T20:02:30.3608979Z   Using cached pillow-11.3.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (9.0 kB)
2025-07-08T20:02:30.5085310Z Collecting fonttools>=4.34.0 (from fpdf2->-r mvp_site/requirements.txt (line 8))
2025-07-08T20:02:30.5166587Z   Downloading fonttools-4.58.5-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (106 kB)
2025-07-08T20:02:30.7855277Z Collecting lxml>=3.1.0 (from python-docx->-r mvp_site/requirements.txt (line 9))
2025-07-08T20:02:30.7872482Z   Using cached lxml-6.0.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (6.6 kB)
2025-07-08T20:02:30.8116805Z Collecting grpc-google-iam-v1<1.0.0,>=0.14.0 (from google-cloud-secret-manager->-r mvp_site/requirements.txt (line 10))
2025-07-08T20:02:30.8131434Z   Using cached grpc_google_iam_v1-0.14.2-py3-none-any.whl.metadata (9.1 kB)
2025-07-08T20:02:30.8674738Z Collecting trio~=0.30.0 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.8689513Z   Using cached trio-0.30.0-py3-none-any.whl.metadata (8.5 kB)
2025-07-08T20:02:30.8834594Z Collecting trio-websocket~=0.12.2 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.8848469Z   Using cached trio_websocket-0.12.2-py3-none-any.whl.metadata (5.1 kB)
2025-07-08T20:02:30.9141811Z Collecting websocket-client~=1.8.0 (from selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.9156465Z   Using cached websocket_client-1.8.0-py3-none-any.whl.metadata (8.0 kB)
2025-07-08T20:02:30.9349018Z Collecting attrs>=23.2.0 (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.9360452Z   Using cached attrs-25.3.0-py3-none-any.whl.metadata (10 kB)
2025-07-08T20:02:30.9568964Z Collecting sortedcontainers (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.9584238Z   Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl.metadata (10 kB)
2025-07-08T20:02:30.9713842Z Collecting outcome (from trio~=0.30.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.9728068Z   Using cached outcome-1.3.0.post0-py2.py3-none-any.whl.metadata (2.6 kB)
2025-07-08T20:02:30.9952813Z Collecting wsproto>=0.14 (from trio-websocket~=0.12.2->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:30.9973803Z   Using cached wsproto-1.2.0-py3-none-any.whl.metadata (5.6 kB)
2025-07-08T20:02:31.0167695Z Collecting pysocks!=1.5.7,<2.0,>=1.5.6 (from urllib3[socks]~=2.5.0->selenium->-r mvp_site/requirements.txt (line 11))
2025-07-08T20:02:31.0181539Z   Using cached PySocks-1.7.1-py3-none-any.whl.metadata (13 kB)
2025-07-08T20:02:31.1009710Z Collecting msgpack<2.0.0,>=0.5.2 (from cachecontrol>=0.12.6->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.1027585Z   Using cached msgpack-1.1.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (8.4 kB)
2025-07-08T20:02:31.1279477Z Collecting httplib2<1.0.0,>=0.19.0 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.1292408Z   Using cached httplib2-0.22.0-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T20:02:31.1687538Z Collecting google-auth-httplib2<1.0.0,>=0.2.0 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.1701451Z   Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl.metadata (2.2 kB)
2025-07-08T20:02:31.1822462Z Collecting uritemplate<5,>=3.0.1 (from google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.1836156Z   Using cached uritemplate-4.2.0-py3-none-any.whl.metadata (2.6 kB)
2025-07-08T20:02:31.2236428Z Collecting pyparsing!=3.0.0,!=3.0.1,!=3.0.2,!=3.0.3,<4,>=2.4.2 (from httplib2<1.0.0,>=0.19.0->google-api-python-client>=1.7.8->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.2249936Z   Using cached pyparsing-3.2.3-py3-none-any.whl.metadata (5.0 kB)
2025-07-08T20:02:31.2708153Z Collecting google-resumable-media<3.0.0,>=2.7.2 (from google-cloud-storage>=1.37.1->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.2724893Z   Using cached google_resumable_media-2.7.2-py2.py3-none-any.whl.metadata (2.2 kB)
2025-07-08T20:02:31.3271530Z Collecting google-crc32c<2.0.0,>=1.1.3 (from google-cloud-storage>=1.37.1->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.3286876Z   Using cached google_crc32c-1.7.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (2.3 kB)
2025-07-08T20:02:31.3888555Z Collecting MarkupSafe>=2.0 (from Jinja2>=3.1.2->Flask==3.0.0->-r mvp_site/requirements.txt (line 1))
2025-07-08T20:02:31.3903706Z   Using cached MarkupSafe-3.0.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.0 kB)
2025-07-08T20:02:31.5927554Z Collecting cryptography>=3.4.0 (from pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.6004238Z   Downloading cryptography-45.0.5-cp311-abi3-manylinux_2_34_x86_64.whl.metadata (5.7 kB)
2025-07-08T20:02:31.7780916Z Collecting cffi>=1.14 (from cryptography>=3.4.0->pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.7797290Z   Using cached cffi-1.17.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (1.5 kB)
2025-07-08T20:02:31.7944436Z Collecting pycparser (from cffi>=1.14->cryptography>=3.4.0->pyjwt[crypto]>=2.5.0->firebase-admin==6.5.0->-r mvp_site/requirements.txt (line 3))
2025-07-08T20:02:31.7961107Z   Using cached pycparser-2.22-py3-none-any.whl.metadata (943 bytes)
2025-07-08T20:02:31.8219286Z Using cached flask-3.0.0-py3-none-any.whl (99 kB)
2025-07-08T20:02:31.8233704Z Using cached gunicorn-21.2.0-py3-none-any.whl (80 kB)
2025-07-08T20:02:31.8247813Z Using cached firebase_admin-6.5.0-py3-none-any.whl (126 kB)
2025-07-08T20:02:31.8262131Z Using cached google_cloud_firestore-2.16.0-py2.py3-none-any.whl (317 kB)
2025-07-08T20:02:31.8279078Z Using cached protobuf-4.25.3-cp37-abi3-manylinux2014_x86_64.whl (294 kB)
2025-07-08T20:02:31.8294322Z Using cached Flask_Cors-4.0.0-py2.py3-none-any.whl (14 kB)
2025-07-08T20:02:31.8307936Z Using cached google_api_core-2.25.1-py3-none-any.whl (160 kB)
2025-07-08T20:02:31.8322232Z Using cached google_auth-2.40.3-py2.py3-none-any.whl (216 kB)
2025-07-08T20:02:31.8336928Z Using cached cachetools-5.5.2-py3-none-any.whl (10 kB)
2025-07-08T20:02:31.8350276Z Using cached google_cloud_core-2.4.3-py2.py3-none-any.whl (29 kB)
2025-07-08T20:02:31.8363969Z Using cached googleapis_common_protos-1.70.0-py3-none-any.whl (294 kB)
2025-07-08T20:02:31.8379559Z Using cached grpcio-1.73.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (6.0 MB)
2025-07-08T20:02:31.8439414Z Using cached grpcio_status-1.62.3-py3-none-any.whl (14 kB)
2025-07-08T20:02:31.8455871Z Using cached proto_plus-1.26.1-py3-none-any.whl (50 kB)
2025-07-08T20:02:31.8477441Z Using cached requests-2.32.4-py3-none-any.whl (64 kB)
2025-07-08T20:02:31.8499271Z Using cached charset_normalizer-3.4.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (147 kB)
2025-07-08T20:02:31.8521350Z Using cached idna-3.10-py3-none-any.whl (70 kB)
2025-07-08T20:02:31.8543079Z Using cached rsa-4.9.1-py3-none-any.whl (34 kB)
2025-07-08T20:02:31.8623819Z Downloading urllib3-2.5.0-py3-none-any.whl (129 kB)
2025-07-08T20:02:31.8678722Z Using cached google_genai-1.24.0-py3-none-any.whl (226 kB)
2025-07-08T20:02:31.8694022Z Using cached anyio-4.9.0-py3-none-any.whl (100 kB)
2025-07-08T20:02:31.8708700Z Using cached httpx-0.28.1-py3-none-any.whl (73 kB)
2025-07-08T20:02:31.8722847Z Using cached httpcore-1.0.9-py3-none-any.whl (78 kB)
2025-07-08T20:02:31.8737044Z Using cached pydantic-2.11.7-py3-none-any.whl (444 kB)
2025-07-08T20:02:31.8754081Z Using cached pydantic_core-2.33.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.0 MB)
2025-07-08T20:02:31.8782099Z Using cached tenacity-8.5.0-py3-none-any.whl (28 kB)
2025-07-08T20:02:31.8857341Z Downloading typing_extensions-4.14.1-py3-none-any.whl (43 kB)
2025-07-08T20:02:31.8898509Z Using cached websockets-15.0.1-cp311-cp311-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-07-08T20:02:31.8913746Z Using cached fpdf2-2.8.3-py2.py3-none-any.whl (245 kB)
2025-07-08T20:02:31.8928843Z Using cached python_docx-1.2.0-py3-none-any.whl (252 kB)
2025-07-08T20:02:31.8944210Z Using cached google_cloud_secret_manager-2.24.0-py3-none-any.whl (218 kB)
2025-07-08T20:02:31.8959333Z Using cached grpc_google_iam_v1-0.14.2-py3-none-any.whl (19 kB)
2025-07-08T20:02:31.9032976Z Downloading selenium-4.34.2-py3-none-any.whl (9.4 MB)
2025-07-08T20:02:31.9577803Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 9.4/9.4 MB 192.0 MB/s eta 0:00:00
2025-07-08T20:02:31.9596842Z Using cached trio-0.30.0-py3-none-any.whl (499 kB)
2025-07-08T20:02:31.9613782Z Using cached trio_websocket-0.12.2-py3-none-any.whl (21 kB)
2025-07-08T20:02:31.9627729Z Using cached PySocks-1.7.1-py3-none-any.whl (16 kB)
2025-07-08T20:02:31.9641530Z Using cached websocket_client-1.8.0-py3-none-any.whl (58 kB)
2025-07-08T20:02:31.9655694Z Using cached annotated_types-0.7.0-py3-none-any.whl (13 kB)
2025-07-08T20:02:31.9669287Z Using cached attrs-25.3.0-py3-none-any.whl (63 kB)
2025-07-08T20:02:31.9683437Z Using cached blinker-1.9.0-py3-none-any.whl (8.5 kB)
2025-07-08T20:02:31.9697268Z Using cached cachecontrol-0.14.3-py3-none-any.whl (21 kB)
2025-07-08T20:02:31.9711249Z Using cached msgpack-1.1.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (429 kB)
2025-07-08T20:02:31.9728230Z Using cached certifi-2025.6.15-py3-none-any.whl (157 kB)
2025-07-08T20:02:31.9742488Z Using cached click-8.2.1-py3-none-any.whl (102 kB)
2025-07-08T20:02:31.9820352Z Downloading fonttools-4.58.5-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (5.0 MB)
2025-07-08T20:02:32.0082821Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 5.0/5.0 MB 203.9 MB/s eta 0:00:00
2025-07-08T20:02:32.0162380Z Downloading google_api_python_client-2.176.0-py3-none-any.whl (13.7 MB)
2025-07-08T20:02:32.0766674Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13.7/13.7 MB 234.3 MB/s eta 0:00:00
2025-07-08T20:02:32.0781054Z Using cached google_auth_httplib2-0.2.0-py2.py3-none-any.whl (9.3 kB)
2025-07-08T20:02:32.0795333Z Using cached httplib2-0.22.0-py3-none-any.whl (96 kB)
2025-07-08T20:02:32.0809650Z Using cached pyparsing-3.2.3-py3-none-any.whl (111 kB)
2025-07-08T20:02:32.0824293Z Using cached uritemplate-4.2.0-py3-none-any.whl (11 kB)
2025-07-08T20:02:32.0899544Z Downloading google_cloud_storage-3.2.0-py3-none-any.whl (176 kB)
2025-07-08T20:02:32.0957112Z Using cached google_crc32c-1.7.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (32 kB)
2025-07-08T20:02:32.0973095Z Using cached google_resumable_media-2.7.2-py2.py3-none-any.whl (81 kB)
2025-07-08T20:02:32.0988021Z Using cached h11-0.16.0-py3-none-any.whl (37 kB)
2025-07-08T20:02:32.1002104Z Using cached itsdangerous-2.2.0-py3-none-any.whl (16 kB)
2025-07-08T20:02:32.1015952Z Using cached jinja2-3.1.6-py3-none-any.whl (134 kB)
2025-07-08T20:02:32.1030513Z Using cached lxml-6.0.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (5.2 MB)
2025-07-08T20:02:32.1079256Z Using cached MarkupSafe-3.0.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (23 kB)
2025-07-08T20:02:32.1093141Z Using cached outcome-1.3.0.post0-py2.py3-none-any.whl (10 kB)
2025-07-08T20:02:32.1107235Z Using cached pillow-11.3.0-cp311-cp311-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (6.6 MB)
2025-07-08T20:02:32.1167254Z Using cached pyasn1-0.6.1-py3-none-any.whl (83 kB)
2025-07-08T20:02:32.1181060Z Using cached pyasn1_modules-0.4.2-py3-none-any.whl (181 kB)
2025-07-08T20:02:32.1195640Z Using cached PyJWT-2.10.1-py3-none-any.whl (22 kB)
2025-07-08T20:02:32.1271906Z Downloading cryptography-45.0.5-cp311-abi3-manylinux_2_34_x86_64.whl (4.5 MB)
2025-07-08T20:02:32.1510372Z    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.5/4.5 MB 202.9 MB/s eta 0:00:00
2025-07-08T20:02:32.1524452Z Using cached cffi-1.17.1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (467 kB)
2025-07-08T20:02:32.1541318Z Using cached sniffio-1.3.1-py3-none-any.whl (10 kB)
2025-07-08T20:02:32.1555524Z Using cached typing_inspection-0.4.1-py3-none-any.whl (14 kB)
2025-07-08T20:02:32.1569339Z Using cached werkzeug-3.1.3-py3-none-any.whl (224 kB)
2025-07-08T20:02:32.1584297Z Using cached wsproto-1.2.0-py3-none-any.whl (24 kB)
2025-07-08T20:02:32.1598123Z Using cached defusedxml-0.7.1-py2.py3-none-any.whl (25 kB)
2025-07-08T20:02:32.1611739Z Using cached packaging-25.0-py3-none-any.whl (66 kB)
2025-07-08T20:02:32.1625917Z Using cached pycparser-2.22-py3-none-any.whl (117 kB)
2025-07-08T20:02:32.1640279Z Using cached sortedcontainers-2.4.0-py2.py3-none-any.whl (29 kB)
2025-07-08T20:02:32.3977874Z Installing collected packages: sortedcontainers, websockets, websocket-client, urllib3, uritemplate, typing-extensions, tenacity, sniffio, pysocks, pyparsing, pyjwt, pycparser, pyasn1, protobuf, Pillow, packaging, msgpack, MarkupSafe, lxml, itsdangerous, idna, h11, grpcio, google-crc32c, fonttools, defusedxml, click, charset_normalizer, certifi, cachetools, blinker, attrs, annotated-types, wsproto, Werkzeug, typing-inspection, rsa, requests, python-docx, pydantic-core, pyasn1-modules, proto-plus, outcome, Jinja2, httplib2, httpcore, gunicorn, googleapis-common-protos, google-resumable-media, fpdf2, cffi, anyio, trio, pydantic, httpx, grpcio-status, google-auth, Flask, cryptography, cachecontrol, trio-websocket, grpc-google-iam-v1, google-genai, google-auth-httplib2, google-api-core, Flask-Cors, selenium, google-cloud-core, google-api-python-client, google-cloud-storage, google-cloud-secret-manager, google-cloud-firestore, firebase-admin
2025-07-08T20:02:38.4393376Z 
2025-07-08T20:02:38.4436844Z Successfully installed Flask-3.0.0 Flask-Cors-4.0.0 Jinja2-3.1.6 MarkupSafe-3.0.2 Pillow-11.3.0 Werkzeug-3.1.3 annotated-types-0.7.0 anyio-4.9.0 attrs-25.3.0 blinker-1.9.0 cachecontrol-0.14.3 cachetools-5.5.2 certifi-2025.6.15 cffi-1.17.1 charset_normalizer-3.4.2 click-8.2.1 cryptography-45.0.5 defusedxml-0.7.1 firebase-admin-6.5.0 fonttools-4.58.5 fpdf2-2.8.3 google-api-core-2.25.1 google-api-python-client-2.176.0 google-auth-2.40.3 google-auth-httplib2-0.2.0 google-cloud-core-2.4.3 google-cloud-firestore-2.16.0 google-cloud-secret-manager-2.24.0 google-cloud-storage-3.2.0 google-crc32c-1.7.1 google-genai-1.24.0 google-resumable-media-2.7.2 googleapis-common-protos-1.70.0 grpc-google-iam-v1-0.14.2 grpcio-1.73.1 grpcio-status-1.62.3 gunicorn-21.2.0 h11-0.16.0 httpcore-1.0.9 httplib2-0.22.0 httpx-0.28.1 idna-3.10 itsdangerous-2.2.0 lxml-6.0.0 msgpack-1.1.1 outcome-1.3.0.post0 packaging-25.0 proto-plus-1.26.1 protobuf-4.25.3 pyasn1-0.6.1 pyasn1-modules-0.4.2 pycparser-2.22 pydantic-2.11.7 pydantic-core-2.33.2 pyjwt-2.10.1 pyparsing-3.2.3 pysocks-1.7.1 python-docx-1.2.0 requests-2.32.4 rsa-4.9.1 selenium-4.34.2 sniffio-1.3.1 sortedcontainers-2.4.0 tenacity-8.5.0 trio-0.30.0 trio-websocket-0.12.2 typing-extensions-4.14.1 typing-inspection-0.4.1 uritemplate-4.2.0 urllib3-2.5.0 websocket-client-1.8.0 websockets-15.0.1 wsproto-1.2.0
2025-07-08T20:02:39.0900680Z ##[group]Run # Find all test files in mvp_site/tests directory, excluding integration and manual tests
2025-07-08T20:02:39.0901385Z [36;1m# Find all test files in mvp_site/tests directory, excluding integration and manual tests[0m
2025-07-08T20:02:39.0902177Z [36;1mtest_files=$(find mvp_site/tests -name "test_*.py" -type f ! -path "*/integration/*" ! -path "*/test_integration/*" ! -path "*/manual_tests/*" ! -name "*integration*" | sort)[0m
2025-07-08T20:02:39.0902800Z [36;1m[0m
2025-07-08T20:02:39.0902986Z [36;1m# Run each test file[0m
2025-07-08T20:02:39.0903455Z [36;1mfailed_tests=0[0m
2025-07-08T20:02:39.0903747Z [36;1mtotal_tests=0[0m
2025-07-08T20:02:39.0904164Z [36;1mfailed_list=""[0m
2025-07-08T20:02:39.0904359Z [36;1m[0m
2025-07-08T20:02:39.0904547Z [36;1mfor test_file in $test_files; do[0m
2025-07-08T20:02:39.0904826Z [36;1m  echo "Running $test_file..."[0m
2025-07-08T20:02:39.0905092Z [36;1m  total_tests=$((total_tests + 1))[0m
2025-07-08T20:02:39.0905369Z [36;1m  [0m
2025-07-08T20:02:39.0905580Z [36;1m  if TESTING=true python "$test_file"; then[0m
2025-07-08T20:02:39.0905877Z [36;1m    echo "✅ $test_file passed"[0m
2025-07-08T20:02:39.0906129Z [36;1m  else[0m
2025-07-08T20:02:39.0906328Z [36;1m    echo "❌ $test_file failed"[0m
2025-07-08T20:02:39.0906592Z [36;1m    failed_tests=$((failed_tests + 1))[0m
2025-07-08T20:02:39.0906896Z [36;1m    failed_list="$failed_list\n  - $test_file"[0m
2025-07-08T20:02:39.0907172Z [36;1m  fi[0m
2025-07-08T20:02:39.0907383Z [36;1m  echo "----------------------------------------"[0m
2025-07-08T20:02:39.0907662Z [36;1mdone[0m
2025-07-08T20:02:39.0907841Z [36;1m[0m
2025-07-08T20:02:39.0908014Z [36;1m# Summary[0m
2025-07-08T20:02:39.0908207Z [36;1mecho ""[0m
2025-07-08T20:02:39.0908428Z [36;1mecho "========================================"[0m
2025-07-08T20:02:39.0908838Z [36;1mecho "TEST SUMMARY: $((total_tests - failed_tests))/$total_tests tests passed"[0m
2025-07-08T20:02:39.0909252Z [36;1mecho "========================================"[0m
2025-07-08T20:02:39.0909514Z [36;1m[0m
2025-07-08T20:02:39.0909707Z [36;1mif [ $failed_tests -gt 0 ]; then[0m
2025-07-08T20:02:39.0909952Z [36;1m  echo ""[0m
2025-07-08T20:02:39.0910171Z [36;1m  echo "Failed tests:$failed_list"[0m
2025-07-08T20:02:39.0910426Z [36;1m  echo ""[0m
2025-07-08T20:02:39.0910659Z [36;1m  echo "Note: Some tests may fail in CI due to:"[0m
2025-07-08T20:02:39.0911007Z [36;1m  echo "  - Missing local services (e.g., test server)"[0m
2025-07-08T20:02:39.0911334Z [36;1m  echo "  - Test isolation issues"[0m
2025-07-08T20:02:39.0911619Z [36;1m  echo "  - Timing-sensitive tests"[0m
2025-07-08T20:02:39.0911871Z [36;1m  exit 1[0m
2025-07-08T20:02:39.0912092Z [36;1mfi[0m
2025-07-08T20:02:39.0969287Z shell: /usr/bin/bash -e {0}
2025-07-08T20:02:39.0969522Z env:
2025-07-08T20:02:39.0969773Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0970206Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T20:02:39.0970619Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0970981Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0971341Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:02:39.0971704Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T20:02:39.0972006Z   TESTING: true
2025-07-08T20:02:39.0972185Z ##[endgroup]
2025-07-08T20:02:39.1081806Z Running mvp_site/tests/auth/test_auth_resilience.py...
2025-07-08T20:02:39.2444319Z test_clock_skew_auto_retry_mechanism (__main__.AuthResilienceTest.test_clock_skew_auto_retry_mechanism)
2025-07-08T20:02:39.2446438Z 🔴 RED TEST: Verify that clock skew errors trigger auto-retry ... ok
2025-07-08T20:02:39.2447364Z test_connection_status_monitoring (__main__.AuthResilienceTest.test_connection_status_monitoring)
2025-07-08T20:02:39.2449013Z 🔴 RED TEST: Verify that connection status is monitored for smart UI adaptations ... ok
2025-07-08T20:02:39.2450157Z test_integrated_resilience_workflow (__main__.AuthResilienceTest.test_integrated_resilience_workflow)
2025-07-08T20:02:39.2453088Z 🟢 GREEN TEST: Test the complete resilience workflow end-to-end ... ok
2025-07-08T20:02:39.2454172Z test_offline_campaign_caching (__main__.AuthResilienceTest.test_offline_campaign_caching)
2025-07-08T20:02:39.2455442Z 🔴 RED TEST: Verify that successful campaign data is cached for offline viewing ... ok
2025-07-08T20:02:39.2457330Z test_user_friendly_error_messages (__main__.AuthResilienceTest.test_user_friendly_error_messages)
2025-07-08T20:02:39.2459644Z 🔴 RED TEST: Verify that user gets helpful error messages instead of generic failures ... ok
2025-07-08T20:02:39.2460418Z 
2025-07-08T20:02:39.2460628Z ----------------------------------------------------------------------
2025-07-08T20:02:39.2461143Z Ran 5 tests in 0.002s
2025-07-08T20:02:39.2461347Z 
2025-07-08T20:02:39.2461458Z OK
2025-07-08T20:02:39.2461615Z 
2025-07-08T20:02:39.2462869Z ============================================================
2025-07-08T20:02:39.2463642Z 🧪 AUTHENTICATION RESILIENCE: RED/GREEN TEST SUITE
2025-07-08T20:02:39.2464257Z ============================================================
2025-07-08T20:02:39.2464856Z 🔴 RED TEST: Testing clock skew auto-retry mechanism
2025-07-08T20:02:39.2465387Z ✅ Auto-retry mechanism implementation found
2025-07-08T20:02:39.2465917Z 🔴 RED TEST: Testing connection status monitoring
2025-07-08T20:02:39.2466479Z ✅ Connection status monitoring implementation found
2025-07-08T20:02:39.2467074Z 🟢 GREEN TEST: Testing integrated resilience workflow
2025-07-08T20:02:39.2467689Z ✅ All resilience components properly integrated
2025-07-08T20:02:39.2468295Z 🔴 RED TEST: Testing offline campaign caching
2025-07-08T20:02:39.2468874Z ✅ Offline campaign caching implementation found
2025-07-08T20:02:39.2469475Z 🔴 RED TEST: Testing user-friendly error messaging
2025-07-08T20:02:39.2470120Z ✅ User-friendly error messaging implementation found
2025-07-08T20:02:39.2470500Z 
2025-07-08T20:02:39.2470663Z ============================================================
2025-07-08T20:02:39.2471386Z 🟢 GREEN STATE ACHIEVED: All resilience features implemented correctly!
2025-07-08T20:02:39.2472041Z ✅ 5 tests passed
2025-07-08T20:02:39.2472239Z 
2025-07-08T20:02:39.2472476Z 🎯 RESILIENCE FEATURES VALIDATED:
2025-07-08T20:02:39.2473009Z    • JWT clock skew auto-retry ✅
2025-07-08T20:02:39.2473743Z    • User-friendly error messages ✅
2025-07-08T20:02:39.2474254Z    • Offline campaign caching ✅
2025-07-08T20:02:39.2474734Z    • Connection status monitoring ✅
2025-07-08T20:02:39.2475217Z    • Integrated workflow ✅
2025-07-08T20:02:39.2475622Z ============================================================
2025-07-08T20:02:39.2575225Z ✅ mvp_site/tests/auth/test_auth_resilience.py passed
2025-07-08T20:02:39.2577278Z ----------------------------------------
2025-07-08T20:02:39.2578812Z Running mvp_site/tests/test_age_field_validation.py...
2025-07-08T20:02:39.4622316Z .........
2025-07-08T20:02:39.4629269Z ----------------------------------------------------------------------
2025-07-08T20:02:39.4634891Z Ran 9 tests in 0.001s
2025-07-08T20:02:39.4635093Z 
2025-07-08T20:02:39.4635199Z OK
2025-07-08T20:02:39.4847530Z ✅ mvp_site/tests/test_age_field_validation.py passed
2025-07-08T20:02:39.4853432Z ----------------------------------------
2025-07-08T20:02:39.4853980Z Running mvp_site/tests/test_always_json_mode.py...
2025-07-08T20:02:40.2057915Z .2025-07-08 20:02:40,205 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:40.2061074Z 2025-07-08 20:02:40,205 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:40.2074423Z 2025-07-08 20:02:40,207 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:40.2079989Z 2025-07-08 20:02:40,207 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:40.2099066Z 2025-07-08 20:02:40,209 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:02:40.2100641Z 2025-07-08 20:02:40,209 - INFO - Added LLM-generated standard planning block
2025-07-08T20:02:40.2109496Z .2025-07-08 20:02:40,210 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:40.2110685Z 2025-07-08 20:02:40,210 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:40.2122977Z 2025-07-08 20:02:40,212 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:40.2130922Z 2025-07-08 20:02:40,212 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:40.2132537Z 2025-07-08 20:02:40,212 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:40.2135148Z 2025-07-08 20:02:40,213 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:40.2136074Z 2025-07-08 20:02:40,213 - INFO - Starting dual-pass generation
2025-07-08T20:02:40.2136787Z 2025-07-08 20:02:40,213 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:40.2145474Z 2025-07-08 20:02:40,213 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:40.2150706Z 2025-07-08 20:02:40,213 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:40.2151554Z 2025-07-08 20:02:40,213 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:40.2152226Z 2025-07-08 20:02:40,213 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:40.2152842Z 2025-07-08 20:02:40,213 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:40.2153798Z 2025-07-08 20:02:40,213 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:40.2154772Z 2025-07-08 20:02:40,213 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:40.2155480Z 2025-07-08 20:02:40,214 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:40.2156188Z 2025-07-08 20:02:40,214 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:40.2156976Z 2025-07-08 20:02:40,214 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:40.2157936Z 2025-07-08 20:02:40,214 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:40.2158736Z 2025-07-08 20:02:40,214 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:40.2159276Z 2025-07-08 20:02:40,214 - INFO - Planning block found in response
2025-07-08T20:02:40.2159703Z ...
2025-07-08T20:02:40.2160027Z ----------------------------------------------------------------------
2025-07-08T20:02:40.2160488Z Ran 5 tests in 0.011s
2025-07-08T20:02:40.2160683Z 
2025-07-08T20:02:40.2160787Z OK
2025-07-08T20:02:40.2967462Z ✅ mvp_site/tests/test_always_json_mode.py passed
2025-07-08T20:02:40.2973861Z ----------------------------------------
2025-07-08T20:02:40.2974435Z Running mvp_site/tests/test_animation_system.py...
2025-07-08T20:02:40.3612683Z test_accessibility_features (__main__.TestAnimationSystem.test_accessibility_features)
2025-07-08T20:02:40.3616419Z Test that accessibility features are properly implemented ... ok
2025-07-08T20:02:40.3622009Z test_animation_css_exists_and_valid (__main__.TestAnimationSystem.test_animation_css_exists_and_valid)
2025-07-08T20:02:40.3623399Z Test that animation CSS file exists and contains expected animations ... ok
2025-07-08T20:02:40.3624447Z test_animation_css_syntax_validation (__main__.TestAnimationSystem.test_animation_css_syntax_validation)
2025-07-08T20:02:40.3625362Z Test CSS syntax is valid (basic validation) ... ok
2025-07-08T20:02:40.3626226Z test_animation_js_exists_and_valid (__main__.TestAnimationSystem.test_animation_js_exists_and_valid)
2025-07-08T20:02:40.3631845Z Test that animation JavaScript file exists and is valid ... ok
2025-07-08T20:02:40.3642023Z test_animation_performance_properties (__main__.TestAnimationSystem.test_animation_performance_properties)
2025-07-08T20:02:40.3643115Z Test that performance-enhancing CSS properties are present ... ok
2025-07-08T20:02:40.3644344Z test_index_html_includes_animation_files (__main__.TestAnimationSystem.test_index_html_includes_animation_files)
2025-07-08T20:02:40.3645330Z Test that index.html includes animation CSS and JS ... ok
2025-07-08T20:02:40.3646163Z test_javascript_error_handling (__main__.TestAnimationSystem.test_javascript_error_handling)
2025-07-08T20:02:40.3675135Z Test that JavaScript has proper error handling patterns ... ok
2025-07-08T20:02:40.3675934Z test_theme_specific_animations (__main__.TestAnimationSystem.test_theme_specific_animations)
2025-07-08T20:02:40.3676698Z Test that theme-specific animations are included ... ok
2025-07-08T20:02:40.3677841Z test_animation_system_compatibility (__main__.TestAnimationIntegration.test_animation_system_compatibility)
2025-07-08T20:02:40.3678811Z Test that animation system doesn't conflict with existing app.js ... ok
2025-07-08T20:02:40.3679595Z test_loading_order_in_html (__main__.TestAnimationIntegration.test_loading_order_in_html)
2025-07-08T20:02:40.3680268Z Test that scripts are loaded in correct order ... ok
2025-07-08T20:02:40.3680912Z test_css_file_size (__main__.TestAnimationPerformance.test_css_file_size)
2025-07-08T20:02:40.3681503Z Test that CSS file size is reasonable ... ok
2025-07-08T20:02:40.3682189Z test_css_selector_efficiency (__main__.TestAnimationPerformance.test_css_selector_efficiency)
2025-07-08T20:02:40.3682886Z Test that CSS selectors are efficient ... ok
2025-07-08T20:02:40.3683757Z test_javascript_file_size (__main__.TestAnimationPerformance.test_javascript_file_size)
2025-07-08T20:02:40.3684396Z Test that JavaScript file size is reasonable ... ok
2025-07-08T20:02:40.3685089Z test_animation_duration_variables (__main__.TestAnimationFunctionality.test_animation_duration_variables)
2025-07-08T20:02:40.3685917Z Test that animation duration variables are properly defined ... ok
2025-07-08T20:02:40.3686765Z test_javascript_api_methods (__main__.TestAnimationFunctionality.test_javascript_api_methods)
2025-07-08T20:02:40.3687546Z Test that JavaScript API provides expected methods ... ok
2025-07-08T20:02:40.3688392Z test_keyframe_animations_defined (__main__.TestAnimationFunctionality.test_keyframe_animations_defined)
2025-07-08T20:02:40.3689222Z Test that essential keyframe animations are defined ... ok
2025-07-08T20:02:40.3689561Z 
2025-07-08T20:02:40.3689764Z ----------------------------------------------------------------------
2025-07-08T20:02:40.3690217Z Ran 16 tests in 0.004s
2025-07-08T20:02:40.3690430Z 
2025-07-08T20:02:40.3690536Z OK
2025-07-08T20:02:40.3691095Z 🧪 Running Animation System Tests...
2025-07-08T20:02:40.3691568Z ✅ All animation tests passed!
2025-07-08T20:02:40.3779250Z ✅ mvp_site/tests/test_animation_system.py passed
2025-07-08T20:02:40.3780684Z ----------------------------------------
2025-07-08T20:02:40.3781166Z Running mvp_site/tests/test_api_routes.py...
2025-07-08T20:02:41.3384680Z ......Traceback (most recent call last):
2025-07-08T20:02:41.3395078Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 620, in update_campaign
2025-07-08T20:02:41.3396857Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T20:02:41.3398568Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:02:41.3399951Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:02:41.3400609Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:41.3401723Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:02:41.3402957Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:02:41.3403983Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:41.3409332Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:02:41.3410552Z     raise effect
2025-07-08T20:02:41.3410908Z Exception: Update error
2025-07-08T20:02:41.3544639Z ...2025-07-08 20:02:41,354 - INFO - Received custom_options: ['destinySystem']
2025-07-08T20:02:41.3545959Z 2025-07-08 20:02:41,354 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3596305Z .2025-07-08 20:02:41,359 - INFO - Received custom_options: []
2025-07-08T20:02:41.3598439Z 2025-07-08 20:02:41,359 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3697918Z ..2025-07-08 20:02:41,369 - INFO - Received custom_options: ['destinySystem', 'companions', 'defaultWorld']
2025-07-08T20:02:41.3699379Z 2025-07-08 20:02:41,369 - INFO - Selected attribute_system: D&D
2025-07-08T20:02:41.3751273Z .2025-07-08 20:02:41,375 - INFO - Received custom_options: []
2025-07-08T20:02:41.3756670Z 2025-07-08 20:02:41,375 - INFO - Selected attribute_system: <MagicMock name='constants.ATTRIBUTE_SYSTEM_DND' id='140041096164496'>
2025-07-08T20:02:41.3869184Z ..2025-07-08 20:02:41,386 - INFO - Exporting file '/tmp/campaign_exports/ed99d3a2-a2a7-4cd8-9d32-3efbd11bd543.pdf' with download_name='Test Campaign.pdf'
2025-07-08T20:02:41.3915364Z ..
2025-07-08T20:02:41.3916662Z ----------------------------------------------------------------------
2025-07-08T20:02:41.3917319Z Ran 17 tests in 0.089s
2025-07-08T20:02:41.3918694Z 
2025-07-08T20:02:41.3918936Z OK
2025-07-08T20:02:41.5204284Z ✅ mvp_site/tests/test_api_routes.py passed
2025-07-08T20:02:41.5207732Z ----------------------------------------
2025-07-08T20:02:41.5208296Z Running mvp_site/tests/test_architectural_decisions.py...
2025-07-08T20:02:41.6513741Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6516968Z   @validator('strength', pre=True)
2025-07-08T20:02:41.6520039Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6523043Z   @validator('dexterity', pre=True)
2025-07-08T20:02:41.6525949Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6529606Z   @validator('constitution', pre=True)
2025-07-08T20:02:41.6532179Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6535068Z   @validator('intelligence', pre=True)
2025-07-08T20:02:41.6538083Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6540769Z   @validator('wisdom', pre=True)
2025-07-08T20:02:41.6543577Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6546218Z   @validator('charisma', pre=True)
2025-07-08T20:02:41.6711309Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6716029Z   @validator('hp', pre=True)
2025-07-08T20:02:41.6718577Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6721102Z   @validator('hp_max', pre=True)
2025-07-08T20:02:41.6723835Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6726423Z   @validator('temp_hp', pre=True)
2025-07-08T20:02:41.6758298Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6761005Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:02:41.6792728Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6796320Z   @validator('level', pre=True)
2025-07-08T20:02:41.6799560Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6802522Z   @validator('gender')
2025-07-08T20:02:41.6805495Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6808908Z   @validator('age')
2025-07-08T20:02:41.6811750Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6816520Z   @validator('mbti')
2025-07-08T20:02:41.6820793Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6824037Z   @validator('alignment')
2025-07-08T20:02:41.6826624Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6829269Z   @validator('entity_type')
2025-07-08T20:02:41.6982268Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.6987076Z   @validator('participants')
2025-07-08T20:02:41.6999462Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.7003655Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:02:41.7006512Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:41.7009251Z   @validator('present_entities')
2025-07-08T20:02:41.7069825Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:41.7072548Z ..
2025-07-08T20:02:41.7073690Z ----------------------------------------------------------------------
2025-07-08T20:02:41.7074701Z Ran 6 tests in 0.149s
2025-07-08T20:02:41.7076380Z 
2025-07-08T20:02:41.7077845Z OK
2025-07-08T20:02:41.7380041Z ✅ mvp_site/tests/test_architectural_decisions.py passed
2025-07-08T20:02:41.7381536Z ----------------------------------------
2025-07-08T20:02:41.7382111Z Running mvp_site/tests/test_banned_name_prevention_v2.py...
2025-07-08T20:02:41.7763868Z ....
2025-07-08T20:02:41.7765427Z ----------------------------------------------------------------------
2025-07-08T20:02:41.7765982Z Ran 4 tests in 0.002s
2025-07-08T20:02:41.7766196Z 
2025-07-08T20:02:41.7766314Z OK
2025-07-08T20:02:41.7821572Z ✅ mvp_site/tests/test_banned_name_prevention_v2.py passed
2025-07-08T20:02:41.7823829Z ----------------------------------------
2025-07-08T20:02:41.7825443Z Running mvp_site/tests/test_banned_names_loading.py...
2025-07-08T20:02:41.8282166Z ........
2025-07-08T20:02:41.8283639Z ----------------------------------------------------------------------
2025-07-08T20:02:41.8285233Z Ran 8 tests in 0.001s
2025-07-08T20:02:41.8285453Z 
2025-07-08T20:02:41.8285572Z OK
2025-07-08T20:02:41.8355183Z ✅ mvp_site/tests/test_banned_names_loading.py passed
2025-07-08T20:02:41.8356928Z ----------------------------------------
2025-07-08T20:02:41.8358085Z Running mvp_site/tests/test_banned_names_visibility_v2.py...
2025-07-08T20:02:41.8802501Z ...
2025-07-08T20:02:41.8804144Z ----------------------------------------------------------------------
2025-07-08T20:02:41.8805741Z Ran 3 tests in 0.002s
2025-07-08T20:02:41.8807337Z 
2025-07-08T20:02:41.8807465Z OK
2025-07-08T20:02:41.8872497Z ✅ mvp_site/tests/test_banned_names_visibility_v2.py passed
2025-07-08T20:02:41.8874989Z ----------------------------------------
2025-07-08T20:02:41.8876398Z Running mvp_site/tests/test_campaign_clicks.py...
2025-07-08T20:02:41.9504653Z ....
2025-07-08T20:02:41.9506370Z ----------------------------------------------------------------------
2025-07-08T20:02:41.9506875Z Ran 4 tests in 0.001s
2025-07-08T20:02:41.9507096Z 
2025-07-08T20:02:41.9507206Z OK
2025-07-08T20:02:41.9618966Z ✅ mvp_site/tests/test_campaign_clicks.py passed
2025-07-08T20:02:41.9620649Z ----------------------------------------
2025-07-08T20:02:41.9621832Z Running mvp_site/tests/test_combat_bug_green.py...
2025-07-08T20:02:42.0048788Z test_cleanup_defeated_enemies_handles_list_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_handles_list_combatants)
2025-07-08T20:02:42.0053043Z ======================================================================
2025-07-08T20:02:42.0055819Z GREEN TEST: This should PASS without errors ... ok
2025-07-08T20:02:42.0056915Z test_cleanup_defeated_enemies_preserves_dict_combatants (__main__.TestCombatBugGreen.test_cleanup_defeated_enemies_preserves_dict_combatants)
2025-07-08T20:02:42.0058142Z Verify that dict format still works correctly (regression test) ... ok
2025-07-08T20:02:42.0059162Z test_cleanup_with_complex_list_structure (__main__.TestCombatBugGreen.test_cleanup_with_complex_list_structure)
2025-07-08T20:02:42.0060166Z Test with more complex list structure that AI might generate ... ok
2025-07-08T20:02:42.0060613Z 
2025-07-08T20:02:42.0060842Z ----------------------------------------------------------------------
2025-07-08T20:02:42.0061364Z Ran 3 tests in 0.000s
2025-07-08T20:02:42.0061608Z 
2025-07-08T20:02:42.0061726Z OK
2025-07-08T20:02:42.0062264Z 🟢 RUNNING GREEN TEST - THIS SHOULD PASS!
2025-07-08T20:02:42.0063983Z If this test PASSES, the bug is fixed.
2025-07-08T20:02:42.0064446Z ======================================================================
2025-07-08T20:02:42.0064765Z 
2025-07-08T20:02:42.0065155Z ✅ GREEN TEST: Attempting to call cleanup_defeated_enemies()...
2025-07-08T20:02:42.0065776Z Expected: No errors, returns list of defeated enemies
2025-07-08T20:02:42.0066398Z ✅ Successfully cleaned up defeated enemies: ['Dragon']
2025-07-08T20:02:42.0066957Z ✅ Combatants normalized to dict format and Dragon removed
2025-07-08T20:02:42.0067342Z 
2025-07-08T20:02:42.0067632Z ✅ Dict format still works correctly (no regression)
2025-07-08T20:02:42.0067996Z 
2025-07-08T20:02:42.0068248Z ✅ Complex list structure handled correctly
2025-07-08T20:02:42.0122958Z ✅ mvp_site/tests/test_combat_bug_green.py passed
2025-07-08T20:02:42.0124523Z ----------------------------------------
2025-07-08T20:02:42.0125082Z Running mvp_site/tests/test_combat_cleanup_comprehensive.py...
2025-07-08T20:02:42.9586850Z test_automatic_cleanup_via_state_updates_hp_defeat (__main__.TestCombatCleanupComprehensive.test_automatic_cleanup_via_state_updates_hp_defeat)
2025-07-08T20:02:42.9589114Z Test: Enemy defeated via AI HP update should be automatically cleaned up. ... 2025-07-08 20:02:42,958 - INFO - COMBAT STARTED - Participants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T20:02:42.9591401Z 2025-07-08 20:02:42,958 - INFO - COMBAT INITIALIZED - Initiative order: ['Hero(18)', 'Orc Warrior(14)', 'Goblin(12)']
2025-07-08T20:02:42.9592808Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9593754Z   "combat_state": {
2025-07-08T20:02:42.9594243Z     "combatants": {
2025-07-08T20:02:42.9595643Z       "Orc Warrior": {
2025-07-08T20:02:42.9595961Z         "hp_current": 0,
2025-07-08T20:02:42.9596259Z         "status": [
2025-07-08T20:02:42.9596529Z           "bloodied",
2025-07-08T20:02:42.9596814Z           "unconscious"
2025-07-08T20:02:42.9597101Z         ]
2025-07-08T20:02:42.9597336Z       }
2025-07-08T20:02:42.9597564Z     }
2025-07-08T20:02:42.9597807Z   }
2025-07-08T20:02:42.9598299Z }
2025-07-08T20:02:42.9598745Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9599314Z   "combatants": {
2025-07-08T20:02:42.9599611Z     "Orc Warrior": {
2025-07-08T20:02:42.9599946Z       "hp_current": 0,
2025-07-08T20:02:42.9600283Z       "status": [
2025-07-08T20:02:42.9600572Z         "bloodied",
2025-07-08T20:02:42.9600870Z         "unconscious"
2025-07-08T20:02:42.9601170Z       ]
2025-07-08T20:02:42.9601409Z     }
2025-07-08T20:02:42.9601665Z   }
2025-07-08T20:02:42.9601917Z }
2025-07-08T20:02:42.9602361Z 2025-07-08 20:02:42,958 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9602948Z   "Orc Warrior": {
2025-07-08T20:02:42.9603432Z     "hp_current": 0,
2025-07-08T20:02:42.9603751Z     "status": [
2025-07-08T20:02:42.9604035Z       "bloodied",
2025-07-08T20:02:42.9604331Z       "unconscious"
2025-07-08T20:02:42.9604631Z     ]
2025-07-08T20:02:42.9604897Z   }
2025-07-08T20:02:42.9605166Z }
2025-07-08T20:02:42.9605628Z 2025-07-08 20:02:42,959 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9606215Z   "hp_current": 0,
2025-07-08T20:02:42.9606515Z   "status": [
2025-07-08T20:02:42.9606783Z     "bloodied",
2025-07-08T20:02:42.9607060Z     "unconscious"
2025-07-08T20:02:42.9607320Z   ]
2025-07-08T20:02:42.9607539Z }
2025-07-08T20:02:42.9610743Z 2025-07-08 20:02:42,960 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9612036Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9613454Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9614784Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9616127Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9617643Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Marking Orc Warrior (enemy) as defeated
2025-07-08T20:02:42.9618875Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Removed Orc Warrior from combat_state.combatants
2025-07-08T20:02:42.9619876Z 2025-07-08 20:02:42,961 - INFO - COMBAT CLEANUP: Removed Orc Warrior from npc_data
2025-07-08T20:02:42.9621038Z 2025-07-08 20:02:42,961 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Orc Warrior']
2025-07-08T20:02:42.9621812Z ok
2025-07-08T20:02:42.9622880Z test_cleanup_without_explicit_combat_state_changes (__main__.TestCombatCleanupComprehensive.test_cleanup_without_explicit_combat_state_changes)
2025-07-08T20:02:42.9625462Z Test: Cleanup should trigger even when combat_state isn't explicitly in proposed_changes. ... 2025-07-08 20:02:42,961 - INFO - COMBAT STARTED - Participants: ['Ranger', 'Troll']
2025-07-08T20:02:42.9627410Z 2025-07-08 20:02:42,961 - INFO - COMBAT INITIALIZED - Initiative order: ['Ranger(16)', 'Troll(8)']
2025-07-08T20:02:42.9628765Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9638542Z   "combat_state": {
2025-07-08T20:02:42.9639438Z     "current_turn_index": 1,
2025-07-08T20:02:42.9640322Z     "current_round": 3
2025-07-08T20:02:42.9641086Z   },
2025-07-08T20:02:42.9641669Z   "world_data": {
2025-07-08T20:02:42.9642131Z     "current_weather": "stormy"
2025-07-08T20:02:42.9642869Z Running comprehensive combat cleanup tests
2025-07-08T20:02:42.9643671Z These tests verify the automatic cleanup system works correctly
2025-07-08T20:02:42.9644219Z ======================================================================
2025-07-08T20:02:42.9644544Z 
2025-07-08T20:02:42.9644736Z Testing: Automatic cleanup via HP state updates
2025-07-08T20:02:42.9645306Z Initial combatants: ['Hero', 'Orc Warrior', 'Goblin']
2025-07-08T20:02:42.9645835Z Initial NPC data: ['Orc Warrior', 'Goblin', 'Merchant']
2025-07-08T20:02:42.9646665Z AI proposed changes: {'combat_state': {'combatants': {'Orc Warrior': {'hp_current': 0, 'status': ['bloodied', 'unconscious']}}}}
2025-07-08T20:02:42.9647745Z After automatic cleanup - Combatants: ['Hero', 'Goblin']
2025-07-08T20:02:42.9648283Z After automatic cleanup - NPCs: ['Goblin', 'Merchant']
2025-07-08T20:02:42.9648606Z 
2025-07-08T20:02:42.9648808Z Testing: Cleanup without explicit combat state changes
2025-07-08T20:02:42.9649291Z Before update - Troll HP: 0
2025-07-08T20:02:42.9649681Z Before update - Combatants: ['Ranger', 'Troll']
2025-07-08T20:02:42.9650112Z After update - Combatants: ['Ranger']
2025-07-08T20:02:42.9650387Z 
2025-07-08T20:02:42.9650560Z Testing: Combat end with pre-defeated enemies
2025-07-08T20:02:42.9651117Z Before combat end - Combatants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T20:02:42.9651621Z Dead Orc HP: 0
2025-07-08T20:02:42.9651915Z After combat end - In combat: False
2025-07-08T20:02:42.9652374Z After combat end - Combatants: ['Player', 'Living Wolf']
2025-07-08T20:02:42.9652708Z 
2025-07-08T20:02:42.9652857Z Testing: Multiple simultaneous defeats
2025-07-08T20:02:42.9659404Z Before fireball - Combatants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T20:02:42.9660060Z After fireball - Combatants: ['Wizard', 'Orc Chief']
2025-07-08T20:02:42.9660559Z After fireball - NPCs: ['Orc Chief', 'Village Elder']
2025-07-08T20:02:42.9661068Z   }
2025-07-08T20:02:42.9661297Z }
2025-07-08T20:02:42.9661715Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9662265Z   "current_turn_index": 1,
2025-07-08T20:02:42.9662570Z   "current_round": 3
2025-07-08T20:02:42.9662852Z }
2025-07-08T20:02:42.9663409Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9664043Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9664565Z   "current_weather": "stormy"
2025-07-08T20:02:42.9664886Z }
2025-07-08T20:02:42.9665244Z 2025-07-08 20:02:42,961 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9665846Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9666603Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP CHECK: Found 2 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9667389Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Marking Troll (enemy) as defeated
2025-07-08T20:02:42.9668092Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Troll from combat_state.combatants
2025-07-08T20:02:42.9668771Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Troll from npc_data
2025-07-08T20:02:42.9669435Z 2025-07-08 20:02:42,962 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Troll']
2025-07-08T20:02:42.9669941Z ok
2025-07-08T20:02:42.9670657Z test_combat_end_with_pre_defeated_enemies (__main__.TestCombatCleanupComprehensive.test_combat_end_with_pre_defeated_enemies)
2025-07-08T20:02:42.9672208Z Test: When combat ends and there are already defeated enemies, they should be cleaned up. ... 2025-07-08 20:02:42,962 - INFO - COMBAT STARTED - Participants: ['Player', 'Dead Orc', 'Living Wolf']
2025-07-08T20:02:42.9673707Z 2025-07-08 20:02:42,962 - INFO - COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dead Orc(12)', 'Living Wolf(10)']
2025-07-08T20:02:42.9674552Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9675264Z   "combat_state": {
2025-07-08T20:02:42.9675558Z     "in_combat": false,
2025-07-08T20:02:42.9675865Z     "current_round": 0
2025-07-08T20:02:42.9676176Z   }
2025-07-08T20:02:42.9676408Z }
2025-07-08T20:02:42.9676807Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9677332Z   "in_combat": false,
2025-07-08T20:02:42.9677628Z   "current_round": 0
2025-07-08T20:02:42.9677904Z }
2025-07-08T20:02:42.9678266Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9678861Z 2025-07-08 20:02:42,962 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9679612Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP CHECK: Found 3 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9680573Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Marking Dead Orc (enemy) as defeated
2025-07-08T20:02:42.9681308Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Dead Orc from combat_state.combatants
2025-07-08T20:02:42.9682034Z 2025-07-08 20:02:42,962 - INFO - COMBAT CLEANUP: Removed Dead Orc from npc_data
2025-07-08T20:02:42.9682700Z 2025-07-08 20:02:42,962 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Dead Orc']
2025-07-08T20:02:42.9683400Z ok
2025-07-08T20:02:42.9684089Z test_multiple_enemies_defeated_same_turn (__main__.TestCombatCleanupComprehensive.test_multiple_enemies_defeated_same_turn)
2025-07-08T20:02:42.9685546Z Test: Multiple enemies defeated in the same AI response should all be cleaned up. ... 2025-07-08 20:02:42,963 - INFO - COMBAT STARTED - Participants: ['Wizard', 'Goblin A', 'Goblin B', 'Orc Chief']
2025-07-08T20:02:42.9686923Z 2025-07-08 20:02:42,963 - INFO - COMBAT INITIALIZED - Initiative order: ['Wizard(20)', 'Goblin A(15)', 'Goblin B(14)', 'Orc Chief(13)']
2025-07-08T20:02:42.9687830Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9688334Z   "combat_state": {
2025-07-08T20:02:42.9688643Z     "combatants": {
2025-07-08T20:02:42.9688920Z       "Goblin A": {
2025-07-08T20:02:42.9689202Z         "hp_current": 0,
2025-07-08T20:02:42.9689489Z         "status": [
2025-07-08T20:02:42.9689741Z           "dead"
2025-07-08T20:02:42.9690008Z         ]
2025-07-08T20:02:42.9690245Z       },
2025-07-08T20:02:42.9690478Z       "Goblin B": {
2025-07-08T20:02:42.9690762Z         "hp_current": 0,
2025-07-08T20:02:42.9691052Z         "status": [
2025-07-08T20:02:42.9691302Z           "dead"
2025-07-08T20:02:42.9691560Z         ]
2025-07-08T20:02:42.9691786Z       },
2025-07-08T20:02:42.9692022Z       "Orc Chief": {
2025-07-08T20:02:42.9692315Z         "hp_current": 5,
2025-07-08T20:02:42.9692615Z         "status": [
2025-07-08T20:02:42.9692881Z           "wounded"
2025-07-08T20:02:42.9693161Z ... (truncated, showing 19/24 lines)
2025-07-08T20:02:42.9693888Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9694394Z   "combatants": {
2025-07-08T20:02:42.9694659Z     "Goblin A": {
2025-07-08T20:02:42.9694937Z       "hp_current": 0,
2025-07-08T20:02:42.9695220Z       "status": [
2025-07-08T20:02:42.9695476Z         "dead"
2025-07-08T20:02:42.9695724Z       ]
2025-07-08T20:02:42.9695961Z     },
2025-07-08T20:02:42.9696189Z     "Goblin B": {
2025-07-08T20:02:42.9696469Z       "hp_current": 0,
2025-07-08T20:02:42.9696755Z       "status": [
2025-07-08T20:02:42.9697002Z         "dead"
2025-07-08T20:02:42.9697250Z       ]
2025-07-08T20:02:42.9697473Z     },
2025-07-08T20:02:42.9697700Z     "Orc Chief": {
2025-07-08T20:02:42.9697976Z       "hp_current": 5,
2025-07-08T20:02:42.9698253Z       "status": [
2025-07-08T20:02:42.9698500Z         "wounded"
2025-07-08T20:02:42.9698744Z       ]
2025-07-08T20:02:42.9699001Z ... (truncated, showing 19/22 lines)
2025-07-08T20:02:42.9699498Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9699986Z   "Goblin A": {
2025-07-08T20:02:42.9700251Z     "hp_current": 0,
2025-07-08T20:02:42.9700532Z     "status": [
2025-07-08T20:02:42.9700958Z       "dead"
2025-07-08T20:02:42.9701223Z     ]
2025-07-08T20:02:42.9701448Z   },
2025-07-08T20:02:42.9701671Z   "Goblin B": {
2025-07-08T20:02:42.9701935Z     "hp_current": 0,
2025-07-08T20:02:42.9702207Z     "status": [
2025-07-08T20:02:42.9702455Z       "dead"
2025-07-08T20:02:42.9702700Z     ]
2025-07-08T20:02:42.9702928Z   },
2025-07-08T20:02:42.9703145Z   "Orc Chief": {
2025-07-08T20:02:42.9703574Z     "hp_current": 5,
2025-07-08T20:02:42.9703846Z     "status": [
2025-07-08T20:02:42.9704085Z       "wounded"
2025-07-08T20:02:42.9704330Z     ]
2025-07-08T20:02:42.9704563Z   }
2025-07-08T20:02:42.9704778Z }
2025-07-08T20:02:42.9705167Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9705860Z   "hp_current": 0,
2025-07-08T20:02:42.9706122Z   "status": [
2025-07-08T20:02:42.9706363Z     "dead"
2025-07-08T20:02:42.9706599Z   ]
2025-07-08T20:02:42.9706819Z }
2025-07-08T20:02:42.9707183Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9707835Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9708338Z   "hp_current": 0,
2025-07-08T20:02:42.9708619Z   "status": [
2025-07-08T20:02:42.9708867Z     "dead"
2025-07-08T20:02:42.9709093Z   ]
2025-07-08T20:02:42.9709313Z }
2025-07-08T20:02:42.9709686Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9710300Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:42.9710804Z   "hp_current": 5,
2025-07-08T20:02:42.9711065Z   "status": [
2025-07-08T20:02:42.9711302Z     "wounded"
2025-07-08T20:02:42.9711548Z   ]
2025-07-08T20:02:42.9711768Z }
2025-07-08T20:02:42.9712132Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9712755Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9713481Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9714077Z 2025-07-08 20:02:42,963 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:42.9714862Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP CHECK: Found 4 combatants, scanning for defeated enemies...
2025-07-08T20:02:42.9715631Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Marking Goblin A (enemy) as defeated
2025-07-08T20:02:42.9716281Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Marking Goblin B (enemy) as defeated
2025-07-08T20:02:42.9716976Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin A from combat_state.combatants
2025-07-08T20:02:42.9717644Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin A from npc_data
2025-07-08T20:02:42.9718341Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin B from combat_state.combatants
2025-07-08T20:02:42.9719010Z 2025-07-08 20:02:42,963 - INFO - COMBAT CLEANUP: Removed Goblin B from npc_data
2025-07-08T20:02:42.9719728Z 2025-07-08 20:02:42,964 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: ['Goblin A', 'Goblin B']
2025-07-08T20:02:42.9720297Z ok
2025-07-08T20:02:42.9720427Z 
2025-07-08T20:02:42.9720619Z ----------------------------------------------------------------------
2025-07-08T20:02:42.9721037Z Ran 4 tests in 0.006s
2025-07-08T20:02:42.9721218Z 
2025-07-08T20:02:42.9721314Z OK
2025-07-08T20:02:43.1174908Z ✅ mvp_site/tests/test_combat_cleanup_comprehensive.py passed
2025-07-08T20:02:43.1176417Z ----------------------------------------
2025-07-08T20:02:43.1176971Z Running mvp_site/tests/test_complete_combined_approach.py...
2025-07-08T20:02:43.3001073Z test_complete_combined_approach_integration (__main__.TestCompleteCombinedApproach.test_complete_combined_approach_integration)
2025-07-08T20:02:43.3020616Z Test complete Combined approach integration flow ... ok
2025-07-08T20:02:43.3023019Z test_failure_case_handling (__main__.TestCompleteCombinedApproach.test_failure_case_handling)
2025-07-08T20:02:43.3033516Z Test how the system handles failure cases ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:43.3035761Z ok
2025-07-08T20:02:43.3038468Z test_step1_structured_generation_prompt_creation (__main__.TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation)
2025-07-08T20:02:43.3044107Z Step 1: Create structured generation prompt with entity manifest ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step1_structured_generation_prompt_creation of <__main__.TestCompleteCombinedApproach testMethod=test_step1_structured_generation_prompt_creation>>)
2025-07-08T20:02:43.3047145Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3047558Z ok
2025-07-08T20:02:43.3048331Z test_step2_structured_response_parsing (__main__.TestCompleteCombinedApproach.test_step2_structured_response_parsing)
2025-07-08T20:02:43.3051124Z Step 2: Parse structured JSON response from LLM ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step2_structured_response_parsing of <__main__.TestCompleteCombinedApproach testMethod=test_step2_structured_response_parsing>>)
2025-07-08T20:02:43.3053521Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3053857Z ok
2025-07-08T20:02:43.3054389Z test_step3_schema_validation (__main__.TestCompleteCombinedApproach.test_step3_schema_validation)
2025-07-08T20:02:43.3057140Z Step 3: Validate structured response against expected schema ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step3_schema_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step3_schema_validation>>)
2025-07-08T20:02:43.3059485Z 🎯 Complete Combined Approach Implementation Test
2025-07-08T20:02:43.3060302Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3060743Z Testing Milestone 1: Production Entity Tracking
2025-07-08T20:02:43.3061231Z ok
2025-07-08T20:02:43.3064576Z ======================================================================
2025-07-08T20:02:43.3072716Z 
2025-07-08T20:02:43.3073045Z 🚀 Complete Combined Approach Integration Test
2025-07-08T20:02:43.3073622Z ============================================================
2025-07-08T20:02:43.3082547Z 
2025-07-08T20:02:43.3082870Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T20:02:43.3088324Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3088931Z    ✅ Prompt injection created (836 chars)
2025-07-08T20:02:43.3089203Z 
2025-07-08T20:02:43.3089446Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T20:02:43.3089908Z    ✅ JSON parsed successfully
2025-07-08T20:02:43.3090347Z    ✅ Narrative extracted (380 chars)
2025-07-08T20:02:43.3090838Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3091124Z 
2025-07-08T20:02:43.3091385Z 🔧 Step 3: Schema validation of structured response
2025-07-08T20:02:43.3091893Z    ✅ Schema validation: True
2025-07-08T20:02:43.3092293Z    ✅ Narrative validation: True
2025-07-08T20:02:43.3092689Z    ✅ Coverage rate: 1.00
2025-07-08T20:02:43.3092895Z 
2025-07-08T20:02:43.3093140Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T20:02:43.3093786Z    ✅ All entities present: True
2025-07-08T20:02:43.3094253Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3094698Z    ✅ Confidence: 1.00
2025-07-08T20:02:43.3094911Z 
2025-07-08T20:02:43.3095103Z 📊 Combined Approach Results:
2025-07-08T20:02:43.3095542Z    🎯 Structured Generation: ✅ PASS
2025-07-08T20:02:43.3095995Z    🎯 Response Parsing: ✅ PASS
2025-07-08T20:02:43.3096471Z    🎯 Schema Validation: ✅ PASS (100% coverage)
2025-07-08T20:02:43.3097217Z    🎯 Sync Validation: ✅ PASS (100% confidence)
2025-07-08T20:02:43.3097699Z    🎯 Overall: ✅ 100% SUCCESS
2025-07-08T20:02:43.3097918Z 
2025-07-08T20:02:43.3098149Z 🎉 Combined Approach Implementation VERIFIED!
2025-07-08T20:02:43.3098577Z    The Cassian Problem is SOLVED!
2025-07-08T20:02:43.3098823Z 
2025-07-08T20:02:43.3099027Z 🧪 Testing failure case handling
2025-07-08T20:02:43.3099460Z    ✅ Graceful fallback for non-JSON response
2025-07-08T20:02:43.3100115Z    ✅ Validation still detects missing entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3100568Z 
2025-07-08T20:02:43.3100832Z 🔧 Step 1: Creating structured generation prompt
2025-07-08T20:02:43.3101385Z    ✅ Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3102092Z    ✅ Prompt injection created (836 chars)
2025-07-08T20:02:43.3102369Z 
2025-07-08T20:02:43.3102589Z 🔧 Step 2: Parsing structured JSON response
2025-07-08T20:02:43.3103051Z    ✅ JSON parsed successfully
2025-07-08T20:02:43.3103635Z    ✅ Narrative extracted (380 chars)
2025-07-08T20:02:43.3104152Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3104459Z 
2025-07-08T20:02:43.3104711Z 🔧 Step 3: Schema validation of structured response
2025-07-08T20:02:43.3105197Z    ✅ Schema validation: True
2025-07-08T20:02:43.3105589Z    ✅ Narrative validation: True
2025-07-08T20:02:43.3105995Z    ✅ Coverage rate: 1.00
2025-07-08T20:02:43.3106194Z 
2025-07-08T20:02:43.3106436Z 🔧 Step 4: Additional narrative sync validation
2025-07-08T20:02:43.3106920Z    ✅ All entities present: True
2025-07-08T20:02:43.3107393Z    ✅ Entities found: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:43.3107867Z    ✅ Confidence: 1.00
2025-07-08T20:02:43.3108607Z test_step4_narrative_sync_validation (__main__.TestCompleteCombinedApproach.test_step4_narrative_sync_validation)
2025-07-08T20:02:43.3111219Z Step 4: Additional validation with NarrativeSyncValidator ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestCompleteCombinedApproach.test_step4_narrative_sync_validation of <__main__.TestCompleteCombinedApproach testMethod=test_step4_narrative_sync_validation>>)
2025-07-08T20:02:43.3113654Z   return self.run(*args, **kwds)
2025-07-08T20:02:43.3113979Z ok
2025-07-08T20:02:43.3114108Z 
2025-07-08T20:02:43.3114301Z ----------------------------------------------------------------------
2025-07-08T20:02:43.3114736Z Ran 6 tests in 0.005s
2025-07-08T20:02:43.3114929Z 
2025-07-08T20:02:43.3115022Z OK
2025-07-08T20:02:43.3299039Z ✅ mvp_site/tests/test_complete_combined_approach.py passed
2025-07-08T20:02:43.3300702Z ----------------------------------------
2025-07-08T20:02:43.3301210Z Running mvp_site/tests/test_constants.py...
2025-07-08T20:02:43.3678946Z ...............
2025-07-08T20:02:43.3680521Z ----------------------------------------------------------------------
2025-07-08T20:02:43.3681993Z Ran 15 tests in 0.001s
2025-07-08T20:02:43.3682240Z 
2025-07-08T20:02:43.3682386Z OK
2025-07-08T20:02:43.3735212Z ✅ mvp_site/tests/test_constants.py passed
2025-07-08T20:02:43.3736775Z ----------------------------------------
2025-07-08T20:02:43.3737290Z Running mvp_site/tests/test_context_truncation.py...
2025-07-08T20:02:44.0064451Z 2025-07-08 20:02:44,005 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0082867Z 2025-07-08 20:02:44,005 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0084204Z 2025-07-08 20:02:44,005 - INFO - Initial context stats: Turns: 2, Tokens: 5 (est: 5), Core Memories: 0
2025-07-08T20:02:44.0084954Z 2025-07-08 20:02:44,005 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:44.0085621Z .2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0086651Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0087955Z 2025-07-08 20:02:44,006 - INFO - Initial context stats: Turns: 6, Tokens: 15 (est: 15), Core Memories: 0
2025-07-08T20:02:44.0088714Z 2025-07-08 20:02:44,006 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:44.0089299Z .2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0090277Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0091280Z 2025-07-08 20:02:44,006 - INFO - Initial context stats: Turns: 4, Tokens: 50 (est: 50), Core Memories: 0
2025-07-08T20:02:44.0092208Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Context (50 tokens) exceeds budget of 30 tokens. Truncating...
2025-07-08T20:02:44.0093081Z 2025-07-08 20:02:44,006 - INFO - Initializing Gemini Client
2025-07-08T20:02:44.0094305Z 2025-07-08 20:02:44,006 - WARNING - ⚠️ Could not count tokens for context stats: CRITICAL: GEMINI_API_KEY environment variable not found!
2025-07-08T20:02:44.0095351Z 2025-07-08 20:02:44,006 - INFO - Final context stats after truncation: Turns: 4, Tokens: 67 (est: 67), Core Memories: 0
2025-07-08T20:02:44.0095983Z .
2025-07-08T20:02:44.0096303Z ----------------------------------------------------------------------
2025-07-08T20:02:44.0096739Z Ran 3 tests in 0.001s
2025-07-08T20:02:44.0096926Z 
2025-07-08T20:02:44.0097024Z OK
2025-07-08T20:02:44.0097412Z \n--- Running Test: test_does_not_truncate_if_within_all_limits ---
2025-07-08T20:02:44.0097903Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0098366Z \n--- Running Test: test_no_truncation_when_under_char_limit ---
2025-07-08T20:02:44.0098851Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0099345Z \n--- Running Test: test_truncates_when_few_turns_over_char_limit ---
2025-07-08T20:02:44.0099848Z --- Test Finished Successfully ---
2025-07-08T20:02:44.0870208Z ✅ mvp_site/tests/test_context_truncation.py passed
2025-07-08T20:02:44.0872068Z ----------------------------------------
2025-07-08T20:02:44.0873128Z Running mvp_site/tests/test_data_integrity.py...
2025-07-08T20:02:44.3430755Z INFO: COMBAT STARTED - Participants: ['Player', 'Dragon Boss', 'Friendly Wolf']
2025-07-08T20:02:44.3432268Z INFO: COMBAT INITIALIZED - Initiative order: ['Player(15)', 'Dragon Boss(12)', 'Friendly Wolf(8)']
2025-07-08T20:02:44.3433660Z INFO: COMBAT CLEANUP: Marking Dragon Boss (enemy) as defeated
2025-07-08T20:02:44.3435173Z INFO: COMBAT CLEANUP: Removed Dragon Boss from combat_state.combatants
2025-07-08T20:02:44.3437441Z INFO: COMBAT CLEANUP: Removed Dragon Boss from npc_data
2025-07-08T20:02:44.3438248Z ..INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3438822Z   "custom_campaign_state": {
2025-07-08T20:02:44.3439257Z     "active_missions": {
2025-07-08T20:02:44.3439642Z       "rogue_mission": {
2025-07-08T20:02:44.3440034Z         "title": "This shouldn't be here"
2025-07-08T20:02:44.3440397Z       }
2025-07-08T20:02:44.3440650Z     }
2025-07-08T20:02:44.3440910Z   }
2025-07-08T20:02:44.3441164Z }
2025-07-08T20:02:44.3441566Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3442029Z   "active_missions": {
2025-07-08T20:02:44.3442331Z     "rogue_mission": {
2025-07-08T20:02:44.3442633Z       "title": "This shouldn't be here"
2025-07-08T20:02:44.3442980Z     }
2025-07-08T20:02:44.3443413Z   }
2025-07-08T20:02:44.3443636Z }
2025-07-08T20:02:44.3444518Z WARNING: ⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:02:44.3445224Z INFO: Adding new mission: rogue_mission
2025-07-08T20:02:44.3445654Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3446137Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3461997Z ........INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3462863Z   "npc_data": {
2025-07-08T20:02:44.3463676Z     "Grishnak": "defeated"
2025-07-08T20:02:44.3464322Z   }
2025-07-08T20:02:44.3464872Z }
2025-07-08T20:02:44.3465920Z INFO: --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:44.3466655Z   "Grishnak": "defeated"
2025-07-08T20:02:44.3467273Z }
2025-07-08T20:02:44.3468303Z INFO: update_state: Preserving dict structure for key 'Grishnak', adding 'status' field.
2025-07-08T20:02:44.3470311Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3472130Z INFO: --- update_state_with_changes: finished ---
2025-07-08T20:02:44.3474146Z .
2025-07-08T20:02:44.3475816Z ----------------------------------------------------------------------
2025-07-08T20:02:44.3477602Z Ran 11 tests in 0.002s
2025-07-08T20:02:44.3479337Z 
2025-07-08T20:02:44.3480466Z OK
2025-07-08T20:02:44.3828735Z ✅ mvp_site/tests/test_data_integrity.py passed
2025-07-08T20:02:44.3830921Z ----------------------------------------
2025-07-08T20:02:44.3831938Z Running mvp_site/tests/test_debug_hybrid_system.py...
2025-07-08T20:02:44.3932559Z Traceback (most recent call last):
2025-07-08T20:02:44.3934655Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/tests/test_debug_hybrid_system.py", line 5, in <module>
2025-07-08T20:02:44.3936774Z     import pytest
2025-07-08T20:02:44.3937159Z ModuleNotFoundError: No module named 'pytest'
2025-07-08T20:02:44.3956336Z ❌ mvp_site/tests/test_debug_hybrid_system.py failed
2025-07-08T20:02:44.3958112Z ----------------------------------------
2025-07-08T20:02:44.3959140Z Running mvp_site/tests/test_debug_logging.py...
2025-07-08T20:02:45.2650630Z ...
2025-07-08T20:02:45.2651700Z ----------------------------------------------------------------------
2025-07-08T20:02:45.2653120Z Ran 3 tests in 0.025s
2025-07-08T20:02:45.2653770Z 
2025-07-08T20:02:45.2654066Z OK
2025-07-08T20:02:45.3977006Z ✅ mvp_site/tests/test_debug_logging.py passed
2025-07-08T20:02:45.3978152Z ----------------------------------------
2025-07-08T20:02:45.3983767Z Running mvp_site/tests/test_debug_mode.py...
2025-07-08T20:02:46.2470455Z 2025-07-08 20:02:46,246 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2472445Z 2025-07-08 20:02:46,246 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2535828Z .2025-07-08 20:02:46,253 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2537713Z 2025-07-08 20:02:46,253 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2592325Z .2025-07-08 20:02:46,259 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2594652Z 2025-07-08 20:02:46,259 - WARNING - ⚠️ AI response missing debug content for campaign test_campaign_456
2025-07-08T20:02:46.2596334Z 2025-07-08 20:02:46,259 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:02:46.2597732Z 2025-07-08 20:02:46,259 - INFO - Response length: 40 characters (~10 tokens)
2025-07-08T20:02:46.2652369Z .2025-07-08 20:02:46,265 - INFO - Debug mode enabled for campaign test_campaign_456
2025-07-08T20:02:46.2672731Z 2025-07-08 20:02:46,267 - INFO - Debug mode disabled for campaign test_campaign_456
2025-07-08T20:02:46.2726215Z .2025-07-08 20:02:46,272 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:46.2728025Z 2025-07-08 20:02:46,272 - INFO - Debug content generated for campaign test_campaign_456: {'dm_notes': False, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:46.2732526Z .
2025-07-08T20:02:46.2732929Z ----------------------------------------------------------------------
2025-07-08T20:02:46.2733678Z Ran 5 tests in 0.035s
2025-07-08T20:02:46.2733892Z 
2025-07-08T20:02:46.2734003Z OK
2025-07-08T20:02:46.3996058Z ✅ mvp_site/tests/test_debug_mode.py passed
2025-07-08T20:02:46.4000061Z ----------------------------------------
2025-07-08T20:02:46.4000572Z Running mvp_site/tests/test_debug_mode_e2e.py...
2025-07-08T20:02:47.2588271Z .2025-07-08 20:02:47,258 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:47.2590236Z 2025-07-08 20:02:47,258 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:47.2646724Z .2025-07-08 20:02:47,264 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Test Hero' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:47.2648549Z 2025-07-08 20:02:47,264 - INFO - Debug content generated for campaign test_campaign_e2e: {'dm_notes': True, 'dice_rolls': True, 'state_changes': False}
2025-07-08T20:02:47.2653462Z .
2025-07-08T20:02:47.2653850Z ----------------------------------------------------------------------
2025-07-08T20:02:47.2654337Z Ran 3 tests in 0.019s
2025-07-08T20:02:47.2654548Z 
2025-07-08T20:02:47.2654656Z OK
2025-07-08T20:02:47.3890001Z ✅ mvp_site/tests/test_debug_mode_e2e.py passed
2025-07-08T20:02:47.3891424Z ----------------------------------------
2025-07-08T20:02:47.3891954Z Running mvp_site/tests/test_debug_mode_game_state.py...
2025-07-08T20:02:47.4327897Z ......
2025-07-08T20:02:47.4329820Z ----------------------------------------------------------------------
2025-07-08T20:02:47.4330346Z Ran 6 tests in 0.000s
2025-07-08T20:02:47.4330564Z 
2025-07-08T20:02:47.4330686Z OK
2025-07-08T20:02:47.4395354Z ✅ mvp_site/tests/test_debug_mode_game_state.py passed
2025-07-08T20:02:47.4396265Z ----------------------------------------
2025-07-08T20:02:47.4397567Z Running mvp_site/tests/test_debug_mode_parser.py...
2025-07-08T20:02:47.4857950Z ...............
2025-07-08T20:02:47.4858805Z ----------------------------------------------------------------------
2025-07-08T20:02:47.4859660Z Ran 15 tests in 0.006s
2025-07-08T20:02:47.4860717Z 
2025-07-08T20:02:47.4860862Z OK
2025-07-08T20:02:47.4926857Z ✅ mvp_site/tests/test_debug_mode_parser.py passed
2025-07-08T20:02:47.4927694Z ----------------------------------------
2025-07-08T20:02:47.4928433Z Running mvp_site/tests/test_debug_mode_unit.py...
2025-07-08T20:02:47.5584631Z .......
2025-07-08T20:02:47.5585102Z ----------------------------------------------------------------------
2025-07-08T20:02:47.5585621Z Ran 7 tests in 0.001s
2025-07-08T20:02:47.5585843Z 
2025-07-08T20:02:47.5585958Z OK
2025-07-08T20:02:47.5689132Z ✅ mvp_site/tests/test_debug_mode_unit.py passed
2025-07-08T20:02:47.5690460Z ----------------------------------------
2025-07-08T20:02:47.5690963Z Running mvp_site/tests/test_debug_stripping.py...
2025-07-08T20:02:47.6186617Z ..............
2025-07-08T20:02:47.6187455Z ----------------------------------------------------------------------
2025-07-08T20:02:47.6188261Z Ran 14 tests in 0.001s
2025-07-08T20:02:47.6188819Z 
2025-07-08T20:02:47.6189154Z OK
2025-07-08T20:02:47.6258150Z ✅ mvp_site/tests/test_debug_stripping.py passed
2025-07-08T20:02:47.6258974Z ----------------------------------------
2025-07-08T20:02:47.6259758Z Running mvp_site/tests/test_debug_stripping_isolated.py...
2025-07-08T20:02:47.6634325Z .........
2025-07-08T20:02:47.6636525Z ----------------------------------------------------------------------
2025-07-08T20:02:47.6637067Z Ran 9 tests in 0.001s
2025-07-08T20:02:47.6637295Z 
2025-07-08T20:02:47.6637411Z OK
2025-07-08T20:02:47.6690533Z ✅ mvp_site/tests/test_debug_stripping_isolated.py passed
2025-07-08T20:02:47.6691884Z ----------------------------------------
2025-07-08T20:02:47.6692459Z Running mvp_site/tests/test_debug_stripping_json_safety.py...
2025-07-08T20:02:47.7355856Z .....
2025-07-08T20:02:47.7358938Z ----------------------------------------------------------------------
2025-07-08T20:02:47.7359697Z Ran 5 tests in 0.001s
2025-07-08T20:02:47.7360395Z 
2025-07-08T20:02:47.7360698Z OK
2025-07-08T20:02:47.7459307Z ✅ mvp_site/tests/test_debug_stripping_json_safety.py passed
2025-07-08T20:02:47.7460443Z ----------------------------------------
2025-07-08T20:02:47.7462028Z Running mvp_site/tests/test_decorators.py...
2025-07-08T20:02:47.8124225Z .........
2025-07-08T20:02:47.8125138Z ----------------------------------------------------------------------
2025-07-08T20:02:47.8126371Z Ran 9 tests in 0.004s
2025-07-08T20:02:47.8126813Z 
2025-07-08T20:02:47.8127232Z OK
2025-07-08T20:02:47.8227518Z ✅ mvp_site/tests/test_decorators.py passed
2025-07-08T20:02:47.8228868Z ----------------------------------------
2025-07-08T20:02:47.8229451Z Running mvp_site/tests/test_defensive_numeric_converter.py...
2025-07-08T20:02:47.9966150Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9967656Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9968731Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T20:02:47.9969834Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9970813Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9971757Z WARNING:root:⚠️ Invalid value 'Unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9972666Z WARNING:root:⚠️ Invalid value 'UNKNOWN' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9973913Z WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T20:02:47.9974914Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'hp'. Using default: 1
2025-07-08T20:02:47.9975935Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9976874Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:47.9977850Z WARNING:root:⚠️ Invalid value 'unknown' for field 'temp_hp'. Using default: 0
2025-07-08T20:02:47.9978767Z WARNING:root:⚠️ Invalid value 'None' for field 'temp_hp'. Using default: 0
2025-07-08T20:02:47.9979709Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:47.9980731Z WARNING:root:⚠️ Invalid value 'None' for field 'level'. Using default: 1
2025-07-08T20:02:47.9981724Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'level'. Using default: 1
2025-07-08T20:02:47.9982714Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'gold'. Using default: 0
2025-07-08T20:02:47.9983838Z WARNING:root:⚠️ Invalid value 'None' for field 'gold'. Using default: 0
2025-07-08T20:02:47.9984799Z WARNING:root:⚠️ Invalid value 'unknown' for field 'initiative'. Using default: 0
2025-07-08T20:02:47.9985718Z WARNING:root:⚠️ Invalid value 'None' for field 'initiative'. Using default: 0
2025-07-08T20:02:47.9986634Z ....WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:47.9987460Z WARNING:root:⚠️ Invalid value 'None' for field 'strength'. Using default: 10
2025-07-08T20:02:47.9988625Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'strength'. Using default: 10
2025-07-08T20:02:47.9989684Z WARNING:root:⚠️ Invalid value 'unknown' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9990654Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9991649Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'dexterity'. Using default: 10
2025-07-08T20:02:47.9992699Z WARNING:root:⚠️ Invalid value 'unknown' for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9993832Z WARNING:root:⚠️ Invalid value 'None' for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9994880Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:47.9995933Z WARNING:root:⚠️ Invalid value 'unknown' for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9996916Z WARNING:root:⚠️ Invalid value 'None' for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9998178Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'intelligence'. Using default: 10
2025-07-08T20:02:47.9999252Z WARNING:root:⚠️ Invalid value 'unknown' for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0000178Z WARNING:root:⚠️ Invalid value 'None' for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0001141Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'wisdom'. Using default: 10
2025-07-08T20:02:48.0002131Z WARNING:root:⚠️ Invalid value 'unknown' for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0003064Z WARNING:root:⚠️ Invalid value 'None' for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0004212Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'charisma'. Using default: 10
2025-07-08T20:02:48.0005398Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:48.0006296Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.0007187Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.0008160Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T20:02:48.0009074Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.0014184Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.0035677Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:48.0036625Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:48.0037624Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:48.0038293Z .
2025-07-08T20:02:48.0038666Z ----------------------------------------------------------------------
2025-07-08T20:02:48.0039203Z Ran 12 tests in 0.002s
2025-07-08T20:02:48.0039419Z 
2025-07-08T20:02:48.0041207Z OK
2025-07-08T20:02:48.0221158Z ✅ mvp_site/tests/test_defensive_numeric_converter.py passed
2025-07-08T20:02:48.0222578Z ----------------------------------------
2025-07-08T20:02:48.0223051Z Running mvp_site/tests/test_delete_fix.py...
2025-07-08T20:02:48.0327182Z === Testing __DELETE__ Token Processing ===
2025-07-08T20:02:48.0327602Z 
2025-07-08T20:02:48.0327751Z Test 1: Simple deletion
2025-07-08T20:02:48.0328711Z Before: {'npc_data': {'Drake 1': {'name': 'Drake 1', 'type': 'enemy'}, 'Drake 2': {'name': 'Drake 2', 'type': 'enemy'}, 'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T20:02:48.0329681Z Removed 'Drake 1' from state.
2025-07-08T20:02:48.0330062Z Removed 'Drake 2' from state.
2025-07-08T20:02:48.0330709Z After: {'npc_data': {'Friendly NPC': {'name': 'Friend', 'type': 'ally'}}, 'other_data': 'should remain'}
2025-07-08T20:02:48.0331565Z ✅ Test 1 passed!
2025-07-08T20:02:48.0331763Z 
2025-07-08T20:02:48.0331906Z Test 2: Top-level deletion
2025-07-08T20:02:48.0332631Z Before: {'defeated_enemy': {'name': 'Orc', 'hp': 0}, 'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T20:02:48.0333581Z Removed 'defeated_enemy' from state.
2025-07-08T20:02:48.0334174Z After: {'alive_ally': {'name': 'Ranger', 'hp': 50}, 'world_data': {'location': 'forest'}}
2025-07-08T20:02:48.0334803Z ✅ Test 2 passed!
2025-07-08T20:02:48.0335003Z 
2025-07-08T20:02:48.0335371Z 🎉 All tests passed! __DELETE__ token processing works correctly.
2025-07-08T20:02:48.0347340Z ✅ mvp_site/tests/test_delete_fix.py passed
2025-07-08T20:02:48.0348726Z ----------------------------------------
2025-07-08T20:02:48.0349272Z Running mvp_site/tests/test_delete_token_comprehensive.py...
2025-07-08T20:02:48.1049102Z .....
2025-07-08T20:02:48.1049578Z ----------------------------------------------------------------------
2025-07-08T20:02:48.1050148Z Ran 5 tests in 0.004s
2025-07-08T20:02:48.1050361Z 
2025-07-08T20:02:48.1053599Z OK
2025-07-08T20:02:48.1164784Z ✅ mvp_site/tests/test_delete_token_comprehensive.py passed
2025-07-08T20:02:48.1166380Z ----------------------------------------
2025-07-08T20:02:48.1167237Z Running mvp_site/tests/test_deployment_build.py...
2025-07-08T20:02:48.1651131Z ...
2025-07-08T20:02:48.1652974Z ----------------------------------------------------------------------
2025-07-08T20:02:48.1654895Z Ran 3 tests in 0.007s
2025-07-08T20:02:48.1656155Z 
2025-07-08T20:02:48.1657267Z OK
2025-07-08T20:02:48.1728455Z ✅ mvp_site/tests/test_deployment_build.py passed
2025-07-08T20:02:48.1729121Z ----------------------------------------
2025-07-08T20:02:48.1764071Z Running mvp_site/tests/test_dual_pass_generator.py...
2025-07-08T20:02:48.2414523Z .....................
2025-07-08T20:02:48.2416098Z ----------------------------------------------------------------------
2025-07-08T20:02:48.2417997Z Ran 21 tests in 0.003s
2025-07-08T20:02:48.2419176Z 
2025-07-08T20:02:48.2420266Z OK
2025-07-08T20:02:48.2515339Z ✅ mvp_site/tests/test_dual_pass_generator.py passed
2025-07-08T20:02:48.2515816Z ----------------------------------------
2025-07-08T20:02:48.2516429Z Running mvp_site/tests/test_entity_classes.py...
2025-07-08T20:02:48.4328353Z ......WARNING:root:⚠️ Invalid value 'unknown' for field 'level'. Using default: 1
2025-07-08T20:02:48.4332009Z .....WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:48.4334211Z WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:48.4335239Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'temp_hp'. Using default: 0
2025-07-08T20:02:48.4339935Z ..........WARNING:root:⚠️ Invalid value 'unknown' for field 'strength'. Using default: 10
2025-07-08T20:02:48.4341804Z WARNING:root:⚠️ Invalid value 'None' for field 'dexterity'. Using default: 10
2025-07-08T20:02:48.4342782Z WARNING:root:⚠️ Failed to convert 'invalid' to int for field 'constitution'. Using default: 10
2025-07-08T20:02:48.4343600Z .
2025-07-08T20:02:48.4343937Z ----------------------------------------------------------------------
2025-07-08T20:02:48.4344409Z Ran 22 tests in 0.002s
2025-07-08T20:02:48.4344612Z 
2025-07-08T20:02:48.4344732Z OK
2025-07-08T20:02:48.4563695Z ✅ mvp_site/tests/test_entity_classes.py passed
2025-07-08T20:02:48.4565041Z ----------------------------------------
2025-07-08T20:02:48.4565574Z Running mvp_site/tests/test_entity_instructions.py...
2025-07-08T20:02:48.5226915Z ............................
2025-07-08T20:02:48.5228413Z ----------------------------------------------------------------------
2025-07-08T20:02:48.5228929Z Ran 28 tests in 0.002s
2025-07-08T20:02:48.5229131Z 
2025-07-08T20:02:48.5229241Z OK
2025-07-08T20:02:48.5337196Z ✅ mvp_site/tests/test_entity_instructions.py passed
2025-07-08T20:02:48.5338308Z ----------------------------------------
2025-07-08T20:02:48.5339126Z Running mvp_site/tests/test_entity_preloader.py...
2025-07-08T20:02:48.7121869Z .............
2025-07-08T20:02:48.7125040Z ----------------------------------------------------------------------
2025-07-08T20:02:48.7125514Z Ran 13 tests in 0.003s
2025-07-08T20:02:48.7125730Z 
2025-07-08T20:02:48.7125835Z OK
2025-07-08T20:02:48.7341678Z ✅ mvp_site/tests/test_entity_preloader.py passed
2025-07-08T20:02:48.7343075Z ----------------------------------------
2025-07-08T20:02:48.7343795Z Running mvp_site/tests/test_entity_tracking.py...
2025-07-08T20:02:48.9128631Z test_entity_id_format_standardization (__main__.TestEntityTracking.test_entity_id_format_standardization)
2025-07-08T20:02:48.9133979Z Test that entity IDs follow underscore format like 'pc_name_001' ... ok
2025-07-08T20:02:48.9135585Z test_existing_string_ids_preserved (__main__.TestEntityTracking.test_existing_string_ids_preserved)
2025-07-08T20:02:48.9137932Z Test that existing string_ids from game state are preserved ... ok
2025-07-08T20:02:48.9138882Z test_expected_entities_filtering (__main__.TestEntityTracking.test_expected_entities_filtering)
2025-07-08T20:02:48.9139888Z Test that expected entities correctly filters visible, conscious entities ... ok
2025-07-08T20:02:48.9140808Z test_get_validation_info (__main__.TestEntityTracking.test_get_validation_info)
2025-07-08T20:02:48.9141986Z Test get_validation_info function returns correct information. ... ok
2025-07-08T20:02:48.9142866Z test_integration_flow (__main__.TestEntityTracking.test_integration_flow)
2025-07-08T20:02:48.9154820Z Test the complete entity tracking flow ... ok
2025-07-08T20:02:48.9161290Z test_manifest_prompt_format (__main__.TestEntityTracking.test_manifest_prompt_format)
2025-07-08T20:02:48.9162095Z Test manifest to prompt format conversion ... ok
2025-07-08T20:02:48.9162870Z test_narrative_sync_validator (__main__.TestEntityTracking.test_narrative_sync_validator)
2025-07-08T20:02:48.9164451Z Test NarrativeSyncValidator functionality ... ok
2025-07-08T20:02:48.9165279Z 🧪 Testing Entity Tracking Production Implementation
2025-07-08T20:02:48.9166659Z test_scene_manifest_creation (__main__.TestEntityTracking.test_scene_manifest_creation)
2025-07-08T20:02:48.9167304Z ============================================================
2025-07-08T20:02:48.9168095Z Test SceneManifest creation from game state ... ok
2025-07-08T20:02:48.9168625Z ✅ Integration test passed!
2025-07-08T20:02:48.9169734Z test_validator_presence_detection (__main__.TestEntityTracking.test_validator_presence_detection)
2025-07-08T20:02:48.9170494Z    Expected entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:48.9171368Z Test validator's presence detection logic ... ok
2025-07-08T20:02:48.9178701Z 
2025-07-08T20:02:48.9178942Z ----------------------------------------------------------------------
2025-07-08T20:02:48.9179396Z Ran 9 tests in 0.004s
2025-07-08T20:02:48.9179596Z 
2025-07-08T20:02:48.9179698Z OK
2025-07-08T20:02:48.9180004Z    Found entities: ['Gideon', 'Sariel', 'Rowan']
2025-07-08T20:02:48.9180785Z    Confidence: 1.00
2025-07-08T20:02:48.9414796Z ✅ mvp_site/tests/test_entity_tracking.py passed
2025-07-08T20:02:48.9416200Z ----------------------------------------
2025-07-08T20:02:48.9416763Z Running mvp_site/tests/test_entity_tracking_generic.py...
2025-07-08T20:02:49.1169263Z ..........
2025-07-08T20:02:49.1170167Z ----------------------------------------------------------------------
2025-07-08T20:02:49.1170993Z Ran 10 tests in 0.001s
2025-07-08T20:02:49.1171378Z 
2025-07-08T20:02:49.1171686Z OK
2025-07-08T20:02:49.1415751Z ✅ mvp_site/tests/test_entity_tracking_generic.py passed
2025-07-08T20:02:49.1417432Z ----------------------------------------
2025-07-08T20:02:49.1417930Z Running mvp_site/tests/test_entity_validator.py...
2025-07-08T20:02:49.2062694Z .Entity validation failed after 2 retries. Missing: ['Cassian']
2025-07-08T20:02:49.2069551Z .Entity validation failed after 0 retries. Missing: ['Cassian']
2025-07-08T20:02:49.2088266Z ...............
2025-07-08T20:02:49.2089037Z ----------------------------------------------------------------------
2025-07-08T20:02:49.2090202Z Ran 17 tests in 0.004s
2025-07-08T20:02:49.2090678Z 
2025-07-08T20:02:49.2091009Z OK
2025-07-08T20:02:49.2199839Z ✅ mvp_site/tests/test_entity_validator.py passed
2025-07-08T20:02:49.2201173Z ----------------------------------------
2025-07-08T20:02:49.2201710Z Running mvp_site/tests/test_extra_json_fields.py...
2025-07-08T20:02:49.2639961Z ..
2025-07-08T20:02:49.2640942Z ----------------------------------------------------------------------
2025-07-08T20:02:49.2641638Z Ran 2 tests in 0.000s
2025-07-08T20:02:49.2642037Z 
2025-07-08T20:02:49.2642343Z OK
2025-07-08T20:02:49.2709227Z ✅ mvp_site/tests/test_extra_json_fields.py passed
2025-07-08T20:02:49.2710795Z ----------------------------------------
2025-07-08T20:02:49.2711326Z Running mvp_site/tests/test_fallback_logic_json_bug.py...
2025-07-08T20:02:49.3162896Z ....
2025-07-08T20:02:49.3163809Z ----------------------------------------------------------------------
2025-07-08T20:02:49.3165776Z Ran 4 tests in 0.001s
2025-07-08T20:02:49.3166282Z 
2025-07-08T20:02:49.3166505Z OK
2025-07-08T20:02:49.3231232Z ✅ mvp_site/tests/test_fallback_logic_json_bug.py passed
2025-07-08T20:02:49.3232642Z ----------------------------------------
2025-07-08T20:02:49.3233754Z Running mvp_site/tests/test_firestore_helper_functions_fixed.py...
2025-07-08T20:02:49.5805754Z test_perform_append_all_duplicates (__main__.TestFirestoreHelperFunctions.test_perform_append_all_duplicates)
2025-07-08T20:02:49.5813810Z Test _perform_append when all items are duplicates ... ok
2025-07-08T20:02:49.5815431Z test_perform_append_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_complex_objects)
2025-07-08T20:02:49.5818593Z Test _perform_append with complex objects ... ok
2025-07-08T20:02:49.5819851Z test_perform_append_deduplicate_complex_objects (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_complex_objects)
2025-07-08T20:02:49.5826786Z Test _perform_append deduplication with complex objects ... ok
2025-07-08T20:02:49.5829632Z test_perform_append_deduplicate_false (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_false)
2025-07-08T20:02:49.5830740Z Test _perform_append with deduplication disabled ... ok
2025-07-08T20:02:49.5831893Z test_perform_append_deduplicate_true (__main__.TestFirestoreHelperFunctions.test_perform_append_deduplicate_true)
2025-07-08T20:02:49.5837843Z Test _perform_append with deduplication enabled ... ok
2025-07-08T20:02:49.5840721Z test_perform_append_empty_list (__main__.TestFirestoreHelperFunctions.test_perform_append_empty_list)
2025-07-08T20:02:49.5842049Z Test _perform_append with empty items list ... ok
2025-07-08T20:02:49.5842960Z test_perform_append_list_items (__main__.TestFirestoreHelperFunctions.test_perform_append_list_items)
2025-07-08T20:02:49.5849111Z Test _perform_append with list of items ... ok
2025-07-08T20:02:49.5850479Z test_perform_append_none_item (__main__.TestFirestoreHelperFunctions.test_perform_append_none_item)
2025-07-08T20:02:49.5853500Z Test _perform_append with None as single item ... ok
2025-07-08T20:02:49.5854575Z test_perform_append_single_item (__main__.TestFirestoreHelperFunctions.test_perform_append_single_item)
2025-07-08T20:02:49.5860073Z Test _perform_append with single item (not a list) ... ok
2025-07-08T20:02:49.5862400Z test_truncate_log_json_circular_reference (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_circular_reference)
2025-07-08T20:02:49.5863634Z Test _truncate_log_json with circular reference ... ok
2025-07-08T20:02:49.5864538Z test_truncate_log_json_empty_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_empty_data)
2025-07-08T20:02:49.5865423Z Test _truncate_log_json with empty data ... ok
2025-07-08T20:02:49.5866336Z test_truncate_log_json_exact_boundary (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_exact_boundary)
2025-07-08T20:02:49.5867290Z Test _truncate_log_json with exactly max_lines ... ok
2025-07-08T20:02:49.5868207Z test_truncate_log_json_invalid_json (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_invalid_json)
2025-07-08T20:02:49.5869321Z Test _truncate_log_json exception handling with non-serializable data ... ok
2025-07-08T20:02:49.5873915Z test_truncate_log_json_large_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_large_data)
2025-07-08T20:02:49.5880658Z Test _truncate_log_json with data exceeding max_lines ... ok
2025-07-08T20:02:49.5881602Z test_truncate_log_json_max_lines_parameter (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_max_lines_parameter)
2025-07-08T20:02:49.5882537Z Test _truncate_log_json respects max_lines parameter ... ok
2025-07-08T20:02:49.5883561Z test_truncate_log_json_none_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_none_data)
2025-07-08T20:02:49.5884286Z Test _truncate_log_json with None ... ok
2025-07-08T20:02:49.5884999Z test_truncate_log_json_small_data (__main__.TestFirestoreHelperFunctions.test_truncate_log_json_small_data)
2025-07-08T20:02:49.5885837Z Test _truncate_log_json with data smaller than max_lines ... ok
2025-07-08T20:02:49.5886209Z 
2025-07-08T20:02:49.5886406Z ----------------------------------------------------------------------
2025-07-08T20:02:49.5886844Z Ran 17 tests in 0.007s
2025-07-08T20:02:49.5887042Z 
2025-07-08T20:02:49.5887160Z OK
2025-07-08T20:02:49.6259274Z ✅ mvp_site/tests/test_firestore_helper_functions_fixed.py passed
2025-07-08T20:02:49.6260849Z ----------------------------------------
2025-07-08T20:02:49.6261346Z Running mvp_site/tests/test_firestore_helpers.py...
2025-07-08T20:02:49.7014828Z ...............
2025-07-08T20:02:49.7017455Z ----------------------------------------------------------------------
2025-07-08T20:02:49.7017943Z Ran 15 tests in 0.008s
2025-07-08T20:02:49.7018147Z 
2025-07-08T20:02:49.7018262Z OK
2025-07-08T20:02:49.7119692Z ✅ mvp_site/tests/test_firestore_helpers.py passed
2025-07-08T20:02:49.7120994Z ----------------------------------------
2025-07-08T20:02:49.7121553Z Running mvp_site/tests/test_firestore_mission_handler.py...
2025-07-08T20:02:49.9707742Z test_find_existing_mission_index_empty_list (__main__.TestMissionHandler.test_find_existing_mission_index_empty_list)
2025-07-08T20:02:49.9710683Z Test find_existing_mission_index with empty list ... ok
2025-07-08T20:02:49.9711627Z test_find_existing_mission_index_found (__main__.TestMissionHandler.test_find_existing_mission_index_found)
2025-07-08T20:02:49.9712568Z Test find_existing_mission_index when mission exists ... ok
2025-07-08T20:02:49.9713899Z test_find_existing_mission_index_invalid_mission_objects (__main__.TestMissionHandler.test_find_existing_mission_index_invalid_mission_objects)
2025-07-08T20:02:49.9715076Z Test find_existing_mission_index with non-dict items in list ... ok
2025-07-08T20:02:49.9716201Z test_find_existing_mission_index_missing_mission_id (__main__.TestMissionHandler.test_find_existing_mission_index_missing_mission_id)
2025-07-08T20:02:49.9717305Z Test find_existing_mission_index when dicts lack mission_id ... ok
2025-07-08T20:02:49.9718328Z test_find_existing_mission_index_not_found (__main__.TestMissionHandler.test_find_existing_mission_index_not_found)
2025-07-08T20:02:49.9719332Z Test find_existing_mission_index when mission doesn't exist ... ok
2025-07-08T20:02:49.9720336Z test_handle_active_missions_conversion_dict (__main__.TestMissionHandler.test_handle_active_missions_conversion_dict)
2025-07-08T20:02:49.9721587Z Test handle_active_missions_conversion with dict value ... ok
2025-07-08T20:02:49.9722833Z test_handle_active_missions_conversion_invalid_type (__main__.TestMissionHandler.test_handle_active_missions_conversion_invalid_type)
2025-07-08T20:02:49.9733085Z Test handle_active_missions_conversion with non-dict, non-list value ... ok
2025-07-08T20:02:49.9736290Z test_handle_missions_dict_conversion (__main__.TestMissionHandler.test_handle_missions_dict_conversion)
2025-07-08T20:02:49.9742887Z Test handle_missions_dict_conversion with dict of missions ... ok
2025-07-08T20:02:49.9744129Z test_handle_missions_dict_conversion_empty (__main__.TestMissionHandler.test_handle_missions_dict_conversion_empty)
2025-07-08T20:02:49.9745163Z Test handle_missions_dict_conversion with empty dict ... ok
2025-07-08T20:02:49.9746256Z test_handle_missions_dict_conversion_mixed_types (__main__.TestMissionHandler.test_handle_missions_dict_conversion_mixed_types)
2025-07-08T20:02:49.9749616Z Test handle_missions_dict_conversion with various invalid types ... ok
2025-07-08T20:02:49.9760726Z test_initialize_missions_list_already_list (__main__.TestMissionHandler.test_initialize_missions_list_already_list)
2025-07-08T20:02:49.9761778Z Test initialize_missions_list when key already has a list ... ok
2025-07-08T20:02:49.9762792Z test_initialize_missions_list_missing_key (__main__.TestMissionHandler.test_initialize_missions_list_missing_key)
2025-07-08T20:02:49.9763974Z Test initialize_missions_list when key doesn't exist ... ok
2025-07-08T20:02:49.9764928Z test_initialize_missions_list_non_list_value (__main__.TestMissionHandler.test_initialize_missions_list_non_list_value)
2025-07-08T20:02:49.9765951Z Test initialize_missions_list when key exists but isn't a list ... ok
2025-07-08T20:02:49.9766827Z test_initialize_missions_list_none_value (__main__.TestMissionHandler.test_initialize_missions_list_none_value)
2025-07-08T20:02:49.9768037Z Test initialize_missions_list when key has None value ... ok
2025-07-08T20:02:49.9768908Z test_process_mission_data_adds_missing_id (__main__.TestMissionHandler.test_process_mission_data_adds_missing_id)
2025-07-08T20:02:49.9769749Z Test process_mission_data adds mission_id if missing ... ok
2025-07-08T20:02:49.9770553Z test_process_mission_data_new_mission (__main__.TestMissionHandler.test_process_mission_data_new_mission)
2025-07-08T20:02:49.9771339Z Test process_mission_data adding a new mission ... ok
2025-07-08T20:02:49.9772150Z test_process_mission_data_update_existing (__main__.TestMissionHandler.test_process_mission_data_update_existing)
2025-07-08T20:02:49.9777941Z Test process_mission_data updating an existing mission ... ok
2025-07-08T20:02:49.9778614Z 
2025-07-08T20:02:49.9778824Z ----------------------------------------------------------------------
2025-07-08T20:02:49.9779293Z Ran 17 tests in 0.006s
2025-07-08T20:02:49.9779498Z 
2025-07-08T20:02:49.9779603Z OK
2025-07-08T20:02:50.0170287Z ✅ mvp_site/tests/test_firestore_mission_handler.py passed
2025-07-08T20:02:50.0171793Z ----------------------------------------
2025-07-08T20:02:50.0172302Z Running mvp_site/tests/test_firestore_service.py...
2025-07-08T20:02:50.2823606Z .............WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2826054Z .WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2829646Z .....WARNING:root:⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:50.2830607Z ..
2025-07-08T20:02:50.2831052Z ----------------------------------------------------------------------
2025-07-08T20:02:50.2831666Z Ran 21 tests in 0.003s
2025-07-08T20:02:50.2833453Z 
2025-07-08T20:02:50.2834228Z OK
2025-07-08T20:02:50.3221914Z ✅ mvp_site/tests/test_firestore_service.py passed
2025-07-08T20:02:50.3223745Z ----------------------------------------
2025-07-08T20:02:50.3224273Z Running mvp_site/tests/test_firestore_state_helpers.py...
2025-07-08T20:02:50.5814927Z test_handle_append_syntax_core_memories_dedup (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_core_memories_dedup)
2025-07-08T20:02:50.5826377Z Test _handle_append_syntax with core_memories uses deduplication ... ok
2025-07-08T20:02:50.5829094Z test_handle_append_syntax_creates_list (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_creates_list)
2025-07-08T20:02:50.5835559Z Test _handle_append_syntax creates list if missing ... ok
2025-07-08T20:02:50.5837119Z test_handle_append_syntax_no_append_key (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_no_append_key)
2025-07-08T20:02:50.5839708Z Test _handle_append_syntax with dict missing 'append' key ... ok
2025-07-08T20:02:50.5842605Z test_handle_append_syntax_not_dict (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_not_dict)
2025-07-08T20:02:50.5843793Z Test _handle_append_syntax with non-dict value ... ok
2025-07-08T20:02:50.5844663Z test_handle_append_syntax_valid (__main__.TestFirestoreStateHelpers.test_handle_append_syntax_valid)
2025-07-08T20:02:50.5846690Z Test _handle_append_syntax with valid append syntax ... ok
2025-07-08T20:02:50.5847951Z test_handle_core_memories_safeguard_creates_list (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_creates_list)
2025-07-08T20:02:50.5856651Z Test _handle_core_memories_safeguard creates list if missing ... ok
2025-07-08T20:02:50.5858538Z test_handle_core_memories_safeguard_other_key (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_other_key)
2025-07-08T20:02:50.5859887Z Test _handle_core_memories_safeguard ignores other keys ... ok
2025-07-08T20:02:50.5861186Z test_handle_core_memories_safeguard_triggered (__main__.TestFirestoreStateHelpers.test_handle_core_memories_safeguard_triggered)
2025-07-08T20:02:50.5868302Z Test _handle_core_memories_safeguard prevents overwrite ... ok
2025-07-08T20:02:50.5869612Z test_handle_delete_token_deletes_existing (__main__.TestFirestoreStateHelpers.test_handle_delete_token_deletes_existing)
2025-07-08T20:02:50.5874909Z Test _handle_delete_token removes existing key ... ok
2025-07-08T20:02:50.5877609Z test_handle_delete_token_missing_key (__main__.TestFirestoreStateHelpers.test_handle_delete_token_missing_key)
2025-07-08T20:02:50.5880109Z Test _handle_delete_token with non-existent key ... ok
2025-07-08T20:02:50.5882561Z test_handle_delete_token_wrong_value (__main__.TestFirestoreStateHelpers.test_handle_delete_token_wrong_value)
2025-07-08T20:02:50.5883971Z Test _handle_delete_token with value not DELETE_TOKEN ... ok
2025-07-08T20:02:50.5886228Z test_handle_dict_merge_existing_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_existing_dict)
2025-07-08T20:02:50.5887158Z Test _handle_dict_merge merges with existing dict ... ok
2025-07-08T20:02:50.5888038Z test_handle_dict_merge_new_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_new_dict)
2025-07-08T20:02:50.5894936Z Test _handle_dict_merge creates new dict when key missing ... ok
2025-07-08T20:02:50.5895939Z test_handle_dict_merge_non_dict_value (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_non_dict_value)
2025-07-08T20:02:50.5896864Z Test _handle_dict_merge with non-dict value ... ok
2025-07-08T20:02:50.5897819Z test_handle_dict_merge_overwrite_non_dict (__main__.TestFirestoreStateHelpers.test_handle_dict_merge_overwrite_non_dict)
2025-07-08T20:02:50.5898899Z Test _handle_dict_merge overwrites non-dict existing value ... ok
2025-07-08T20:02:50.5899997Z test_handle_string_to_dict_update_missing_key (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_missing_key)
2025-07-08T20:02:50.5901065Z Test _handle_string_to_dict_update with missing key ... ok
2025-07-08T20:02:50.5902168Z test_handle_string_to_dict_update_non_dict_existing (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_non_dict_existing)
2025-07-08T20:02:50.5903548Z Test _handle_string_to_dict_update with non-dict existing value ... ok
2025-07-08T20:02:50.5904765Z test_handle_string_to_dict_update_overwrites_status (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_overwrites_status)
2025-07-08T20:02:50.5911291Z Test _handle_string_to_dict_update overwrites existing status ... ok
2025-07-08T20:02:50.5915829Z test_handle_string_to_dict_update_preserves_dict (__main__.TestFirestoreStateHelpers.test_handle_string_to_dict_update_preserves_dict)
2025-07-08T20:02:50.5916950Z Test _handle_string_to_dict_update preserves dict structure ... ok
2025-07-08T20:02:50.5918026Z test_update_state_with_changes_integration (__main__.TestFirestoreStateHelpers.test_update_state_with_changes_integration)
2025-07-08T20:02:50.5919112Z Test update_state_with_changes with various scenarios ... ok
2025-07-08T20:02:50.5920523Z 
2025-07-08T20:02:50.5920845Z ----------------------------------------------------------------------
2025-07-08T20:02:50.5921989Z Ran 20 tests in 0.011s
2025-07-08T20:02:50.5922209Z 
2025-07-08T20:02:50.5922313Z OK
2025-07-08T20:02:50.6307348Z ✅ mvp_site/tests/test_firestore_state_helpers.py passed
2025-07-08T20:02:50.6308778Z ----------------------------------------
2025-07-08T20:02:50.6309377Z Running mvp_site/tests/test_firestore_state_helpers_edge_cases.py...
2025-07-08T20:02:50.8917838Z test_handle_append_syntax_nested_append_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_append_syntax_nested_append_structure)
2025-07-08T20:02:50.8928140Z Test append syntax with nested append structure ... ok
2025-07-08T20:02:50.8930490Z test_handle_dict_merge_with_delete_token_in_value (__main__.TestFirestoreStateHelpersEdgeCases.test_handle_dict_merge_with_delete_token_in_value)
2025-07-08T20:02:50.8935989Z Test dict merge where new dict contains DELETE_TOKEN ... ok
2025-07-08T20:02:50.8938377Z test_update_state_complex_nested_structure (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_complex_nested_structure)
2025-07-08T20:02:50.8944962Z Test deeply nested structure updates ... ok
2025-07-08T20:02:50.8946736Z test_update_state_core_memories_multiple_attempts (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_core_memories_multiple_attempts)
2025-07-08T20:02:50.8951113Z Test multiple types of core_memories updates in one call ... ok
2025-07-08T20:02:50.8953180Z test_update_state_delete_nested_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_delete_nested_keys)
2025-07-08T20:02:50.8957436Z Test DELETE_TOKEN on nested dictionary keys ... ok
2025-07-08T20:02:50.8959285Z test_update_state_empty_changes (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_empty_changes)
2025-07-08T20:02:50.8960581Z Test update_state_with_changes with empty changes dict ... ok
2025-07-08T20:02:50.8961579Z test_update_state_list_overwrite (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_list_overwrite)
2025-07-08T20:02:50.8962611Z Test that non-append list updates do overwrite ... ok
2025-07-08T20:02:50.8965089Z test_update_state_nested_append_syntax (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_nested_append_syntax)
2025-07-08T20:02:50.8968108Z Test nested append syntax in dict values ... ok
2025-07-08T20:02:50.8969929Z test_update_state_none_values (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_none_values)
2025-07-08T20:02:50.8970842Z Test update_state_with_changes with None values ... ok
2025-07-08T20:02:50.8971859Z test_update_state_preserve_unchanged_keys (__main__.TestFirestoreStateHelpersEdgeCases.test_update_state_preserve_unchanged_keys)
2025-07-08T20:02:50.8972848Z Test that unchanged keys are preserved ... ok
2025-07-08T20:02:50.8974386Z 
2025-07-08T20:02:50.8974714Z ----------------------------------------------------------------------
2025-07-08T20:02:50.8975841Z Ran 10 tests in 0.006s
2025-07-08T20:02:50.8976046Z 
2025-07-08T20:02:50.8976161Z OK
2025-07-08T20:02:50.9350681Z ✅ mvp_site/tests/test_firestore_state_helpers_edge_cases.py passed
2025-07-08T20:02:50.9352199Z ----------------------------------------
2025-07-08T20:02:50.9352702Z Running mvp_site/tests/test_game_state.py...
2025-07-08T20:02:51.8634424Z ....................2025-07-08 20:02:51,863 - INFO - Performing one-time cleanup. Deleting 3 legacy keys: ['player.name', 'player.level', 'world.location']
2025-07-08T20:02:51.8636973Z .2025-07-08 20:02:51,863 - INFO - Performing one-time cleanup. Deleting 1 legacy keys: ['world_time']
2025-07-08T20:02:51.8640052Z .......2025-07-08 20:02:51,863 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: invalid_key = invalid_json
2025-07-08T20:02:51.8642649Z ....2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 7 new items to 'test_key'.
2025-07-08T20:02:51.8645264Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: No new items were added to 'test_key' (duplicates may have been found).
2025-07-08T20:02:51.8646316Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T20:02:51.8647609Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T20:02:51.8649508Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'test_key'.
2025-07-08T20:02:51.8650523Z .2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'test_key'.
2025-07-08T20:02:51.8651354Z .2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8652012Z   "core_memories": [
2025-07-08T20:02:51.8652368Z     "memory2",
2025-07-08T20:02:51.8652694Z     "memory3"
2025-07-08T20:02:51.8652994Z   ]
2025-07-08T20:02:51.8653445Z }
2025-07-08T20:02:51.8654587Z 2025-07-08 20:02:51,864 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8655833Z 2025-07-08 20:02:51,864 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T20:02:51.8656569Z 2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8657708Z .2025-07-08 20:02:51,864 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8659354Z   "core_memories": [
2025-07-08T20:02:51.8660128Z     "new_memory1",
2025-07-08T20:02:51.8660475Z     "new_memory2"
2025-07-08T20:02:51.8660798Z   ]
2025-07-08T20:02:51.8661068Z }
2025-07-08T20:02:51.8662190Z 2025-07-08 20:02:51,865 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8663653Z 2025-07-08 20:02:51,865 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T20:02:51.8664494Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8665586Z .2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8666238Z   "core_memories": [
2025-07-08T20:02:51.8666591Z     "memory1",
2025-07-08T20:02:51.8666907Z     "memory2"
2025-07-08T20:02:51.8667221Z   ]
2025-07-08T20:02:51.8667509Z }
2025-07-08T20:02:51.8668564Z 2025-07-08 20:02:51,865 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8669779Z 2025-07-08 20:02:51,865 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'core_memories'.
2025-07-08T20:02:51.8670607Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8671393Z .2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8671983Z   "level1": {
2025-07-08T20:02:51.8672277Z     "level2": {
2025-07-08T20:02:51.8672595Z       "level3": {
2025-07-08T20:02:51.8672928Z         "value": "new",
2025-07-08T20:02:51.8673590Z         "add": "this"
2025-07-08T20:02:51.8673945Z       }
2025-07-08T20:02:51.8674232Z     }
2025-07-08T20:02:51.8674522Z   }
2025-07-08T20:02:51.8674810Z }
2025-07-08T20:02:51.8675300Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8675950Z   "level2": {
2025-07-08T20:02:51.8676275Z     "level3": {
2025-07-08T20:02:51.8676602Z       "value": "new",
2025-07-08T20:02:51.8676937Z       "add": "this"
2025-07-08T20:02:51.8677252Z     }
2025-07-08T20:02:51.8677522Z   }
2025-07-08T20:02:51.8677782Z }
2025-07-08T20:02:51.8678275Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8678894Z   "level3": {
2025-07-08T20:02:51.8679209Z     "value": "new",
2025-07-08T20:02:51.8679538Z     "add": "this"
2025-07-08T20:02:51.8679858Z   }
2025-07-08T20:02:51.8680126Z }
2025-07-08T20:02:51.8680614Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8681218Z   "value": "new",
2025-07-08T20:02:51.8681526Z   "add": "this"
2025-07-08T20:02:51.8681822Z }
2025-07-08T20:02:51.8682247Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8684793Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8685585Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8686339Z 2025-07-08 20:02:51,865 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8687117Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8687808Z   "items": {
2025-07-08T20:02:51.8688134Z     "append": [
2025-07-08T20:02:51.8688459Z       "potion",
2025-07-08T20:02:51.8688773Z       "key"
2025-07-08T20:02:51.8689072Z     ]
2025-07-08T20:02:51.8689350Z   }
2025-07-08T20:02:51.8689634Z }
2025-07-08T20:02:51.8690160Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'items'.
2025-07-08T20:02:51.8690982Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'items'.
2025-07-08T20:02:51.8691763Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8692777Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8693607Z   "key": {
2025-07-08T20:02:51.8693906Z     "append": [
2025-07-08T20:02:51.8694221Z       "item1"
2025-07-08T20:02:51.8694535Z     ]
2025-07-08T20:02:51.8694809Z   }
2025-07-08T20:02:51.8695082Z }
2025-07-08T20:02:51.8695579Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'key'.
2025-07-08T20:02:51.8696343Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'key'.
2025-07-08T20:02:51.8697076Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8697849Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8698714Z   "new_list": {
2025-07-08T20:02:51.8699053Z     "append": [
2025-07-08T20:02:51.8699372Z       "item1",
2025-07-08T20:02:51.8699680Z       "item2"
2025-07-08T20:02:51.8699980Z     ]
2025-07-08T20:02:51.8700264Z   }
2025-07-08T20:02:51.8700525Z }
2025-07-08T20:02:51.8701002Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'new_list'.
2025-07-08T20:02:51.8701755Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'new_list'.
2025-07-08T20:02:51.8702442Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8703179Z .2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8703904Z   "player": {
2025-07-08T20:02:51.8704167Z     "level": 2,
2025-07-08T20:02:51.8704414Z     "gold": 100
2025-07-08T20:02:51.8704666Z   },
2025-07-08T20:02:51.8704907Z   "inventory": {
2025-07-08T20:02:51.8705187Z     "append": [
2025-07-08T20:02:51.8705458Z       "potion"
2025-07-08T20:02:51.8705719Z     ]
2025-07-08T20:02:51.8705939Z   },
2025-07-08T20:02:51.8706182Z   "core_memories": [
2025-07-08T20:02:51.8706472Z     "memory1",
2025-07-08T20:02:51.8706734Z     "memory2"
2025-07-08T20:02:51.8706980Z   ],
2025-07-08T20:02:51.8707233Z   "simple_value": "new",
2025-07-08T20:02:51.8707546Z   "new_key": "new_value"
2025-07-08T20:02:51.8707833Z }
2025-07-08T20:02:51.8708234Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8708748Z   "level": 2,
2025-07-08T20:02:51.8708998Z   "gold": 100
2025-07-08T20:02:51.8709245Z }
2025-07-08T20:02:51.8709598Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8710242Z 2025-07-08 20:02:51,866 - INFO - update_state: Detected explicit append for 'inventory'.
2025-07-08T20:02:51.8710926Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'inventory'.
2025-07-08T20:02:51.8712117Z 2025-07-08 20:02:51,866 - WARNING - ⚠️ CRITICAL SAFEGUARD: Intercepted direct overwrite on 'core_memories'. Converting to safe, deduplicated append.
2025-07-08T20:02:51.8713120Z 2025-07-08 20:02:51,866 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'core_memories'.
2025-07-08T20:02:51.8713967Z 2025-07-08 20:02:51,866 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8714604Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8715095Z   "player": {
2025-07-08T20:02:51.8715345Z     "level": 2,
2025-07-08T20:02:51.8715620Z     "stats": {
2025-07-08T20:02:51.8715868Z       "mp": 50
2025-07-08T20:02:51.8716107Z     }
2025-07-08T20:02:51.8716326Z   },
2025-07-08T20:02:51.8716553Z   "world": {
2025-07-08T20:02:51.8716807Z     "weather": "sunny"
2025-07-08T20:02:51.8717086Z   }
2025-07-08T20:02:51.8717324Z }
2025-07-08T20:02:51.8717733Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8718237Z   "level": 2,
2025-07-08T20:02:51.8718504Z   "stats": {
2025-07-08T20:02:51.8718752Z     "mp": 50
2025-07-08T20:02:51.8718991Z   }
2025-07-08T20:02:51.8719204Z }
2025-07-08T20:02:51.8719580Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8720092Z   "mp": 50
2025-07-08T20:02:51.8720533Z }
2025-07-08T20:02:51.8720908Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8721497Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8722130Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8722626Z   "weather": "sunny"
2025-07-08T20:02:51.8722895Z }
2025-07-08T20:02:51.8723380Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8723974Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8724599Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8725306Z   "key1": "new_value",
2025-07-08T20:02:51.8725590Z   "key3": "added_value"
2025-07-08T20:02:51.8725867Z }
2025-07-08T20:02:51.8726215Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8726831Z .2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8727349Z   "game_data": {
2025-07-08T20:02:51.8727618Z     "player_info": {
2025-07-08T20:02:51.8727903Z       "character_sheet": {
2025-07-08T20:02:51.8728225Z         "name": "UpdatedHero",
2025-07-08T20:02:51.8728552Z         "level": 5,
2025-07-08T20:02:51.8728838Z         "health_ratio": 0.8,
2025-07-08T20:02:51.8729161Z         "is_active": false,
2025-07-08T20:02:51.8729474Z         "special_items": [
2025-07-08T20:02:51.8729773Z           "magic_ring"
2025-07-08T20:02:51.8730046Z         ],
2025-07-08T20:02:51.8730289Z         "skills": {
2025-07-08T20:02:51.8730555Z           "append": [
2025-07-08T20:02:51.8730852Z             "fireball",
2025-07-08T20:02:51.8731142Z             "heal"
2025-07-08T20:02:51.8731396Z           ]
2025-07-08T20:02:51.8731634Z         },
2025-07-08T20:02:51.8731885Z         "attributes": {
2025-07-08T20:02:51.8732175Z           "strength": 15,
2025-07-08T20:02:51.8732507Z ... (truncated, showing 19/60 lines)
2025-07-08T20:02:51.8733036Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8733722Z   "player_info": {
2025-07-08T20:02:51.8734008Z     "character_sheet": {
2025-07-08T20:02:51.8734317Z       "name": "UpdatedHero",
2025-07-08T20:02:51.8734626Z       "level": 5,
2025-07-08T20:02:51.8734903Z       "health_ratio": 0.8,
2025-07-08T20:02:51.8735231Z       "is_active": false,
2025-07-08T20:02:51.8735530Z       "special_items": [
2025-07-08T20:02:51.8735824Z         "magic_ring"
2025-07-08T20:02:51.8736128Z       ],
2025-07-08T20:02:51.8736373Z       "skills": {
2025-07-08T20:02:51.8736643Z         "append": [
2025-07-08T20:02:51.8736940Z           "fireball",
2025-07-08T20:02:51.8737215Z           "heal"
2025-07-08T20:02:51.8737471Z         ]
2025-07-08T20:02:51.8737711Z       },
2025-07-08T20:02:51.8737950Z       "attributes": {
2025-07-08T20:02:51.8738230Z         "strength": 15,
2025-07-08T20:02:51.8738532Z         "wisdom": 14
2025-07-08T20:02:51.8738834Z ... (truncated, showing 19/23 lines)
2025-07-08T20:02:51.8739359Z 2025-07-08 20:02:51,867 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8739869Z   "character_sheet": {
2025-07-08T20:02:51.8740171Z     "name": "UpdatedHero",
2025-07-08T20:02:51.8740474Z     "level": 5,
2025-07-08T20:02:51.8740742Z     "health_ratio": 0.8,
2025-07-08T20:02:51.8741039Z     "is_active": false,
2025-07-08T20:02:51.8741328Z     "special_items": [
2025-07-08T20:02:51.8741608Z       "magic_ring"
2025-07-08T20:02:51.8741885Z     ],
2025-07-08T20:02:51.8742141Z     "skills": {
2025-07-08T20:02:51.8742409Z       "append": [
2025-07-08T20:02:51.8742671Z         "fireball",
2025-07-08T20:02:51.8742938Z         "heal"
2025-07-08T20:02:51.8743184Z       ]
2025-07-08T20:02:51.8743572Z     },
2025-07-08T20:02:51.8743812Z     "attributes": {
2025-07-08T20:02:51.8744085Z       "strength": 15,
2025-07-08T20:02:51.8744365Z       "wisdom": 14
2025-07-08T20:02:51.8744617Z     }
2025-07-08T20:02:51.8745066Z ... (truncated, showing 19/21 lines)
2025-07-08T20:02:51.8745578Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8746099Z   "name": "UpdatedHero",
2025-07-08T20:02:51.8746401Z   "level": 5,
2025-07-08T20:02:51.8746656Z   "health_ratio": 0.8,
2025-07-08T20:02:51.8746951Z   "is_active": false,
2025-07-08T20:02:51.8747246Z   "special_items": [
2025-07-08T20:02:51.8747514Z     "magic_ring"
2025-07-08T20:02:51.8747774Z   ],
2025-07-08T20:02:51.8748005Z   "skills": {
2025-07-08T20:02:51.8748249Z     "append": [
2025-07-08T20:02:51.8748513Z       "fireball",
2025-07-08T20:02:51.8748771Z       "heal"
2025-07-08T20:02:51.8749192Z     ]
2025-07-08T20:02:51.8749412Z   },
2025-07-08T20:02:51.8749649Z   "attributes": {
2025-07-08T20:02:51.8749911Z     "strength": 15,
2025-07-08T20:02:51.8750177Z     "wisdom": 14
2025-07-08T20:02:51.8750422Z   }
2025-07-08T20:02:51.8750634Z }
2025-07-08T20:02:51.8751037Z 2025-07-08 20:02:51,868 - INFO - update_state: Detected explicit append for 'skills'.
2025-07-08T20:02:51.8751678Z 2025-07-08 20:02:51,868 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'skills'.
2025-07-08T20:02:51.8752315Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8752810Z   "strength": 15,
2025-07-08T20:02:51.8753079Z   "wisdom": 14
2025-07-08T20:02:51.8753458Z }
2025-07-08T20:02:51.8754499Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8755374Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8756204Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8757087Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8757885Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8758586Z   "environment": {
2025-07-08T20:02:51.8759059Z     "current_location": {
2025-07-08T20:02:51.8759553Z       "danger_level": 2,
2025-07-08T20:02:51.8760052Z       "weather_factor": 0.3,
2025-07-08T20:02:51.8760588Z       "is_discovered": false,
2025-07-08T20:02:51.8761106Z       "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8761608Z       "npcs": {
2025-07-08T20:02:51.8762062Z         "append": [
2025-07-08T20:02:51.8762651Z           "merchant",
2025-07-08T20:02:51.8763105Z           "guard"
2025-07-08T20:02:51.8763726Z         ]
2025-07-08T20:02:51.8764304Z       },
2025-07-08T20:02:51.8764789Z       "connections": {
2025-07-08T20:02:51.8765292Z         "east": "mountain",
2025-07-08T20:02:51.8765774Z         "west": null
2025-07-08T20:02:51.8766185Z       }
2025-07-08T20:02:51.8766565Z     }
2025-07-08T20:02:51.8766991Z   }
2025-07-08T20:02:51.8767448Z }
2025-07-08T20:02:51.8768086Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8768929Z   "current_location": {
2025-07-08T20:02:51.8769563Z     "danger_level": 2,
2025-07-08T20:02:51.8770201Z     "weather_factor": 0.3,
2025-07-08T20:02:51.8770680Z     "is_discovered": false,
2025-07-08T20:02:51.8772294Z     "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8772642Z     "npcs": {
2025-07-08T20:02:51.8772904Z       "append": [
2025-07-08T20:02:51.8773335Z         "merchant",
2025-07-08T20:02:51.8773619Z         "guard"
2025-07-08T20:02:51.8773906Z       ]
2025-07-08T20:02:51.8774164Z     },
2025-07-08T20:02:51.8774432Z     "connections": {
2025-07-08T20:02:51.8774748Z       "east": "mountain",
2025-07-08T20:02:51.8775047Z       "west": null
2025-07-08T20:02:51.8775297Z     }
2025-07-08T20:02:51.8775523Z   }
2025-07-08T20:02:51.8775753Z }
2025-07-08T20:02:51.8776158Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8776659Z   "danger_level": 2,
2025-07-08T20:02:51.8776963Z   "weather_factor": 0.3,
2025-07-08T20:02:51.8777271Z   "is_discovered": false,
2025-07-08T20:02:51.8777784Z   "hidden_treasure": "gold_coins",
2025-07-08T20:02:51.8778129Z   "npcs": {
2025-07-08T20:02:51.8778373Z     "append": [
2025-07-08T20:02:51.8778631Z       "merchant",
2025-07-08T20:02:51.8778901Z       "guard"
2025-07-08T20:02:51.8779140Z     ]
2025-07-08T20:02:51.8779360Z   },
2025-07-08T20:02:51.8779594Z   "connections": {
2025-07-08T20:02:51.8779873Z     "east": "mountain",
2025-07-08T20:02:51.8780148Z     "west": null
2025-07-08T20:02:51.8780399Z   }
2025-07-08T20:02:51.8780620Z }
2025-07-08T20:02:51.8781003Z 2025-07-08 20:02:51,868 - INFO - update_state: Detected explicit append for 'npcs'.
2025-07-08T20:02:51.8781651Z 2025-07-08 20:02:51,868 - INFO - APPEND/SAFEGUARD: Added 2 new items to 'npcs'.
2025-07-08T20:02:51.8782467Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8782966Z   "east": "mountain",
2025-07-08T20:02:51.8783405Z   "west": null
2025-07-08T20:02:51.8783664Z }
2025-07-08T20:02:51.8784025Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8784643Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8785221Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8785778Z 2025-07-08 20:02:51,868 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8786353Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8786865Z   "session_info": {
2025-07-08T20:02:51.8787177Z     "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T20:02:51.8787520Z     "session_id": 12345,
2025-07-08T20:02:51.8787866Z     "is_tutorial": false,
2025-07-08T20:02:51.8788171Z     "notes": null,
2025-07-08T20:02:51.8788440Z     "participants": [
2025-07-08T20:02:51.8788732Z       "player1"
2025-07-08T20:02:51.8788985Z     ],
2025-07-08T20:02:51.8789228Z     "settings": {
2025-07-08T20:02:51.8789508Z       "difficulty": "normal",
2025-07-08T20:02:51.8789829Z       "auto_save": true
2025-07-08T20:02:51.8790106Z     }
2025-07-08T20:02:51.8790333Z   }
2025-07-08T20:02:51.8790555Z }
2025-07-08T20:02:51.8790946Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8791461Z   "start_time": "2023-06-15 14:30:45+00:00",
2025-07-08T20:02:51.8791820Z   "session_id": 12345,
2025-07-08T20:02:51.8792111Z   "is_tutorial": false,
2025-07-08T20:02:51.8792391Z   "notes": null,
2025-07-08T20:02:51.8792669Z   "participants": [
2025-07-08T20:02:51.8792947Z     "player1"
2025-07-08T20:02:51.8793330Z   ],
2025-07-08T20:02:51.8793573Z   "settings": {
2025-07-08T20:02:51.8793847Z     "difficulty": "normal",
2025-07-08T20:02:51.8794150Z     "auto_save": true
2025-07-08T20:02:51.8794422Z   }
2025-07-08T20:02:51.8794643Z }
2025-07-08T20:02:51.8795014Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8795518Z   "difficulty": "normal",
2025-07-08T20:02:51.8795817Z   "auto_save": true
2025-07-08T20:02:51.8796081Z }
2025-07-08T20:02:51.8796429Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8797009Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8797593Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8798144Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8798744Z .2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8799233Z   "container1": {
2025-07-08T20:02:51.8799498Z     "container2": {
2025-07-08T20:02:51.8799768Z       "container3": {
2025-07-08T20:02:51.8800062Z         "empty_list": {
2025-07-08T20:02:51.8800357Z           "append": [
2025-07-08T20:02:51.8800636Z             "first_item"
2025-07-08T20:02:51.8800918Z           ]
2025-07-08T20:02:51.8801152Z         },
2025-07-08T20:02:51.8801393Z         "empty_dict": {
2025-07-08T20:02:51.8801858Z           "new_key": "new_value"
2025-07-08T20:02:51.8802186Z         },
2025-07-08T20:02:51.8802424Z         "zero_int": 42,
2025-07-08T20:02:51.8802709Z         "zero_float": 3.14,
2025-07-08T20:02:51.8803019Z         "false_bool": true,
2025-07-08T20:02:51.8803486Z         "empty_string": "now_has_content",
2025-07-08T20:02:51.8803872Z         "completely_new": "brand_new_value"
2025-07-08T20:02:51.8804221Z       }
2025-07-08T20:02:51.8804448Z     }
2025-07-08T20:02:51.8804700Z ... (truncated, showing 19/21 lines)
2025-07-08T20:02:51.8805186Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8805676Z   "container2": {
2025-07-08T20:02:51.8805947Z     "container3": {
2025-07-08T20:02:51.8806395Z       "empty_list": {
2025-07-08T20:02:51.8806669Z         "append": [
2025-07-08T20:02:51.8806940Z           "first_item"
2025-07-08T20:02:51.8807213Z         ]
2025-07-08T20:02:51.8807446Z       },
2025-07-08T20:02:51.8807677Z       "empty_dict": {
2025-07-08T20:02:51.8807968Z         "new_key": "new_value"
2025-07-08T20:02:51.8808279Z       },
2025-07-08T20:02:51.8808513Z       "zero_int": 42,
2025-07-08T20:02:51.8808790Z       "zero_float": 3.14,
2025-07-08T20:02:51.8809083Z       "false_bool": true,
2025-07-08T20:02:51.8809392Z       "empty_string": "now_has_content",
2025-07-08T20:02:51.8809772Z       "completely_new": "brand_new_value"
2025-07-08T20:02:51.8810116Z     }
2025-07-08T20:02:51.8810331Z   }
2025-07-08T20:02:51.8810553Z }
2025-07-08T20:02:51.8810940Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8811432Z   "container3": {
2025-07-08T20:02:51.8811687Z     "empty_list": {
2025-07-08T20:02:51.8811967Z       "append": [
2025-07-08T20:02:51.8812236Z         "first_item"
2025-07-08T20:02:51.8812493Z       ]
2025-07-08T20:02:51.8812730Z     },
2025-07-08T20:02:51.8812979Z     "empty_dict": {
2025-07-08T20:02:51.8813399Z       "new_key": "new_value"
2025-07-08T20:02:51.8813706Z     },
2025-07-08T20:02:51.8813951Z     "zero_int": 42,
2025-07-08T20:02:51.8814224Z     "zero_float": 3.14,
2025-07-08T20:02:51.8814519Z     "false_bool": true,
2025-07-08T20:02:51.8814831Z     "empty_string": "now_has_content",
2025-07-08T20:02:51.8815210Z     "completely_new": "brand_new_value"
2025-07-08T20:02:51.8815554Z   }
2025-07-08T20:02:51.8815783Z }
2025-07-08T20:02:51.8816162Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8816656Z   "empty_list": {
2025-07-08T20:02:51.8816926Z     "append": [
2025-07-08T20:02:51.8817179Z       "first_item"
2025-07-08T20:02:51.8817426Z     ]
2025-07-08T20:02:51.8817653Z   },
2025-07-08T20:02:51.8817883Z   "empty_dict": {
2025-07-08T20:02:51.8818156Z     "new_key": "new_value"
2025-07-08T20:02:51.8818450Z   },
2025-07-08T20:02:51.8818682Z   "zero_int": 42,
2025-07-08T20:02:51.8818940Z   "zero_float": 3.14,
2025-07-08T20:02:51.8819231Z   "false_bool": true,
2025-07-08T20:02:51.8819542Z   "empty_string": "now_has_content",
2025-07-08T20:02:51.8819910Z   "completely_new": "brand_new_value"
2025-07-08T20:02:51.8820255Z }
2025-07-08T20:02:51.8820672Z 2025-07-08 20:02:51,869 - INFO - update_state: Detected explicit append for 'empty_list'.
2025-07-08T20:02:51.8821338Z 2025-07-08 20:02:51,869 - INFO - APPEND/SAFEGUARD: Added 1 new items to 'empty_list'.
2025-07-08T20:02:51.8821979Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:51.8822478Z   "new_key": "new_value"
2025-07-08T20:02:51.8822758Z }
2025-07-08T20:02:51.8823109Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8823827Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8824406Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8824954Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8825692Z 2025-07-08 20:02:51,869 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:51.8826151Z .
2025-07-08T20:02:51.8826465Z ----------------------------------------------------------------------
2025-07-08T20:02:51.8826912Z Ran 50 tests in 0.009s
2025-07-08T20:02:51.8827103Z 
2025-07-08T20:02:51.8827199Z OK
2025-07-08T20:02:52.0459475Z ✅ mvp_site/tests/test_game_state.py passed
2025-07-08T20:02:52.0462155Z ----------------------------------------
2025-07-08T20:02:52.0464804Z Running mvp_site/tests/test_gemini_response.py...
2025-07-08T20:02:52.6748958Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6759431Z   @validator('strength', pre=True)
2025-07-08T20:02:52.6762129Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6764973Z   @validator('dexterity', pre=True)
2025-07-08T20:02:52.6767622Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6770316Z   @validator('constitution', pre=True)
2025-07-08T20:02:52.6772971Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6782805Z   @validator('intelligence', pre=True)
2025-07-08T20:02:52.6785653Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6788294Z   @validator('wisdom', pre=True)
2025-07-08T20:02:52.6790949Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6798788Z   @validator('charisma', pre=True)
2025-07-08T20:02:52.6801362Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6804224Z   @validator('hp', pre=True)
2025-07-08T20:02:52.6818884Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6821602Z   @validator('hp_max', pre=True)
2025-07-08T20:02:52.6824382Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6827256Z   @validator('temp_hp', pre=True)
2025-07-08T20:02:52.6838036Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6842299Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:02:52.6867518Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6877280Z   @validator('level', pre=True)
2025-07-08T20:02:52.6879924Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6882577Z   @validator('gender')
2025-07-08T20:02:52.6885330Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6887966Z   @validator('age')
2025-07-08T20:02:52.6890592Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6893451Z   @validator('mbti')
2025-07-08T20:02:52.6896020Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6898702Z   @validator('alignment')
2025-07-08T20:02:52.6901453Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.6904269Z   @validator('entity_type')
2025-07-08T20:02:52.7046085Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7051056Z   @validator('participants')
2025-07-08T20:02:52.7063041Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7066804Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:02:52.7069769Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:02:52.7072482Z   @validator('present_entities')
2025-07-08T20:02:52.7176170Z 2025-07-08 20:02:52,717 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:02:52.7180722Z 2025-07-08 20:02:52,717 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:52.7183661Z 2025-07-08 20:02:52,717 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:52.7189439Z 2025-07-08 20:02:52,718 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:52.7194820Z 2025-07-08 20:02:52,719 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:52.7210300Z 2025-07-08 20:02:52,720 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:52.7211871Z 2025-07-08 20:02:52,720 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:52.7214988Z 2025-07-08 20:02:52,720 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:52.7215914Z 2025-07-08 20:02:52,720 - INFO - Starting dual-pass generation
2025-07-08T20:02:52.7216619Z 2025-07-08 20:02:52,721 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:52.7217432Z 2025-07-08 20:02:52,721 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:52.7229288Z 2025-07-08 20:02:52,721 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:52.7230173Z 2025-07-08 20:02:52,721 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:52.7230890Z 2025-07-08 20:02:52,721 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:52.7231601Z 2025-07-08 20:02:52,721 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:52.7232454Z 2025-07-08 20:02:52,721 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:52.7233774Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:52.7234600Z 2025-07-08 20:02:52,722 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:52.7235697Z 2025-07-08 20:02:52,722 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:52.7236669Z 2025-07-08 20:02:52,722 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:52.7237825Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:52.7238782Z 2025-07-08 20:02:52,722 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:52.7252758Z ......2025-07-08 20:02:52,725 - WARNING - ⚠️ No specific system prompts selected for initial story. Using none.
2025-07-08T20:02:52.7261185Z 2025-07-08 20:02:52,725 - INFO - Using model: gemini-1.5-flash for initial story generation.
2025-07-08T20:02:52.7266807Z .2025-07-08 20:02:52,726 - WARNING - Using deprecated create_legacy method. Switch to create() with raw response.
2025-07-08T20:02:52.7278867Z ...2025-07-08 20:02:52,727 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:52.7280230Z 2025-07-08 20:02:52,727 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:02:52.7283097Z 2025-07-08 20:02:52,727 - INFO - Recovered from incomplete JSON response. Narrative length: 42 characters (~10 tokens)
2025-07-08T20:02:52.7283980Z ..
2025-07-08T20:02:52.7284334Z ----------------------------------------------------------------------
2025-07-08T20:02:52.7284799Z Ran 12 tests in 0.616s
2025-07-08T20:02:52.7285000Z 
2025-07-08T20:02:52.7285102Z OK
2025-07-08T20:02:52.8000020Z ✅ mvp_site/tests/test_gemini_response.py passed
2025-07-08T20:02:52.8001462Z ----------------------------------------
2025-07-08T20:02:52.8001968Z Running mvp_site/tests/test_generator_isolated.py...
2025-07-08T20:02:53.2204136Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:579: ResourceWarning: unclosed file <_io.BufferedReader name='/tmp/tmp5gzrqg4p.pdf'>
2025-07-08T20:02:53.2205365Z   if method() is not None:
2025-07-08T20:02:53.2205945Z ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-07-08T20:02:53.2206564Z .
2025-07-08T20:02:53.2206947Z ----------------------------------------------------------------------
2025-07-08T20:02:53.2207476Z Ran 1 test in 0.098s
2025-07-08T20:02:53.2207672Z 
2025-07-08T20:02:53.2207774Z OK
2025-07-08T20:02:53.2208082Z \n--- Running PDF Generation Test ---
2025-07-08T20:02:53.2208493Z INFO: DejaVuSans.ttf found and loaded.
2025-07-08T20:02:53.2208929Z --- PDF Generation Test Finished Successfully ---
2025-07-08T20:02:53.2847935Z ✅ mvp_site/tests/test_generator_isolated.py passed
2025-07-08T20:02:53.2851480Z ----------------------------------------
2025-07-08T20:02:53.2852070Z Running mvp_site/tests/test_god_mode_json_display_red_green.py...
2025-07-08T20:02:53.3300908Z .......
2025-07-08T20:02:53.3303523Z ----------------------------------------------------------------------
2025-07-08T20:02:53.3304076Z Ran 7 tests in 0.001s
2025-07-08T20:02:53.3304307Z 
2025-07-08T20:02:53.3304423Z OK
2025-07-08T20:02:53.3369850Z ✅ mvp_site/tests/test_god_mode_json_display_red_green.py passed
2025-07-08T20:02:53.3371200Z ----------------------------------------
2025-07-08T20:02:53.3371734Z Running mvp_site/tests/test_god_mode_json_logging_bug.py...
2025-07-08T20:02:53.3827891Z ....
2025-07-08T20:02:53.3828326Z POTENTIAL BUG: Double JSON encoding detected
2025-07-08T20:02:53.3828888Z BUG DETECTED: Raw JSON would be logged instead of narrative
2025-07-08T20:02:53.3829799Z ----------------------------------------------------------------------
2025-07-08T20:02:53.3830403Z Ran 4 tests in 0.000s
2025-07-08T20:02:53.3831414Z 
2025-07-08T20:02:53.3831552Z OK
2025-07-08T20:02:53.3897873Z ✅ mvp_site/tests/test_god_mode_json_logging_bug.py passed
2025-07-08T20:02:53.3899226Z ----------------------------------------
2025-07-08T20:02:53.3899782Z Running mvp_site/tests/test_god_mode_response_field.py...
2025-07-08T20:02:53.4348493Z ........
2025-07-08T20:02:53.4350720Z ----------------------------------------------------------------------
2025-07-08T20:02:53.4351261Z Ran 8 tests in 0.001s
2025-07-08T20:02:53.4351958Z 
2025-07-08T20:02:53.4352214Z OK
2025-07-08T20:02:53.4415717Z ✅ mvp_site/tests/test_god_mode_response_field.py passed
2025-07-08T20:02:53.4417058Z ----------------------------------------
2025-07-08T20:02:53.4417625Z Running mvp_site/tests/test_god_mode_response_parsing_debug.py...
2025-07-08T20:02:53.4965840Z test_check_narrative_response_schema (__main__.TestGodModeResponseParsingDebug.test_check_narrative_response_schema)
2025-07-08T20:02:53.4966774Z NarrativeResponse fields: {}
2025-07-08T20:02:53.4969450Z Check if NarrativeResponse schema supports god_mode_response field. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_check_narrative_response_schema of <__main__.TestGodModeResponseParsingDebug testMethod=test_check_narrative_response_schema>>)
2025-07-08T20:02:53.4981142Z   return self.run(*args, **kwds)
2025-07-08T20:02:53.4981578Z ok
2025-07-08T20:02:53.4982350Z test_luke_campaign_scene_31_exact_debug (__main__.TestGodModeResponseParsingDebug.test_luke_campaign_scene_31_exact_debug)
2025-07-08T20:02:53.4983615Z Debug the exact Scene #31 response from Luke's campaign. ... ok
2025-07-08T20:02:53.4984768Z test_narrative_response_creation_with_god_mode (__main__.TestGodModeResponseParsingDebug.test_narrative_response_creation_with_god_mode)
2025-07-08T20:02:53.4985938Z Test if NarrativeResponse creation fails with god mode data. ... ok
2025-07-08T20:02:53.4986853Z test_simulate_parsing_paths (__main__.TestGodModeResponseParsingDebug.test_simulate_parsing_paths)
2025-07-08T20:02:53.4989556Z Simulate different parsing paths to see which one is taken. ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestGodModeResponseParsingDebug.test_simulate_parsing_paths of <__main__.TestGodModeResponseParsingDebug testMethod=test_simulate_parsing_paths>>)
2025-07-08T20:02:53.4991688Z   return self.run(*args, **kwds)
2025-07-08T20:02:53.4992044Z ok
2025-07-08T20:02:53.4992198Z 
2025-07-08T20:02:53.4992423Z ----------------------------------------------------------------------
2025-07-08T20:02:53.4992911Z Ran 4 tests in 0.001s
2025-07-08T20:02:53.4993116Z 
2025-07-08T20:02:53.4993362Z OK
2025-07-08T20:02:53.4993676Z God mode response creation succeeded
2025-07-08T20:02:53.4994879Z JSON parsing successful. Keys: ['narrative', 'god_mode_response', 'entities_mentioned', 'location_confirmed', 'state_updates', 'debug_info']
2025-07-08T20:02:53.4995829Z narrative: ''
2025-07-08T20:02:53.4996234Z god_mode_response length: 1322
2025-07-08T20:02:53.4996737Z parse_structured_response succeeded
2025-07-08T20:02:53.4997755Z Returned narrative_text: 'That's another excellent point, and I understand why you'd expect EXP for such a significant and imp...' (length: 1322)
2025-07-08T20:02:53.4999001Z Structured response type: <class 'narrative_response_schema.NarrativeResponse'>
2025-07-08T20:02:53.5000439Z NarrativeResponse creation succeeded
2025-07-08T20:02:53.5000879Z Has god_mode_response attr: True
2025-07-08T20:02:53.5001317Z god_mode_response value: Test god mode response
2025-07-08T20:02:53.5001816Z MAIN PATH: NarrativeResponse creation succeeded
2025-07-08T20:02:53.5002306Z MAIN PATH: god_mode_response detected
2025-07-08T20:02:53.5002856Z MAIN PATH: Combined response: 'Test response for path debugging'
2025-07-08T20:02:53.5046028Z ✅ mvp_site/tests/test_god_mode_response_parsing_debug.py passed
2025-07-08T20:02:53.5046821Z ----------------------------------------
2025-07-08T20:02:53.5047445Z Running mvp_site/tests/test_hp_unknown_values.py...
2025-07-08T20:02:53.6789959Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6791690Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6798569Z .WARNING:root:⚠️ Failed to convert '' to int for field 'hp'. Using default: 1
2025-07-08T20:02:53.6800487Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6801387Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp'. Using default: 1
2025-07-08T20:02:53.6802335Z .WARNING:root:⚠️ Failed to convert 'not_a_number' to int for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6803170Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6804116Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:02:53.6804866Z .WARNING:root:⚠️ Invalid value 'None' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6805878Z ..WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:02:53.6806382Z ....
2025-07-08T20:02:53.6806702Z ----------------------------------------------------------------------
2025-07-08T20:02:53.6807169Z Ran 13 tests in 0.001s
2025-07-08T20:02:53.6807377Z 
2025-07-08T20:02:53.6807493Z OK
2025-07-08T20:02:53.7013776Z ✅ mvp_site/tests/test_hp_unknown_values.py passed
2025-07-08T20:02:53.7017168Z ----------------------------------------
2025-07-08T20:02:53.7017677Z Running mvp_site/tests/test_incomplete_json_recovery.py...
2025-07-08T20:02:53.7714049Z .......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:53.7722441Z ...
2025-07-08T20:02:53.7723909Z ----------------------------------------------------------------------
2025-07-08T20:02:53.7724461Z Ran 10 tests in 0.005s
2025-07-08T20:02:53.7724676Z 
2025-07-08T20:02:53.7724789Z OK
2025-07-08T20:02:53.7831018Z ✅ mvp_site/tests/test_incomplete_json_recovery.py passed
2025-07-08T20:02:53.7832076Z ----------------------------------------
2025-07-08T20:02:53.7834252Z Running mvp_site/tests/test_json_bug_fix.py...
2025-07-08T20:02:53.8114687Z ============================================================
2025-07-08T20:02:53.8116458Z JSON Bug Root Cause Test
2025-07-08T20:02:53.8118871Z ============================================================
2025-07-08T20:02:53.8119424Z Testing parse_structured_response with raw JSON...
2025-07-08T20:02:53.8119925Z Input (first 100 chars): {
2025-07-08T20:02:53.8120591Z     "narrative": "[Mode: STORY MODE]\n[SESSION_HEADER]\nTimestamp: Year 11 New Peace, Kythorn Day ...
2025-07-08T20:02:53.8121168Z 
2025-07-08T20:02:53.8121461Z 🔍 Results:
2025-07-08T20:02:53.8121796Z    response_text type: <class 'str'>
2025-07-08T20:02:53.8122244Z    response_text starts with '{': False
2025-07-08T20:02:53.8122716Z    response_text first 200 chars: [Mode: STORY MODE]
2025-07-08T20:02:53.8123172Z [SESSION_HEADER]
2025-07-08T20:02:53.8123777Z Timestamp: Year 11 New Peace, Kythorn Day 2, 08:00
2025-07-08T20:02:53.8124228Z Location: Character Creation
2025-07-08T20:02:53.8124646Z Status: Lvl 1 Unknown | HP: 0/0 (Temp: 0) | XP: 0/300 | Gold: 0gp
2025-07-08T20:02:53.8125157Z Resources: HD: 0/0
2025-07-08T20:02:53.8125480Z    structured_response exists: True
2025-07-08T20:02:53.8125759Z 
2025-07-08T20:02:53.8126148Z ✅ parse_structured_response correctly extracted narrative!
2025-07-08T20:02:53.8126553Z 
2025-07-08T20:02:53.8126825Z 🟢 parse_structured_response works correctly
2025-07-08T20:02:53.8164798Z ✅ mvp_site/tests/test_json_bug_fix.py passed
2025-07-08T20:02:53.8166097Z ----------------------------------------
2025-07-08T20:02:53.8166590Z Running mvp_site/tests/test_json_bug_green.py...
2025-07-08T20:02:53.8538030Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:53.8540331Z ============================================================
2025-07-08T20:02:53.8541138Z 🟢 GREEN TEST: JSON Bug Fix Verification
2025-07-08T20:02:53.8542579Z ============================================================
2025-07-08T20:02:53.8543554Z Test 1: Well-formed JSON
2025-07-08T20:02:53.8543927Z   Result starts with '{': False
2025-07-08T20:02:53.8544292Z   Result: [Mode: STORY MODE]
2025-07-08T20:02:53.8544679Z You enter the dark cave......
2025-07-08T20:02:53.8544942Z 
2025-07-08T20:02:53.8545348Z Test 2: Malformed JSON without proper structure
2025-07-08T20:02:53.8545849Z   Result starts with '{': True
2025-07-08T20:02:53.8546339Z   Result: {"Some malformed JSON that would cause the bug...
2025-07-08T20:02:53.8547064Z   ⚠️  EXPECTED: Malformed JSON returned as fallback
2025-07-08T20:02:53.8547637Z   This is expected behavior for completely broken JSON
2025-07-08T20:02:53.8548011Z 
2025-07-08T20:02:53.8548199Z Test 3: JSON that triggers the temporary fix
2025-07-08T20:02:53.8548719Z   Result: The story text that should be extracted
2025-07-08T20:02:53.8549297Z   ✅ Narrative correctly extracted
2025-07-08T20:02:53.8549581Z 
2025-07-08T20:02:53.8549775Z Test 4: Full flow with GeminiResponse creation
2025-07-08T20:02:53.8550428Z   narrative_text: You chose option 2. Let me create a character for ...
2025-07-08T20:02:53.8550993Z   narrative_text starts with '{': False
2025-07-08T20:02:53.8551579Z   ✅ Full flow works correctly - no JSON in narrative_text
2025-07-08T20:02:53.8551929Z 
2025-07-08T20:02:53.8552109Z ✅ TESTS PASSED!
2025-07-08T20:02:53.8552452Z The JSON bug has been fixed successfully.
2025-07-08T20:02:53.8552901Z Note: Malformed JSON fallback is expected behavior.
2025-07-08T20:02:53.8604015Z ✅ mvp_site/tests/test_json_bug_green.py passed
2025-07-08T20:02:53.8605326Z ----------------------------------------
2025-07-08T20:02:53.8605823Z Running mvp_site/tests/test_json_bug_scenario.py...
2025-07-08T20:02:54.5198207Z 2025-07-08 20:02:54,519 - INFO - STRUCTURED_GENERATION: Coverage rate 1.00, Schema valid: True
2025-07-08T20:02:54.5198932Z ============================================================
2025-07-08T20:02:54.5199357Z Exact JSON Bug Scenario Test
2025-07-08T20:02:54.5199769Z ============================================================
2025-07-08T20:02:54.5200240Z 1. Testing _get_text_from_response simulation...
2025-07-08T20:02:54.5200714Z 2. Testing _process_structured_response...
2025-07-08T20:02:54.5201013Z 
2025-07-08T20:02:54.5201428Z 🔍 After _process_structured_response:
2025-07-08T20:02:54.5201850Z    response_text type: <class 'str'>
2025-07-08T20:02:54.5202242Z    response_text starts with '{': False
2025-07-08T20:02:54.5202637Z    response_text[:100]: [Mode: STORY MODE]
2025-07-08T20:02:54.5203057Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:02:54.5203538Z 
2025-07-08T20:02:54.5203708Z "Excellent choice, adventurer!" The voice tha
2025-07-08T20:02:54.5204000Z 
2025-07-08T20:02:54.5204266Z ✅ No bug found - response_text is clean narrative
2025-07-08T20:02:54.5204572Z 
2025-07-08T20:02:54.5204805Z 🟢 Could not reproduce bug with this scenario
2025-07-08T20:02:54.5933118Z ✅ mvp_site/tests/test_json_bug_scenario.py passed
2025-07-08T20:02:54.5934810Z ----------------------------------------
2025-07-08T20:02:54.5935389Z Running mvp_site/tests/test_json_bug_state_updates.py...
2025-07-08T20:02:54.6227889Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.6228395Z Initial response_text (clean):
2025-07-08T20:02:54.6228789Z   Starts with '{': False
2025-07-08T20:02:54.6229203Z   First 100 chars: [Mode: STORY MODE]
2025-07-08T20:02:54.6229649Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:02:54.6229938Z 
2025-07-08T20:02:54.6230121Z "Excellent choice, adventurer!" The voice tha
2025-07-08T20:02:54.6230452Z 
2025-07-08T20:02:54.6230610Z After appending state updates:
2025-07-08T20:02:54.6231026Z   Length increased from 155 to 315
2025-07-08T20:02:54.6231443Z   Still starts with '{': False
2025-07-08T20:02:54.6231866Z   Contains 'STATE_UPDATES_PROPOSED': True
2025-07-08T20:02:54.6232189Z 
2025-07-08T20:02:54.6232405Z Conclusion: State updates don't cause the JSON bug
2025-07-08T20:02:54.6232775Z 
2025-07-08T20:02:54.6232940Z ============================================================
2025-07-08T20:02:54.6234122Z Testing edge cases where parse_structured_response might return JSON
2025-07-08T20:02:54.6234582Z 
2025-07-08T20:02:54.6234852Z Test case 1: {"narrative": "Test story", "entities_mentioned": ...
2025-07-08T20:02:54.6235588Z   Result starts with '{': False
2025-07-08T20:02:54.6235965Z   Result: Test story
2025-07-08T20:02:54.6236157Z 
2025-07-08T20:02:54.6236376Z Test case 2: {"narrative": "Test story" "broken json here...
2025-07-08T20:02:54.6236887Z   Result starts with '{': False
2025-07-08T20:02:54.6237258Z   Result: Test story
2025-07-08T20:02:54.6237457Z 
2025-07-08T20:02:54.6237637Z Test case 3: {"Some weird text that starts with brace...
2025-07-08T20:02:54.6238045Z   Result starts with '{': True
2025-07-08T20:02:54.6238494Z   Result: {"Some weird text that starts with brace
2025-07-08T20:02:54.6239121Z   🚨 FOUND IT! This input causes JSON to be returned!
2025-07-08T20:02:54.6239481Z 
2025-07-08T20:02:54.6239835Z 🔴 Found a case where parse_structured_response returns JSON!
2025-07-08T20:02:54.6276740Z ✅ mvp_site/tests/test_json_bug_state_updates.py passed
2025-07-08T20:02:54.6278095Z ----------------------------------------
2025-07-08T20:02:54.6278629Z Running mvp_site/tests/test_json_cleanup_safety.py...
2025-07-08T20:02:54.6742681Z ..ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.6747801Z .....
2025-07-08T20:02:54.6748182Z ----------------------------------------------------------------------
2025-07-08T20:02:54.6748665Z Ran 7 tests in 0.002s
2025-07-08T20:02:54.6748862Z 
2025-07-08T20:02:54.6748966Z OK
2025-07-08T20:02:54.6820596Z ✅ mvp_site/tests/test_json_cleanup_safety.py passed
2025-07-08T20:02:54.6821987Z ----------------------------------------
2025-07-08T20:02:54.6822479Z Running mvp_site/tests/test_json_display_bugs.py...
2025-07-08T20:02:54.7497674Z test_empty_response_handling (__main__.TestIntegrationBugs.test_empty_response_handling)
2025-07-08T20:02:54.7499257Z Test handling of empty or null responses ... INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T20:02:54.7501982Z INFO:root:Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T20:02:54.7511928Z ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.7513895Z INFO:root:No JSON found in response, treating as plain text narrative
2025-07-08T20:02:54.7516260Z INFO:root:Recovered from incomplete JSON response. Narrative length: 9 characters (~2 tokens)
2025-07-08T20:02:54.7517280Z ok
2025-07-08T20:02:54.7519979Z test_state_updates_with_malformed_json (__main__.TestIntegrationBugs.test_state_updates_with_malformed_json)
2025-07-08T20:02:54.7521255Z Test that state updates work even when JSON is malformed ... INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T20:02:54.7522437Z INFO:root:Recovered from incomplete JSON response. Narrative length: 19 characters (~4 tokens)
2025-07-08T20:02:54.7523184Z ok
2025-07-08T20:02:54.7524106Z test_unicode_and_special_characters (__main__.TestIntegrationBugs.test_unicode_and_special_characters)
2025-07-08T20:02:54.7525062Z Test handling of unicode and special characters ... ok
2025-07-08T20:02:54.7525867Z test_very_long_json_response (__main__.TestIntegrationBugs.test_very_long_json_response)
2025-07-08T20:02:54.7526685Z Test handling of very long JSON responses ... ok
2025-07-08T20:02:54.7527745Z test_code_block_json_extraction (__main__.TestRawJsonDisplayBugs.test_code_block_json_extraction)
2025-07-08T20:02:54.7528962Z Test extraction of JSON from code blocks ... INFO:root:Extracted JSON from markdown code block
2025-07-08T20:02:54.7529802Z ok
2025-07-08T20:02:54.7530513Z test_debug_mode_content_stripping (__main__.TestRawJsonDisplayBugs.test_debug_mode_content_stripping)
2025-07-08T20:02:54.7538329Z Test that debug mode content is properly stripped ... WARNING:root:⚠️ Invalid debug_info type: str, expected dict. Using empty dict instead.
2025-07-08T20:02:54.7553564Z ok
2025-07-08T20:02:54.7554163Z test_json_artifact_cleaning (__main__.TestRawJsonDisplayBugs.test_json_artifact_cleaning)
2025-07-08T20:02:54.7555334Z Test that JSON artifacts are cleaned from narrative ... ok
2025-07-08T20:02:54.7556138Z test_malformed_json_fallback (__main__.TestRawJsonDisplayBugs.test_malformed_json_fallback)
2025-07-08T20:02:54.7557356Z Test that malformed JSON falls back to cleaned text ... INFO:root:Successfully completed incomplete JSON
2025-07-08T20:02:54.7558320Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7559012Z INFO:root:Successfully fixed JSON boundaries
2025-07-08T20:02:54.7559732Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7560473Z INFO:root:Successfully parsed with aggressive fixes
2025-07-08T20:02:54.7561207Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7561988Z INFO:root:Extracted JSON from markdown code block
2025-07-08T20:02:54.7562588Z INFO:root:Successfully extracted fields from malformed JSON
2025-07-08T20:02:54.7563581Z INFO:root:Recovered from incomplete JSON response. Narrative length: 21 characters (~5 tokens)
2025-07-08T20:02:54.7564278Z ok
2025-07-08T20:02:54.7564937Z test_narrative_extraction_utility (__main__.TestRawJsonDisplayBugs.test_narrative_extraction_utility)
2025-07-08T20:02:54.7565747Z Test the narrative extraction utility function ... ok
2025-07-08T20:02:54.7566478Z test_narrative_field_extraction (__main__.TestRawJsonDisplayBugs.test_narrative_field_extraction)
2025-07-08T20:02:54.7567299Z Test extraction of narrative field from complex JSON ... ok
2025-07-08T20:02:54.7568101Z test_robust_json_parser_fallback (__main__.TestRawJsonDisplayBugs.test_robust_json_parser_fallback)
2025-07-08T20:02:54.7569077Z Test the robust JSON parser as fallback ... INFO:root:Successfully completed incomplete JSON
2025-07-08T20:02:54.7569664Z ok
2025-07-08T20:02:54.7570074Z test_valid_json_parsing (__main__.TestRawJsonDisplayBugs.test_valid_json_parsing)
2025-07-08T20:02:54.7570645Z Test that valid JSON is parsed correctly ... ok
2025-07-08T20:02:54.7571271Z test_empty_state_updates (__main__.TestStateUpdateBugs.test_empty_state_updates)
2025-07-08T20:02:54.7572019Z Test handling of responses with empty state updates ... ok
2025-07-08T20:02:54.7572823Z test_json_state_updates_extraction (__main__.TestStateUpdateBugs.test_json_state_updates_extraction)
2025-07-08T20:02:54.7573875Z Test that state updates are properly extracted from JSON format ... ok
2025-07-08T20:02:54.7574682Z test_malformed_state_updates (__main__.TestStateUpdateBugs.test_malformed_state_updates)
2025-07-08T20:02:54.7576067Z Test handling of malformed state updates ... WARNING:root:⚠️ Invalid state_updates type: str, expected dict. Using empty dict instead.
2025-07-08T20:02:54.7577031Z ok
2025-07-08T20:02:54.7577693Z test_markdown_state_updates_deprecated (__main__.TestStateUpdateBugs.test_markdown_state_updates_deprecated)
2025-07-08T20:02:54.7578909Z Test that old markdown state updates are handled gracefully ... INFO:root:Successfully parsed with aggressive fixes
2025-07-08T20:02:54.7580001Z INFO:root:Recovered from incomplete JSON response. Narrative length: 2 characters (~0 tokens)
2025-07-08T20:02:54.7580695Z ok
2025-07-08T20:02:54.7581227Z test_mixed_format_handling (__main__.TestStateUpdateBugs.test_mixed_format_handling)
2025-07-08T20:02:54.7582242Z Test handling of responses with both JSON and markdown formats ... INFO:root:Successfully fixed JSON boundaries
2025-07-08T20:02:54.7583442Z INFO:root:Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:02:54.7584140Z ok
2025-07-08T20:02:54.7584762Z test_state_updates_not_in_narrative (__main__.TestStateUpdateBugs.test_state_updates_not_in_narrative)
2025-07-08T20:02:54.7585647Z Test that state updates don't leak into narrative text ... ok
2025-07-08T20:02:54.7586061Z 
2025-07-08T20:02:54.7586293Z ----------------------------------------------------------------------
2025-07-08T20:02:54.7587004Z Ran 18 tests in 0.005s
2025-07-08T20:02:54.7587231Z 
2025-07-08T20:02:54.7587347Z OK
2025-07-08T20:02:54.7667153Z ✅ mvp_site/tests/test_json_display_bugs.py passed
2025-07-08T20:02:54.7668557Z ----------------------------------------
2025-07-08T20:02:54.7669332Z Running mvp_site/tests/test_json_display_fix.py...
2025-07-08T20:02:54.8138805Z ......ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:54.8141453Z ...
2025-07-08T20:02:54.8141885Z ----------------------------------------------------------------------
2025-07-08T20:02:54.8142466Z Ran 9 tests in 0.002s
2025-07-08T20:02:54.8145448Z 
2025-07-08T20:02:54.8145708Z OK
2025-07-08T20:02:54.8211774Z ✅ mvp_site/tests/test_json_display_fix.py passed
2025-07-08T20:02:54.8215350Z ----------------------------------------
2025-07-08T20:02:54.8215855Z Running mvp_site/tests/test_json_mode_constants.py...
2025-07-08T20:02:54.8573095Z ..
2025-07-08T20:02:54.8578744Z ----------------------------------------------------------------------
2025-07-08T20:02:54.8579326Z Ran 2 tests in 0.000s
2025-07-08T20:02:54.8579565Z 
2025-07-08T20:02:54.8579683Z OK
2025-07-08T20:02:54.8630755Z ✅ mvp_site/tests/test_json_mode_constants.py passed
2025-07-08T20:02:54.8631732Z ----------------------------------------
2025-07-08T20:02:54.8632737Z Running mvp_site/tests/test_json_mode_preference.py...
2025-07-08T20:02:55.7871255Z 2025-07-08 20:02:55,786 - INFO - Extracted JSON from markdown code block
2025-07-08T20:02:55.7872651Z 2025-07-08 20:02:55,787 - INFO - Extracted JSON from generic code block
2025-07-08T20:02:55.7874844Z ....2025-07-08 20:02:55,787 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:55.7884246Z ..
2025-07-08T20:02:55.7886247Z ----------------------------------------------------------------------
2025-07-08T20:02:55.7887222Z Ran 6 tests in 0.002s
2025-07-08T20:02:55.7888618Z 
2025-07-08T20:02:55.7889863Z OK
2025-07-08T20:02:55.9383609Z ✅ mvp_site/tests/test_json_mode_preference.py passed
2025-07-08T20:02:55.9386858Z ----------------------------------------
2025-07-08T20:02:55.9387424Z Running mvp_site/tests/test_json_mode_state_updates.py...
2025-07-08T20:02:56.0039334Z ...
2025-07-08T20:02:56.0039970Z ✅ Empty state updates handled correctly
2025-07-08T20:02:56.0040621Z ✅ JSON response with state updates properly converted
2025-07-08T20:02:56.0041263Z ✅ JSON response without state updates handled correctly
2025-07-08T20:02:56.0042097Z ----------------------------------------------------------------------
2025-07-08T20:02:56.0042697Z Ran 3 tests in 0.000s
2025-07-08T20:02:56.0043003Z 
2025-07-08T20:02:56.0043389Z OK
2025-07-08T20:02:56.0141927Z ✅ mvp_site/tests/test_json_mode_state_updates.py passed
2025-07-08T20:02:56.0143508Z ----------------------------------------
2025-07-08T20:02:56.0144061Z Running mvp_site/tests/test_json_only_comprehensive.py...
2025-07-08T20:02:56.9371473Z ..2025-07-08 20:02:56,936 - INFO - Calling Gemini API with prompt: test logging...
2025-07-08T20:02:56.9372651Z 2025-07-08 20:02:56,937 - INFO - Calling Gemini API: 11 characters (~2 tokens)
2025-07-08T20:02:56.9378290Z 2025-07-08 20:02:56,937 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'int'
2025-07-08T20:02:56.9379601Z 2025-07-08 20:02:56,937 - INFO - Using model: gemini-2.5-flash
2025-07-08T20:02:56.9380441Z 2025-07-08 20:02:56,937 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:56.9386071Z ..2025-07-08 20:02:56,938 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:56.9391705Z ....
2025-07-08T20:02:56.9392416Z ----------------------------------------------------------------------
2025-07-08T20:02:56.9393118Z Ran 8 tests in 0.003s
2025-07-08T20:02:56.9393684Z 
2025-07-08T20:02:56.9393888Z OK
2025-07-08T20:02:57.0998063Z ✅ mvp_site/tests/test_json_only_comprehensive.py passed
2025-07-08T20:02:57.0999521Z ----------------------------------------
2025-07-08T20:02:57.1000444Z Running mvp_site/tests/test_json_only_mode.py...
2025-07-08T20:02:57.7366490Z 2025-07-08 20:02:57,736 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:02:57.7372253Z 2025-07-08 20:02:57,736 - INFO - Prompt scaffold is 125 chars (~31 tokens). Remaining budget for story: 2999875 chars (~749968 tokens)
2025-07-08T20:02:57.7374054Z 2025-07-08 20:02:57,736 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:02:57.7379946Z 2025-07-08 20:02:57,737 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:02:57.7385424Z 2025-07-08 20:02:57,738 - INFO - Generated entity manifest for session 1, turn 1
2025-07-08T20:02:57.7386514Z 2025-07-08 20:02:57,738 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7390220Z 2025-07-08 20:02:57,738 - INFO - Calling Gemini API: 65253 characters (~16313 tokens)
2025-07-08T20:02:57.7395284Z 2025-07-08 20:02:57,739 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7396479Z 2025-07-08 20:02:57,739 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7397283Z 2025-07-08 20:02:57,739 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7415397Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:57.7416717Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:57.7418944Z 2025-07-08 20:02:57,741 - INFO - ENTITY_TRACKING_RETRY: Attempting dual-pass generation to fix missing entities
2025-07-08T20:02:57.7419903Z 2025-07-08 20:02:57,741 - INFO - Starting dual-pass generation
2025-07-08T20:02:57.7422026Z 2025-07-08 20:02:57,741 - INFO - Pass 1: Generating initial narrative
2025-07-08T20:02:57.7422814Z 2025-07-08 20:02:57,741 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7423882Z 2025-07-08 20:02:57,741 - INFO - Calling Gemini API: 65253 characters (~16313 tokens)
2025-07-08T20:02:57.7426806Z 2025-07-08 20:02:57,741 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7427820Z 2025-07-08 20:02:57,742 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7428544Z 2025-07-08 20:02:57,742 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7429417Z 2025-07-08 20:02:57,742 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:57.7430547Z 2025-07-08 20:02:57,742 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:57.7435013Z 2025-07-08 20:02:57,742 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:57.7435759Z 2025-07-08 20:02:57,742 - INFO - Pass 1 completed: 0/1 entities found
2025-07-08T20:02:57.7436473Z 2025-07-08 20:02:57,743 - INFO - Pass 2: Injecting missing entities: ['Unknown']
2025-07-08T20:02:57.7437317Z 2025-07-08 20:02:57,743 - INFO - Calling Gemini API with prompt: GOD MODE: test prompt...
2025-07-08T20:02:57.7438194Z 2025-07-08 20:02:57,743 - INFO - Calling Gemini API: 63701 characters (~15925 tokens)
2025-07-08T20:02:57.7439496Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ Could not count tokens before API call: unsupported operand type(s) for +: 'Mock' and 'Mock'
2025-07-08T20:02:57.7440476Z 2025-07-08 20:02:57,743 - INFO - Using model: gemini-1.5-flash
2025-07-08T20:02:57.7441132Z 2025-07-08 20:02:57,743 - INFO - Using JSON response mode with 50000 token limit
2025-07-08T20:02:57.7442560Z 2025-07-08 20:02:57,743 - INFO - STRUCTURED_GENERATION: Coverage rate 0.00, Schema valid: False
2025-07-08T20:02:57.7444337Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ STRUCTURED_GENERATION: Missing from schema: ['unknown']
2025-07-08T20:02:57.7445645Z 2025-07-08 20:02:57,743 - INFO - Entity validation: 0/1 found, confidence: 0.00
2025-07-08T20:02:57.7446884Z 2025-07-08 20:02:57,743 - INFO - Dual-pass completed: 0/1 entities found, improvement: False
2025-07-08T20:02:57.7448590Z 2025-07-08 20:02:57,743 - INFO - ENTITY_TRACKING_RETRY: Dual-pass succeeded. Entities recovered: 0
2025-07-08T20:02:57.7450620Z 2025-07-08 20:02:57,743 - WARNING - ⚠️ ENTITY_TRACKING_VALIDATION: Narrative failed entity validation
2025-07-08T20:02:57.7451810Z 2025-07-08 20:02:57,744 - WARNING - ⚠️ Missing entities: ['Unknown']
2025-07-08T20:02:57.7452742Z .2025-07-08 20:02:57,744 - ERROR - ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:57.7461674Z ..2025-07-08 20:02:57,745 - ERROR - 🔥🔴 --- EXCEPTION IN: continue_story ---
2025-07-08T20:02:57.7462310Z Args: ([], 'prompt', 'story')
2025-07-08T20:02:57.7462668Z Kwargs: {}
2025-07-08T20:02:57.7463180Z Error: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T20:02:57.7463989Z Traceback:
2025-07-08T20:02:57.7464300Z Traceback (most recent call last):
2025-07-08T20:02:57.7465318Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/decorators.py", line 35, in wrapper
2025-07-08T20:02:57.7466229Z     return func(*args, **kwargs)
2025-07-08T20:02:57.7466615Z            ^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:02:57.7467261Z TypeError: continue_story() missing 1 required positional argument: 'current_game_state'
2025-07-08T20:02:57.7467973Z --- END EXCEPTION ---
2025-07-08T20:02:58.0507542Z ....2025-07-08 20:02:58,050 - INFO - Extracted JSON from markdown code block
2025-07-08T20:02:58.0513043Z 2025-07-08 20:02:58,050 - INFO - Successfully completed incomplete JSON
2025-07-08T20:02:58.0514116Z 2025-07-08 20:02:58,050 - INFO - Recovered from incomplete JSON response. Narrative length: 4 characters (~1 tokens)
2025-07-08T20:02:58.0514790Z ..
2025-07-08T20:02:58.0515137Z ----------------------------------------------------------------------
2025-07-08T20:02:58.0515579Z Ran 9 tests in 0.316s
2025-07-08T20:02:58.0515783Z 
2025-07-08T20:02:58.0515880Z OK
2025-07-08T20:02:58.2044418Z ✅ mvp_site/tests/test_json_only_mode.py passed
2025-07-08T20:02:58.2045912Z ----------------------------------------
2025-07-08T20:02:58.2046439Z Running mvp_site/tests/test_json_state_updates_fix.py...
2025-07-08T20:02:59.1402663Z 2025-07-08 20:02:59,140 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:02:59.1404294Z 2025-07-08 20:02:59,140 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:02:59.1405723Z 2025-07-08 20:02:59,140 - INFO - Recovered from incomplete JSON response. Narrative length: 197 characters (~49 tokens)
2025-07-08T20:02:59.1426479Z 2025-07-08 20:02:59,142 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:59.1432612Z 2025-07-08 20:02:59,143 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T20:02:59.1434724Z 2025-07-08 20:02:59,143 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:02:59.1436791Z 2025-07-08 20:02:59,143 - INFO - Response length: 197 characters (~49 tokens)
2025-07-08T20:02:59.1493445Z .2025-07-08 20:02:59,149 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:02:59.1500073Z 2025-07-08 20:02:59,149 - INFO - Debug content generated for campaign test-campaign: {'dm_notes': False, 'dice_rolls': False, 'state_changes': True}
2025-07-08T20:02:59.1501783Z 2025-07-08 20:02:59,149 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1503073Z   "player_character_data": {
2025-07-08T20:02:59.1504103Z     "hp_current": 15,
2025-07-08T20:02:59.1504605Z     "combat_state": {
2025-07-08T20:02:59.1504955Z       "is_in_combat": true,
2025-07-08T20:02:59.1505315Z       "current_turn": "player"
2025-07-08T20:02:59.1505664Z     }
2025-07-08T20:02:59.1505925Z   },
2025-07-08T20:02:59.1506182Z   "npc_data": {
2025-07-08T20:02:59.1506481Z     "Goblin_1": {
2025-07-08T20:02:59.1506793Z       "hp_current": 8,
2025-07-08T20:02:59.1507503Z       "status": "wounded"
2025-07-08T20:02:59.1507833Z     }
2025-07-08T20:02:59.1508090Z   }
2025-07-08T20:02:59.1508336Z }
2025-07-08T20:02:59.1508778Z 2025-07-08 20:02:59,149 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1509540Z   "hp_current": 15,
2025-07-08T20:02:59.1509851Z   "combat_state": {
2025-07-08T20:02:59.1510171Z     "is_in_combat": true,
2025-07-08T20:02:59.1510525Z     "current_turn": "player"
2025-07-08T20:02:59.1510873Z   }
2025-07-08T20:02:59.1511120Z }
2025-07-08T20:02:59.1511578Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1512154Z   "is_in_combat": true,
2025-07-08T20:02:59.1512489Z   "current_turn": "player"
2025-07-08T20:02:59.1512825Z }
2025-07-08T20:02:59.1513432Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1514169Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1514901Z 2025-07-08 20:02:59,150 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1515483Z   "Goblin_1": {
2025-07-08T20:02:59.1515822Z     "hp_current": 8,
2025-07-08T20:02:59.1516148Z     "status": "wounded"
2025-07-08T20:02:59.1516469Z   }
2025-07-08T20:02:59.1516710Z }
2025-07-08T20:02:59.1517169Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1517765Z   "hp_current": 8,
2025-07-08T20:02:59.1518093Z   "status": "wounded"
2025-07-08T20:02:59.1518401Z }
2025-07-08T20:02:59.1518804Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1519506Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1520172Z 2025-07-08 20:02:59,151 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1522970Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1524716Z   "player_character_data": {
2025-07-08T20:02:59.1527409Z     "hp_current": 15,
2025-07-08T20:02:59.1528236Z     "combat_state": {
2025-07-08T20:02:59.1528583Z       "is_in_combat": true,
2025-07-08T20:02:59.1528952Z       "current_turn": "player"
2025-07-08T20:02:59.1529339Z     }
2025-07-08T20:02:59.1529624Z   },
2025-07-08T20:02:59.1529920Z   "npc_data": {
2025-07-08T20:02:59.1530257Z     "Goblin_1": {
2025-07-08T20:02:59.1530595Z       "hp_current": 8,
2025-07-08T20:02:59.1530958Z       "status": "wounded"
2025-07-08T20:02:59.1531322Z     }
2025-07-08T20:02:59.1531608Z   }
2025-07-08T20:02:59.1531881Z }
2025-07-08T20:02:59.1532374Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1533015Z   "hp_current": 15,
2025-07-08T20:02:59.1533513Z   "combat_state": {
2025-07-08T20:02:59.1533854Z     "is_in_combat": true,
2025-07-08T20:02:59.1534233Z     "current_turn": "player"
2025-07-08T20:02:59.1534579Z   }
2025-07-08T20:02:59.1534843Z }
2025-07-08T20:02:59.1535340Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1535944Z   "is_in_combat": true,
2025-07-08T20:02:59.1536310Z   "current_turn": "player"
2025-07-08T20:02:59.1536657Z }
2025-07-08T20:02:59.1537106Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1537843Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1538617Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1539238Z   "Goblin_1": {
2025-07-08T20:02:59.1539564Z     "hp_current": 8,
2025-07-08T20:02:59.1539923Z     "status": "wounded"
2025-07-08T20:02:59.1540259Z   }
2025-07-08T20:02:59.1540518Z }
2025-07-08T20:02:59.1541001Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1541626Z   "hp_current": 8,
2025-07-08T20:02:59.1541958Z   "status": "wounded"
2025-07-08T20:02:59.1542278Z }
2025-07-08T20:02:59.1542990Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1543872Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1545423Z 2025-07-08 20:02:59,152 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1546750Z 2025-07-08 20:02:59,152 - INFO - AI proposed changes for campaign test-campaign:\n{
2025-07-08T20:02:59.1547399Z   "custom_campaign_state": {
2025-07-08T20:02:59.1547793Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1548184Z   },
2025-07-08T20:02:59.1548473Z   "player_character_data": {
2025-07-08T20:02:59.1548843Z     "hp_current": 15,
2025-07-08T20:02:59.1549164Z     "combat_state": {
2025-07-08T20:02:59.1549491Z       "is_in_combat": true,
2025-07-08T20:02:59.1549871Z       "current_turn": "player"
2025-07-08T20:02:59.1550223Z     }
2025-07-08T20:02:59.1550480Z   },
2025-07-08T20:02:59.1550741Z   "npc_data": {
2025-07-08T20:02:59.1551040Z     "Goblin_1": {
2025-07-08T20:02:59.1551364Z       "hp_current": 8,
2025-07-08T20:02:59.1551688Z       "status": "wounded"
2025-07-08T20:02:59.1552003Z     }
2025-07-08T20:02:59.1552261Z   }
2025-07-08T20:02:59.1552518Z }
2025-07-08T20:02:59.1554875Z 2025-07-08 20:02:59,153 - INFO - Applying formatted state changes for campaign test-campaign:\nGame state updated (6 entries):\n  - custom_campaign_state.last_story_mode_sequence_id: 2\n  - player_character_data.hp_current: 15\n  - player_character_data.combat_state.is_in_combat: true\n  - player_character_data.combat_state.current_turn: "player"\n  - npc_data.Goblin_1.hp_current: 8\n  - npc_data.Goblin_1.status: "wounded"
2025-07-08T20:02:59.1560600Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1561209Z   "custom_campaign_state": {
2025-07-08T20:02:59.1561601Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1561985Z   },
2025-07-08T20:02:59.1562265Z   "player_character_data": {
2025-07-08T20:02:59.1562642Z     "hp_current": 15,
2025-07-08T20:02:59.1562993Z     "combat_state": {
2025-07-08T20:02:59.1563501Z       "is_in_combat": true,
2025-07-08T20:02:59.1563870Z       "current_turn": "player"
2025-07-08T20:02:59.1564220Z     }
2025-07-08T20:02:59.1564469Z   },
2025-07-08T20:02:59.1564733Z   "npc_data": {
2025-07-08T20:02:59.1565052Z     "Goblin_1": {
2025-07-08T20:02:59.1565351Z       "hp_current": 8,
2025-07-08T20:02:59.1565677Z       "status": "wounded"
2025-07-08T20:02:59.1565998Z     }
2025-07-08T20:02:59.1566243Z   }
2025-07-08T20:02:59.1566494Z }
2025-07-08T20:02:59.1566959Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1567563Z   "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1567932Z }
2025-07-08T20:02:59.1568341Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1569034Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1569584Z   "hp_current": 15,
2025-07-08T20:02:59.1569902Z   "combat_state": {
2025-07-08T20:02:59.1570224Z     "is_in_combat": true,
2025-07-08T20:02:59.1570591Z     "current_turn": "player"
2025-07-08T20:02:59.1570946Z   }
2025-07-08T20:02:59.1571199Z }
2025-07-08T20:02:59.1571640Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1572213Z   "is_in_combat": true,
2025-07-08T20:02:59.1572554Z   "current_turn": "player"
2025-07-08T20:02:59.1572883Z }
2025-07-08T20:02:59.1573444Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1574152Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1574869Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1575430Z   "Goblin_1": {
2025-07-08T20:02:59.1575733Z     "hp_current": 8,
2025-07-08T20:02:59.1576056Z     "status": "wounded"
2025-07-08T20:02:59.1576362Z   }
2025-07-08T20:02:59.1576615Z }
2025-07-08T20:02:59.1577295Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:02:59.1577847Z   "hp_current": 8,
2025-07-08T20:02:59.1578155Z   "status": "wounded"
2025-07-08T20:02:59.1578468Z }
2025-07-08T20:02:59.1579117Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1579769Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1580384Z 2025-07-08 20:02:59,153 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:02:59.1581079Z 2025-07-08 20:02:59,153 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:02:59.1581809Z 2025-07-08 20:02:59,154 - INFO - New complete game state for campaign test-campaign:\n{
2025-07-08T20:02:59.1582365Z   "game_state_version": 1,
2025-07-08T20:02:59.1582709Z   "player_character_data": {
2025-07-08T20:02:59.1583028Z     "hp_current": 15,
2025-07-08T20:02:59.1583624Z     "combat_state": {
2025-07-08T20:02:59.1583939Z       "is_in_combat": true,
2025-07-08T20:02:59.1584263Z       "current_turn": "player"
2025-07-08T20:02:59.1584576Z     }
2025-07-08T20:02:59.1584809Z   },
2025-07-08T20:02:59.1585052Z   "world_data": {},
2025-07-08T20:02:59.1585319Z   "npc_data": {
2025-07-08T20:02:59.1585581Z     "Goblin_1": {
2025-07-08T20:02:59.1585872Z       "hp_current": 8,
2025-07-08T20:02:59.1586164Z       "status": "wounded"
2025-07-08T20:02:59.1586458Z     }
2025-07-08T20:02:59.1586681Z   },
2025-07-08T20:02:59.1586936Z   "custom_campaign_state": {
2025-07-08T20:02:59.1587285Z     "attribute_system": "D&D",
2025-07-08T20:02:59.1587641Z     "last_story_mode_sequence_id": 2
2025-07-08T20:02:59.1587980Z   },
2025-07-08T20:02:59.1588234Z ... (truncated, showing 20/30 lines)
2025-07-08T20:02:59.1588590Z .
2025-07-08T20:02:59.1588913Z ----------------------------------------------------------------------
2025-07-08T20:02:59.1589357Z Ran 2 tests in 0.022s
2025-07-08T20:02:59.1589549Z 
2025-07-08T20:02:59.1590870Z OK
2025-07-08T20:02:59.3248858Z ✅ mvp_site/tests/test_json_state_updates_fix.py passed
2025-07-08T20:02:59.3250292Z ----------------------------------------
2025-07-08T20:02:59.3250768Z Running mvp_site/tests/test_json_utils.py...
2025-07-08T20:02:59.3727202Z ........................................................
2025-07-08T20:02:59.3729234Z ----------------------------------------------------------------------
2025-07-08T20:02:59.3730922Z Ran 56 tests in 0.004s
2025-07-08T20:02:59.3731153Z 
2025-07-08T20:02:59.3731267Z OK
2025-07-08T20:02:59.3793168Z ✅ mvp_site/tests/test_json_utils.py passed
2025-07-08T20:02:59.3794696Z ----------------------------------------
2025-07-08T20:02:59.3795185Z Running mvp_site/tests/test_llm_response.py...
2025-07-08T20:02:59.4260906Z test_backwards_compatibility (__main__.TestLLMResponse.test_backwards_compatibility)
2025-07-08T20:02:59.4264026Z Test that old GeminiResponse interface still works. ... ok
2025-07-08T20:02:59.4264799Z test_debug_tag_detection (__main__.TestLLMResponse.test_debug_tag_detection)
2025-07-08T20:02:59.4265536Z Test automatic debug tag detection. ... ok
2025-07-08T20:02:59.4266196Z test_factory_function (__main__.TestLLMResponse.test_factory_function)
2025-07-08T20:02:59.4266934Z Test the factory function for creating responses. ... ok
2025-07-08T20:02:59.4267797Z test_gemini_llm_response_creation (__main__.TestLLMResponse.test_gemini_llm_response_creation)
2025-07-08T20:02:59.4268578Z Test creating GeminiLLMResponse directly. ... ok
2025-07-08T20:02:59.4269264Z test_invalid_response_handling (__main__.TestLLMResponse.test_invalid_response_handling)
2025-07-08T20:02:59.4270436Z Test handling of invalid responses. ... ERROR:root:ERROR: No structured response available for state updates. JSON mode is required.
2025-07-08T20:02:59.4280293Z ok
2025-07-08T20:02:59.4280867Z test_to_dict_serialization (__main__.TestLLMResponse.test_to_dict_serialization)
2025-07-08T20:02:59.4281654Z Test converting response to dictionary for API usage. ... ok
2025-07-08T20:02:59.4282756Z test_unsupported_provider (__main__.TestLLMResponse.test_unsupported_provider)
2025-07-08T20:02:59.4283691Z Test that unsupported providers raise appropriate errors. ... ok
2025-07-08T20:02:59.4284089Z 
2025-07-08T20:02:59.4284302Z ----------------------------------------------------------------------
2025-07-08T20:02:59.4285007Z Ran 7 tests in 0.001s
2025-07-08T20:02:59.4285234Z 
2025-07-08T20:02:59.4285341Z OK
2025-07-08T20:02:59.4350607Z ✅ mvp_site/tests/test_llm_response.py passed
2025-07-08T20:02:59.4351933Z ----------------------------------------
2025-07-08T20:02:59.4352439Z Running mvp_site/tests/test_loading_messages.py...
2025-07-08T20:02:59.4725459Z .....
2025-07-08T20:02:59.4726474Z ----------------------------------------------------------------------
2025-07-08T20:02:59.4728003Z Ran 5 tests in 0.001s
2025-07-08T20:02:59.4728478Z 
2025-07-08T20:02:59.4728741Z OK
2025-07-08T20:02:59.4785463Z ✅ mvp_site/tests/test_loading_messages.py passed
2025-07-08T20:02:59.4786771Z ----------------------------------------
2025-07-08T20:02:59.4787393Z Running mvp_site/tests/test_luke_campaign_god_mode_json_bug.py...
2025-07-08T20:02:59.5246250Z ....
2025-07-08T20:02:59.5248107Z ----------------------------------------------------------------------
2025-07-08T20:02:59.5248610Z Ran 4 tests in 0.000s
2025-07-08T20:02:59.5248872Z 
2025-07-08T20:02:59.5248983Z OK
2025-07-08T20:02:59.5318349Z ✅ mvp_site/tests/test_luke_campaign_god_mode_json_bug.py passed
2025-07-08T20:02:59.5319402Z ----------------------------------------
2025-07-08T20:02:59.5320443Z Running mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py...
2025-07-08T20:02:59.7462402Z ...
2025-07-08T20:02:59.7462865Z ----------------------------------------------------------------------
2025-07-08T20:02:59.7463516Z Ran 3 tests in 0.000s
2025-07-08T20:02:59.7463718Z 
2025-07-08T20:02:59.7463828Z OK
2025-07-08T20:02:59.7696976Z ✅ mvp_site/tests/test_luke_campaign_jedi_master_gender_fix.py passed
2025-07-08T20:02:59.7699188Z ----------------------------------------
2025-07-08T20:02:59.7699620Z Running mvp_site/tests/test_main.py...
2025-07-08T20:03:00.6538969Z 2025-07-08 20:03:00,653 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6600567Z .2025-07-08 20:03:00,659 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6602093Z 2025-07-08 20:03:00,659 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:00.6603138Z 2025-07-08 20:03:00,659 - INFO - GOD_MODE_SET raw payload:\n---\n
2025-07-08T20:03:00.6606443Z player.level = 5
2025-07-08T20:03:00.6606800Z player.hp = 50\n---
2025-07-08T20:03:00.6607329Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:00.6607914Z   "player": {
2025-07-08T20:03:00.6608224Z     "level": 5,
2025-07-08T20:03:00.6608525Z     "hp": 50
2025-07-08T20:03:00.6608814Z   }
2025-07-08T20:03:00.6609103Z }
2025-07-08T20:03:00.6609531Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:00.6614761Z   "game_state_version": 1,
2025-07-08T20:03:00.6615187Z   "player_character_data": {},
2025-07-08T20:03:00.6615597Z   "world_data": {},
2025-07-08T20:03:00.6615966Z   "npc_data": {},
2025-07-08T20:03:00.6616329Z   "custom_campaign_state": {
2025-07-08T20:03:00.6616740Z     "attribute_system": "D&D"
2025-07-08T20:03:00.6617120Z   },
2025-07-08T20:03:00.6617406Z   "combat_state": {
2025-07-08T20:03:00.6617736Z     "in_combat": false
2025-07-08T20:03:00.6618078Z   },
2025-07-08T20:03:00.6618528Z   "last_state_update_timestamp": "2025-07-08 20:03:00.659823+00:00",
2025-07-08T20:03:00.6619128Z   "time_sensitive_events": {},
2025-07-08T20:03:00.6619535Z   "npc_agendas": {},
2025-07-08T20:03:00.6619890Z   "world_resources": {},
2025-07-08T20:03:00.6620275Z   "time_pressure_warnings": {},
2025-07-08T20:03:00.6620653Z   "debug_mode": true,
2025-07-08T20:03:00.6620990Z   "player": {
2025-07-08T20:03:00.6621798Z     "name": "Hero",
2025-07-08T20:03:00.6622155Z ... (truncated, showing 19/22 lines)
2025-07-08T20:03:00.6622857Z 2025-07-08 20:03:00,660 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:00.6624098Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:00.6624638Z   "player": {
2025-07-08T20:03:00.6624953Z     "name": "Hero",
2025-07-08T20:03:00.6625276Z     "level": 5,
2025-07-08T20:03:00.6625586Z     "hp": 50
2025-07-08T20:03:00.6625886Z   }
2025-07-08T20:03:00.6626160Z }
2025-07-08T20:03:00.6630595Z 2025-07-08 20:03:00,660 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - player.level: 5\n  - player.hp: 50
2025-07-08T20:03:00.6631873Z 2025-07-08 20:03:00,661 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:00.6678438Z .2025-07-08 20:03:00,667 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6681684Z 2025-07-08 20:03:00,667 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:00.6736475Z .2025-07-08 20:03:00,673 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6785444Z .2025-07-08 20:03:00,678 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6840506Z .2025-07-08 20:03:00,683 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:00.6846709Z 2025-07-08 20:03:00,684 - WARNING - ⚠️ AI response missing debug content for campaign test-campaign
2025-07-08T20:03:00.6848606Z 2025-07-08 20:03:00,684 - WARNING - ⚠️ Debug tags found: {'dm_notes': False, 'dice_rolls': False, 'state_changes': False}
2025-07-08T20:03:00.6850922Z 2025-07-08 20:03:00,684 - INFO - Response length: 47 characters (~11 tokens)
2025-07-08T20:03:00.6892348Z .........2025-07-08 20:03:00,689 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: player.data = {invalid json}
2025-07-08T20:03:00.6976774Z ......
2025-07-08T20:03:00.6978722Z ----------------------------------------------------------------------
2025-07-08T20:03:00.6980236Z Ran 20 tests in 0.043s
2025-07-08T20:03:00.6981911Z 
2025-07-08T20:03:00.6982565Z OK
2025-07-08T20:03:00.8464135Z ✅ mvp_site/tests/test_main.py passed
2025-07-08T20:03:00.8465560Z ----------------------------------------
2025-07-08T20:03:00.8466035Z Running mvp_site/tests/test_main_auth.py...
2025-07-08T20:03:01.7537589Z ............
2025-07-08T20:03:01.7538541Z ----------------------------------------------------------------------
2025-07-08T20:03:01.7539339Z Ran 12 tests in 0.057s
2025-07-08T20:03:01.7540581Z 
2025-07-08T20:03:01.7540729Z OK
2025-07-08T20:03:01.9081929Z ✅ mvp_site/tests/test_main_auth.py passed
2025-07-08T20:03:01.9083911Z ----------------------------------------
2025-07-08T20:03:01.9084451Z Running mvp_site/tests/test_main_auth_state_phase2.py...
2025-07-08T20:03:02.8031541Z .................
2025-07-08T20:03:02.8035713Z ----------------------------------------------------------------------
2025-07-08T20:03:02.8039405Z Ran 17 tests in 0.037s
2025-07-08T20:03:02.8042317Z 
2025-07-08T20:03:02.8044402Z OK
2025-07-08T20:03:02.9320459Z ✅ mvp_site/tests/test_main_auth_state_phase2.py passed
2025-07-08T20:03:02.9321922Z ----------------------------------------
2025-07-08T20:03:02.9322481Z Running mvp_site/tests/test_main_authentication_advanced.py...
2025-07-08T20:03:03.8646303Z sssssssssssssssssssssssss
2025-07-08T20:03:03.8647278Z ----------------------------------------------------------------------
2025-07-08T20:03:03.8648078Z Ran 25 tests in 0.000s
2025-07-08T20:03:03.8649387Z 
2025-07-08T20:03:03.8649535Z OK (skipped=25)
2025-07-08T20:03:04.0502717Z ✅ mvp_site/tests/test_main_authentication_advanced.py passed
2025-07-08T20:03:04.0506697Z ----------------------------------------
2025-07-08T20:03:04.0507266Z Running mvp_site/tests/test_main_error_handling_final.py...
2025-07-08T20:03:04.9696845Z test_arrays_and_objects (__main__.TestParseSetCommandErrorHandling.test_arrays_and_objects)
2025-07-08T20:03:04.9698686Z Test complex JSON structures ... ok
2025-07-08T20:03:04.9702134Z test_edge_cases (__main__.TestParseSetCommandErrorHandling.test_edge_cases)
2025-07-08T20:03:04.9708997Z Test various edge cases ... ok
2025-07-08T20:03:04.9710206Z test_empty_values_and_whitespace (__main__.TestParseSetCommandErrorHandling.test_empty_values_and_whitespace)
2025-07-08T20:03:04.9711490Z Test handling of empty values and whitespace ... ok
2025-07-08T20:03:04.9712522Z test_escaped_characters (__main__.TestParseSetCommandErrorHandling.test_escaped_characters)
2025-07-08T20:03:04.9714512Z Test escaped characters in JSON strings ... ok
2025-07-08T20:03:04.9715303Z test_json_decode_errors (__main__.TestParseSetCommandErrorHandling.test_json_decode_errors)
2025-07-08T20:03:04.9717542Z Test handling of invalid JSON values ... ok
2025-07-08T20:03:04.9718734Z test_lines_without_equals (__main__.TestParseSetCommandErrorHandling.test_lines_without_equals)
2025-07-08T20:03:04.9719883Z Test lines that don't contain equals sign are ignored ... ok
2025-07-08T20:03:04.9721133Z test_numeric_boolean_null_values (__main__.TestParseSetCommandErrorHandling.test_numeric_boolean_null_values)
2025-07-08T20:03:04.9722694Z Test various value types ... ok
2025-07-08T20:03:04.9723868Z test_special_characters_in_values (__main__.TestParseSetCommandErrorHandling.test_special_characters_in_values)
2025-07-08T20:03:04.9724873Z Test values containing special characters ... ok
2025-07-08T20:03:04.9726330Z test_unicode_and_emoji (__main__.TestParseSetCommandErrorHandling.test_unicode_and_emoji)
2025-07-08T20:03:04.9727009Z Test unicode characters and emoji ... ok
2025-07-08T20:03:04.9727638Z test_very_long_values (__main__.TestParseSetCommandErrorHandling.test_very_long_values)
2025-07-08T20:03:04.9728310Z Test handling of very long values ... ok
2025-07-08T20:03:04.9728579Z 
2025-07-08T20:03:04.9728774Z ----------------------------------------------------------------------
2025-07-08T20:03:04.9729226Z Ran 10 tests in 0.003s
2025-07-08T20:03:04.9729420Z 
2025-07-08T20:03:04.9729537Z OK
2025-07-08T20:03:05.1329895Z ✅ mvp_site/tests/test_main_error_handling_final.py passed
2025-07-08T20:03:05.1330467Z ----------------------------------------
2025-07-08T20:03:05.1330924Z Running mvp_site/tests/test_main_god_mode.py...
2025-07-08T20:03:05.9733920Z 2025-07-08 20:03:05,973 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9806673Z .2025-07-08 20:03:05,980 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9809309Z 2025-07-08 20:03:05,980 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9810413Z 2025-07-08 20:03:05,980 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = {invalid: json, missing_quotes: true}\n---
2025-07-08T20:03:05.9812205Z 2025-07-08 20:03:05,980 - WARNING - ⚠️ Skipping line in SET command due to invalid JSON value: current_scene = {invalid: json, missing_quotes: true}
2025-07-08T20:03:05.9813538Z 2025-07-08 20:03:05,980 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T20:03:05.9814582Z 2025-07-08 20:03:05,980 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T20:03:05.9860980Z .2025-07-08 20:03:05,985 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9864149Z 2025-07-08 20:03:05,985 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9865012Z 2025-07-08 20:03:05,985 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2\n---
2025-07-08T20:03:05.9866228Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:05.9866801Z   "current_scene": 2
2025-07-08T20:03:05.9867131Z }
2025-07-08T20:03:05.9867545Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:05.9868313Z   "game_state_version": 1,
2025-07-08T20:03:05.9868731Z   "player_character_data": {},
2025-07-08T20:03:05.9869124Z   "world_data": {},
2025-07-08T20:03:05.9869447Z   "npc_data": {},
2025-07-08T20:03:05.9869784Z   "custom_campaign_state": {
2025-07-08T20:03:05.9870198Z     "attribute_system": "D&D"
2025-07-08T20:03:05.9870577Z   },
2025-07-08T20:03:05.9870869Z   "combat_state": {
2025-07-08T20:03:05.9871220Z     "in_combat": false
2025-07-08T20:03:05.9871565Z   },
2025-07-08T20:03:05.9872006Z   "last_state_update_timestamp": "2025-07-08 20:03:05.985783+00:00",
2025-07-08T20:03:05.9872610Z   "time_sensitive_events": {},
2025-07-08T20:03:05.9873023Z   "npc_agendas": {},
2025-07-08T20:03:05.9873576Z   "world_resources": {},
2025-07-08T20:03:05.9873987Z   "time_pressure_warnings": {},
2025-07-08T20:03:05.9874397Z   "debug_mode": true
2025-07-08T20:03:05.9874720Z }
2025-07-08T20:03:05.9875205Z 2025-07-08 20:03:05,986 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:05.9875842Z   "current_scene": 2
2025-07-08T20:03:05.9876181Z }
2025-07-08T20:03:05.9876633Z 2025-07-08 20:03:05,986 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:05.9890307Z 2025-07-08 20:03:05,986 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:05.9891162Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:05.9891730Z   "game_state_version": 1,
2025-07-08T20:03:05.9892132Z   "player_character_data": {},
2025-07-08T20:03:05.9892525Z   "world_data": {},
2025-07-08T20:03:05.9893823Z   "npc_data": {},
2025-07-08T20:03:05.9894378Z   "custom_campaign_state": {
2025-07-08T20:03:05.9895040Z     "attribute_system": "D&D"
2025-07-08T20:03:05.9897834Z   },
2025-07-08T20:03:05.9901780Z   "combat_state": {
2025-07-08T20:03:05.9902147Z     "in_combat": false
2025-07-08T20:03:05.9902482Z   },
2025-07-08T20:03:05.9902904Z   "last_state_update_timestamp": "2025-07-08 20:03:05.985783+00:00",
2025-07-08T20:03:05.9903659Z   "time_sensitive_events": {},
2025-07-08T20:03:05.9904091Z   "npc_agendas": {},
2025-07-08T20:03:05.9904463Z   "world_resources": {},
2025-07-08T20:03:05.9904862Z   "time_pressure_warnings": {},
2025-07-08T20:03:05.9905258Z   "debug_mode": true,
2025-07-08T20:03:05.9905605Z   "current_scene": 2
2025-07-08T20:03:05.9905925Z }
2025-07-08T20:03:05.9906719Z 2025-07-08 20:03:05,986 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (1 entry):\n  - current_scene: 2
2025-07-08T20:03:05.9907874Z 2025-07-08 20:03:05,987 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:05.9938124Z .2025-07-08 20:03:05,993 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9943897Z 2025-07-08 20:03:05,993 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9944778Z 2025-07-08 20:03:05,993 - INFO - GOD_MODE_SET raw payload:\n---\n ["not", "an", "object"]\n---
2025-07-08T20:03:05.9945642Z 2025-07-08 20:03:05,993 - INFO - GOD_MODE_SET parsed changes to be merged:\n{}
2025-07-08T20:03:05.9946674Z 2025-07-08 20:03:05,993 - WARNING - ⚠️ GOD_MODE_SET command resulted in no valid changes.
2025-07-08T20:03:05.9992672Z .2025-07-08 20:03:05,999 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:05.9994379Z 2025-07-08 20:03:05,999 - INFO - --- GOD_MODE_SET received for campaign test-campaign ---
2025-07-08T20:03:05.9996603Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET raw payload:\n---\n current_scene = 2
2025-07-08T20:03:05.9998494Z npcs = [{"name": "Test NPC"}]\n---
2025-07-08T20:03:05.9999094Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET parsed changes to be merged:\n{
2025-07-08T20:03:05.9999914Z   "current_scene": 2,
2025-07-08T20:03:06.0000260Z   "npcs": [
2025-07-08T20:03:06.0000536Z     {
2025-07-08T20:03:06.0000836Z       "name": "Test NPC"
2025-07-08T20:03:06.0001176Z     }
2025-07-08T20:03:06.0001630Z   ]
2025-07-08T20:03:06.0001897Z }
2025-07-08T20:03:06.0002314Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET state BEFORE update:\n{
2025-07-08T20:03:06.0008887Z   "game_state_version": 1,
2025-07-08T20:03:06.0009329Z   "player_character_data": {},
2025-07-08T20:03:06.0009741Z   "world_data": {},
2025-07-08T20:03:06.0010073Z   "npc_data": {},
2025-07-08T20:03:06.0010416Z   "custom_campaign_state": {
2025-07-08T20:03:06.0010828Z     "attribute_system": "D&D"
2025-07-08T20:03:06.0011205Z   },
2025-07-08T20:03:06.0011481Z   "combat_state": {
2025-07-08T20:03:06.0011827Z     "in_combat": false
2025-07-08T20:03:06.0012159Z   },
2025-07-08T20:03:06.0012586Z   "last_state_update_timestamp": "2025-07-08 20:03:05.999065+00:00",
2025-07-08T20:03:06.0013185Z   "time_sensitive_events": {},
2025-07-08T20:03:06.0013750Z   "npc_agendas": {},
2025-07-08T20:03:06.0014104Z   "world_resources": {},
2025-07-08T20:03:06.0014512Z   "time_pressure_warnings": {},
2025-07-08T20:03:06.0014938Z   "debug_mode": true,
2025-07-08T20:03:06.0015314Z   "current_scene": 1,
2025-07-08T20:03:06.0015656Z   "npcs": []
2025-07-08T20:03:06.0015964Z }
2025-07-08T20:03:06.0016462Z 2025-07-08 20:03:05,999 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:06.0017091Z   "current_scene": 2,
2025-07-08T20:03:06.0017434Z   "npcs": [
2025-07-08T20:03:06.0017781Z     {
2025-07-08T20:03:06.0018069Z       "name": "Test NPC"
2025-07-08T20:03:06.0018413Z     }
2025-07-08T20:03:06.0018668Z   ]
2025-07-08T20:03:06.0018930Z }
2025-07-08T20:03:06.0019380Z 2025-07-08 20:03:05,999 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:06.0020134Z 2025-07-08 20:03:05,999 - INFO - COMBAT CLEANUP CHECK: No combatants found, skipping cleanup
2025-07-08T20:03:06.0020879Z 2025-07-08 20:03:05,999 - INFO - GOD_MODE_SET state AFTER update:\n{
2025-07-08T20:03:06.0021408Z   "game_state_version": 1,
2025-07-08T20:03:06.0021795Z   "player_character_data": {},
2025-07-08T20:03:06.0022169Z   "world_data": {},
2025-07-08T20:03:06.0022488Z   "npc_data": {},
2025-07-08T20:03:06.0022825Z   "custom_campaign_state": {
2025-07-08T20:03:06.0023397Z     "attribute_system": "D&D"
2025-07-08T20:03:06.0023759Z   },
2025-07-08T20:03:06.0024043Z   "combat_state": {
2025-07-08T20:03:06.0024350Z     "in_combat": false
2025-07-08T20:03:06.0024663Z   },
2025-07-08T20:03:06.0025037Z   "last_state_update_timestamp": "2025-07-08 20:03:05.999065+00:00",
2025-07-08T20:03:06.0025567Z   "time_sensitive_events": {},
2025-07-08T20:03:06.0025945Z   "npc_agendas": {},
2025-07-08T20:03:06.0026324Z   "world_resources": {},
2025-07-08T20:03:06.0026667Z   "time_pressure_warnings": {},
2025-07-08T20:03:06.0027038Z   "debug_mode": true,
2025-07-08T20:03:06.0027386Z   "current_scene": 2,
2025-07-08T20:03:06.0027729Z   "npcs": [
2025-07-08T20:03:06.0028046Z ... (truncated, showing 19/24 lines)
2025-07-08T20:03:06.0029117Z 2025-07-08 20:03:06,000 - INFO - GOD_MODE_SET changes applied for campaign test-campaign:\nGame state updated (2 entries):\n  - current_scene: 2\n  - npcs: [{"name": "Test NPC"}]
2025-07-08T20:03:06.0030272Z 2025-07-08 20:03:06,000 - INFO - --- GOD_MODE_SET for campaign test-campaign complete ---
2025-07-08T20:03:06.0076505Z .2025-07-08 20:03:06,007 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Invalid state data
2025-07-08T20:03:06.0079383Z 2025-07-08 20:03:06,007 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T20:03:06.0086509Z 2025-07-08 20:03:06,008 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T20:03:06.0088345Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 645, in handle_interaction
2025-07-08T20:03:06.0095205Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0098043Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0099325Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 73, in _prepare_game_state
2025-07-08T20:03:06.0100447Z     current_game_state = GameState.from_dict(current_game_state_doc.to_dict())
2025-07-08T20:03:06.0101137Z                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0102207Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:06.0103025Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:06.0103660Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0104489Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:06.0105383Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:06.0105902Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0106846Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:06.0107703Z     raise effect
2025-07-08T20:03:06.0108073Z ValueError: Invalid state data
2025-07-08T20:03:06.0108355Z 
2025-07-08T20:03:06.0173475Z .2025-07-08 20:03:06,017 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0217378Z .2025-07-08 20:03:06,021 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0261956Z .2025-07-08 20:03:06,025 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0306854Z .2025-07-08 20:03:06,030 - ERROR - 🔥🔴 Critical error in handle_interaction for campaign test-campaign: Unexpected database error
2025-07-08T20:03:06.0313141Z 2025-07-08 20:03:06,030 - ERROR - 🔥🔴 User input: GOD_MODE_UPDATE_STATE: {"current_scene": 2}
2025-07-08T20:03:06.0314325Z 2025-07-08 20:03:06,030 - ERROR - 🔥🔴 Traceback (most recent call last):
2025-07-08T20:03:06.0315455Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 645, in handle_interaction
2025-07-08T20:03:06.0316605Z     current_game_state, was_cleaned, num_cleaned = _prepare_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0317367Z                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0318439Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 69, in _prepare_game_state
2025-07-08T20:03:06.0319581Z     current_game_state_doc = firestore_service.get_campaign_game_state(user_id, campaign_id)
2025-07-08T20:03:06.0320346Z                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0321429Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:06.0322288Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:06.0322756Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0323822Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:06.0324702Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:06.0325213Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:06.0326182Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:06.0327063Z     raise effect
2025-07-08T20:03:06.0327425Z Exception: Unexpected database error
2025-07-08T20:03:06.0327739Z 
2025-07-08T20:03:06.0384434Z .2025-07-08 20:03:06,038 - INFO - RETROACTIVE_ASSIGNMENT: Character 'Player Character' is missing an MBTI type. The AI will be prompted to assign one.
2025-07-08T20:03:06.0386261Z 2025-07-08 20:03:06,038 - INFO - --- update_state_with_changes: applying changes:\n{
2025-07-08T20:03:06.0388081Z   "current_scene": 2,
2025-07-08T20:03:06.0388664Z   "hp": 80
2025-07-08T20:03:06.0389144Z }
2025-07-08T20:03:06.0390948Z 2025-07-08 20:03:06,038 - INFO - --- update_state_with_changes: finished ---
2025-07-08T20:03:06.0405633Z 2025-07-08 20:03:06,040 - INFO - COMBAT CLEANUP CHECK: Found 0 combatants, scanning for defeated enemies...
2025-07-08T20:03:06.0413910Z 2025-07-08 20:03:06,041 - INFO - AUTOMATIC CLEANUP: Defeated enemies removed: <MagicMock name='GameState.from_dict().cleanup_defeated_enemies()' id='139849902954320'>
2025-07-08T20:03:06.0597612Z ......
2025-07-08T20:03:06.0599094Z ----------------------------------------------------------------------
2025-07-08T20:03:06.0599562Z Ran 16 tests in 0.094s
2025-07-08T20:03:06.0599763Z 
2025-07-08T20:03:06.0599871Z OK
2025-07-08T20:03:06.1921904Z ✅ mvp_site/tests/test_main_god_mode.py passed
2025-07-08T20:03:06.1923558Z ----------------------------------------
2025-07-08T20:03:06.1924073Z Running mvp_site/tests/test_main_route_edge_cases.py...
2025-07-08T20:03:07.1343079Z sssssssssssssssssssssssss
2025-07-08T20:03:07.1344418Z ----------------------------------------------------------------------
2025-07-08T20:03:07.1345078Z Ran 25 tests in 0.000s
2025-07-08T20:03:07.1345309Z 
2025-07-08T20:03:07.1345440Z OK (skipped=25)
2025-07-08T20:03:07.2803755Z ✅ mvp_site/tests/test_main_route_edge_cases.py passed
2025-07-08T20:03:07.2805300Z ----------------------------------------
2025-07-08T20:03:07.2805794Z Running mvp_site/tests/test_main_routes.py...
2025-07-08T20:03:08.1485956Z 2025-07-08 20:03:08,148 - INFO - Received custom_options: []
2025-07-08T20:03:08.1487141Z 2025-07-08 20:03:08,148 - INFO - Selected attribute_system: D&D
2025-07-08T20:03:08.1539960Z .2025-07-08 20:03:08,153 - INFO - Received custom_options: ['companions', 'defaultWorld']
2025-07-08T20:03:08.1541172Z 2025-07-08 20:03:08,153 - INFO - Selected attribute_system: D&D
2025-07-08T20:03:08.1705090Z ...2025-07-08 20:03:08,170 - INFO - Exporting file '/tmp/campaign_exports/test-uuid.txt' with download_name='Test Campaign.txt'
2025-07-08T20:03:08.2078793Z ........Traceback (most recent call last):
2025-07-08T20:03:08.2081978Z   File "/home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/main.py", line 620, in update_campaign
2025-07-08T20:03:08.2083121Z     firestore_service.update_campaign_title(user_id, campaign_id, new_title)
2025-07-08T20:03:08.2084433Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1124, in __call__
2025-07-08T20:03:08.2085292Z     return self._mock_call(*args, **kwargs)
2025-07-08T20:03:08.2085742Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:08.2086621Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1128, in _mock_call
2025-07-08T20:03:08.2087530Z     return self._execute_mock_call(*args, **kwargs)
2025-07-08T20:03:08.2088032Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-07-08T20:03:08.2088961Z   File "/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/mock.py", line 1183, in _execute_mock_call
2025-07-08T20:03:08.2089874Z     raise effect
2025-07-08T20:03:08.2090249Z Exception: Update failed
2025-07-08T20:03:08.2244069Z .....
2025-07-08T20:03:08.2246302Z ----------------------------------------------------------------------
2025-07-08T20:03:08.2246804Z Ran 17 tests in 0.083s
2025-07-08T20:03:08.2248083Z 
2025-07-08T20:03:08.2251347Z OK
2025-07-08T20:03:08.3629664Z ✅ mvp_site/tests/test_main_routes.py passed
2025-07-08T20:03:08.3632442Z ----------------------------------------
2025-07-08T20:03:08.3633004Z Running mvp_site/tests/test_main_routes_comprehensive.py...
2025-07-08T20:03:09.2169598Z ...2025-07-08 20:03:09,216 - INFO - Legacy state cleanup complete. Removed 5 entries.
2025-07-08T20:03:09.2171665Z .
2025-07-08T20:03:09.2172015Z ----------------------------------------------------------------------
2025-07-08T20:03:09.2173026Z Ran 4 tests in 0.006s
2025-07-08T20:03:09.2173503Z 
2025-07-08T20:03:09.2173607Z OK
2025-07-08T20:03:09.3745953Z ✅ mvp_site/tests/test_main_routes_comprehensive.py passed
2025-07-08T20:03:09.3747769Z ----------------------------------------
2025-07-08T20:03:09.3748724Z Running mvp_site/tests/test_main_security_validation.py...
2025-07-08T20:03:09.4798573Z .........../opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/zipfile.py:1567: UserWarning: Duplicate name: 'file1.txt'
2025-07-08T20:03:09.4799928Z   return self._open_to_write(zinfo, force_zip64=force_zip64)
2025-07-08T20:03:09.4898007Z .................
2025-07-08T20:03:09.4898918Z ----------------------------------------------------------------------
2025-07-08T20:03:09.4900041Z Ran 28 tests in 0.045s
2025-07-08T20:03:09.4900923Z 
2025-07-08T20:03:09.4902175Z OK
2025-07-08T20:03:09.5046088Z ✅ mvp_site/tests/test_main_security_validation.py passed
2025-07-08T20:03:09.5048010Z ----------------------------------------
2025-07-08T20:03:09.5048558Z Running mvp_site/tests/test_main_state_helper.py...
2025-07-08T20:03:10.3897994Z .........s.......
2025-07-08T20:03:10.3899525Z ----------------------------------------------------------------------
2025-07-08T20:03:10.3900031Z Ran 17 tests in 0.019s
2025-07-08T20:03:10.3900274Z 
2025-07-08T20:03:10.3900390Z OK (skipped=1)
2025-07-08T20:03:10.5249831Z ✅ mvp_site/tests/test_main_state_helper.py passed
2025-07-08T20:03:10.5251287Z ----------------------------------------
2025-07-08T20:03:10.5251889Z Running mvp_site/tests/test_milestone_4_interactive_features.py...
2025-07-08T20:03:10.5657853Z 🚀 Starting Milestone 4: Interactive Features Test Suite
2025-07-08T20:03:10.5659505Z ============================================================
2025-07-08T20:03:10.5660199Z 🧪 Testing Milestone 4: Interactive Features
2025-07-08T20:03:10.5660676Z ============================================================
2025-07-08T20:03:10.5661492Z test_accessibility_features (__main__.TestMilestone4InteractiveFeatures.test_accessibility_features)
2025-07-08T20:03:10.5666088Z Test that interactive features maintain accessibility ... ✅ Interactive features maintain accessibility standards
2025-07-08T20:03:10.5667739Z ok
2025-07-08T20:03:10.5668480Z test_backward_compatibility (__main__.TestMilestone4InteractiveFeatures.test_backward_compatibility)
2025-07-08T20:03:10.5671869Z Test that features maintain backward compatibility ... ✅ All features maintain backward compatibility
2025-07-08T20:03:10.5673789Z ok
2025-07-08T20:03:10.5674554Z test_campaign_wizard_html_structure (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_html_structure)
2025-07-08T20:03:10.5677860Z Test campaign wizard generates proper HTML structure ... ✅ Campaign wizard generates proper HTML structure
2025-07-08T20:03:10.5679511Z ok
2025-07-08T20:03:10.5680201Z test_campaign_wizard_js_exists (__main__.TestMilestone4InteractiveFeatures.test_campaign_wizard_js_exists)
2025-07-08T20:03:10.5683857Z Test that campaign wizard JavaScript file exists ... ✅ Campaign Wizard JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5685649Z ok
2025-07-08T20:03:10.5686365Z test_css_modern_mode_selectors (__main__.TestMilestone4InteractiveFeatures.test_css_modern_mode_selectors)
2025-07-08T20:03:10.5687987Z Test CSS has proper modern mode selectors ... ✅ CSS has proper modern mode selectors and responsive design
2025-07-08T20:03:10.5688924Z ok
2025-07-08T20:03:10.5689626Z test_css_theme_integration (__main__.TestMilestone4InteractiveFeatures.test_css_theme_integration)
2025-07-08T20:03:10.5691084Z Test CSS integrates properly with existing theme system ... ✅ CSS integrates properly with existing theme system
2025-07-08T20:03:10.5693054Z ok
2025-07-08T20:03:10.5694933Z test_enhanced_search_features (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_features)
2025-07-08T20:03:10.5696261Z Test enhanced search has all required features ... ✅ Enhanced search has all required features
2025-07-08T20:03:10.5697304Z ok
2025-07-08T20:03:10.5699282Z test_enhanced_search_js_exists (__main__.TestMilestone4InteractiveFeatures.test_enhanced_search_js_exists)
2025-07-08T20:03:10.5701816Z Test that enhanced search JavaScript file exists ... ✅ Enhanced Search JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5702712Z ok
2025-07-08T20:03:10.5703481Z test_error_handling (__main__.TestMilestone4InteractiveFeatures.test_error_handling)
2025-07-08T20:03:10.5706254Z Test that features handle errors gracefully ... ✅ Features include proper error handling
2025-07-08T20:03:10.5707753Z ok
2025-07-08T20:03:10.5708452Z test_file_integration_order (__main__.TestMilestone4InteractiveFeatures.test_file_integration_order)
2025-07-08T20:03:10.5709975Z Test that files are loaded in the correct order ... ✅ JavaScript files are loaded in correct dependency order
2025-07-08T20:03:10.5710950Z ok
2025-07-08T20:03:10.5711748Z test_index_html_has_interface_toggle (__main__.TestMilestone4InteractiveFeatures.test_index_html_has_interface_toggle)
2025-07-08T20:03:10.5714770Z Test that index.html contains the interface mode toggle ... ✅ index.html contains interface mode toggle UI
2025-07-08T20:03:10.5716417Z ok
2025-07-08T20:03:10.5717181Z test_index_html_includes_scripts (__main__.TestMilestone4InteractiveFeatures.test_index_html_includes_scripts)
2025-07-08T20:03:10.5718741Z Test that index.html includes all necessary script files ... ✅ index.html includes all interactive features scripts and CSS
2025-07-08T20:03:10.5719635Z ok
2025-07-08T20:03:10.5720642Z test_interactive_features_css_exists (__main__.TestMilestone4InteractiveFeatures.test_interactive_features_css_exists)
2025-07-08T20:03:10.5722458Z Test that interactive features CSS file exists ... ✅ Interactive Features CSS file exists and contains styling rules
2025-07-08T20:03:10.5723649Z ok
2025-07-08T20:03:10.5725687Z test_interface_manager_feature_control (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_feature_control)
2025-07-08T20:03:10.5728103Z Test interface manager can control features ... ✅ Interface manager has proper feature control methods
2025-07-08T20:03:10.5728830Z ok
2025-07-08T20:03:10.5729559Z test_interface_manager_js_exists (__main__.TestMilestone4InteractiveFeatures.test_interface_manager_js_exists)
2025-07-08T20:03:10.5731569Z Test that interface manager JavaScript file exists ... ✅ Interface Manager JavaScript file exists and contains core functionality
2025-07-08T20:03:10.5732558Z ok
2025-07-08T20:03:10.5733456Z test_javascript_file_structure (__main__.TestMilestone4InteractiveFeatures.test_javascript_file_structure)
2025-07-08T20:03:10.5735415Z Test JavaScript files have proper structure ... ✅ All JavaScript files have proper structure and integration
2025-07-08T20:03:10.5736167Z ok
2025-07-08T20:03:10.5736873Z test_performance_considerations (__main__.TestMilestone4InteractiveFeatures.test_performance_considerations)
2025-07-08T20:03:10.5739188Z Test that features are optimized for performance ... ✅ Features include performance optimizations
2025-07-08T20:03:10.5740738Z ok
2025-07-08T20:03:10.5741457Z test_progressive_enhancement (__main__.TestMilestone4InteractiveFeatures.test_progressive_enhancement)
2025-07-08T20:03:10.5745573Z Test that features use progressive enhancement ... ✅ Features use progressive enhancement and default to safe mode
2025-07-08T20:03:10.5747177Z ok
2025-07-08T20:03:10.5747330Z 
2025-07-08T20:03:10.5747537Z ----------------------------------------------------------------------
2025-07-08T20:03:10.5748047Z Ran 18 tests in 0.009s
2025-07-08T20:03:10.5748262Z 
2025-07-08T20:03:10.5748374Z OK
2025-07-08T20:03:10.5748519Z 
2025-07-08T20:03:10.5748666Z ============================================================
2025-07-08T20:03:10.5749158Z 🎯 MILESTONE 4 TEST SUMMARY
2025-07-08T20:03:10.5749511Z ============================================================
2025-07-08T20:03:10.5749955Z ✅ Passed: 18/18
2025-07-08T20:03:10.5750127Z 
2025-07-08T20:03:10.5750444Z 🎉 MILESTONE 4: INTERACTIVE FEATURES - ALL TESTS PASSED!
2025-07-08T20:03:10.5751229Z 📋 Features Ready:
2025-07-08T20:03:10.5751641Z    • Master Interface Toggle (Classic/Modern)
2025-07-08T20:03:10.5752150Z    • Campaign Wizard (Multi-step Creation)
2025-07-08T20:03:10.5752603Z    • Enhanced Search & Filter
2025-07-08T20:03:10.5753162Z    • Enhanced Modals
2025-07-08T20:03:10.5753798Z    • Backward Compatibility
2025-07-08T20:03:10.5754236Z    • Progressive Enhancement
2025-07-08T20:03:10.5817547Z ✅ mvp_site/tests/test_milestone_4_interactive_features.py passed
2025-07-08T20:03:10.5819095Z ----------------------------------------
2025-07-08T20:03:10.5819662Z Running mvp_site/tests/test_mission_conversion_helpers.py...
2025-07-08T20:03:10.8440196Z .........
2025-07-08T20:03:10.8443888Z ----------------------------------------------------------------------
2025-07-08T20:03:10.8444400Z Ran 9 tests in 0.002s
2025-07-08T20:03:10.8444600Z 
2025-07-08T20:03:10.8444705Z OK
2025-07-08T20:03:10.8828016Z ✅ mvp_site/tests/test_mission_conversion_helpers.py passed
2025-07-08T20:03:10.8829099Z ----------------------------------------
2025-07-08T20:03:10.8829878Z Running mvp_site/tests/test_mission_handling.py...
2025-07-08T20:03:11.1398630Z WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:03:11.1401743Z ..WARNING:root:⚠️ SMART CONVERSION: AI attempted to set 'active_missions' as dict. Converting to list append.
2025-07-08T20:03:11.1402462Z .
2025-07-08T20:03:11.1402796Z ----------------------------------------------------------------------
2025-07-08T20:03:11.1403480Z Ran 3 tests in 0.001s
2025-07-08T20:03:11.1403684Z 
2025-07-08T20:03:11.1403792Z OK
2025-07-08T20:03:11.1788864Z ✅ mvp_site/tests/test_mission_handling.py passed
2025-07-08T20:03:11.1789958Z ----------------------------------------
2025-07-08T20:03:11.1791738Z Running mvp_site/tests/test_narrative_cutoff_bug.py...
2025-07-08T20:03:11.2192260Z test_complex_nested_quotes (__main__.TestNarrativeCutoffBug.test_complex_nested_quotes)
2025-07-08T20:03:11.2196223Z Test extraction with complex nested quotes and escape sequences. ... ok
2025-07-08T20:03:11.2197372Z test_extraction_performance (__main__.TestNarrativeCutoffBug.test_extraction_performance)
2025-07-08T20:03:11.2215707Z Test that the fix handles very long narratives efficiently. ... ok
2025-07-08T20:03:11.2216920Z test_incomplete_json_narrative (__main__.TestNarrativeCutoffBug.test_incomplete_json_narrative)
2025-07-08T20:03:11.2218296Z Test that incomplete JSON (cut off mid-narrative) still extracts what's available. ... ok
2025-07-08T20:03:11.2221331Z test_narrative_extraction_with_quotes_GREEN_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_GREEN_phase)
2025-07-08T20:03:11.2223850Z GREEN PHASE: Demonstrate that the fixed implementation works correctly. ... ok
2025-07-08T20:03:11.2225333Z test_narrative_extraction_with_quotes_RED_phase (__main__.TestNarrativeCutoffBug.test_narrative_extraction_with_quotes_RED_phase)
2025-07-08T20:03:11.2226195Z 
2025-07-08T20:03:11.2226687Z RED PHASE: Demonstrate that a naive regex approach would fail. ... ok
2025-07-08T20:03:11.2229587Z test_narrative_with_json_special_chars (__main__.TestNarrativeCutoffBug.test_narrative_with_json_special_chars)
2025-07-08T20:03:11.2230799Z Test narratives containing JSON special characters. ... ok
2025-07-08T20:03:11.2232480Z 
2025-07-08T20:03:11.2232722Z ----------------------------------------------------------------------
2025-07-08T20:03:11.2233434Z Ran 6 tests in 0.003s
2025-07-08T20:03:11.2233656Z 
2025-07-08T20:03:11.2233767Z OK
2025-07-08T20:03:11.2235892Z Actual result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T20:03:11.2238396Z 
2025-07-08T20:03:11.2240554Z Expected result: 'The wizard says, "The ancient tome reads: \'Beware the curse of the shadow realm, for it whispers \\"death\\" to all who enter.\' We must be careful."\n\nHe continues, "I\'ve studied these texts for years. The curse can only be broken by someone who truly understands the meaning of sacrifice."\n\nOptions:\n1. Ask about the curse\n2. "Tell me more about this \'sacrifice\' you mentioned"\n3. Leave immediately'
2025-07-08T20:03:11.2242433Z 
2025-07-08T20:03:11.2242952Z 🟢 GREEN PHASE: Fixed extraction successfully got all 691 chars
2025-07-08T20:03:11.2243911Z Narrative ends correctly with: ...g presence to get him to spill everything quickly.
2025-07-08T20:03:11.2244610Z 
2025-07-08T20:03:11.2245072Z 🔴 RED PHASE: Buggy extraction got only 177 chars instead of 691
2025-07-08T20:03:11.2245798Z Cutoff happened at: ...proaches you, his eyes gleaming with urgency.\n\n\
2025-07-08T20:03:11.2293755Z ✅ mvp_site/tests/test_narrative_cutoff_bug.py passed
2025-07-08T20:03:11.2295153Z ----------------------------------------
2025-07-08T20:03:11.2295648Z Running mvp_site/tests/test_npc_data_handling.py...
2025-07-08T20:03:11.4837561Z .....
2025-07-08T20:03:11.4838413Z ----------------------------------------------------------------------
2025-07-08T20:03:11.4840865Z Ran 5 tests in 0.001s
2025-07-08T20:03:11.4841086Z 
2025-07-08T20:03:11.4841187Z OK
2025-07-08T20:03:11.5230407Z ✅ mvp_site/tests/test_npc_data_handling.py passed
2025-07-08T20:03:11.5231919Z ----------------------------------------
2025-07-08T20:03:11.5232501Z Running mvp_site/tests/test_npc_gender_consistency_red_green.py...
2025-07-08T20:03:11.6976242Z .....
2025-07-08T20:03:11.6978398Z ----------------------------------------------------------------------
2025-07-08T20:03:11.6978891Z Ran 5 tests in 0.001s
2025-07-08T20:03:11.6979094Z 
2025-07-08T20:03:11.6979194Z OK
2025-07-08T20:03:11.7194195Z ✅ mvp_site/tests/test_npc_gender_consistency_red_green.py passed
2025-07-08T20:03:11.7195798Z ----------------------------------------
2025-07-08T20:03:11.7196331Z Running mvp_site/tests/test_null_narrative_bug_fix.py...
2025-07-08T20:03:11.7639131Z .....
2025-07-08T20:03:11.7639897Z ----------------------------------------------------------------------
2025-07-08T20:03:11.7642222Z Ran 5 tests in 0.000s
2025-07-08T20:03:11.7642715Z 
2025-07-08T20:03:11.7644465Z OK
2025-07-08T20:03:11.7707622Z ✅ mvp_site/tests/test_null_narrative_bug_fix.py passed
2025-07-08T20:03:11.7708986Z ----------------------------------------
2025-07-08T20:03:11.7709533Z Running mvp_site/tests/test_numeric_field_converter.py...
2025-07-08T20:03:11.8106274Z ...........
2025-07-08T20:03:11.8107809Z ----------------------------------------------------------------------
2025-07-08T20:03:11.8108338Z Ran 11 tests in 0.001s
2025-07-08T20:03:11.8108568Z 
2025-07-08T20:03:11.8108686Z OK
2025-07-08T20:03:11.8166989Z ✅ mvp_site/tests/test_numeric_field_converter.py passed
2025-07-08T20:03:11.8168373Z ----------------------------------------
2025-07-08T20:03:11.8168976Z Running mvp_site/tests/test_planning_block_enforcement.py...
2025-07-08T20:03:11.9502607Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9508856Z   @validator('strength', pre=True)
2025-07-08T20:03:11.9511539Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9514685Z   @validator('dexterity', pre=True)
2025-07-08T20:03:11.9517431Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9520007Z   @validator('constitution', pre=True)
2025-07-08T20:03:11.9522370Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9525220Z   @validator('intelligence', pre=True)
2025-07-08T20:03:11.9527863Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9530501Z   @validator('wisdom', pre=True)
2025-07-08T20:03:11.9533103Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9535939Z   @validator('charisma', pre=True)
2025-07-08T20:03:11.9678624Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9691711Z   @validator('hp', pre=True)
2025-07-08T20:03:11.9694516Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9697166Z   @validator('hp_max', pre=True)
2025-07-08T20:03:11.9699806Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9702468Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:11.9726471Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9731345Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:11.9757449Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9760643Z   @validator('level', pre=True)
2025-07-08T20:03:11.9764041Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9767017Z   @validator('gender')
2025-07-08T20:03:11.9769846Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9772854Z   @validator('age')
2025-07-08T20:03:11.9776033Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9779016Z   @validator('mbti')
2025-07-08T20:03:11.9781775Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9784848Z   @validator('alignment')
2025-07-08T20:03:11.9787706Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9790764Z   @validator('entity_type')
2025-07-08T20:03:11.9939962Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9943025Z   @validator('participants')
2025-07-08T20:03:11.9958302Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9965645Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:11.9968856Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:11.9971546Z   @validator('present_entities')
2025-07-08T20:03:12.0116457Z 2025-07-08 20:03:12,011 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0133056Z 2025-07-08 20:03:12,013 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0134219Z 2025-07-08 20:03:12,013 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0148877Z 2025-07-08 20:03:12,014 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0163675Z 2025-07-08 20:03:12,016 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0165472Z 2025-07-08 20:03:12,016 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0167379Z 2025-07-08 20:03:12,016 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0198732Z .2025-07-08 20:03:12,019 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0211671Z 2025-07-08 20:03:12,020 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0213617Z 2025-07-08 20:03:12,021 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0224161Z 2025-07-08 20:03:12,022 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0229020Z 2025-07-08 20:03:12,022 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0230911Z 2025-07-08 20:03:12,022 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0233158Z 2025-07-08 20:03:12,022 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0272171Z .2025-07-08 20:03:12,026 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0277870Z 2025-07-08 20:03:12,027 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0280186Z 2025-07-08 20:03:12,027 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0280977Z 2025-07-08 20:03:12,027 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0284321Z 2025-07-08 20:03:12,028 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0286478Z 2025-07-08 20:03:12,028 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0288727Z 2025-07-08 20:03:12,028 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0290084Z 2025-07-08 20:03:12,028 - WARNING - ⚠️ No specific system prompts selected for continue_story. Using none.
2025-07-08T20:03:12.0294420Z 2025-07-08 20:03:12,029 - INFO - Prompt scaffold is 131 chars (~32 tokens). Remaining budget for story: 2999869 chars (~749967 tokens)
2025-07-08T20:03:12.0296799Z 2025-07-08 20:03:12,029 - INFO - Initial context stats: Turns: 0, Tokens: 0
2025-07-08T20:03:12.0297716Z 2025-07-08 20:03:12,029 - INFO - Context is within token budget. No truncation needed.
2025-07-08T20:03:12.0299067Z 2025-07-08 20:03:12,029 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0301078Z 2025-07-08 20:03:12,029 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0303483Z 2025-07-08 20:03:12,029 - INFO - Recovered from incomplete JSON response. Narrative length: 34 characters (~8 tokens)
2025-07-08T20:03:12.0312339Z .2025-07-08 20:03:12,031 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0321297Z 2025-07-08 20:03:12,031 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T20:03:12.0331076Z .2025-07-08 20:03:12,032 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0341054Z 2025-07-08 20:03:12,033 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0343044Z 2025-07-08 20:03:12,033 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0345926Z 2025-07-08 20:03:12,034 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T20:03:12.0346925Z 2025-07-08 20:03:12,034 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0353727Z .2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0355965Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0356804Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0357625Z 2025-07-08 20:03:12,035 - INFO - Skipping planning block for character creation step
2025-07-08T20:03:12.0382376Z ...2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0384798Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0385680Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0386528Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0387381Z 2025-07-08 20:03:12,038 - INFO - User switching to god/dm mode - skipping planning block
2025-07-08T20:03:12.0394493Z .2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0396630Z 2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0397519Z 2025-07-08 20:03:12,039 - INFO - Response indicates mode switch - skipping planning block
2025-07-08T20:03:12.0406079Z .2025-07-08 20:03:12,040 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0417009Z 2025-07-08 20:03:12,041 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0418937Z 2025-07-08 20:03:12,041 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0421227Z 2025-07-08 20:03:12,041 - INFO - Recovered from incomplete JSON response. Narrative length: 206 characters (~51 tokens)
2025-07-08T20:03:12.0422206Z 2025-07-08 20:03:12,041 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0429272Z .2025-07-08 20:03:12,042 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0440262Z 2025-07-08 20:03:12,043 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0442174Z 2025-07-08 20:03:12,043 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0444959Z 2025-07-08 20:03:12,043 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0445985Z 2025-07-08 20:03:12,043 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0447207Z 2025-07-08 20:03:12,044 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0449038Z 2025-07-08 20:03:12,044 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0451227Z 2025-07-08 20:03:12,044 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0452283Z 2025-07-08 20:03:12,044 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0453676Z 2025-07-08 20:03:12,044 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0454863Z 2025-07-08 20:03:12,044 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0455984Z 2025-07-08 20:03:12,044 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0456785Z 2025-07-08 20:03:12,044 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0457831Z 2025-07-08 20:03:12,044 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0458831Z 2025-07-08 20:03:12,044 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0459950Z 2025-07-08 20:03:12,045 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0461798Z 2025-07-08 20:03:12,045 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0463762Z 2025-07-08 20:03:12,045 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0464813Z 2025-07-08 20:03:12,045 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0465736Z 2025-07-08 20:03:12,045 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0466828Z 2025-07-08 20:03:12,045 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0467842Z 2025-07-08 20:03:12,045 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0468563Z 2025-07-08 20:03:12,045 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0469542Z 2025-07-08 20:03:12,045 - INFO - Recovered from incomplete JSON response. Narrative length: 601 characters (~150 tokens)
2025-07-08T20:03:12.0470474Z 2025-07-08 20:03:12,045 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.0479121Z .2025-07-08 20:03:12,047 - INFO - Planning block found in response
2025-07-08T20:03:12.0489188Z .2025-07-08 20:03:12,048 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.0499534Z 2025-07-08 20:03:12,049 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.0501406Z 2025-07-08 20:03:12,049 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.0503689Z 2025-07-08 20:03:12,049 - INFO - Recovered from incomplete JSON response. Narrative length: 163 characters (~40 tokens)
2025-07-08T20:03:12.0504542Z 2025-07-08 20:03:12,049 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:12.0505026Z .
2025-07-08T20:03:12.0505358Z ----------------------------------------------------------------------
2025-07-08T20:03:12.0505819Z Ran 14 tests in 0.171s
2025-07-08T20:03:12.0506016Z 
2025-07-08T20:03:12.0506125Z OK
2025-07-08T20:03:12.0771999Z ✅ mvp_site/tests/test_planning_block_enforcement.py passed
2025-07-08T20:03:12.0774000Z ----------------------------------------
2025-07-08T20:03:12.0774636Z Running mvp_site/tests/test_planning_block_json_corruption_fix.py...
2025-07-08T20:03:12.7088684Z test_planning_block_api_failure_fallback (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_api_failure_fallback)
2025-07-08T20:03:12.7097606Z TEST: Verify that when planning block generation fails, ... 2025-07-08 20:03:12,709 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7100117Z 2025-07-08 20:03:12,709 - ERROR - 🔥🔴 Failed to generate planning block: API Error
2025-07-08T20:03:12.7100748Z ok
2025-07-08T20:03:12.7101662Z test_planning_block_json_response_gets_parsed (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_json_response_gets_parsed)
2025-07-08T20:03:12.7106497Z RED TEST: Verify that when planning block generation returns JSON, ... 2025-07-08 20:03:12,710 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7109070Z 2025-07-08 20:03:12,710 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.7109660Z ok
2025-07-08T20:03:12.7110615Z test_planning_block_plain_text_response_unchanged (__main__.TestPlanningBlockJSONCorruptionFix.test_planning_block_plain_text_response_unchanged)
2025-07-08T20:03:12.7116104Z GREEN TEST: Verify that when planning block generation returns plain text, ... 2025-07-08 20:03:12,711 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:12.7126272Z 2025-07-08 20:03:12,712 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:12.7128396Z 2025-07-08 20:03:12,712 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:12.7129699Z 2025-07-08 20:03:12,712 - INFO - Recovered from incomplete JSON response. Narrative length: 219 characters (~54 tokens)
2025-07-08T20:03:12.7130563Z 2025-07-08 20:03:12,712 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:12.7131085Z ok
2025-07-08T20:03:12.7131510Z 
2025-07-08T20:03:12.7131902Z 🔴 RUNNING RED/GREEN TESTS: Planning Block JSON Corruption Fix
2025-07-08T20:03:12.7132432Z ======================================================================
2025-07-08T20:03:12.7133053Z ✅ Test passed: Planning block API failure fallback works
2025-07-08T20:03:12.7133886Z ✅ Test passed: Planning block JSON response properly parsed
2025-07-08T20:03:12.7134388Z Result length: 274 characters
2025-07-08T20:03:12.7135105Z Result preview: 'eed cautiously** - Move forward carefully\n3. **Cast a detection spell** - Use magic to sense dangers'
2025-07-08T20:03:12.7136055Z ✅ Test passed: Planning block plain text response works correctly
2025-07-08T20:03:12.7137358Z ----------------------------------------------------------------------
2025-07-08T20:03:12.7137818Z Ran 3 tests in 0.004s
2025-07-08T20:03:12.7138010Z 
2025-07-08T20:03:12.7138114Z OK
2025-07-08T20:03:12.7837319Z ✅ mvp_site/tests/test_planning_block_json_corruption_fix.py passed
2025-07-08T20:03:12.7839137Z ----------------------------------------
2025-07-08T20:03:12.7839670Z Running mvp_site/tests/test_planning_block_simplified.py...
2025-07-08T20:03:13.4144399Z 2025-07-08 20:03:13,414 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4157472Z 2025-07-08 20:03:13,415 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4158927Z 2025-07-08 20:03:13,415 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4161826Z 2025-07-08 20:03:13,415 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4162827Z 2025-07-08 20:03:13,415 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4165634Z 2025-07-08 20:03:13,416 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4171110Z 2025-07-08 20:03:13,416 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4171978Z 2025-07-08 20:03:13,416 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4173725Z 2025-07-08 20:03:13,417 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4175422Z 2025-07-08 20:03:13,417 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4180394Z 2025-07-08 20:03:13,417 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4183175Z 2025-07-08 20:03:13,418 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4184746Z 2025-07-08 20:03:13,418 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4186257Z 2025-07-08 20:03:13,418 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4187544Z 2025-07-08 20:03:13,418 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4193386Z 2025-07-08 20:03:13,419 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4196831Z 2025-07-08 20:03:13,419 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4198020Z 2025-07-08 20:03:13,419 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4199554Z 2025-07-08 20:03:13,419 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4200750Z 2025-07-08 20:03:13,419 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4205740Z 2025-07-08 20:03:13,420 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4208522Z 2025-07-08 20:03:13,420 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4209681Z 2025-07-08 20:03:13,420 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4211020Z 2025-07-08 20:03:13,420 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4213475Z 2025-07-08 20:03:13,420 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4217688Z .2025-07-08 20:03:13,421 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4222075Z 2025-07-08 20:03:13,422 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4223461Z 2025-07-08 20:03:13,422 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4225032Z 2025-07-08 20:03:13,422 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4227340Z 2025-07-08 20:03:13,422 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:13.4231198Z .2025-07-08 20:03:13,422 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4234378Z 2025-07-08 20:03:13,423 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4235591Z 2025-07-08 20:03:13,423 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4237152Z 2025-07-08 20:03:13,423 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4239456Z 2025-07-08 20:03:13,423 - INFO - Added LLM-generated standard planning block
2025-07-08T20:03:13.4243842Z .2025-07-08 20:03:13,424 - WARNING - ⚠️ PLANNING_BLOCK_MISSING: Story mode response missing required planning block
2025-07-08T20:03:13.4248554Z 2025-07-08 20:03:13,424 - ERROR - 🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:13.4249944Z 2025-07-08 20:03:13,424 - INFO - No JSON found in response, treating as plain text narrative
2025-07-08T20:03:13.4251140Z 2025-07-08 20:03:13,424 - INFO - Recovered from incomplete JSON response. Narrative length: 32 characters (~8 tokens)
2025-07-08T20:03:13.4253162Z 2025-07-08 20:03:13,424 - INFO - Added LLM-generated deep think planning block
2025-07-08T20:03:13.4254570Z .
2025-07-08T20:03:13.4255054Z ----------------------------------------------------------------------
2025-07-08T20:03:13.4255607Z Ran 4 tests in 0.012s
2025-07-08T20:03:13.4260619Z 
2025-07-08T20:03:13.4260922Z OK
2025-07-08T20:03:13.4970861Z ✅ mvp_site/tests/test_planning_block_simplified.py passed
2025-07-08T20:03:13.4972498Z ----------------------------------------
2025-07-08T20:03:13.4973000Z Running mvp_site/tests/test_planning_blocks_ui.py...
2025-07-08T20:03:13.5328077Z ....
2025-07-08T20:03:13.5328830Z ----------------------------------------------------------------------
2025-07-08T20:03:13.5329659Z Ran 4 tests in 0.000s
2025-07-08T20:03:13.5330184Z 
2025-07-08T20:03:13.5330450Z OK
2025-07-08T20:03:13.5384975Z ✅ mvp_site/tests/test_planning_blocks_ui.py passed
2025-07-08T20:03:13.5386331Z ----------------------------------------
2025-07-08T20:03:13.5386828Z Running mvp_site/tests/test_pr_changes_runner.py...
2025-07-08T20:03:13.7108636Z 
2025-07-08T20:03:13.7110372Z === Testing Debug Mode Default Change ===
2025-07-08T20:03:13.7111553Z ✓ GameState defaults to debug_mode=True
2025-07-08T20:03:13.7114334Z ✓ GameState can be set to debug_mode=False
2025-07-08T20:03:13.7114827Z ✓ debug_mode is included in serialization
2025-07-08T20:03:13.7115359Z ✓ debug_mode is preserved in deserialization
2025-07-08T20:03:13.7115651Z 
2025-07-08T20:03:13.7115795Z === Testing Entity Schema Constant ===
2025-07-08T20:03:13.7116446Z ✓ Entity schema has been properly integrated into game_state instructions
2025-07-08T20:03:13.7116881Z 
2025-07-08T20:03:13.7117026Z === Testing Manifest Cache Exclusion ===
2025-07-08T20:03:13.7117679Z ✓ Internal attributes starting with _ are excluded from serialization
2025-07-08T20:03:13.7118095Z 
2025-07-08T20:03:13.7118233Z === Testing Entity ID Format ===
2025-07-08T20:03:13.7118725Z ✓ PC entity ID format correct: pc_test_hero_001
2025-07-08T20:03:13.7119274Z ✓ NPC entity ID format correct: npc_guard_captain_001
2025-07-08T20:03:13.7119616Z 
2025-07-08T20:03:13.7119750Z === All PR Change Tests Passed! ===
2025-07-08T20:03:13.7352585Z ✅ mvp_site/tests/test_pr_changes_runner.py passed
2025-07-08T20:03:13.7354169Z ----------------------------------------
2025-07-08T20:03:13.7354742Z Running mvp_site/tests/test_prompt_mission_examples.py...
2025-07-08T20:03:13.7720685Z ....
2025-07-08T20:03:13.7722402Z ----------------------------------------------------------------------
2025-07-08T20:03:13.7724761Z Ran 4 tests in 0.001s
2025-07-08T20:03:13.7725167Z 
2025-07-08T20:03:13.7725847Z OK
2025-07-08T20:03:13.7777059Z ✅ mvp_site/tests/test_prompt_mission_examples.py passed
2025-07-08T20:03:13.7777925Z ----------------------------------------
2025-07-08T20:03:13.7778817Z Running mvp_site/tests/test_prompt_npc_examples.py...
2025-07-08T20:03:13.8141608Z ....
2025-07-08T20:03:13.8142444Z ----------------------------------------------------------------------
2025-07-08T20:03:13.8144511Z Ran 4 tests in 0.001s
2025-07-08T20:03:13.8144738Z 
2025-07-08T20:03:13.8144896Z OK
2025-07-08T20:03:13.8198511Z ✅ mvp_site/tests/test_prompt_npc_examples.py passed
2025-07-08T20:03:13.8200044Z ----------------------------------------
2025-07-08T20:03:13.8200520Z Running mvp_site/tests/test_prompts.py...
2025-07-08T20:03:14.4521905Z 2025-07-08 20:03:14,451 - INFO - --- Running Test: test_all_prompt_files_are_registered_in_service ---
2025-07-08T20:03:14.4524153Z .2025-07-08 20:03:14,452 - INFO - --- Running Test: test_all_prompts_are_loadable_via_service ---
2025-07-08T20:03:14.4529706Z .2025-07-08 20:03:14,452 - INFO - --- Running Test: test_all_registered_prompts_are_actually_used ---
2025-07-08T20:03:14.4608516Z .2025-07-08 20:03:14,460 - INFO - --- Running Test: test_loading_unknown_prompt_raises_error ---
2025-07-08T20:03:14.4609669Z ✓ Always-loaded prompts: 3/3 verified
2025-07-08T20:03:14.4610932Z 2025-07-08 20:03:14,460 - ERROR - 🔥🔴 FATAL: Unknown instruction type requested: this_is_not_a_real_prompt_type
2025-07-08T20:03:14.4611926Z .
2025-07-08T20:03:14.4612530Z ----------------------------------------------------------------------
2025-07-08T20:03:14.4613512Z Ran 4 tests in 0.009s
2025-07-08T20:03:14.4614020Z 
2025-07-08T20:03:14.4614322Z OK
2025-07-08T20:03:14.4624198Z ✓ Conditional prompts: 3/3 properly referenced
2025-07-08T20:03:14.5452071Z ✅ mvp_site/tests/test_prompts.py passed
2025-07-08T20:03:14.5454261Z ----------------------------------------
2025-07-08T20:03:14.5454848Z Running mvp_site/tests/test_raw_json_display_bug_reproduction.py...
2025-07-08T20:03:14.5891613Z ..
2025-07-08T20:03:14.5892400Z ----------------------------------------------------------------------
2025-07-08T20:03:14.5894300Z Ran 2 tests in 0.000s
2025-07-08T20:03:14.5894569Z 
2025-07-08T20:03:14.5894679Z OK
2025-07-08T20:03:14.5962913Z ✅ mvp_site/tests/test_raw_json_display_bug_reproduction.py passed
2025-07-08T20:03:14.5972644Z ----------------------------------------
2025-07-08T20:03:14.5974326Z Running mvp_site/tests/test_real_json_bug_reproduction.py...
2025-07-08T20:03:14.6402931Z ..
2025-07-08T20:03:14.6407717Z \nTesting exact user JSON structure...
2025-07-08T20:03:14.6408202Z Input length: 5399
2025-07-08T20:03:14.6408545Z Input preview: {
2025-07-08T20:03:14.6409701Z     "narrative": "[Mode: STORY MODE]\n[CHARACTER CREATION - Step 2 of 7]\n\n\"Understood,\" the voice echoes, a comforting presence as you consider your newfound destiny. \"Allow me to craft an iden...
2025-07-08T20:03:14.6410890Z \nResult length: 4239
2025-07-08T20:03:14.6411273Z Result preview: [Mode: STORY MODE]
2025-07-08T20:03:14.6411721Z [CHARACTER CREATION - Step 2 of 7]
2025-07-08T20:03:14.6412005Z 
2025-07-08T20:03:14.6412718Z "Understood," the voice echoes, a comforting presence as you consider your newfound destiny. "Allow me to craft an identity that truly reflects t...
2025-07-08T20:03:14.6413952Z ----------------------------------------------------------------------
2025-07-08T20:03:14.6414469Z Ran 2 tests in 0.000s
2025-07-08T20:03:14.6414694Z 
2025-07-08T20:03:14.6414815Z OK
2025-07-08T20:03:14.6472571Z ✅ mvp_site/tests/test_real_json_bug_reproduction.py passed
2025-07-08T20:03:14.6474047Z ----------------------------------------
2025-07-08T20:03:14.6475489Z Running mvp_site/tests/test_red_green_demonstration.py...
2025-07-08T20:03:14.7104412Z GeminiResponse Integration Bug Fix - TDD Demonstration
2025-07-08T20:03:14.7107090Z ============================================================
2025-07-08T20:03:14.7107418Z 
2025-07-08T20:03:14.7107828Z 🧪 TEST-DRIVEN DEVELOPMENT CYCLE
2025-07-08T20:03:14.7108246Z ============================================================
2025-07-08T20:03:14.7108537Z 
2025-07-08T20:03:14.7108749Z 1. 🔴 RED: Write failing test
2025-07-08T20:03:14.7109280Z    • Test expects GeminiResponse integration to work
2025-07-08T20:03:14.7109932Z    • Test fails because firestore can't encode GeminiResponse
2025-07-08T20:03:14.7110639Z    • Error: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T20:03:14.7111046Z 
2025-07-08T20:03:14.7111257Z 2. 🟢 GREEN: Make test pass
2025-07-08T20:03:14.7111788Z    • Extract .narrative_text from GeminiResponse
2025-07-08T20:03:14.7112371Z    • Pass string to firestore instead of object
2025-07-08T20:03:14.7112865Z    • Test now passes
2025-07-08T20:03:14.7113083Z 
2025-07-08T20:03:14.7113462Z 3. 🔄 REFACTOR: Clean up
2025-07-08T20:03:14.7114004Z    • Update all test mocks to return GeminiResponse
2025-07-08T20:03:14.7114561Z    • Ensure consistent interface
2025-07-08T20:03:14.7115051Z    • Maintain backward compatibility
2025-07-08T20:03:14.7115345Z 
2025-07-08T20:03:14.7115576Z 🔴 RED PHASE: Demonstrating the bug
2025-07-08T20:03:14.7116007Z ==================================================
2025-07-08T20:03:14.7116578Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T20:03:14.7117414Z ✅ GeminiResponse.narrative_text: 'Your adventure begins in a bustling tavern......'
2025-07-08T20:03:14.7117965Z 
2025-07-08T20:03:14.7118350Z ❌ BEFORE FIX: firestore_service.add_story_entry() tries to call:
2025-07-08T20:03:14.7118909Z    text.encode('utf-8')
2025-07-08T20:03:14.7119312Z    where text = gemini_response_object
2025-07-08T20:03:14.7119620Z 
2025-07-08T20:03:14.7120028Z    ❌ AttributeError: 'GeminiResponse' object has no attribute 'encode'
2025-07-08T20:03:14.7120692Z    ❌ Campaign creation fails!
2025-07-08T20:03:14.7120934Z 
2025-07-08T20:03:14.7121477Z 🟢 GREEN PHASE: Demonstrating the fix
2025-07-08T20:03:14.7121895Z ==================================================
2025-07-08T20:03:14.7122431Z ✅ get_initial_story() returns: GeminiResponse
2025-07-08T20:03:14.7122750Z 
2025-07-08T20:03:14.7123004Z ✅ AFTER FIX: main.py extracts narrative_text:
2025-07-08T20:03:14.7123746Z    opening_story_response = gemini_service.get_initial_story(...)
2025-07-08T20:03:14.7124437Z    create_campaign(..., opening_story_response.narrative_text, ...)
2025-07-08T20:03:14.7124815Z 
2025-07-08T20:03:14.7125007Z ✅ Extracted narrative_text: str
2025-07-08T20:03:14.7125489Z ✅ Content: 'Your adventure begins in a bustling tavern......'
2025-07-08T20:03:14.7126255Z ✅ Successfully encoded: 45 bytes
2025-07-08T20:03:14.7126746Z ✅ Campaign creation succeeds!
2025-07-08T20:03:14.7127004Z 
2025-07-08T20:03:14.7127224Z 🔄 REFACTOR PHASE: Clean architecture
2025-07-08T20:03:14.7127629Z ==================================================
2025-07-08T20:03:14.7128119Z ✅ Clean separation of concerns:
2025-07-08T20:03:14.7128679Z    • GeminiResponse: Encapsulates AI service response
2025-07-08T20:03:14.7129290Z    • .narrative_text: Clean narrative for users
2025-07-08T20:03:14.7129911Z    • .structured_response: State updates and entities
2025-07-08T20:03:14.7130552Z    • .debug_tags_present: Debug monitoring
2025-07-08T20:03:14.7130859Z 
2025-07-08T20:03:14.7131087Z ✅ Backward compatibility maintained:
2025-07-08T20:03:14.7131613Z    • All existing functionality preserved
2025-07-08T20:03:14.7132143Z    • Tests updated to use new interface
2025-07-08T20:03:14.7132621Z    • No breaking changes
2025-07-08T20:03:14.7132848Z 
2025-07-08T20:03:14.7133028Z ✅ Benefits achieved:
2025-07-08T20:03:14.7133671Z    • Type safety with GeminiResponse objects
2025-07-08T20:03:14.7134206Z    • Clear interface between services
2025-07-08T20:03:14.7134703Z    • Debug monitoring capabilities
2025-07-08T20:03:14.7135210Z    • Consistent JSON response handling
2025-07-08T20:03:14.7135506Z 
2025-07-08T20:03:14.7135738Z 🎉 SUMMARY: TDD cycle complete!
2025-07-08T20:03:14.7136203Z    • Bug identified and reproduced (RED)
2025-07-08T20:03:14.7136718Z    • Fix implemented and tested (GREEN)
2025-07-08T20:03:14.7137237Z    • Architecture improved (REFACTOR)
2025-07-08T20:03:14.7137730Z    • All 67 tests passing ✅
2025-07-08T20:03:14.7210673Z ✅ mvp_site/tests/test_red_green_demonstration.py passed
2025-07-08T20:03:14.7212019Z ----------------------------------------
2025-07-08T20:03:14.7212512Z Running mvp_site/tests/test_red_green_json_fix.py...
2025-07-08T20:03:14.7617163Z test_green_state_comprehensive_fix (__main__.TestRedGreenJSONFix.test_green_state_comprehensive_fix)
2025-07-08T20:03:14.7627278Z GREEN TEST: Demonstrates the complete fix working ... ok
2025-07-08T20:03:14.7629102Z test_red_state_escaped_characters (__main__.TestRedGreenJSONFix.test_red_state_escaped_characters)
2025-07-08T20:03:14.7630033Z RED TEST: JSON with escaped characters like \n and \" ... ok
2025-07-08T20:03:14.7631058Z test_red_state_markdown_wrapped_json (__main__.TestRedGreenJSONFix.test_red_state_markdown_wrapped_json)
2025-07-08T20:03:14.7632081Z RED TEST: AI returns JSON wrapped in markdown code blocks ... ok
2025-07-08T20:03:14.7633707Z ============================================================
2025-07-08T20:03:14.7634202Z RED/GREEN TESTING: JSON Display Bug Fix
2025-07-08T20:03:14.7634668Z ============================================================
2025-07-08T20:03:14.7634993Z 
2025-07-08T20:03:14.7635209Z This demonstrates how the bug manifested (red state)
2025-07-08T20:03:14.7635714Z and how the fix resolves it (green state).
2025-07-08T20:03:14.7636019Z 
2025-07-08T20:03:14.7636026Z 
2025-07-08T20:03:14.7636216Z === GREEN STATE TEST: Complete Fix ===
2025-07-08T20:03:14.7636848Z   ✓ Plain JSON: Clean narrative extracted
2025-07-08T20:03:14.7637414Z   ✓ Markdown-wrapped: Clean narrative extracted
2025-07-08T20:03:14.7637996Z   ✓ Partial JSON: Clean narrative extracted
2025-07-08T20:03:14.7638829Z   ✓ Escaped chars: Clean narrative extracted
2025-07-08T20:03:14.7639386Z   ✓ Malformed: Clean narrative extracted
2025-07-08T20:03:14.7640470Z test_red_state_partial_json_fallback (__main__.TestRedGreenJSONFix.test_red_state_partial_json_fallback)
2025-07-08T20:03:14.7641387Z   ✓ Invalid field: Clean narrative extracted
2025-07-08T20:03:14.7642123Z RED TEST: Partial JSON that can't be parsed ... ok
2025-07-08T20:03:14.7642929Z test_red_state_raw_json_displayed (__main__.TestRedGreenJSONFix.test_red_state_raw_json_displayed)
2025-07-08T20:03:14.7643706Z 
2025-07-08T20:03:14.7644221Z RED TEST: Demonstrates the bug where raw JSON is shown to users ... ok
2025-07-08T20:03:14.7644988Z ✓ GREEN: All test cases pass - users never see JSON!
2025-07-08T20:03:14.7646138Z test_simulate_red_state (__main__.TestRedGreenJSONFix.test_simulate_red_state)
2025-07-08T20:03:14.7646643Z 
2025-07-08T20:03:14.7647071Z SIMULATION: What the bug looked like before the fix ... ok
2025-07-08T20:03:14.7647629Z === RED STATE TEST: Escaped Characters ===
2025-07-08T20:03:14.7648275Z Returned narrative: 'She said "Hello!"\nNew line here\nAnother line'...
2025-07-08T20:03:14.7648932Z 
2025-07-08T20:03:14.7649209Z ✓ GREEN: Escape sequences properly converted
2025-07-08T20:03:14.7649575Z 
2025-07-08T20:03:14.7651015Z ----------------------------------------------------------------------
2025-07-08T20:03:14.7652200Z Ran 6 tests in 0.002s
2025-07-08T20:03:14.7652380Z 
2025-07-08T20:03:14.7652481Z OK
2025-07-08T20:03:14.7656915Z === RED STATE TEST: Markdown-wrapped JSON ===
2025-07-08T20:03:14.7658476Z Returned narrative: [Mode: DM MODE] Understanding confirmed. Processing user request....
2025-07-08T20:03:14.7659379Z ✓ GREEN: Markdown unwrapped, JSON parsed correctly
2025-07-08T20:03:14.7659763Z 
2025-07-08T20:03:14.7659920Z === RED STATE TEST: Partial JSON ===
2025-07-08T20:03:14.7660359Z Returned narrative: The story continues...
2025-07-08T20:03:14.7660934Z ✓ GREEN: Narrative extracted from partial JSON
2025-07-08T20:03:14.7661294Z 
2025-07-08T20:03:14.7661468Z === RED STATE TEST: Raw JSON Bug ===
2025-07-08T20:03:14.7662268Z Returned narrative: Scene #14: [Mode: DM MODE] The party continues their journey through the mystical forest....
2025-07-08T20:03:14.7663404Z ✓ GREEN: JSON properly parsed, narrative extracted
2025-07-08T20:03:14.7663733Z 
2025-07-08T20:03:14.7663894Z === SIMULATING RED STATE (Bug Behavior) ===
2025-07-08T20:03:14.7664195Z 
2025-07-08T20:03:14.7664340Z BUG OUTPUT (what users saw):
2025-07-08T20:03:14.7664688Z ```json
2025-07-08T20:03:14.7664929Z {
2025-07-08T20:03:14.7665323Z   "narrative": "[Mode: DM MODE] Understanding confirmed. Processing user request.",
2025-07-08T20:03:14.7665903Z   "entities_mentioned": ["Test Entity"],
2025-07-08T20:03:14.7666389Z   "location_confirmed": "Test Location",
2025-07-08T20:03:14.7666778Z   "state_updates": {}
2025-07-08T20:03:14.7667107Z }
2025-07-08T20:03:14.7667361Z ```
2025-07-08T20:03:14.7667519Z 
2025-07-08T20:03:14.7667526Z 
2025-07-08T20:03:14.7667676Z FIXED OUTPUT (what users see now):
2025-07-08T20:03:14.7668236Z [Mode: DM MODE] Understanding confirmed. Processing user request.
2025-07-08T20:03:14.7668636Z 
2025-07-08T20:03:14.7668872Z ✓ Bug fixed: Users only see narrative text!
2025-07-08T20:03:14.7669130Z 
2025-07-08T20:03:14.7669278Z ============================================================
2025-07-08T20:03:14.7669706Z SUMMARY:
2025-07-08T20:03:14.7669985Z Tests run: 6
2025-07-08T20:03:14.7670265Z Failures: 0
2025-07-08T20:03:14.7670542Z Errors: 0
2025-07-08T20:03:14.7670700Z 
2025-07-08T20:03:14.7670974Z ✅ All tests GREEN - JSON display bug is FIXED!
2025-07-08T20:03:14.7671512Z Users will never see raw JSON in their game interface.
2025-07-08T20:03:14.7672029Z ============================================================
2025-07-08T20:03:14.7710526Z ✅ mvp_site/tests/test_red_green_json_fix.py passed
2025-07-08T20:03:14.7711784Z ----------------------------------------
2025-07-08T20:03:14.7712307Z Running mvp_site/tests/test_refactoring_coverage.py...
2025-07-08T20:03:14.9633371Z .....sss..........
2025-07-08T20:03:14.9634223Z ----------------------------------------------------------------------
2025-07-08T20:03:14.9634772Z Ran 18 tests in 0.006s
2025-07-08T20:03:14.9634977Z 
2025-07-08T20:03:14.9636251Z OK (skipped=3)
2025-07-08T20:03:14.9890474Z ✅ mvp_site/tests/test_refactoring_coverage.py passed
2025-07-08T20:03:14.9891838Z ----------------------------------------
2025-07-08T20:03:14.9892358Z Running mvp_site/tests/test_robust_json_parser.py...
2025-07-08T20:03:15.0557530Z ....ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:15.0577219Z .................
2025-07-08T20:03:15.0578422Z ----------------------------------------------------------------------
2025-07-08T20:03:15.0580045Z Ran 21 tests in 0.004s
2025-07-08T20:03:15.0580259Z 
2025-07-08T20:03:15.0580375Z OK
2025-07-08T20:03:15.0680203Z ✅ mvp_site/tests/test_robust_json_parser.py passed
2025-07-08T20:03:15.0681510Z ----------------------------------------
2025-07-08T20:03:15.0682017Z Running mvp_site/tests/test_scene_numbering.py...
2025-07-08T20:03:15.3252512Z .
2025-07-08T20:03:15.3254952Z ----------------------------------------------------------------------
2025-07-08T20:03:15.3255848Z ✓ User scene numbers correctly increment only for AI responses
2025-07-08T20:03:15.3256364Z Ran 1 test in 0.000s
2025-07-08T20:03:15.3256563Z 
2025-07-08T20:03:15.3256670Z OK
2025-07-08T20:03:15.3257014Z ✓ Sequence IDs increment for all entries
2025-07-08T20:03:15.3257527Z ✓ This fixes the increment-by-2 display issue
2025-07-08T20:03:15.3622286Z ✅ mvp_site/tests/test_scene_numbering.py passed
2025-07-08T20:03:15.3628369Z ----------------------------------------
2025-07-08T20:03:15.3628920Z Running mvp_site/tests/test_scene_prefix_json_bug.py...
2025-07-08T20:03:15.4082822Z .....
2025-07-08T20:03:15.4085451Z ----------------------------------------------------------------------
2025-07-08T20:03:15.4085996Z Ran 5 tests in 0.001s
2025-07-08T20:03:15.4087397Z 
2025-07-08T20:03:15.4090860Z OK
2025-07-08T20:03:15.4155159Z ✅ mvp_site/tests/test_scene_prefix_json_bug.py passed
2025-07-08T20:03:15.4156515Z ----------------------------------------
2025-07-08T20:03:15.4157024Z Running mvp_site/tests/test_simple_json_bug_check.py...
2025-07-08T20:03:15.4602788Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method TestSimpleJsonBugCheck.test_character_creation_json_parsing of <__main__.TestSimpleJsonBugCheck testMethod=test_character_creation_json_parsing>>)
2025-07-08T20:03:15.4605078Z   return self.run(*args, **kwds)
2025-07-08T20:03:15.4612248Z ..
2025-07-08T20:03:15.4613184Z ----------------------------------------------------------------------
2025-07-08T20:03:15.4614013Z \n=== Testing Character Creation JSON Parsing ===
2025-07-08T20:03:15.4614490Z Ran 2 tests in 0.001s
2025-07-08T20:03:15.4614727Z 
2025-07-08T20:03:15.4614839Z OK
2025-07-08T20:03:15.4616274Z Input JSON length: 1062
2025-07-08T20:03:15.4616877Z ✅ Parsing succeeded!
2025-07-08T20:03:15.4617232Z Result text length: 456
2025-07-08T20:03:15.4617636Z Result preview: [CHARACTER CREATION - Step 1 of 7]
2025-07-08T20:03:15.4617971Z 
2025-07-08T20:03:15.4618280Z Welcome, adventurer! Before we begin your journey, we need to cr...
2025-07-08T20:03:15.4618861Z Contains JSON artifacts: False
2025-07-08T20:03:15.4619263Z \n=== Testing Malformed JSON Handling ===
2025-07-08T20:03:15.4619681Z Result: Some content here
2025-07-08T20:03:15.4620039Z Contains original JSON: False
2025-07-08T20:03:15.4690573Z ✅ mvp_site/tests/test_simple_json_bug_check.py passed
2025-07-08T20:03:15.4691966Z ----------------------------------------
2025-07-08T20:03:15.4692499Z Running mvp_site/tests/test_state_updates_json_parsing.py...
2025-07-08T20:03:15.5354061Z .....
2025-07-08T20:03:15.5354707Z ----------------------------------------------------------------------
2025-07-08T20:03:15.5355234Z Ran 5 tests in 0.000s
2025-07-08T20:03:15.5355448Z 
2025-07-08T20:03:15.5355570Z OK
2025-07-08T20:03:15.5466247Z ✅ mvp_site/tests/test_state_updates_json_parsing.py passed
2025-07-08T20:03:15.5467200Z ----------------------------------------
2025-07-08T20:03:15.5468288Z Running mvp_site/tests/test_structured_generation.py...
2025-07-08T20:03:15.7248712Z test_entity_tracking_instruction (__main__.TestStructuredGeneration.test_entity_tracking_instruction)
2025-07-08T20:03:15.7252619Z Test EntityTrackingInstruction creation ... ok
2025-07-08T20:03:15.7253816Z test_integration_with_entity_tracking (__main__.TestStructuredGeneration.test_integration_with_entity_tracking)
2025-07-08T20:03:15.7255019Z Test integration with existing entity tracking system ... ok
2025-07-08T20:03:15.7256061Z test_narrative_response_schema (__main__.TestStructuredGeneration.test_narrative_response_schema)
2025-07-08T20:03:15.7257423Z Test NarrativeResponse model ... ok
2025-07-08T20:03:15.7263651Z test_parse_structured_response_fallback (__main__.TestStructuredGeneration.test_parse_structured_response_fallback)
2025-07-08T20:03:15.7271530Z Test fallback for invalid JSON ... ERROR:root:🔥🔴 All JSON parsing strategies failed
2025-07-08T20:03:15.7280539Z ok
2025-07-08T20:03:15.7281271Z test_parse_structured_response_valid_json (__main__.TestStructuredGeneration.test_parse_structured_response_valid_json)
2025-07-08T20:03:15.7282091Z Test parsing valid JSON response ... ok
2025-07-08T20:03:15.7282961Z test_parse_structured_response_with_extra_text (__main__.TestStructuredGeneration.test_parse_structured_response_with_extra_text)
2025-07-08T20:03:15.7284028Z Test parsing JSON with extra text around it ... ok
2025-07-08T20:03:15.7284792Z test_structured_prompt_injection (__main__.TestStructuredGeneration.test_structured_prompt_injection)
2025-07-08T20:03:15.7285559Z Test prompt injection creation ... ok
2025-07-08T20:03:15.7286318Z test_validate_entity_coverage_missing (__main__.TestStructuredGeneration.test_validate_entity_coverage_missing)
2025-07-08T20:03:15.7287163Z Test entity coverage validation with missing entities ... ok
2025-07-08T20:03:15.7288019Z test_validate_entity_coverage_perfect (__main__.TestStructuredGeneration.test_validate_entity_coverage_perfect)
2025-07-08T20:03:15.7288863Z Test entity coverage validation with perfect coverage ... ok
2025-07-08T20:03:15.7289216Z 
2025-07-08T20:03:15.7289409Z ----------------------------------------------------------------------
2025-07-08T20:03:15.7289860Z Ran 9 tests in 0.003s
2025-07-08T20:03:15.7290054Z 
2025-07-08T20:03:15.7290151Z OK
2025-07-08T20:03:15.7290647Z 🧪 Testing Structured Generation Implementation
2025-07-08T20:03:15.7291076Z ============================================================
2025-07-08T20:03:15.7291702Z ✅ Integration test: Structured generation works with entity tracking
2025-07-08T20:03:15.7553165Z ✅ mvp_site/tests/test_structured_generation.py passed
2025-07-08T20:03:15.7554856Z ----------------------------------------
2025-07-08T20:03:15.7555319Z Running mvp_site/tests/test_syntax.py...
2025-07-08T20:03:16.3628609Z ./home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3631803Z   @validator('strength', pre=True)
2025-07-08T20:03:16.3635136Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3638218Z   @validator('dexterity', pre=True)
2025-07-08T20:03:16.3641459Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3644558Z   @validator('constitution', pre=True)
2025-07-08T20:03:16.3647432Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3650710Z   @validator('intelligence', pre=True)
2025-07-08T20:03:16.3653762Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3657338Z   @validator('wisdom', pre=True)
2025-07-08T20:03:16.3660215Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3663727Z   @validator('charisma', pre=True)
2025-07-08T20:03:16.3666661Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3669549Z   @validator('hp', pre=True)
2025-07-08T20:03:16.3672349Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3675967Z   @validator('hp_max', pre=True)
2025-07-08T20:03:16.3678788Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3681619Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:16.3708070Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3710686Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:16.3740005Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3743552Z   @validator('level', pre=True)
2025-07-08T20:03:16.3746766Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3749926Z   @validator('gender')
2025-07-08T20:03:16.3752754Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3755777Z   @validator('age')
2025-07-08T20:03:16.3758546Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3761628Z   @validator('mbti')
2025-07-08T20:03:16.3764654Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3767720Z   @validator('alignment')
2025-07-08T20:03:16.3770570Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3773784Z   @validator('entity_type')
2025-07-08T20:03:16.3934199Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3937367Z   @validator('participants')
2025-07-08T20:03:16.3952499Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3959942Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:16.3963462Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:16.3966146Z   @validator('present_entities')
2025-07-08T20:03:16.4074749Z .
2025-07-08T20:03:16.4075665Z ----------------------------------------------------------------------
2025-07-08T20:03:16.4076059Z 
2025-07-08T20:03:16.4076403Z --- Attempting to import gemini_service.py ---
2025-07-08T20:03:16.4076976Z Setting dummy GEMINI_API_KEY for import test...
2025-07-08T20:03:16.4077786Z Ran 2 tests in 0.616s
2025-07-08T20:03:16.4078465Z 
2025-07-08T20:03:16.4078797Z OK
2025-07-08T20:03:16.4083706Z SUCCESS: gemini_service.py was imported without a syntax error.
2025-07-08T20:03:16.4833788Z ✅ mvp_site/tests/test_syntax.py passed
2025-07-08T20:03:16.4837162Z ----------------------------------------
2025-07-08T20:03:16.4837716Z Running mvp_site/tests/test_syntax_comprehensive.py...
2025-07-08T20:03:16.5706957Z test_all_python_files_syntax (__main__.TestComprehensiveSyntax.test_all_python_files_syntax)
2025-07-08T20:03:16.6113755Z Test that all Python files in the project have valid syntax using AST parsing. ... ok
2025-07-08T20:03:16.6115531Z test_basic_game_state_instantiation (__main__.TestComprehensiveSyntax.test_basic_game_state_instantiation)
2025-07-08T20:03:16.6173008Z Test basic GameState instantiation without combat-specific features. ... ok
2025-07-08T20:03:16.6175932Z test_game_state_syntax_and_import (__main__.TestComprehensiveSyntax.test_game_state_syntax_and_import)
2025-07-08T20:03:16.6198281Z Specifically test game_state.py syntax and import. ... ok
2025-07-08T20:03:16.6199565Z test_main_module_syntax (__main__.TestComprehensiveSyntax.test_main_module_syntax)
2025-07-08T20:03:17.4735481Z Test that main.py has valid syntax and can load its dependencies. ... /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:55: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4739122Z   @validator('strength', pre=True)
2025-07-08T20:03:17.4742002Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:59: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4746091Z   @validator('dexterity', pre=True)
2025-07-08T20:03:17.4748737Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:63: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4751414Z   @validator('constitution', pre=True)
2025-07-08T20:03:17.4754212Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:67: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4756891Z   @validator('intelligence', pre=True)
2025-07-08T20:03:17.4759913Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:71: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4769742Z   @validator('wisdom', pre=True)
2025-07-08T20:03:17.4772383Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:75: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4775500Z   @validator('charisma', pre=True)
2025-07-08T20:03:17.4778114Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:93: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4780722Z   @validator('hp', pre=True)
2025-07-08T20:03:17.4783441Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:97: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4786046Z   @validator('hp_max', pre=True)
2025-07-08T20:03:17.4788622Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:101: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4791232Z   @validator('temp_hp', pre=True)
2025-07-08T20:03:17.4811822Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4816334Z   warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
2025-07-08T20:03:17.4841972Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:147: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4850708Z   @validator('level', pre=True)
2025-07-08T20:03:17.4853536Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:175: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4856228Z   @validator('gender')
2025-07-08T20:03:17.4859013Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:210: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4861672Z   @validator('age')
2025-07-08T20:03:17.4864381Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:220: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4867300Z   @validator('mbti')
2025-07-08T20:03:17.4869893Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:239: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4872545Z   @validator('alignment')
2025-07-08T20:03:17.4875321Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:252: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.4877908Z   @validator('entity_type')
2025-07-08T20:03:17.5029237Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:300: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5034184Z   @validator('participants')
2025-07-08T20:03:17.5046404Z /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/pydantic/fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5055561Z   warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)
2025-07-08T20:03:17.5058540Z /home/runner/work/worldarchitect.ai/worldarchitect.ai/mvp_site/schemas/entities_pydantic.py:337: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
2025-07-08T20:03:17.5061245Z   @validator('present_entities')
2025-07-08T20:03:17.5173841Z ok
2025-07-08T20:03:17.5174071Z 
2025-07-08T20:03:17.5174288Z ----------------------------------------------------------------------
2025-07-08T20:03:17.5174787Z === Comprehensive Syntax Testing ===
2025-07-08T20:03:17.5175248Z This test would have caught the f-string syntax error.
2025-07-08T20:03:17.5175603Z 
2025-07-08T20:03:17.5175775Z --- Quick syntax check for all Python files ---
2025-07-08T20:03:17.5176516Z ✓ test_firestore_database_errors.py: Syntax OK
2025-07-08T20:03:17.5176994Z ✓ gemini_service.py: Syntax OK
2025-07-08T20:03:17.5177398Z ✓ inspect_sdk.py: Syntax OK
2025-07-08T20:03:17.5178051Z ✓ debug_mode_parser.py: Syntax OK
2025-07-08T20:03:17.5178495Z ✓ robust_json_parser.py: Syntax OK
2025-07-08T20:03:17.5178943Z ✓ narrative_sync_validator.py: Syntax OK
2025-07-08T20:03:17.5179426Z ✓ test_gemini_error_handling.py: Syntax OK
2025-07-08T20:03:17.5179848Z ✓ main.py: Syntax OK
2025-07-08T20:03:17.5180197Z ✓ logging_util.py: Syntax OK
2025-07-08T20:03:17.5180571Z ✓ json_utils.py: Syntax OK
2025-07-08T20:03:17.5180967Z ✓ entity_preloader.py: Syntax OK
2025-07-08T20:03:17.5181373Z ✓ gemini_response.py: Syntax OK
2025-07-08T20:03:17.5181783Z ✓ firestore_service.py: Syntax OK
2025-07-08T20:03:17.5182180Z ✓ world_loader.py: Syntax OK
2025-07-08T20:03:17.5182583Z ✓ main_parallel_dual_pass.py: Syntax OK
2025-07-08T20:03:17.5183349Z ✓ token_utils.py: Syntax OK
2025-07-08T20:03:17.5183769Z ✓ narrative_response_schema.py: Syntax OK
2025-07-08T20:03:17.5184194Z ✓ game_state.py: Syntax OK
2025-07-08T20:03:17.5184551Z ✓ __init__.py: Syntax OK
2025-07-08T20:03:17.5184959Z ✓ test_gemini_token_management.py: Syntax OK
2025-07-08T20:03:17.5185475Z ✓ test_gemini_generation.py: Syntax OK
2025-07-08T20:03:17.5185918Z ✓ dual_pass_generator.py: Syntax OK
2025-07-08T20:03:17.5186333Z ✓ entity_validator.py: Syntax OK
2025-07-08T20:03:17.5186787Z ✓ test_documentation_performance.py: Syntax OK
2025-07-08T20:03:17.5187265Z ✓ debug_json_response.py: Syntax OK
2025-07-08T20:03:17.5187741Z ✓ test_gemini_response_validation.py: Syntax OK
2025-07-08T20:03:17.5188215Z ✓ debug_hybrid_system.py: Syntax OK
2025-07-08T20:03:17.5188643Z ✓ decorators.py: Syntax OK
2025-07-08T20:03:17.5189010Z ✓ llm_response.py: Syntax OK
2025-07-08T20:03:17.5189390Z ✓ constants.py: Syntax OK
2025-07-08T20:03:17.5189785Z ✓ numeric_field_converter.py: Syntax OK
2025-07-08T20:03:17.5190236Z ✓ document_generator.py: Syntax OK
2025-07-08T20:03:17.5190655Z ✓ entity_instructions.py: Syntax OK
2025-07-08T20:03:17.5191107Z ✓ gemini_response_simplified.py: Syntax OK
2025-07-08T20:03:17.5191550Z ✓ entity_tracking.py: Syntax OK
2025-07-08T20:03:17.5191773Z 
2025-07-08T20:03:17.5191936Z --- Running comprehensive test suite ---
2025-07-08T20:03:17.5192627Z Ran 4 tests in 0.946s
2025-07-08T20:03:17.5193029Z 
2025-07-08T20:03:17.5193459Z OK
2025-07-08T20:03:17.6618777Z ✅ mvp_site/tests/test_syntax_comprehensive.py passed
2025-07-08T20:03:17.6620210Z ----------------------------------------
2025-07-08T20:03:17.6620705Z Running mvp_site/tests/test_think_block_protocol.py...
2025-07-08T20:03:18.2900860Z test_error_response_format_defined (__main__.TestThinkBlockProtocol.test_error_response_format_defined)
2025-07-08T20:03:18.2906646Z Test that error response format is specified ... ok
2025-07-08T20:03:18.2909332Z test_forbidden_actions_defined (__main__.TestThinkBlockProtocol.test_forbidden_actions_defined)
2025-07-08T20:03:18.2945135Z Test that forbidden actions are clearly defined ... ok
2025-07-08T20:03:18.2947914Z test_invalid_input_definitions (__main__.TestThinkBlockProtocol.test_invalid_input_definitions)
2025-07-08T20:03:18.2953045Z Test that invalid post-think-block inputs are defined ... ok
2025-07-08T20:03:18.2954894Z test_protocol_overrides_other_instructions (__main__.TestThinkBlockProtocol.test_protocol_overrides_other_instructions)
2025-07-08T20:03:18.2956825Z Test that protocol explicitly states it overrides other instructions ... ok
2025-07-08T20:03:18.2958011Z test_protocol_priority_placement (__main__.TestThinkBlockProtocol.test_protocol_priority_placement)
2025-07-08T20:03:18.2964185Z Test that think block protocol is at the beginning of the file ... ok
2025-07-08T20:03:18.2965196Z test_state_validation_checkpoints (__main__.TestThinkBlockProtocol.test_state_validation_checkpoints)
2025-07-08T20:03:18.2970320Z Test that state validation checkpoints are defined ... ok
2025-07-08T20:03:18.2971808Z test_think_block_protocol_exists_in_prompt (__main__.TestThinkBlockProtocol.test_think_block_protocol_exists_in_prompt)
2025-07-08T20:03:18.2982314Z Test that think block protocol is present in the prompt file ... ok
2025-07-08T20:03:18.2984038Z test_think_keywords_detection (__main__.TestThinkBlockProtocol.test_think_keywords_detection)
2025-07-08T20:03:18.3001722Z Test that all think block keywords are properly defined ... ok
2025-07-08T20:03:18.3002955Z test_valid_input_definitions (__main__.TestThinkBlockProtocol.test_valid_input_definitions)
2025-07-08T20:03:18.3015463Z Test that valid post-think-block inputs are defined ... ok
2025-07-08T20:03:18.3016582Z test_complex_planning_scenario (__main__.TestThinkBlockScenarios.test_complex_planning_scenario)
2025-07-08T20:03:18.3018666Z Test complex planning scenario ... ok
2025-07-08T20:03:18.3019518Z test_invalid_continuation_scenario (__main__.TestThinkBlockScenarios.test_invalid_continuation_scenario)
2025-07-08T20:03:18.3023151Z Test invalid continuation after think block ... ok
2025-07-08T20:03:18.3024047Z test_simple_think_scenario (__main__.TestThinkBlockScenarios.test_simple_think_scenario)
2025-07-08T20:03:18.3028211Z Test simple think command scenario ... ok
2025-07-08T20:03:18.3029434Z test_valid_selection_scenario (__main__.TestThinkBlockScenarios.test_valid_selection_scenario)
2025-07-08T20:03:18.3030552Z Test valid option selection after think block ... ok
2025-07-08T20:03:18.3032110Z test_backup_file_exists (__main__.TestPromptFileIntegrity.test_backup_file_exists)
2025-07-08T20:03:18.3032922Z Test that backup file was created ... skipped 'Backup file is optional'
2025-07-08T20:03:18.3034003Z test_essential_protocols_preserved (__main__.TestPromptFileIntegrity.test_essential_protocols_preserved)
2025-07-08T20:03:18.3052802Z Test that essential game protocols are preserved ... ok
2025-07-08T20:03:18.3056025Z test_prompt_file_exists (__main__.TestPromptFileIntegrity.test_prompt_file_exists)
2025-07-08T20:03:18.3056725Z Test that the prompt file exists ... ok
2025-07-08T20:03:18.3057388Z test_prompt_file_readable (__main__.TestPromptFileIntegrity.test_prompt_file_readable)
2025-07-08T20:03:18.3058085Z Test that the prompt file is readable ... ok
2025-07-08T20:03:18.3058851Z test_state_transition_rules (__main__.TestThinkBlockStateManagement.test_state_transition_rules)
2025-07-08T20:03:18.3074839Z Test that state transition rules are clearly defined ... ok
2025-07-08T20:03:18.3077370Z test_waiting_state_definition (__main__.TestThinkBlockStateManagement.test_waiting_state_definition)
2025-07-08T20:03:18.3080097Z Test that planning block state is defined ... ok
2025-07-08T20:03:18.3080631Z Running Think Block Protocol Tests...
2025-07-08T20:03:18.3081185Z ==================================================
2025-07-08T20:03:18.3081596Z 
2025-07-08T20:03:18.3081773Z 
2025-07-08T20:03:18.3082223Z ✅ All think block tests passed!
2025-07-08T20:03:18.3082827Z ----------------------------------------------------------------------
2025-07-08T20:03:18.3084209Z Ran 19 tests in 0.018s
2025-07-08T20:03:18.3084425Z 
2025-07-08T20:03:18.3084551Z OK (skipped=1)
2025-07-08T20:03:18.3874590Z ✅ mvp_site/tests/test_think_block_protocol.py passed
2025-07-08T20:03:18.3875644Z ----------------------------------------
2025-07-08T20:03:18.3876237Z Running mvp_site/tests/test_time_consolidation.py...
2025-07-08T20:03:18.4330645Z .........
2025-07-08T20:03:18.4331451Z ----------------------------------------------------------------------
2025-07-08T20:03:18.4332783Z Ran 9 tests in 0.001s
2025-07-08T20:03:18.4333538Z 
2025-07-08T20:03:18.4333673Z OK
2025-07-08T20:03:18.4404321Z ✅ mvp_site/tests/test_time_consolidation.py passed
2025-07-08T20:03:18.4405153Z ----------------------------------------
2025-07-08T20:03:18.4405813Z Running mvp_site/tests/test_time_pressure.py...
2025-07-08T20:03:19.0711800Z 2025-07-08 20:03:19,070 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0716478Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0719307Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0723708Z .2025-07-08 20:03:19,071 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0725912Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0726785Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0729158Z .2025-07-08 20:03:19,072 - INFO - Calculated time_of_day as 'Midday' from hour 12
2025-07-08T20:03:19.0730050Z .
2025-07-08T20:03:19.0730713Z ----------------------------------------------------------------------
2025-07-08T20:03:19.0731451Z Ran 7 tests in 0.002s
2025-07-08T20:03:19.0731829Z 
2025-07-08T20:03:19.0732384Z OK
2025-07-08T20:03:19.1508552Z ✅ mvp_site/tests/test_time_pressure.py passed
2025-07-08T20:03:19.1509997Z ----------------------------------------
2025-07-08T20:03:19.1510479Z Running mvp_site/tests/test_token_utils.py...
2025-07-08T20:03:19.2161389Z ...........
2025-07-08T20:03:19.2163932Z ----------------------------------------------------------------------
2025-07-08T20:03:19.2164429Z Ran 11 tests in 0.003s
2025-07-08T20:03:19.2164636Z 
2025-07-08T20:03:19.2164736Z OK
2025-07-08T20:03:19.2263384Z ✅ mvp_site/tests/test_token_utils.py passed
2025-07-08T20:03:19.2264706Z ----------------------------------------
2025-07-08T20:03:19.2265263Z Running mvp_site/tests/test_user_scenario_fix_validation.py...
2025-07-08T20:03:19.2719236Z ....
2025-07-08T20:03:19.2720031Z ----------------------------------------------------------------------
2025-07-08T20:03:19.2721558Z Ran 4 tests in 0.001s
2025-07-08T20:03:19.2721779Z 
2025-07-08T20:03:19.2721894Z OK
2025-07-08T20:03:19.2790363Z ✅ mvp_site/tests/test_user_scenario_fix_validation.py passed
2025-07-08T20:03:19.2791254Z ----------------------------------------
2025-07-08T20:03:19.2791959Z Running mvp_site/tests/test_validation_comparison.py...
2025-07-08T20:03:19.4533181Z .WARNING:root:⚠️ Invalid value 'unknown' for field 'hp'. Using default: 1
2025-07-08T20:03:19.4536627Z WARNING:root:⚠️ Invalid value 'unknown' for field 'hp_max'. Using default: 1
2025-07-08T20:03:19.4579812Z ...
2025-07-08T20:03:19.4580162Z Pydantic: Handled invalid data gracefully
2025-07-08T20:03:19.4581078Z Pydantic validation: 100 iterations in 0.004s (22471 ops/sec)
2025-07-08T20:03:19.4581935Z ----------------------------------------------------------------------
2025-07-08T20:03:19.4582649Z Ran 4 tests in 0.005s
2025-07-08T20:03:19.4584262Z 
2025-07-08T20:03:19.4584557Z OK
2025-07-08T20:03:19.4860214Z ✅ mvp_site/tests/test_validation_comparison.py passed
2025-07-08T20:03:19.4861178Z ----------------------------------------
2025-07-08T20:03:19.4862031Z Running mvp_site/tests/test_world_loader.py...
2025-07-08T20:03:19.5499148Z test_development_scenario_parent_world (__main__.TestWorldLoader.test_development_scenario_parent_world)
2025-07-08T20:03:19.5515367Z Test loading from ../world in development environment. ... ok
2025-07-08T20:03:19.5517001Z test_missing_world_files_error_handling (__main__.TestWorldLoader.test_missing_world_files_error_handling)
2025-07-08T20:03:19.5528816Z Test error handling when world files are missing. ... ok
2025-07-08T20:03:19.5529999Z test_path_construction_logic (__main__.TestWorldLoader.test_path_construction_logic)
2025-07-08T20:03:19.5536358Z Test the path construction logic for both scenarios. ... ok
2025-07-08T20:03:19.5537293Z test_production_scenario_local_world (__main__.TestWorldLoader.test_production_scenario_local_world)
2025-07-08T20:03:19.5552104Z Test loading from world/ in production environment. ... ok
2025-07-08T20:03:19.5552974Z 
2025-07-08T20:03:19.5553678Z ----------------------------------------------------------------------
2025-07-08T20:03:19.5554533Z Ran 4 tests in 0.005s
2025-07-08T20:03:19.5554981Z 
2025-07-08T20:03:19.5557116Z OK
2025-07-08T20:03:19.5660704Z ✅ mvp_site/tests/test_world_loader.py passed
2025-07-08T20:03:19.5661529Z ----------------------------------------
2025-07-08T20:03:19.5662436Z Running mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py...
2025-07-08T20:03:29.0649242Z test_campaign_wizard_reset_issue_reproduction (__main__.CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction)
2025-07-08T20:03:43.9888668Z Reproduce the complete user workflow that leads to persistent spinner ... /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/unittest/case.py:678: DeprecationWarning: It is deprecated to return a value that is not None from a test case (<bound method CampaignWizardResetReproductionTest.test_campaign_wizard_reset_issue_reproduction of <__main__.CampaignWizardResetReproductionTest testMethod=test_campaign_wizard_reset_issue_reproduction>>)
2025-07-08T20:03:43.9891290Z   return self.run(*args, **kwds)
2025-07-08T20:03:43.9891646Z ok
2025-07-08T20:03:44.5116315Z 
2025-07-08T20:03:44.5116854Z 
2025-07-08T20:03:44.5119278Z ----------------------------------------------------------------------
2025-07-08T20:03:44.5120620Z 🧪 REPRODUCING CAMPAIGN WIZARD RESET ISSUE
2025-07-08T20:03:44.5121502Z Ran 1 test in 24.758s
2025-07-08T20:03:44.5124699Z 
2025-07-08T20:03:44.5124999Z 📱 Step 1: Loading application...
2025-07-08T20:03:44.5133484Z OK
2025-07-08T20:03:44.5133976Z 🎮 Step 2: Simulating first campaign creation...
2025-07-08T20:03:44.5134593Z 🚀 Step 3: Clicking 'Begin Adventure' to create first campaign...
2025-07-08T20:03:44.5135155Z ⏳ Step 4: Waiting for spinner to appear...
2025-07-08T20:03:44.5135529Z    Spinner visible: True
2025-07-08T20:03:44.5135992Z 📊 Step 5: Waiting for campaign creation to complete...
2025-07-08T20:03:44.5136407Z    Dashboard visible: True
2025-07-08T20:03:44.5136934Z 🎯 Step 6: Clicking 'Start Campaign' again (reproducing the bug)...
2025-07-08T20:03:44.5137656Z 🔍 Step 7: Checking what appears - fresh wizard or persistent spinner...
2025-07-08T20:03:44.5138237Z    ✅ Fresh wizard content present: True
2025-07-08T20:03:44.5138670Z    ✅ No persistent spinner found
2025-07-08T20:03:44.5139139Z 🔬 Step 8: Analyzing DOM state for debugging...
2025-07-08T20:03:44.5139551Z    Campaign wizard container contents:
2025-07-08T20:03:44.5139895Z    
2025-07-08T20:03:44.5140161Z                             <div class="wizard-content">
2025-07-08T20:03:44.5140595Z                                 <h3>Campaign Creation Wizard</h3>
2025-07-08T20:03:44.5141057Z                                 <div class="wizard-step">Step 1: Basic Detai...
2025-07-08T20:03:44.5141559Z 📋 Step 9: Test Results Summary
2025-07-08T20:03:44.5141901Z ==================================================
2025-07-08T20:03:44.5142475Z ✅ EXPECTED BEHAVIOR: Fresh wizard appears, no persistent spinner
2025-07-08T20:03:44.5142942Z Test Result: PASS
2025-07-08T20:03:44.5143391Z ==================================================
2025-07-08T20:03:44.5223802Z sys:1: ResourceWarning: unclosed <socket.socket fd=3, family=2, type=1, proto=0, laddr=('0.0.0.0', 8766)>
2025-07-08T20:03:44.5378581Z ✅ mvp_site/tests/wizard/test_campaign_wizard_reset_reproduction.py passed
2025-07-08T20:03:44.5379686Z ----------------------------------------
2025-07-08T20:03:44.5380113Z 
2025-07-08T20:03:44.5380253Z ========================================
2025-07-08T20:03:44.5380669Z TEST SUMMARY: 120/121 tests passed
2025-07-08T20:03:44.5385261Z ========================================
2025-07-08T20:03:44.5385556Z 
2025-07-08T20:03:44.5385809Z Failed tests:\n  - mvp_site/tests/test_debug_hybrid_system.py
2025-07-08T20:03:44.5386205Z 
2025-07-08T20:03:44.5386376Z Note: Some tests may fail in CI due to:
2025-07-08T20:03:44.5386670Z   - Missing local services (e.g., test server)
2025-07-08T20:03:44.5386945Z   - Test isolation issues
2025-07-08T20:03:44.5387193Z   - Timing-sensitive tests
2025-07-08T20:03:44.5398193Z ##[error]Process completed with exit code 1.
2025-07-08T20:03:44.5466886Z ##[group]Run actions/upload-artifact@v4
2025-07-08T20:03:44.5467179Z with:
2025-07-08T20:03:44.5467365Z   name: test-results
2025-07-08T20:03:44.5467672Z   path: mvp_site/test-results/
mvp_site/coverage.xml
mvp_site/*.log

2025-07-08T20:03:44.5468005Z   retention-days: 30
2025-07-08T20:03:44.5468209Z   if-no-files-found: warn
2025-07-08T20:03:44.5468419Z   compression-level: 6
2025-07-08T20:03:44.5468621Z   overwrite: false
2025-07-08T20:03:44.5468821Z   include-hidden-files: false
2025-07-08T20:03:44.5469032Z env:
2025-07-08T20:03:44.5469259Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:03:44.5469657Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib/pkgconfig
2025-07-08T20:03:44.5470063Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:03:44.5470408Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:03:44.5470759Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.13/x64
2025-07-08T20:03:44.5471136Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.13/x64/lib
2025-07-08T20:03:44.5471424Z ##[endgroup]
2025-07-08T20:03:44.7749034Z ##[warning]No files were found with the provided path: mvp_site/test-results/
mvp_site/coverage.xml
mvp_site/*.log. No artifacts will be uploaded.
2025-07-08T20:03:44.7906291Z Post job cleanup.
2025-07-08T20:03:44.8858997Z [command]/usr/bin/git version
2025-07-08T20:03:44.8909640Z git version 2.49.0
2025-07-08T20:03:44.8955561Z Temporarily overriding HOME='/home/runner/work/_temp/7787a597-053f-4b6b-a5cc-e93ff341ccc6' before making global git config changes
2025-07-08T20:03:44.8958784Z Adding repository directory to the temporary git global config as a safe directory
2025-07-08T20:03:44.8963662Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/worldarchitect.ai/worldarchitect.ai
2025-07-08T20:03:44.9001202Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-07-08T20:03:44.9035833Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-07-08T20:03:44.9278093Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-07-08T20:03:44.9303863Z http.https://github.com/.extraheader
2025-07-08T20:03:44.9318365Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2025-07-08T20:03:44.9352618Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-07-08T20:03:44.9838328Z Cleaning up orphan processes
